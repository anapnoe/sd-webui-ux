async function ys(e,t,n){const s=document.querySelector(n),i=`
        <button tabItemId="#split-app, #${e}_tabitem" 
                tabGroup="main_group" 
                data-click="#tabs" 
                onclick="mainTabs(this, '#${e}')" 
                class="xtabs-tab">
            <div class="icon-letters">${t.slice(0,2)}</div>
            <span>${t}</span>
        </button>`,o=document.createElement("div");o.innerHTML=i;const a=o.firstElementChild;s.append(a)}async function vs(e){const t=document.querySelector("#split-left"),n=`
        <div id="${e}_tabitem" class="xtabs-item other">
            <div data-parent-selector="gradio-app" data-selector="#${e} > div" class="portal"></div>
        </div>`,s=document.createElement("div");s.innerHTML=n;const i=s.firstElementChild;t.append(i)}async function Ss(){let e=["tab_txt2img","tab_img2img","tab_extras","tab_pnginfo","tab_train","tab_modelmerger","tab_settings","tab_extensions","tab_deforum_interface","tab_infinite-image-browsing","tab_anapnoe_dock","tab_anapnoe_sd_uiux_core","tab_space","tab_anapnoe_sd_uiux_civitai","tab_anapnoe_sd_uiux_db_extra_networks","tab_anapnoe_sd_uiux_db_styles","tab_anapnoe_sd_uiux_db_output_images"];const t=document.querySelectorAll("#tabs > .tabitem");for(const n of t){const s=n.id,i=s.split("tab_")[1];!e.includes(s)&&!s.startsWith("tab_ui_theme")&&await Promise.all([ys(s,i,"#other_extensions"),vs(s)])}}function ws(e,t){const n=document.querySelector(e);if(n){const s=i=>{t.forEach(o=>{const a=document.querySelector(`link[rel="stylesheet"][href*="${o}"]`);if(a){const c=a.cloneNode();i.appendChild(c)}})};n.contentDocument.readyState==="complete"?s(n.contentDocument.head):n.addEventListener("load",i=>{s(i.target.contentDocument.head)},{once:!0})}}function an(e,t,n){for(const s of e)if(!t.querySelector(`link[rel="stylesheet"][href*="${On}${s}"]`)){const o=document.createElement("link");o.rel="stylesheet",o.href=`${On}${s}`,o.onload=()=>{console.log(`Stylesheet ${s} loaded successfully.`)},o.onerror=()=>{console.error(`Error loading stylesheet ${s}.`)},n?t.insertBefore(o,n.nextSibling):t.appendChild(o)}}function Es(e){const t=document.body,n=t.querySelector('link[rel="stylesheet"][href*="sd-webui-ux"]');n?an(e,t,n):(an(e,t),console.warn("The sd-webui-ux/style.css is not found in the body."))}function xs(e,t,n){const i=Array.from(n.querySelectorAll(`link[rel="stylesheet"][href*="${e}"]`)).find(o=>o.href.includes("sd-webui-ux")&&o.href.includes(e));i?(an([t],n,i),i.parentNode.removeChild(i),console.log(`Removed existing stylesheet: ${e}`)):console.warn(`No existing stylesheet found: ${e}`)}const dn=window.basePath.includes("builtin"),un="anapnoe/stable-diffusion-webui-ux",Ts="AUTOMATIC1111/stable-diffusion-webui",Ls="#anapnoe_app",Cs="1.0.0",Xn=window.basePath,Dt=`${Xn}assets/`,On=`${Dt}css/`,Yn=`${Dt}templates/`,As=`${Yn}uiux-gradio-3/`,Is=`${Yn}forge-gradio-4/`,Zn={"template-deforum-params.html":"deforum","template-deforum-results.html":"deforum"},Ps=["uiux-icons.css","uiux-theme-editor.css","uiux-deforum.css","uiux-iibrowser.css","uiux-physton.css","uiux-virtual.css","uiux-tree.css"];let jt=null;const it=()=>(jt||(jt=document.querySelector(Ls)),jt);let Wt=null;const Kn=()=>(Wt||(Wt=document.getElementById("tab_anapnoe_sd_uiux_core")),Wt);let Gt=null;const Ge=()=>(Gt||(Gt=document.querySelector("gradio-app")),Gt);let Vt=null;const Jn=()=>(Vt||(Vt=document.getElementById("loggerUiUx")),Vt),Be={};let xt=null;const Ns=()=>{if(!xt){const e=Ge().querySelector(".versions");if(!e){console.error("Versions element not found");return}xt=e.innerHTML.replace(Ts,un).replace(/\n/g,"").split("• "),xt.forEach(i=>{const[o,a]=i.split(":").map(c=>c.trim());o&&a&&(Be[o]=a)});const n=Be.version.split(".")[0].includes("f")?"forge":"AUTOMATIC1111",s=parseInt(Be.gradio,10);Be.variant=n,Be.gradio_major=s}return xt};let Tt=null;const Qn=()=>(Tt||(Tt=As,Be.gradio_major>3&&Be.variant==="forge"&&(Tt=Is)),Tt),mn=[{value:"SD1",textContent:"SD1"},{value:"SD2",textContent:"SD2"},{value:"SD3",textContent:"SD3"},{value:"SDXL",textContent:"SDXL"},{value:"PONY",textContent:"PONY"},{value:"FLUX",textContent:"FLUX"},{value:"Unknown",textContent:"Unknown"}];let ft;async function Os(){(function(n){console.oldLog=console.log,console.oldWarn=console.warn,ft=function(s,i){return function(...o){const c=o.slice(0,10);let l="",u,m;for(l+=`
                <div class="log-row"><span class="log-date">${new Date().toLocaleString().replace(",","")}</span>`,m=0;m<c.length;m++){u=c[m];const v=u.toString().toLowerCase();let S="";v.indexOf("remove")!==-1||v.indexOf("error")!==-1?S+=" log-remove":v.indexOf("loading")!==-1||v.indexOf("| ref")!==-1||v.indexOf("initial")!==-1||v.indexOf("optimiz")!==-1||v.indexOf("python")!==-1||v.indexOf("success")!==-1?S+=" log-load":v.indexOf("[")!==-1&&(S+=" log-object"),u.toString().indexOf(".css")!==-1||u.toString().indexOf(".html")!==-1?S+=" log-url":u.toString().indexOf(`
`)!==-1&&(l+="<br />"),l+=`
                    <span class="log-${typeof u} ${S}">`,typeof u=="object"&&typeof JSON=="object"&&typeof JSON.stringify=="function"?l+=JSON.stringify(u):l+=u,l+=" </span>"}n.innerHTML+=l+"</div>",i.apply(void 0,c)}},console.log=ft("log",console.oldLog),console.warn=ft("warn",console.oldWarn)})(Jn()),console.log(`
`,"╔═╗╔═╦╦═╗╔═╦═╦╦═╦═╗",`
`,"║╬╚╣║║║╬╚╣╬║║║║╬║╩╣",`
`,"╚══╩╩═╩══╣╔╩╩═╩═╩═╝",`
`,"─────────╚╝"),console.log(`Initialize Anapnoe UI/UX runtime engine version ${Cs}`),console.log("UI/UX Backend Optimizations:",dn),console.log(navigator.userAgent),console.log(Ns()),console.log("Console log enabled: ",window.opts.uiux_enable_console_log),console.log("Dev Mode enabled: ",window.opts.uiux_enable_dev_mode),console.log("Theme editor enabled: ",window.opts.uiux_enable_theme_editor),console.log("Maximum resolution output: ",window.opts.uiux_max_resolution_output),console.log("Ignore overrides: ",window.opts.uiux_ignore_overrides),console.log("Show ticks for input range slider: ",window.opts.uiux_show_input_range_ticks),console.log("Default layout: ",window.opts.uiux_default_layout),console.log("Disable transitions: ",window.opts.uiux_disable_transitions),console.log("Aside labels: ",window.opts.uiux_show_labels_aside),console.log("Main labels: ",window.opts.uiux_show_labels_main),console.log("Tabs labels: ",window.opts.uiux_show_labels_tabs),console.log("Hide extra info for labels, checkboxes: ",window.opts.uiux_hide_extra_info),navigator.userAgent.toLowerCase().includes("firefox")&&console.log("Go to the Firefox about:config page, then search and toggle layout. css.has-selector. enabled"),window.opts.uiux_enable_console_log||(console.log=function(){});let t=document.querySelector("link[rel~='icon']");t||(t=document.createElement("link"),t.rel="icon",document.head.appendChild(t)),t.href=`${Dt}favicon.svg/`}function ks(e){e?(console.log=ft("log",console.oldLog),console.warn=ft("warn",console.oldWarn)):console.log=function(){}}async function Ms(e){const t=[];return e.querySelectorAll(".template:not([status])").forEach(n=>{const s={},i=n.getAttribute("url");s.url=i||Qn();const o=n.getAttribute("key");s.key=o||void 0;const a=n.getAttribute("template")||n.id;if(a)!dn&&a.includes("about")?s.template=`${a}-extension.html`:s.template=`${a}.html`;else{console.warn("Template not found on element:",n);return}s.id=n.id,s.extensionEnabled=$s(s.template),t.push(s)}),t}function $s(e){const t=Zn[e];return t?!!document.head.querySelector(`script[type="text/javascript"][src*="${t}"]`):!1}async function nt(e,t){const n=e[t],s=t<e.length;if(!n)return;let i;if(n.template in Zn&&!n.extensionEnabled){console.log(`Skipping loading for extension template ${n.template} (extension disabled)`),await nt(e,t+1);return}if(s){if(n!=null&&n.parent?i=n.parent:n!=null&&n.id&&(i=document.querySelector(`#${n.id}`)),i){const a=`${n.url}${n.template}`;try{const c=await fetch(a);if(c.ok){const l=await c.text(),u=document.createElement("div");if(n.key){const v=l.replace(/\s*\{\{.*?\}\}\s*/g,n.key);u.innerHTML=v}else u.innerHTML=l;const m=await Ms(u);m.length>0&&(e=e.concat(m)),console.log("Template loaded",a),i.setAttribute("status","true"),i.append(u.firstElementChild),await nt(e,t+1)}else c.status===404&&(console.error("404 template:",a),i.setAttribute("status","error"),await nt(e,t+1))}catch(c){console.error("Error loading template:",c),i.setAttribute("status","error"),await nt(e,t+1)}}}else console.log("Template files merged successfully")}async function Rs(){console.log("Loading Templates",Be.gradio);const e=[{url:Qn(),template:"template-app-root.html",parent:Kn()}];await nt(e,0)}function je(e){if(e){const t=new Event("input",{bubbles:!0,cancelable:!0});e.dispatchEvent(t)}}function Ds(e){if(e){const t=new Event("change",{bubbles:!0,cancelable:!0});e.dispatchEvent(t)}}function zs(){const e=it();e.addEventListener("animationend",t=>{t.animationName==="fade-out"&&t.target.classList.add("hidden")}),e.addEventListener("animationstart",t=>{const n=e.classList.contains("notransition");t.animationName==="fade-out"?n&&t.target.classList.add("hidden"):t.animationName==="fade-in"&&t.target.classList.remove("hidden")})}const Ot=new WeakMap;function es(e){if(!(e instanceof Element))return 0;let t=0;const n=Ot.get(e);if(n)for(const s in n)t+=n[s].size;for(const s of e.children)t+=es(s);return t}(function(){const e=EventTarget.prototype.addEventListener,t=EventTarget.prototype.removeEventListener;EventTarget.prototype.addEventListener=function(n,s,i){typeof i>"u"&&(i=!1);const o=Ot.get(this)||{};o[n]||(o[n]=new Set),o[n].add(s),Ot.set(this,o),e.call(this,n,s,i)},EventTarget.prototype.removeEventListener=function(n,s,i){const o=Ot.get(this);o&&o[n]&&(o[n].delete(s),o[n].size===0&&delete o[n]),t.call(this,n,s,i)},window.countEventListeners=es})();function st(e,t){const n=document.querySelector(`#pnginfo_send_buttons ${t}`),s=document.querySelector('#pnginfo_image input[type="file"]'),i=new DataTransfer;s.files=i.files,fetch(e).then(o=>o.blob()).then(o=>{const a=new File([o],"image.jpg",{type:o.type}),c=new DataTransfer;c.items.add(a),s.files=c.files,Ds(s),setTimeout(()=>{n.click()},1e3)}).catch(o=>console.error("Error fetching image:",o))}const Ce=typeof window<"u"?window:null,pn=Ce===null,gt=pn?void 0:Ce.document,Ie="addEventListener",Pe="removeEventListener",Xt="getBoundingClientRect",rt="_a",Ne="_b",He="_c",Lt="horizontal",Oe=()=>!1,Fs=pn?"calc":`${["","-webkit-","-moz-","-o-"].filter(e=>{const t=gt.createElement("div");return t.style.cssText=`width:${e}calc(9px)`,!!t.style.length}).shift()}calc`,ts=e=>typeof e=="string"||e instanceof String,kn=e=>{if(ts(e)){const t=gt.querySelector(e);if(!t)throw new Error(`Selector ${e} did not match a DOM element`);return t}return e},ge=(e,t,n)=>{const s=e[t];return s!==void 0?s:n},Ct=(e,t,n,s)=>{if(t){if(s==="end")return 0;if(s==="center")return e/2}else if(n){if(s==="start")return 0;if(s==="center")return e/2}return e},Us=(e,t)=>{const n=gt.createElement("div");return n.className=`gutter gutter-${t}`,n},qs=(e,t,n)=>{const s={};return ts(t)?s[e]=t:s[e]=`${Fs}(${t}% - ${n}px)`,s},Hs=(e,t)=>({[e]:`${t}px`}),Bs=(e,t={})=>{if(pn)return{};let n=e,s,i,o,a,c,l;Array.from&&(n=Array.from(n));const m=kn(n[0]).parentNode,v=getComputedStyle?getComputedStyle(m):null,S=v?v.flexDirection:null;let I=ge(t,"sizes")||n.map(()=>100/n.length);const T=ge(t,"minSize",100),q=Array.isArray(T)?T:n.map(()=>T),A=ge(t,"maxSize",1/0),w=Array.isArray(A)?A:n.map(()=>A),f=ge(t,"expandToMin",!1),b=ge(t,"gutterSize",10),L=ge(t,"gutterAlign","center"),_=ge(t,"snapOffset",30),R=Array.isArray(_)?_:n.map(()=>_),X=ge(t,"dragInterval",1),p=ge(t,"direction",Lt),d=ge(t,"cursor",p===Lt?"col-resize":"row-resize"),h=ge(t,"gutter",Us),y=ge(t,"elementStyle",qs),E=ge(t,"gutterStyle",Hs);p===Lt?(s="width",i="clientX",o="left",a="right",c="clientWidth"):p==="vertical"&&(s="height",i="clientY",o="top",a="bottom",c="clientHeight");function $(P,g,C,O){const U=y(s,g,C,O);Object.keys(U).forEach(ee=>{P.style[ee]=U[ee]})}function M(P,g,C){const O=E(s,g,C);Object.keys(O).forEach(U=>{P.style[U]=O[U]})}function W(){return l.map(P=>P.size)}function Z(P){return"touches"in P?P.touches[0][i]:P[i]}function te(P){const g=l[this.a],C=l[this.b],O=g.size+C.size;g.size=P/this.size*O,C.size=O-P/this.size*O,$(g.element,g.size,this[Ne],g.i),$(C.element,C.size,this[He],C.i)}function le(P){let g;const C=l[this.a],O=l[this.b];this.dragging&&(g=Z(P)-this.start+(this[Ne]-this.dragOffset),X>1&&(g=Math.round(g/X)*X),g<=C.minSize+C.snapOffset+this[Ne]?g=C.minSize+this[Ne]:g>=this.size-(O.minSize+O.snapOffset+this[He])&&(g=this.size-(O.minSize+this[He])),g>=C.maxSize-C.snapOffset+this[Ne]?g=C.maxSize+this[Ne]:g<=this.size-(O.maxSize-O.snapOffset+this[He])&&(g=this.size-(O.maxSize+this[He])),te.call(this,g),ge(t,"onDrag",Oe)(W()))}function ne(){const P=l[this.a].element,g=l[this.b].element,C=P[Xt](),O=g[Xt]();this.size=C[s]+O[s]+this[Ne]+this[He],this.start=C[o],this.end=C[a]}function ae(P){if(!getComputedStyle)return null;const g=getComputedStyle(P);if(!g)return null;let C=P[c];return C===0?null:(p===Lt?C-=parseFloat(g.paddingLeft)+parseFloat(g.paddingRight):C-=parseFloat(g.paddingTop)+parseFloat(g.paddingBottom),C)}function z(P){const g=ae(m);if(g===null||q.reduce((ee,J)=>ee+J,0)>g)return P;let C=0;const O=[],U=P.map((ee,J)=>{const ce=g*ee/100,F=Ct(b,J===0,J===P.length-1,L),Y=q[J]+F;return ce<Y?(C+=Y-ce,O.push(0),Y):(O.push(ce-Y),ce)});return C===0?P:U.map((ee,J)=>{let ce=ee;if(C>0&&O[J]-C>0){const F=Math.min(C,O[J]-C);C-=F,ce=ee-F}return ce/g*100})}function K(){const P=this,g=l[P.a].element,C=l[P.b].element;P.dragging&&ge(t,"onDragEnd",Oe)(W()),P.dragging=!1,Ce[Pe]("mouseup",P.stop),Ce[Pe]("touchend",P.stop),Ce[Pe]("touchcancel",P.stop),Ce[Pe]("mousemove",P.move),Ce[Pe]("touchmove",P.move),P.stop=null,P.move=null,g[Pe]("selectstart",Oe),g[Pe]("dragstart",Oe),C[Pe]("selectstart",Oe),C[Pe]("dragstart",Oe),g.style.userSelect="",g.style.webkitUserSelect="",g.style.MozUserSelect="",g.style.pointerEvents="",C.style.userSelect="",C.style.webkitUserSelect="",C.style.MozUserSelect="",C.style.pointerEvents="",P.gutter.style.cursor="",P.parent.style.cursor="",gt.body.style.cursor=""}function Q(P){if("button"in P&&P.button!==0)return;const g=this,C=l[g.a].element,O=l[g.b].element;g.dragging||ge(t,"onDragStart",Oe)(W()),P.preventDefault(),g.dragging=!0,g.move=le.bind(g),g.stop=K.bind(g),Ce[Ie]("mouseup",g.stop),Ce[Ie]("touchend",g.stop),Ce[Ie]("touchcancel",g.stop),Ce[Ie]("mousemove",g.move),Ce[Ie]("touchmove",g.move),C[Ie]("selectstart",Oe),C[Ie]("dragstart",Oe),O[Ie]("selectstart",Oe),O[Ie]("dragstart",Oe),C.style.userSelect="none",C.style.webkitUserSelect="none",C.style.MozUserSelect="none",C.style.pointerEvents="none",O.style.userSelect="none",O.style.webkitUserSelect="none",O.style.MozUserSelect="none",O.style.pointerEvents="none",g.gutter.style.cursor=d,g.parent.style.cursor=d,gt.body.style.cursor=d,ne.call(g),g.dragOffset=Z(P)-g.end}I=z(I);const se=[];l=n.map((P,g)=>{const C={element:kn(P),size:I[g],minSize:q[g],maxSize:w[g],snapOffset:R[g],i:g};let O;if(g>0&&(O={a:g-1,b:g,dragging:!1,direction:p,parent:m},O[Ne]=Ct(b,g-1===0,!1,L),O[He]=Ct(b,!1,g===n.length-1,L),S==="row-reverse"||S==="column-reverse")){const U=O.a;O.a=O.b,O.b=U}if(g>0){const U=h(g,p,C.element);M(U,b,g),O[rt]=Q.bind(O),U[Ie]("mousedown",O[rt]),U[Ie]("touchstart",O[rt]),m.insertBefore(U,C.element),O.gutter=U}return $(C.element,C.size,Ct(b,g===0,g===n.length-1,L),g),g>0&&se.push(O),C});function j(P){const g=P.i===se.length,C=g?se[P.i-1]:se[P.i];ne.call(C);const O=g?C.size-P.minSize-C[He]:P.minSize+C[Ne];te.call(C,O)}l.forEach(P=>{const g=P.element[Xt]()[s];g<P.minSize&&(f?j(P):P.minSize=g)});function pe(P){const g=z(P);g.forEach((C,O)=>{if(O>0){const U=se[O-1],ee=l[U.a],J=l[U.b];ee.size=g[O-1],J.size=C,$(ee.element,ee.size,U[Ne],ee.i),$(J.element,J.size,U[He],J.i)}})}function be(P,g){se.forEach(C=>{if(g!==!0?C.parent.removeChild(C.gutter):(C.gutter[Pe]("mousedown",C[rt]),C.gutter[Pe]("touchstart",C[rt])),P!==!0){const O=y(s,C.a.size,C[Ne]);Object.keys(O).forEach(U=>{l[C.a].element.style[U]="",l[C.b].element.style[U]=""})}})}return{setSizes:pe,getSizes:W,collapse(P){j(l[P])},destroy:be,parent:m,pairs:se}};class ht{constructor(){return ht.instance||(this.splitInstances={},ht.instance=this),ht.instance}set(t){Object.assign(this.splitInstances,t)}get(){return this.splitInstances}}const fn=new ht;Object.freeze(fn);function js(e){fn.set(e)}function Ws(){return fn.get()}async function Gs(e){const t=[];await Promise.all(Array.from(e.querySelectorAll("div.split")).map(async n=>{const s=n.id,i=e.querySelector(`#${s}`),o=(i==null?void 0:i.getAttribute("direction"))==="vertical"?"vertical":"horizontal",a=(i==null?void 0:i.getAttribute("gutterSize"))||"8",c=e.querySelectorAll(`#${s} > div.split-container`),l=Array.from(c).map(S=>{const I=S.getAttribute("data-initSize")?parseInt(S.getAttribute("data-initSize")):100/c.length,T=S.getAttribute("data-minSize")?parseInt(S.getAttribute("data-minSize")):1/0;return{id:`#${S.id}`,initSize:I,minSize:T}}),u=l.map(S=>S.id),m=l.map(S=>S.initSize),v=l.map(S=>S.minSize);console.log("Split component",u,m,v,o,a),t[s]=Bs(u,{sizes:m,minSize:v,direction:o,gutterSize:parseInt(a),snapOffset:0,dragInterval:1,elementStyle:(S,I,T)=>({"flex-basis":`calc(${I}% - ${T}px)`}),gutterStyle:(S,I)=>({"flex-basis":`${I}px`,"min-width":`${I}px`,"min-height":`${I}px`})})})),js(t)}const $t={setItem:function(e,t){localStorage.setItem(e,t),this.notifyChange(e,t)},getItem:function(e){return localStorage.getItem(e)},removeItem:function(e){localStorage.removeItem(e),this.notifyChange(e,null)},notifyChange:function(e,t){const n=new CustomEvent("localStorageChange",{detail:{key:e,value:t}});window.dispatchEvent(n)}};function Vs(e,t){const n=$t.getItem(t);e(t,n);const s=i=>{e(i.detail.key,i.detail.value)};return window.addEventListener("localStorageChange",s),()=>{window.removeEventListener("localStorageChange",s)}}let Yt=0;function Xs(e,t){const n=e.querySelectorAll("td:last-child"),s=document.createElement("style");let i=1,o="";n.forEach((a,c)=>{const l=parseFloat(a.textContent.trim());if(a.id=`td_${c}`,!isNaN(l)){let u;c===0?(i=l,u=100):u=l/i*100,o+=`#td_${c}::before { min-width: ${u}%; }`}}),s.textContent=o,t.appendChild(s)}function Ys(e,t){e.querySelectorAll(`${t}, style`).forEach(s=>{e.removeChild(s)})}function Zs(e,t){const n=e.getAttribute("append-index");Array.from(e.children).forEach(i=>{if(i!==t)if(t.className.includes("gradio-accordion"))if(n){const o=parseInt(n,10);let a=t.children[2].children[o];t.children[2].insertBefore(i,a)}else t.children[2].append(i);else t.append(i)})}async function hn(e,t,n=0,s,i,o=!1){var m;const a=e.getAttribute("data-selector"),c=e.getAttribute("data-parent-selector");let l;if(n%2===0?l=document.querySelector(`${c} ${a}`):l=t.querySelector(`${a}`),l&&e){e.classList.contains("dynamic")&&(Ys(e,a),a.includes("popup-table")&&Xs(l,e)),e.append(l),o&&Yt++,console.log("register | Ref",s,c,a),e.getAttribute("droppable")&&Zs(e,l);const S=e.getAttribute("show-button");S&&((m=document.querySelector(S))==null||m.classList.remove("hidden"))}else if(n<2){const v=e.getAttribute("data-timeout"),S=v?parseInt(v):500;await new Promise(I=>setTimeout(I,S)),console.log(n+1,"retry | ",S," | Ref",s,c,a),await hn(e,t,n+1,s,i,o)}else e.classList.contains("dynamic")?console.error("error | Ref",s,c,a):console.warn("dynamic | Ref",s,c,a),o&&Yt++;Yt===i&&o&&$t.getItem("UiUxReady")==="false"&&(console.log("Runtime components initialized"),$t.setItem("UiUxReady","true"))}async function Ks(e){await Promise.all(Array.from(e.querySelectorAll(".portal:not(.dynamic)")).map(async(t,n,s)=>{hn(t,e,0,n,s.length,!0)}))}async function Js(e){const t=it();await Promise.all(Array.from(e.querySelectorAll(".xtabs-tab")).map(async s=>{if(s.addEventListener("click",()=>{const o=s.parentElement,a=s.getAttribute("tabGroup");s.getAttribute("data-click");const c=s.getAttribute("toggle"),l=s.classList.contains("active");function u(m){m.classList.remove("active");const v=m.getAttribute("tabItemId");t.querySelectorAll(v).forEach(S=>{S.classList.remove("fade-in"),S.classList.add("fade-out")})}if((!c||c&&l)&&(a?t.querySelectorAll(`[tabGroup="${a}"]`).forEach(m=>{m.classList.contains("active")&&u(m)}):o&&[].slice.call(o.children).forEach(v=>{v.classList.contains("active")&&u(v)})),!c||c&&!l){const m=s.getAttribute("tabItemId");t.querySelectorAll(m).forEach(v=>{v.classList.remove("fade-out"),v.classList.add("fade-in"),v.querySelectorAll(".portal.dynamic").forEach((S,I,T)=>{hn(S,document,0,I,T.length)})}),s.classList.add("active"),n(s)}}),!s.getAttribute("active")){const o=s.getAttribute("tabItemId");t.querySelectorAll(o).forEach(a=>{a.classList.remove("fade-in"),a.classList.add("fade-out")})}})),await Promise.all(Array.from(e.querySelectorAll(".xtabs-tab[active]")).map(async s=>{s.classList.add("active");const i=s.getAttribute("tabItemId");s.getAttribute("data-click"),t.querySelectorAll(i).forEach(o=>{o.classList.remove("fade-out"),o.classList.add("fade-in")}),n(s)}));function n(s,i,o){const a=s.closest(".accordion-bar");if(a){const c=a.parentElement;if(c.className.indexOf("expand")===-1){let l=a;const u=c.getAttribute("iconTrigger");if(u){const m=e.querySelector(u);m&&(l=m)}l.click()}}}}const Mn={DEFAULT_PATH:Xn,FOCUS_PROMPT:"txt2img",loadCurrentTemplate:nt,initUiUxComponents:ns};async function Qs(){document.head.querySelectorAll(`
        [rel="stylesheet"][href*="/assets/"],
        [rel="stylesheet"][href*="theme.css"],
        [rel="stylesheet"][href*="index"]`).forEach(s=>{s.remove(),console.log("Remove stylesheet",s.getAttribute("href"))}),document.body.querySelectorAll(`
        [rel="stylesheet"][href*="file=style.css"]`).forEach(s=>{s.remove(),console.log("Remove stylesheet",s.getAttribute("href"))});const e=document.querySelectorAll('.styler, [class*="svelte"]:not(input)'),t=e.length;let n=0;e.forEach(s=>{s.style.display!=="none"&&s.style.display!=="block"&&(s.removeAttribute("style"),n++),[...s.classList].filter(i=>i.match(/^svelte.*/)).forEach(i=>s.classList.remove(i))}),console.log("Remove inline styles from DOM","Total Selectors:",t,"Removed Selectors:",n)}async function ei(){var e,t,n,s,i,o,a,c;if(!dn){const l=Ge();console.log("Remove Extra Networks Instances"),(e=l.querySelector("#img2img_textual_inversion_cards_html"))==null||e.remove(),(t=l.querySelector("#img2img_checkpoints_cards_html"))==null||t.remove(),(n=l.querySelector("#img2img_hypernetworks_cards_html"))==null||n.remove(),(s=l.querySelector("#img2img_lora_cards_html"))==null||s.remove(),(i=l.querySelector("#txt2img_textual_inversion_cards_html"))==null||i.remove(),(o=l.querySelector("#txt2img_checkpoints_cards_html"))==null||o.remove(),(a=l.querySelector("#txt2img_hypernetworks_cards_html"))==null||a.remove(),(c=l.querySelector("#txt2img_lora_cards_html"))==null||c.remove(),console.log("Remove element #img2img_textual_inversion_cards_html"),console.log("Remove element #img2img_checkpoints_cards_html"),console.log("Remove element #img2img_hypernetworks_cards_html"),console.log("Remove element #img2img_lora_cards_html"),console.log("Remove element #txt2img_textual_inversion_cards_html"),console.log("Remove element #txt2img_checkpoints_cards_html"),console.log("Remove element #txt2img_hypernetworks_cards_html"),console.log("Remove element #txt2img_lora_cards_html")}}async function ti(e){await Promise.all(Array.from(e.querySelectorAll(".ae-button")).map(async t=>{const n=t.getAttribute("toggle"),s=t.getAttribute("active"),i=t.querySelector("input");i&&(i.checked===!0&&!s||i.checked===!1&&s)&&i.click(),s?t.classList.add("active"):t.classList.remove("active"),n&&t.addEventListener("click",o=>{const a=t.querySelector("input");a?(a.click(),a.checked===!0?t.classList.add("active"):a.checked===!1&&t.classList.remove("active")):t.classList.toggle("active")})}))}async function ni(e){const t=Ws();await Promise.all(Array.from(e.querySelectorAll(".accordion-bar")).map(async n=>{const s=n.parentElement,i=s.closest(".split-container");let o=n;const a=s.getAttribute("iconTrigger");if(a){const c=e.querySelector(a);c&&(o=c,n.classList.add("pointer-events-none"))}if(s.className.indexOf("accordion-vertical")!==-1&&i.className.indexOf("split")!==-1){s.classList.add("expand");const c=i.parentElement.id,l=t[c];i.setAttribute("data-sizes",JSON.stringify(l.getSizes())),o==null||o.addEventListener("click",()=>{if(s.classList.toggle("expand"),i.className.indexOf("v-expand")!==-1)i.classList.remove("v-expand"),l.setSizes(JSON.parse(i.getAttribute("data-sizes")));else{i.classList.add("v-expand");let u=l.getSizes();i.setAttribute("data-sizes",JSON.stringify(u)),console.log(u),u[u.length-1]=0,u[u.length-2]=100;const m=parseFloat(window.getComputedStyle(n,null).getPropertyValue("padding-left"))*2;i.style.minWidth=n.offsetWidth+m+"px",l.setSizes(u)}})}else o==null||o.addEventListener("click",()=>{s.classList.toggle("expand")})}))}async function ns(e){var n;await Gs(e),await Ks(e),await ni(e),await Js(e),await ti(e),document.querySelector("#container-console-log").append(Jn()),(n=document.querySelector("#logger_screen"))==null||n.remove()}async function si(e=un,t=1){return await(await fetch(`https://api.github.com/repos/${e}/contributors?per_page=100&page=${t}`,{method:"GET",headers:{"Content-Type":"application/json"}})).json()}async function ss(e=un,t=1,n=[]){const s=await si(e,t);return n=n.concat(s),s.length===100?ss(e,t+1,n):n}function ii(){const e=document.querySelector("#contributors"),t=document.querySelector("#contributors_tabitem"),n=document.createElement("div");n.id="contributors_grid",n.innerHTML=`Kindly allow us a moment to retrieve the contributors. 
    We're grateful for the many individuals who have generously put their time and effort to make this possible.`,t.append(n),e.addEventListener("click",s=>{e.getAttribute("data-visited")||(e.setAttribute("data-visited","true"),ss().then(o=>{n.innerHTML="";for(let a=0;a<o.length;a++){const c=o[a].login,l=o[a].html_url,u=o[a].avatar_url;n.innerHTML+=`
                        <a href="${l}" target="_blank" rel="noopener noreferrer nofollow" class="contributor-button flexbox col">
                            <figure><img src="${u}" lazy="true"></figure>
                            <div class="contributor-name">
                                ${c}
                            </div>
                        </a>`}}))})}async function is(e,t){try{const n=await fetch(e);if(!n.ok)throw new Error(`HTTP error! Status: ${n.status}`);const s=await n.json();t(s)}catch(n){console.error("Failed to fetch metadata:",n)}}async function ze(e,t,n){try{const s=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw new Error(`HTTP error! Status: ${s.status}`);const i=await s.json();n(i)}catch(s){console.error("Failed to fetch data:",s)}}const $n=()=>window.innerWidth<=768,At=e=>{var n;const t=it();t.querySelectorAll("[mobile]").forEach(s=>{if(e){if(s.childElementCount===0){const i=s.getAttribute("mobile");if(i){const o=t.querySelector(i);o&&(s.setAttribute("mobile-restore",`#${o.parentElement.id}`),s.append(o))}}}else if(s.childElementCount>0){const i=s.getAttribute("mobile-restore");if(i){const o=t.querySelector(i);o&&o.append(s.firstElementChild)}}}),e?((n=t.querySelector(".accordion-vertical.expand #mask-icon-acc-arrow"))==null||n.click(),t.classList.add("default-mobile")):t.classList.remove("default-mobile")},oi=()=>{const e=it(),t=window.opts.uiux_default_layout;e.classList.add(`default-${t.toLowerCase()}`),t==="Auto"?(window.addEventListener("resize",n=>{At($n())}),At($n())):At(t==="Mobile")};function ai(){const e=it(),t=Ge();if(!e||!t){console.warn(`Required elements not found: ${e?"":"anapnoeApp"} ${t?"":"gradioApp"}`);return}t.querySelector("#setting_uiux_mobile_scale input[type=range]").classList.add("hidden");const s=t.querySelector("#setting_uiux_mobile_scale input[type=number]");function i(f){document.head.querySelector('meta[name="viewport"]').setAttribute("content",`width=device-width, initial-scale=1, shrink-to-fit=no, maximum-scale=${f}`)}s.addEventListener("change",f=>{s.value=f.target.value,je(s),i(f.target.value)}),i(window.opts.uiux_mobile_scale);function o(f){t.querySelectorAll('[id$="2img_width"] input,[id$="2img_height"] input').forEach(b=>{b.max=f})}t.querySelector("#setting_uiux_max_resolution_output").addEventListener("input",f=>{let b=parseInt(f.target.value);b=Math.min(Math.max(b,512),16384),o(b)}),o(window.opts.uiux_max_resolution_output);function a(f){f.forEach(b=>{const L=b.step/(b.max-b.min)*100,_=`max(3px, calc(${L}% - 1px))`,R=`max(4px, calc(${L}% + 0px))`;b.style.setProperty("--ae-slider-bg-overlay",`repeating-linear-gradient(90deg, transparent, transparent ${_}, var(--ae-input-border-color) ${_}, var(--ae-input-border-color) ${R})`)})}function c(f,b){const _=t.querySelectorAll("input[type='range']");f?a(_):b&&_.forEach(R=>{R.style.setProperty("--ae-slider-bg-overlay","transparent")})}t.querySelector("#setting_uiux_show_input_range_ticks input").addEventListener("click",f=>{c(f.target.checked,!0)}),c(window.opts.uiux_show_input_range_ticks);function u(){const f=Array.from(t.querySelectorAll("#setting_uiux_ignore_overrides input:checked")).map(L=>L.nextElementSibling.innerHTML);t.querySelectorAll("[id$='2img_override_settings'] .token").forEach(L=>{var X;const[_,R]=L.querySelector("span").textContent.split(":").map(p=>p.trim());f.includes(_)&&(t.querySelector("[id$='2img_override_settings']").classList.add("show"),(X=L.querySelector(".token-remove"))==null||X.click())})}t.querySelector("#setting_uiux_ignore_overrides").addEventListener("click",()=>{setTimeout(u,100)});const m=new MutationObserver(f=>{f.forEach(b=>{b.type==="attributes"&&b.attributeName==="class"&&setTimeout(u,1e3)})}),v=new MutationObserver(f=>{f.forEach(b=>{b.addedNodes.length&&setTimeout(u,1e3)})});document.querySelectorAll("#txt2img_override_settings .wrap-inner, #img2img_override_settings .wrap_inner").forEach(f=>v.observe(f,{childList:!0})),document.querySelectorAll("#txt2img_nav, #img2img_nav").forEach(f=>m.observe(f,{attributes:!0}));function T(f,b){const L=t.querySelector(`${f} input`);if(L){const _=f.split("#setting_")[1],R=window.opts[_];e.classList.toggle(b,R),localStorage.setItem(_,R),L.addEventListener("click",X=>{localStorage.setItem(_,X.target.checked),e.classList.toggle(b,X.target.checked),_==="uiux_enable_console_log"&&ks(X.target.checked)})}}const q=[{key:"#setting_uiux_no_slider_layout",className:"no-slider-layout"},{key:"#setting_uiux_show_labels_aside",className:"aside-labels"},{key:"#setting_uiux_show_labels_main",className:"main-labels"},{key:"#setting_uiux_show_labels_tabs",className:"tab-labels"},{key:"#setting_uiux_hide_extra_info",className:"no-extra-info"},{key:"#setting_uiux_disable_transitions",className:"notransition"},{key:"#setting_uiux_enable_console_log",className:"debug-log"}];for(const{key:f,className:b}of q)T(f,b);function A(f,b){e.style.setProperty(f,b)}const w=["#setting_uiux_exnet_fit_size","#setting_uiux_exnet_aspect_ratio_x","#setting_uiux_exnet_aspect_ratio_y","#setting_uiux_exnet_header_size","#setting_uiux_min_wrap_size","#setting_uiux_exnet_image_tint"];for(const f of w){const b=document.querySelector(`${f} input[type=number]`),L=document.querySelector(`${f} input[type=range]`);if(L&&L.classList.add("hidden"),b){const _=f.split("#setting_")[1],R=`--ae-${_}`,X=window.opts[_];A(R,X),b.addEventListener("change",p=>{je(b),A(R,p.target.value)})}}}function ri(){["#txt2img","#img2img","#deforum"].forEach(t=>{var s;const n=document.querySelector(`${t}_generate`);if(n){(s=document.querySelector(`${t}_nav`))==null||s.classList.remove("hidden");const i=document.querySelector(`${t}_interrupt`),o=i.closest(".portal"),a=n.closest(".ae-button"),c=document.querySelector(`${t}_skip`).closest(".portal"),l=document.querySelector(`${t}_loop`);i.addEventListener("click",()=>{l==null||l.classList.add("stop")}),new MutationObserver(m=>{m.forEach(v=>{i.style.display==="none"?(document.querySelector(".progressDiv .progress")&&(o.classList.remove("disable"),setTimeout(()=>i.click(),500)),l?l.className.indexOf("stop")!==-1||l.className.indexOf("active")===-1?(l.classList.remove("stop"),o.classList.add("disable"),c==null||c.classList.add("disable"),a.classList.remove("active")):l.className.indexOf("active")!==-1&&n.click():(o.classList.add("disable"),a.classList.remove("active"))):(o.classList.remove("disable"),c==null||c.classList.remove("disable"),a.classList.add("active"))})}).observe(i,{attributes:!0,attributeFilter:["style"]})}})}function li(e,t){const n=document.querySelector("#setting_sd_model_checkpoint .wrap .secondary-wrap input")||document.querySelector(".gradio-dropdown.model_selection .wrap .secondary-wrap input"),s=document.querySelector("#setting_sd_model_checkpoint .wrap")||document.querySelector(".gradio-dropdown.model_selection .wrap"),i=document.querySelector("#checkpoints_main_footer_db .model-selected");document.querySelector("#checkpoints_main_footer_db .model-preloader").append(s);let a="";const c=u=>{if(a!==u){const m=u.split(".").slice(0,-1).join();e.selected=t.selected=new Set([m]),e.renderItems(),t.updateSelectedItems(),i.textContent=u,console.log("Checkpoint:",u,m),a=u}};c(n.value);const l=new MutationObserver(function(u){u.forEach(function(m){setTimeout(()=>c(n.value),1e3)})});l.observe(n,{attributes:!0}),l.observe(s,{childList:!0,subtree:!0})}function bt(e,t,n,s=null){return Object.keys(e).forEach(i=>{const o=document.querySelector(`${i}`);if(o){const a=e[i],c=o.tagName==="SELECT"&&o.multiple||o.tagName==="SELECT"||o.type==="checkbox"||o.type==="radio"||o.type!=="range"&&o.type!=="color"&&o.type!=="text"?"change":"input",l=()=>{let u;o.tagName==="SELECT"&&o.multiple?(u=Array.from(o.selectedOptions).map(v=>v.value),t[a]=u):o.type==="checkbox"||o.type==="radio"?u=o.checked:u=o.value;const m=s?s({[a]:u}):{[a]:u};n.updateParamsAndFetch(m,1e3)};o.addEventListener(c,l)}else console.warn(`Input element with id ${i} not found.`)}),t}function Rn(e){let t=e.startsWith("#")?e.slice(1):e,n=1;if(t.length===8?(n=parseInt(t.slice(6,8),16)/255,t=t.slice(0,6)):t.length===3&&(t=t.split("").map(i=>i+i).join("")),t.length!==6)throw new Error("Invalid HEX color.");const s=t.match(/.{2}/g).map(i=>parseInt(i,16));return s.push(n),s}function kt(e){const t=e[0]/255,n=e[1]/255,s=e[2]/255,i=Math.max(t,n,s),o=Math.min(t,n,s),a=i-o,c=i+o,l=o===i?0:t===i?(60*(n-s)/a+360)%360:n===i?60*(s-t)/a+120:60*(t-n)/a+240,u=.5*c,m=u===0?0:u===1?1:u<=.5?a/c:a/(2-c),v=e.length===4?e[3]:1;return[Math.round(l),Math.round(m*100),Math.round(u*100),v]}function rn(e,t,n,s=1){n/=100;const i=(s*255|256).toString(16).slice(1),o=a=>{const c=(a+e/30)%12,l=n-t*Math.min(n,1-n)/100*Math.max(Math.min(c-3,9-c,1),-1);return Math.round(255*Math.max(0,Math.min(l,1))).toString(16).padStart(2,"0")};return`#${o(0)}${o(8)}${o(4)}${i}`}function Dn(e){e.startsWith("#")&&(e=e.slice(1));let t=1;if(e.length===8&&(t=parseInt(e.slice(6,8),16)/255,e=e.slice(0,6)),e.length===3&&(e=e.split("").map(o=>o+o).join("")),e.length!==6)throw new Error("Invalid HEX color.");const n=(255-parseInt(e.slice(0,2),16)).toString(16),s=(255-parseInt(e.slice(2,4),16)).toString(16),i=(255-parseInt(e.slice(4,6),16)).toString(16);return`#${It(n)}${It(s)}${It(i)}${It(Math.round(t*255).toString(16))}`}function It(e,t=2){return(new Array(t).join("0")+e).slice(-t)}const Te={};let _t,lt=[0,0,0,0];const Rt=e=>e.match(/[\d.]+/g).map(Number);function ci(e,t,n,s){let i;if(n.includes("#")){let m=n.replace(/\s+/g,"");_t&&(m=Dn(m),Te[t]=m),i=kt(Rn(m))}else if((n.includes("hsl")||n.includes("rgb"))&&(i=n.includes("rgb")?kt(Rt(n)):Rt(n),_t)){const m=rn(i[0],i[1],i[2],i[3]);Te[t]=Dn(m),i=kt(Rn(Te[t]))}const o=((Number(i[0])||0)+(Number(s[0])||0))%360,a=Math.min(Math.max((Number(i[1])||0)+(Number(s[1])||0),0),100),c=Math.min(Math.max((Number(i[2])||0)+(Number(s[2])||0),0),100),l=Math.min(Math.max((Number(i[3])||1)+(Number(s[3])||0),0),1),u=rn(o,a,c,l).slice(0,-2);return e.value=u,`hsla(${o}, ${a}%, ${c}%, ${l})`}function Zt(e){let t="";for(const i in Te){const o=Te[i];if(i!=""&&o&&o.length>0){const a=document.body.querySelector(`#${i} input`)||document.body.querySelector(`#${i} textarea`);if(a)if((a.type||"text")==="color"){const l=ci(a,i,o,e);t+=`${i}:${l};`}else t+=`${i}:${Te[i]};`}}_t=!1;const n=document.body.querySelector("#preview-styles");n.innerHTML=`:root {${t}}`,n.innerHTML+="@media only screen and (max-width: 860px) { :root { --ae-outside-gap-size: var(--ae-mobile-outside-gap-size); --ae-inside-padding-size: var(--ae-mobile-inside-padding-size); } }";const s=document.body.querySelector("#theme_vars textarea");s.value=t,window.updateInput(s)}function Kt(e){let t="";for(let o=0;o<e.length-1;o++){const[a,c]=e[o].split(":").map(m=>m.trim()),l=a.replace(/\s+/g,"");Te[l]=c,t+=`${l}:${c};`,document.body.querySelectorAll(`#${l} input, #${l} textarea`).forEach(m=>{const v=m.type||"text";if(v==="color")if(c.includes("hsl")||c.includes("rgb")){let S;c.includes("rgb")?S=kt(Rt(c)):S=Rt(c),m.value=rn(S[0],S[1],S[2],S[3]).slice(0,-2)}else m.value=c;else v==="number"||v==="range"?m.value=parseFloat(c)||0:(v==="textarea"||v==="text")&&(m.value=c)})}const n=document.body.querySelector("#preview-styles");if(n)n.innerHTML=`:root {${t}}`,n.innerHTML+="@media only screen and (max-width: 860px) { :root { --ae-outside-gap-size: var(--ae-mobile-outside-gap-size); --ae-inside-padding-size: var(--ae-mobile-inside-padding-size); } }";else{const o=document.createElement("style");o.id="preview-styles",o.innerHTML=`:root {${t}}`,o.innerHTML+="@media only screen and (max-width: 860px) { :root { --ae-outside-gap-size: var(--ae-mobile-outside-gap-size); --ae-inside-padding-size: var(--ae-mobile-inside-padding-size); } }",document.body.appendChild(o)}const s=document.body.querySelector("#theme_vars textarea"),i=document.body.querySelector("#theme_css textarea");s.value=t,window.updateInput(s),window.updateInput(i)}function di(e){const t=e.split("/*BREAKPOINT_CSS_CONTENT*/");let n=t[0].split("}")[0].split("{")[1].replace(/\n|\r/g,"");n=n.replace(/;+/,";").trim();const s=n.split(";"),i=document.body.querySelector("#theme_vars textarea"),o=document.body.querySelector("#theme_css textarea");i.value=n,window.updateInput(i);const a=t[1]!==void 0?t[1]:"";o.value=`/*BREAKPOINT_CSS_CONTENT*/${a}/*BREAKPOINT_CSS_CONTENT*/`,Kt(s);const c=document.body.querySelector("#preview-styles");if(!c){const A=document.createElement("style");A.id="preview-styles",A.innerHTML=e,document.body.appendChild(A)}let l;function u(A){let w=A.value,f=A.parentElement,b=A.type||"text";b==="range"||b==="number"?(f=A.closest(".gradio-slider")||A.closest(".gradio-number"),w+=f.id.indexOf("angle")!==-1?"deg":f.id.indexOf("slider-height")===-1?"px":"",Te[f.id]=w):b==="color"?(f=A.closest(".gradio-colorpicker"),Te[f.id]=w):b==="textarea"?(f=A.closest(".gradio-textbox"),w.length>0?Te[f.id]=w:delete Te[f.id]):b==="text"&&(f=A.closest(".gradio-dropdown"),f&&(Te[f.id]=w)),l!=null&&clearInterval(l),l=setTimeout(()=>{let L=Object.entries(Te).map(([_,R])=>`${_}:${R};`).join("");i.value=L,c.innerHTML=`:root {${L}}@media only screen and (max-width: 860px) { :root { --ae-outside-gap-size: var(--ae-mobile-outside-gap-size); --ae-inside-padding-size: var(--ae-mobile-inside-padding-size); } }`,window.updateInput(i),Zt(lt)},1e3)}document.body.querySelectorAll("#ui_theme_settings input, #ui_theme_settings textarea").forEach(A=>{A.addEventListener("input",w=>{u(w.currentTarget)})});const m=new MutationObserver(A=>{A.forEach(w=>{w.removedNodes.forEach(f=>{f.nodeType===1&&f.matches("ul")&&u(w.target.querySelector(".secondary-wrap input"))})})});document.body.querySelectorAll("#ui_theme_settings .gradio-dropdown").forEach(A=>{m.observe(A,{childList:!0,subtree:!0})}),document.getElementById("theme_reset_btn").addEventListener("click",A=>{A.preventDefault(),document.body.querySelectorAll("#ui_theme_hsv input").forEach(w=>{w.value=0}),lt=[0,0,0],Kt(s)});let S;function I(){if(n!==i.value){clearInterval(S),n=i.value.replace(/\n|\r/g,""),n=n.split(":root{")[0],i.value=n;const A=n.split(";");Kt(A)}}document.body.querySelector("#themes_drop_down input").addEventListener("click",A=>{S!==null&&clearInterval(S),i.value=n,S=setInterval(I,500)}),document.body.querySelectorAll("#theme_hue input, #theme_sat input, #theme_brt input").forEach((A,w)=>{A.addEventListener("change",f=>{f.preventDefault(),lt[Math.floor(w/2)]=f.currentTarget.value,Zt(lt)})}),document.getElementById("theme_invert_btn").addEventListener("click",A=>{A.preventDefault(),_t=!_t,Zt(lt)})}function zn(e){var s;const n=(s=Array.from(e.sheet.cssRules).filter(i=>i instanceof CSSStyleRule&&i.selectorText===":root")[0])==null?void 0:s.cssText;n&&di(n)}function ui(){const e=document.querySelector('[rel="stylesheet"][href*="user"]');if(Ge().querySelector('[id^="tab_ui_theme"]')&&e){zn(e);return}const n=new MutationObserver(()=>{const s=document.querySelector('[rel="stylesheet"][href*="user"]');if(Ge().querySelector('[id^="tab_ui_theme"]'))if(s)n.disconnect(),setTimeout(()=>{zn(s)},500);else{var o=document.createElement("link");o.rel="stylesheet",o.type="text/css",o.href="./file=user.css",document.head.appendChild(o)}});n.observe(Ge(),{childList:!0,subtree:!0})}function Ye(e,t,n=10,s={title:"username",url:"url"},i="",o={},a="POST"){this.container=e,this.originalData=t,this.data=t,this.itemsPerPage=n,this.optItemsPerPage=n,this.apiUrl=i,this.method=a,this.params=o,this.limit=o.limit,this.keys=s,this.startIndex=0,this.renderedItems={},this.lastScrollPos=0,this.isFetching=!1,this.useDataFetching=!0,this.isInit=!1,this.resolvedRenderMethod=this.renderItemsByIndex,this.selected,this.smoothScrolling=!0,this.activePointers={},this.zoom_scale=1,this.scrollDelta=0,this.x=this.y=0,this.createContainer(),this.createSentinels(),this.createDetail(),this.setLayout("vertical"),this.initialize()}Object.assign(Ye.prototype,{initialize(){(!this.apiUrl||this.apiUrl.includes(".json"))&&(this.useDataFetching=!1),this.isInit?this.data.length>0?(this.itemsWrapper.classList.remove("hidden"),this.forceRenderItems(),this.updateDimensions(!0)):this.itemsWrapper.classList.add("hidden"):this.data.length>0&&(this.isInit=!0,this.resolvedRenderMethod(),this.setupEventListeners(),this.setupResizeObserver(),this.updateDimensions())},setFullSize(e){this.isFullSize=e,e?this.container.classList.add("full"):this.container.classList.remove("full")},setTileable(e){this.isTileable=e,e?this.container.classList.add("tileable"):this.container.classList.remove("tileable")},setInfo(e){this.isInfo=e,e?this.container.classList.add("info"):this.container.classList.remove("info")},setFullScreen(e){this.isFullScreen=e,e?this.container.requestFullscreen&&(this.container.parentElement.requestFullscreen(),this.container.classList.add("fullscreen")):document.exitFullscreen&&(document.exitFullscreen(),this.container.classList.remove("fullscreen"))},setLayout(e){e==="horizontal"?(this.direction="horizontal",this.translateProp="translateX",this.scrollProp="scrollLeft",this.client="clientX",this.scrollSize="scrollWidth",this.container.classList.remove("vertical"),this.container.classList.add("horizontal")):(this.direction="vertical",this.translateProp="translateY",this.scrollProp="scrollTop",this.client="clientY",this.scrollSize="scrollHeight",this.container.classList.remove("horizontal"),this.container.classList.add("vertical"))},createContainer(){this.container.classList.add("ae-virtual","visible",this.direction||"vertical"),this.itemsWrapper=document.createElement("div"),this.itemsWrapper.classList.add("ae-virtual-wrapper"),this.container.appendChild(this.itemsWrapper)},createSentinel(){const e=document.createElement("div");return e.classList.add("sentinel"),e},createSentinels(){this.maxSentinel=this.createSentinel(),this.totalSizeSentinel=this.createSentinel(),this.container.append(this.maxSentinel,this.totalSizeSentinel)},createDetail(){this.detail=document.createElement("div"),this.detail.className="ae-virtual-detail";const e=document.createElement("button");e.className="ae-button close";const t=document.createElement("div");t.className="mask-icon icon-cancel",e.appendChild(t),this.detail.appendChild(e);const n=document.createElement("div");n.className="ae-virtual-detail-content",this.detail.appendChild(n),this.container.parentElement.appendChild(this.detail),e.addEventListener("click",this.hideDetail.bind(this)),this.hideDetail()},createItemElement(e,t){const n=document.createElement("div");n.className="item card";const s=e[this.keys.url];s&&(n.style.backgroundImage=`url(${s})`);const i=document.createElement("span");return i.textContent=e[this.keys.title],i.className="title",n.appendChild(i),n},getItemsToRender(){const e=Math.max(0,this.startIndex),t=Math.min(this.data.length,this.startIndex+this.itemsPerPage);return this.data.slice(e,t)},renderItems(){this.forceRenderItems()},getItemsFragment(){const e=new Set,t=this.getItemsToRender(),n=document.createDocumentFragment();return t.forEach((s,i)=>{const o=this.startIndex+i;if(e.add(o),!this.renderedItems[o]){const a=this.createItemElement(s,o);a.dataset.index=o,a.dataset.id=s.id,n.appendChild(a),this.renderedItems[o]=a}}),this.cleanupRenderedItems(e),n},forceRenderItems(){this.itemsWrapper.innerHTML="",this.renderedItems={},this.itemsWrapper.appendChild(this.getItemsFragment()),this.updateSentinels()},renderItemsByIndex(e="increase"){const t=this.getItemsFragment();e==="increase"?this.itemsWrapper.appendChild(t):this.itemsWrapper.insertBefore(t,this.itemsWrapper.firstChild),this.updateSentinels()},cleanupRenderedItems(e){for(const t in this.renderedItems)e.has(Number(t))||(this.renderedItems[t].remove(),delete this.renderedItems[t])},updateSentinels(){const e=Math.max(0,this.startIndex),t=Math.min(this.data.length,this.startIndex+this.itemsPerPage),n=e/this.itemsPerRow*this.itemSize;let s=t/this.itemsPerRow*this.itemSize;s=Math.min(s,this.totalSize),s=Math.round(s/this.itemSize)*this.itemSize,this.maxSentinel.style.transform=`${this.translateProp}(${s}px)`,this.itemsWrapper.style.transform=`${this.translateProp}(${n}px)`},updateDimensions(e=!1){const t=this.itemsWrapper.querySelector(".item");if(!t||(this.itemHeight=t.offsetHeight,this.itemWidth=t.offsetWidth,this.containerWidth=this.container.parentElement.offsetWidth,this.containerHeight=this.container.parentElement.offsetHeight,console.log("this.updateDimensions",this.containerWidth,this.containerHeight),!this.containerWidth)||!this.containerHeight||!this.data.length)return;const n=this.total||this.data.length;this.direction==="horizontal"?(this.itemSize=this.itemWidth,this.containerSize=this.containerWidth,this.itemsPerRow=Math.floor(this.containerHeight/this.itemHeight),this.rowsInView=Math.ceil(this.containerWidth/this.itemWidth)):(this.itemSize=this.itemHeight,this.containerSize=this.containerHeight,this.itemsPerRow=Math.floor(this.containerWidth/this.itemWidth),this.rowsInView=Math.ceil(this.containerHeight/this.itemHeight)),this.totalRows=Math.ceil(n/this.itemsPerRow),this.itemsPerPage=Math.max(this.optItemsPerPage,this.rowsInView*this.itemsPerRow),this.totalSize=this.totalRows*this.itemSize,this.totalSizeSentinel.style.transform=`${this.translateProp}(${this.totalSize}px)`,this.maxStartIndex=Math.max(this.data.length-this.itemsPerPage,0),this.half_w=this.containerWidth/2,this.half_h=this.containerHeight/2,this.boundingClientRect=this.container.getBoundingClientRect(),this.invalidateScrollIndex?(console.log("this.invalidateScrollIndex ",this.invalidateScrollIndex,this.itemsPerRow,this.containerSize),this.isFullSize||(this.invalidateScrollIndex=Math.round(this.invalidateScrollIndex/this.itemsPerRow)),this.container[this.scrollProp]=this.invalidateScrollIndex*this.itemSize,this.startIndex=Math.floor(this.container[this.scrollProp]/this.itemSize)*this.itemsPerRow,this.invalidateScrollIndex=0,this.updateDimensions(!0)):e?this.forceRenderItems():this.scrollHandler()},updateScroll(){const e=this.container[this.scrollProp],{lastScrollPos:t,itemSize:n}=this,s=Math.floor(e/n)*this.itemsPerRow;this.startIndex=s;const i=e>t?"increase":"decrease";if(this.lastScrollPos=e,i==="increase"&&this.useDataFetching&&!this.isFetching&&this.params.cursor&&s>=this.maxStartIndex){this.isFetching=!0,this.fetchUpdateData();return}this.scrollAnimationFrame&&cancelAnimationFrame(this.scrollAnimationFrame),this.scrollAnimationFrame=requestAnimationFrame(()=>{const o=this.itemsWrapper.children;if(o.length>0){const a=parseInt(o[0].dataset.index),c=parseInt(o[o.length-1].dataset.index);a>c?(this.renderTimeout&&clearTimeout(this.renderTimeout),this.renderTimeout=setTimeout(()=>{console.warn("Out of order items detected",{firstRenderedIndex:a,lastRenderedIndex:c}),this.forceRenderItems()},300)):this.resolvedRenderMethod(i)}})},scrollHandler(){this.scrollTimeout&&clearTimeout(this.scrollTimeout),this.scrollAnimationFrame&&cancelAnimationFrame(this.scrollAnimationFrame),this.scrollAnimationFrame=requestAnimationFrame(()=>{this.updateScroll()}),this.scrollTimeout=setTimeout(()=>{this.updateScroll()},100)},clickHandler(e){const{target:t,currentTarget:n}=e,s=t.closest(".item.card").dataset.index,i=this.data[s];console.log(i)},changeHandler(e){},wheelHandler(e){if(!e.target.closest(".full .item-info"))if(!this.isFullSize||!this.isZoomMode){e.preventDefault();const t=Math.sign(e.deltaY);this.scrollDelta+=t,this.useSmoothScrolling(300)}else{const t=-Math.sign(e.deltaY)*.5,n=e.clientX-this.boundingClientRect.left,s=e.clientY-this.boundingClientRect.top;t<0?this.zoomOut(e,n,s):this.zoomIn(e,n,s)}},setupEventListeners(){this.container.addEventListener("scroll",this.throttle(this.scrollHandler.bind(this),100),{passive:!0}),this.container.addEventListener("click",this.clickHandler.bind(this)),this.container.addEventListener("change",this.changeHandler.bind(this)),this.container.addEventListener("wheel",this.wheelHandler.bind(this),{passive:!1}),document.addEventListener("keydown",this.keyPressHandler.bind(this)),this.panel=this.itemsWrapper,this.panel.addEventListener("pointerdown",this.pointerDown.bind(this),{passive:!1}),this.panel.addEventListener("pointermove",this.throttle(this.pointerMove.bind(this),16),{passive:!1}),this.panel.addEventListener("pointerup",this.pointerUp.bind(this),{passive:!1}),this.panel.addEventListener("pointercancel",this.pointerUp.bind(this),{passive:!1}),this.panel.addEventListener("pointerleave",this.pointerUp.bind(this),{passive:!1}),this.isMouseDevice=!1,window.addEventListener("mousemove",()=>{this.isMouseDevice=!0},{once:!0})},useSmoothScrolling(e=200){if(this.smoothScrolling){const t=this.container[this.scrollProp]+this.scrollDelta*this.itemSize,n=Math.round(t/this.itemSize)*this.itemSize;this.smoothScroll(n,e)}else this.container[this.scrollProp]+=this.scrollDelta*this.itemSize,this.scrollDelta=0},smoothScroll(e,t){const n=this.container[this.scrollProp],s=e-n;let i=null,o;const a=c=>{i===null&&(i=c);const l=c-i,u=Math.min(l/t,1),m=1-Math.pow(1-u,3);this.container[this.scrollProp]=n+s*m,u<1?o=requestAnimationFrame(a):(this.scrollDelta=0,this.container[this.scrollProp]=e,o=null)};o&&cancelAnimationFrame(o),o=requestAnimationFrame(a)},setupResizeObserver(){new ResizeObserver(()=>{this.resizeTimer&&clearTimeout(this.resizeTimer),this.invalidateScrollIndex||(this.invalidateScrollIndex=this.startIndex),this.resizeTimer=setTimeout(()=>{this.updateDimensions(!0)},100)}).observe(this.container)},keyPressHandler(e){switch(e.key){case"ArrowDown":this.scrollBy(1);break;case"ArrowUp":this.scrollBy(-1);break;case"Home":this.scrollToStart();break;case"End":this.scrollToEnd();break}},scrollBy(e){this.scrollDelta+=e,this.useSmoothScrolling(0)},scrollToStart(){this.startIndex=0,this.container[this.scrollProp]=0},scrollToEnd(){this.startIndex=Math.max(0,this.data.length-this.itemsPerPage),this.container[this.scrollProp]=this.startIndex*this.itemSize},scrollToId(e){const t=this.originalData.findIndex(n=>n.id===e);console.warn(`Item with Index ${t} clicked.`),t!==-1?(this.container.classList.remove("visible"),this.container[this.scrollProp]=0,this.invalidateScrollIndex=t,setTimeout(()=>{this.updateDimensions(),this.container.classList.add("visible")},200)):console.warn(`Item with ID ${e} not found in loaded data object.`)},scrollToIndex(e){this.container.classList.remove("visible"),this.container[this.scrollProp]=0,this.invalidateScrollIndex=e||0,setTimeout(()=>{this.updateDimensions(),this.container.classList.add("visible")},200)},debounce(e,t=1e3){return(function(...n){const s=this,i=typeof n[n.length-1]=="number"?n.pop():t,o=()=>{this.timeout=null,e.apply(s,n)};clearTimeout(this.timeout),this.timeout=setTimeout(o,i)}).bind(this)},throttle(e,t){let n,s,i;return function(){const o=this;i=arguments;const a=Date.now();s?(clearTimeout(n),n=setTimeout(function(){a-s>=t&&(e.apply(o,i),s=a)},t-(a-s))):(e.apply(o,i),s=a)}},setNextCursor(e){e&&this.data.length>0?(this.params.cursor=e,this.params.page=Math.floor(this.data.length/this.params.limit)+1||1):this.params.cursor&&delete this.params.cursor,this.params.limit&&this.data.length>0?this.params.page=Math.floor(this.data.length/this.params.limit)+1:delete this.params.page},getValueByPath(e,t){return t?t.split(".").reduce((s,i)=>{if(s!=null)return s[i]},e):e},setData(e){this.startIndex=0,this.container[this.scrollProp]=0,this.originalData=e,this.data=this.originalData,this.initialize()},appendData(e){this.originalData.push(...e),this.data=this.originalData,this.isFetching=!1,this.updateDimensions(!0)},updateDataByIndex(e,t){const n=this.originalData[t];for(const[s,i]of Object.entries(e))n[s]=i;this.originalData[t]=n,this.data=this.originalData,this.forceRenderItems()},updateDataById(e,t){const n=this.originalData.find(s=>s.id===t);if(n){for(const[s,i]of Object.entries(e))n[s]=i;this.data=this.originalData,this.forceRenderItems()}else console.warn(`Item with ID ${t} not found in loaded data object.`)},removeDataById(e){const t=this.originalData.findIndex(n=>n.id===e);t!==-1?(this.originalData.splice(t,1),this.data=this.originalData,this.total-=1,this.updateDimensions(!0)):console.warn(`Item with ID ${e} not found in loaded data object.`)},setSelectedItems(e){this.selected=e,this.forceRenderItems()},fetchData(e){return new Promise((t,n)=>{const s=new XMLHttpRequest;let i=this.apiUrl;if(this.method.toUpperCase()==="GET"&&this.params){const o=new URLSearchParams;Object.keys(this.params).forEach(a=>{const c=this.params[a];Array.isArray(c)?c.forEach(l=>o.append(a,l)):o.append(a,c)}),i+="?"+o.toString()}s.open(this.method,i,!0),s.setRequestHeader("Accept","application/json"),s.onprogress=function(o){if(o.lengthComputable){const a=parseInt(o.loaded/o.total*100);e(a)}},s.onload=function(){if(s.status===200){const o=JSON.parse(s.responseText);t(o)}else n(s.status)},s.onerror=function(){n(s.status)},this.method.toUpperCase()==="POST"?(s.setRequestHeader("Content-Type","application/json"),s.send(JSON.stringify(this.params))):s.send()})},async fetchUpdateData(e=!1){var n;this.showLoadingIndicator();const t=await this.fetchData(s=>this.updateLoadingIndicator(s));if(t){this.total=t.total;const s=this.getValueByPath(t,this.keys.dataPath)||t;e?this.setData(s):this.appendData(s),this.setNextCursor(((n=t.metadata)==null?void 0:n.nextCursor)||t.nextCursor)}else console.error(`Error fetching data: ${error}`);this.hideLoadingIndicator()},async updateParamsAndFetch(e,t=1e3){Object.assign(this.params,e),Object.keys(this.params).forEach(s=>{this.params[s]||delete this.params[s]}),this.startIndex=0,delete this.params.cursor,this.originalData=[],this.data=this.originalData,this.debounce(this.fetchUpdateData.bind(this,!0),t)()},showLoadingIndicator(){this.loadingIndicator||(this.loadingIndicator=document.createElement("div"),this.loadingIndicator.className="loading-indicator",this.container.parentElement.appendChild(this.loadingIndicator),this.hideLoadingIndicator(),this.isFetching=!1),this.loadingIndicator.innerHTML="Loading... 0%",this.loadingIndicator.style.display="flex"},updateLoadingIndicator(e){this.loadingIndicator&&(this.loadingIndicator.innerHTML=`Loading... ${e}%`)},hideLoadingIndicator(){this.loadingIndicator&&(this.loadingIndicator.style.display="none")},showDetail(){this.detail.classList.remove("hidden")},hideDetail(){this.detail&&this.detail.classList.add("hidden")},filterItems(e,t={}){this.startIndex=0,this.data=this.originalData.filter(n=>{let s=!0;e&&(s=s&&n[this.keys.title].toLowerCase().includes(e.toLowerCase()));for(const[i,o]of Object.entries(t))if(n[i]!==void 0&&o!==void 0)if(Array.isArray(n[i])){const a=n[i];s=s&&a.some(c=>typeof c=="string"&&c.toLowerCase().includes(o.toLowerCase()))}else typeof n[i]=="string"&&(s=s&&n[i].toLowerCase().includes(o.toLowerCase()));return s}),this.updateDimensions()},sortItems(e,t=!1){this.startIndex=0;const n=this,s=[...this.data];function i(o,a){const c=n.getValueByPath(o,e),l=n.getValueByPath(a,e);return!isNaN(c)&&!isNaN(l)?t?l-c:c-l:t?l<c?-1:l>c?1:0:c<l?-1:c>l?1:0}s.sort(i),this.data=s,this.updateDimensions()},resetZoom(){this.zoom_scale=1,this.x=this.y=0,this.updateZoom()},zoomIn(e,t,n){this.centeredZoom(1/.65,t,n)},zoomOut(e,t,n){this.centeredZoom(.65,t,n)},getRelativePointers(e){const{boundingClientRect:t}=this,[n,s]=e;return{x1:n.x-t.left,y1:n.y-t.top,x2:s.x-t.left,y2:s.y-t.top}},centerOfPointers(e){const{x1:t,y1:n,x2:s,y2:i}=this.getRelativePointers(e),o=(t+s)/2,a=(n+i)/2;return[o,a]},distance(e){if(e.length<2)return 0;const t=e[0].x-e[1].x,n=e[0].y-e[1].y;return Math.sqrt(t*t+n*n)},scalePointers(e){if(e.length<2)return 0;const t=this.distance(e),n=this.previousDistance||0;if(n>0){const s=t/n,i=this.centerOfPointers(e);this.centeredZoom(s,i[0],i[1])}this.previousDistance=t},centeredZoom(e,t,n){const{zoom_scale:s,x:i,y:o,half_w:a,half_h:c}=this;let l=s*e;if(l<=1){this.resetZoom();return}else if(l>50)return;n?(this.x=t-(t-i-a)*e-a,this.y=n-(n-o-c)*e-c):(this.x*=e,this.y*=e),this.zoom_scale=l,this.updateZoom()},updateZoom(){this.zoomTarget&&(this.zoomTarget.style.transform=`translate(${this.x}px, ${this.y}px) scale(${this.zoom_scale})`)},debounceDoubleTap(e){const t=Date.now();this.lastTapTime&&t-this.lastTapTime<300&&(this.isZoomMode=!this.isZoomMode,this.isZoomMode?(this.zoomTarget=e.target.closest(".item-img"),this.zoom_scale=1.2,this.updateZoom()):(this.activePointers={},this.resetZoom())),this.lastTapTime=t},pointerDown(e){e.target.tagName.toLowerCase()!=="select"&&e.preventDefault(),this.dragged=!1,this.startX=e.pageX,this.startY=e.pageY;const{isFullSize:t,isMouseDevice:n,activePointers:s}=this;s[e.pointerId]={x:e.pageX,y:e.pageY};const i=Object.keys(s).length;if(i>2)return;t||(this.isZoomMode=!1),t&&i===1&&this.debounceDoubleTap(e);const o=this.isZoomMode;console.log(`isZoomMode: ${o}`),(!o&&t||!o&&n)&&i===1&&(this.isDragging=!0,this.start=e[this.client],this.scrollStart=this.container[this.scrollProp],this.container.style.cursor="grabbing")},pointerMove(e){e.preventDefault(),this.dragged=!0;const{isZoomMode:t,isFullSize:n,isMouseDevice:s,activePointers:i,startX:o,startY:a,start:c,scrollProp:l,scrollStart:u}=this;if(i[e.pointerId]){i[e.pointerId]={x:e.pageX,y:e.pageY};const m=Object.keys(i).length;if(t){if(m>2)return;if(m===2)this.scalePointers(Object.values(i));else if(m===1){const v=e.pageX-o,S=e.pageY-a;this.startX=e.pageX,this.startY=e.pageY,this.x+=v,this.y+=S,requestAnimationFrame(()=>{this.updateZoom()})}}else if(!t&&n||!t&&s){if(!this.isDragging||m>1)return;const v=c-e[this.client],S=Math.sign(v);S!==0&&(this.scrollDelta=S),requestAnimationFrame(()=>{this.container[l]=u+v})}}},pointerUp(e){e.preventDefault(),this.dragged=!1;const{isZoomMode:t,isFullSize:n,isMouseDevice:s,activePointers:i}=this;if(delete i[e.pointerId],Object.keys(i).length<2&&(this.previousDistance=0),!t&&n||!t&&s){if(this.isDragging=!1,this.scrollDelta==0)return;this.container.style.cursor="grab",this.useSmoothScrolling(300)}}});/*! @license DOMPurify 3.2.3 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.3/LICENSE */const{entries:os,setPrototypeOf:Fn,isFrozen:mi,getPrototypeOf:pi,getOwnPropertyDescriptor:fi}=Object;let{freeze:Ee,seal:Ae,create:as}=Object,{apply:ln,construct:cn}=typeof Reflect<"u"&&Reflect;Ee||(Ee=function(t){return t});Ae||(Ae=function(t){return t});ln||(ln=function(t,n,s){return t.apply(n,s)});cn||(cn=function(t,n){return new t(...n)});const Pt=Le(Array.prototype.forEach),Un=Le(Array.prototype.pop),ct=Le(Array.prototype.push),Mt=Le(String.prototype.toLowerCase),Jt=Le(String.prototype.toString),qn=Le(String.prototype.match),dt=Le(String.prototype.replace),hi=Le(String.prototype.indexOf),gi=Le(String.prototype.trim),Me=Le(Object.prototype.hasOwnProperty),ve=Le(RegExp.prototype.test),ut=_i(TypeError);function Le(e){return function(t){for(var n=arguments.length,s=new Array(n>1?n-1:0),i=1;i<n;i++)s[i-1]=arguments[i];return ln(e,t,s)}}function _i(e){return function(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return cn(e,n)}}function G(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Mt;Fn&&Fn(e,null);let s=t.length;for(;s--;){let i=t[s];if(typeof i=="string"){const o=n(i);o!==i&&(mi(t)||(t[s]=o),i=o)}e[i]=!0}return e}function bi(e){for(let t=0;t<e.length;t++)Me(e,t)||(e[t]=null);return e}function Xe(e){const t=as(null);for(const[n,s]of os(e))Me(e,n)&&(Array.isArray(s)?t[n]=bi(s):s&&typeof s=="object"&&s.constructor===Object?t[n]=Xe(s):t[n]=s);return t}function mt(e,t){for(;e!==null;){const s=fi(e,t);if(s){if(s.get)return Le(s.get);if(typeof s.value=="function")return Le(s.value)}e=pi(e)}function n(){return null}return n}const Hn=Ee(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Qt=Ee(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),en=Ee(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),yi=Ee(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),tn=Ee(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),vi=Ee(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Bn=Ee(["#text"]),jn=Ee(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),nn=Ee(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Wn=Ee(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Nt=Ee(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Si=Ae(/\{\{[\w\W]*|[\w\W]*\}\}/gm),wi=Ae(/<%[\w\W]*|[\w\W]*%>/gm),Ei=Ae(/\$\{[\w\W]*}/gm),xi=Ae(/^data-[\-\w.\u00B7-\uFFFF]+$/),Ti=Ae(/^aria-[\-\w]+$/),rs=Ae(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Li=Ae(/^(?:\w+script|data):/i),Ci=Ae(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),ls=Ae(/^html$/i),Ai=Ae(/^[a-z][.\w]*(-[.\w]+)+$/i);var Gn=Object.freeze({__proto__:null,ARIA_ATTR:Ti,ATTR_WHITESPACE:Ci,CUSTOM_ELEMENT:Ai,DATA_ATTR:xi,DOCTYPE_NAME:ls,ERB_EXPR:wi,IS_ALLOWED_URI:rs,IS_SCRIPT_OR_DATA:Li,MUSTACHE_EXPR:Si,TMPLIT_EXPR:Ei});const pt={element:1,attribute:2,text:3,cdataSection:4,entityReference:5,entityNode:6,progressingInstruction:7,comment:8,document:9,documentType:10,documentFragment:11,notation:12},Ii=function(){return typeof window>"u"?null:window},Pi=function(t,n){if(typeof t!="object"||typeof t.createPolicy!="function")return null;let s=null;const i="data-tt-policy-suffix";n&&n.hasAttribute(i)&&(s=n.getAttribute(i));const o="dompurify"+(s?"#"+s:"");try{return t.createPolicy(o,{createHTML(a){return a},createScriptURL(a){return a}})}catch{return console.warn("TrustedTypes policy "+o+" could not be created."),null}},Vn=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function cs(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ii();const t=D=>cs(D);if(t.version="3.2.3",t.removed=[],!e||!e.document||e.document.nodeType!==pt.document)return t.isSupported=!1,t;let{document:n}=e;const s=n,i=s.currentScript,{DocumentFragment:o,HTMLTemplateElement:a,Node:c,Element:l,NodeFilter:u,NamedNodeMap:m=e.NamedNodeMap||e.MozNamedAttrMap,HTMLFormElement:v,DOMParser:S,trustedTypes:I}=e,T=l.prototype,q=mt(T,"cloneNode"),A=mt(T,"remove"),w=mt(T,"nextSibling"),f=mt(T,"childNodes"),b=mt(T,"parentNode");if(typeof a=="function"){const D=n.createElement("template");D.content&&D.content.ownerDocument&&(n=D.content.ownerDocument)}let L,_="";const{implementation:R,createNodeIterator:X,createDocumentFragment:p,getElementsByTagName:d}=n,{importNode:h}=s;let y=Vn();t.isSupported=typeof os=="function"&&typeof b=="function"&&R&&R.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:E,ERB_EXPR:$,TMPLIT_EXPR:M,DATA_ATTR:W,ARIA_ATTR:Z,IS_SCRIPT_OR_DATA:te,ATTR_WHITESPACE:le,CUSTOM_ELEMENT:ne}=Gn;let{IS_ALLOWED_URI:ae}=Gn,z=null;const K=G({},[...Hn,...Qt,...en,...tn,...Bn]);let Q=null;const se=G({},[...jn,...nn,...Wn,...Nt]);let j=Object.seal(as(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),pe=null,be=null,P=!0,g=!0,C=!1,O=!0,U=!1,ee=!0,J=!1,ce=!1,F=!1,Y=!1,fe=!1,N=!1,H=!0,ie=!1;const re="user-content-";let Ve=!0,Fe=!1,Ze={},Ke=null;const gn=G({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let _n=null;const bn=G({},["audio","video","img","source","image","track"]);let Ft=null;const yn=G({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),yt="http://www.w3.org/1998/Math/MathML",vt="http://www.w3.org/2000/svg",Ue="http://www.w3.org/1999/xhtml";let Je=Ue,Ut=!1,qt=null;const ms=G({},[yt,vt,Ue],Jt);let St=G({},["mi","mo","mn","ms","mtext"]),wt=G({},["annotation-xml"]);const ps=G({},["title","style","font","a","script"]);let ot=null;const fs=["application/xhtml+xml","text/html"],hs="text/html";let de=null,Qe=null;const gs=n.createElement("form"),vn=function(r){return r instanceof RegExp||r instanceof Function},Ht=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Qe&&Qe===r)){if((!r||typeof r!="object")&&(r={}),r=Xe(r),ot=fs.indexOf(r.PARSER_MEDIA_TYPE)===-1?hs:r.PARSER_MEDIA_TYPE,de=ot==="application/xhtml+xml"?Jt:Mt,z=Me(r,"ALLOWED_TAGS")?G({},r.ALLOWED_TAGS,de):K,Q=Me(r,"ALLOWED_ATTR")?G({},r.ALLOWED_ATTR,de):se,qt=Me(r,"ALLOWED_NAMESPACES")?G({},r.ALLOWED_NAMESPACES,Jt):ms,Ft=Me(r,"ADD_URI_SAFE_ATTR")?G(Xe(yn),r.ADD_URI_SAFE_ATTR,de):yn,_n=Me(r,"ADD_DATA_URI_TAGS")?G(Xe(bn),r.ADD_DATA_URI_TAGS,de):bn,Ke=Me(r,"FORBID_CONTENTS")?G({},r.FORBID_CONTENTS,de):gn,pe=Me(r,"FORBID_TAGS")?G({},r.FORBID_TAGS,de):{},be=Me(r,"FORBID_ATTR")?G({},r.FORBID_ATTR,de):{},Ze=Me(r,"USE_PROFILES")?r.USE_PROFILES:!1,P=r.ALLOW_ARIA_ATTR!==!1,g=r.ALLOW_DATA_ATTR!==!1,C=r.ALLOW_UNKNOWN_PROTOCOLS||!1,O=r.ALLOW_SELF_CLOSE_IN_ATTR!==!1,U=r.SAFE_FOR_TEMPLATES||!1,ee=r.SAFE_FOR_XML!==!1,J=r.WHOLE_DOCUMENT||!1,Y=r.RETURN_DOM||!1,fe=r.RETURN_DOM_FRAGMENT||!1,N=r.RETURN_TRUSTED_TYPE||!1,F=r.FORCE_BODY||!1,H=r.SANITIZE_DOM!==!1,ie=r.SANITIZE_NAMED_PROPS||!1,Ve=r.KEEP_CONTENT!==!1,Fe=r.IN_PLACE||!1,ae=r.ALLOWED_URI_REGEXP||rs,Je=r.NAMESPACE||Ue,St=r.MATHML_TEXT_INTEGRATION_POINTS||St,wt=r.HTML_INTEGRATION_POINTS||wt,j=r.CUSTOM_ELEMENT_HANDLING||{},r.CUSTOM_ELEMENT_HANDLING&&vn(r.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(j.tagNameCheck=r.CUSTOM_ELEMENT_HANDLING.tagNameCheck),r.CUSTOM_ELEMENT_HANDLING&&vn(r.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(j.attributeNameCheck=r.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),r.CUSTOM_ELEMENT_HANDLING&&typeof r.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(j.allowCustomizedBuiltInElements=r.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),U&&(g=!1),fe&&(Y=!0),Ze&&(z=G({},Bn),Q=[],Ze.html===!0&&(G(z,Hn),G(Q,jn)),Ze.svg===!0&&(G(z,Qt),G(Q,nn),G(Q,Nt)),Ze.svgFilters===!0&&(G(z,en),G(Q,nn),G(Q,Nt)),Ze.mathMl===!0&&(G(z,tn),G(Q,Wn),G(Q,Nt))),r.ADD_TAGS&&(z===K&&(z=Xe(z)),G(z,r.ADD_TAGS,de)),r.ADD_ATTR&&(Q===se&&(Q=Xe(Q)),G(Q,r.ADD_ATTR,de)),r.ADD_URI_SAFE_ATTR&&G(Ft,r.ADD_URI_SAFE_ATTR,de),r.FORBID_CONTENTS&&(Ke===gn&&(Ke=Xe(Ke)),G(Ke,r.FORBID_CONTENTS,de)),Ve&&(z["#text"]=!0),J&&G(z,["html","head","body"]),z.table&&(G(z,["tbody"]),delete pe.tbody),r.TRUSTED_TYPES_POLICY){if(typeof r.TRUSTED_TYPES_POLICY.createHTML!="function")throw ut('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof r.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw ut('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');L=r.TRUSTED_TYPES_POLICY,_=L.createHTML("")}else L===void 0&&(L=Pi(I,i)),L!==null&&typeof _=="string"&&(_=L.createHTML(""));Ee&&Ee(r),Qe=r}},Sn=G({},[...Qt,...en,...yi]),wn=G({},[...tn,...vi]),_s=function(r){let x=b(r);(!x||!x.tagName)&&(x={namespaceURI:Je,tagName:"template"});const k=Mt(r.tagName),oe=Mt(x.tagName);return qt[r.namespaceURI]?r.namespaceURI===vt?x.namespaceURI===Ue?k==="svg":x.namespaceURI===yt?k==="svg"&&(oe==="annotation-xml"||St[oe]):!!Sn[k]:r.namespaceURI===yt?x.namespaceURI===Ue?k==="math":x.namespaceURI===vt?k==="math"&&wt[oe]:!!wn[k]:r.namespaceURI===Ue?x.namespaceURI===vt&&!wt[oe]||x.namespaceURI===yt&&!St[oe]?!1:!wn[k]&&(ps[k]||!Sn[k]):!!(ot==="application/xhtml+xml"&&qt[r.namespaceURI]):!1},$e=function(r){ct(t.removed,{element:r});try{b(r).removeChild(r)}catch{A(r)}},Et=function(r,x){try{ct(t.removed,{attribute:x.getAttributeNode(r),from:x})}catch{ct(t.removed,{attribute:null,from:x})}if(x.removeAttribute(r),r==="is")if(Y||fe)try{$e(x)}catch{}else try{x.setAttribute(r,"")}catch{}},En=function(r){let x=null,k=null;if(F)r="<remove></remove>"+r;else{const ue=qn(r,/^[\r\n\t ]+/);k=ue&&ue[0]}ot==="application/xhtml+xml"&&Je===Ue&&(r='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+r+"</body></html>");const oe=L?L.createHTML(r):r;if(Je===Ue)try{x=new S().parseFromString(oe,ot)}catch{}if(!x||!x.documentElement){x=R.createDocument(Je,"template",null);try{x.documentElement.innerHTML=Ut?_:oe}catch{}}const he=x.body||x.documentElement;return r&&k&&he.insertBefore(n.createTextNode(k),he.childNodes[0]||null),Je===Ue?d.call(x,J?"html":"body")[0]:J?x.documentElement:he},xn=function(r){return X.call(r.ownerDocument||r,r,u.SHOW_ELEMENT|u.SHOW_COMMENT|u.SHOW_TEXT|u.SHOW_PROCESSING_INSTRUCTION|u.SHOW_CDATA_SECTION,null)},Bt=function(r){return r instanceof v&&(typeof r.nodeName!="string"||typeof r.textContent!="string"||typeof r.removeChild!="function"||!(r.attributes instanceof m)||typeof r.removeAttribute!="function"||typeof r.setAttribute!="function"||typeof r.namespaceURI!="string"||typeof r.insertBefore!="function"||typeof r.hasChildNodes!="function")},Tn=function(r){return typeof c=="function"&&r instanceof c};function qe(D,r,x){Pt(D,k=>{k.call(t,r,x,Qe)})}const Ln=function(r){let x=null;if(qe(y.beforeSanitizeElements,r,null),Bt(r))return $e(r),!0;const k=de(r.nodeName);if(qe(y.uponSanitizeElement,r,{tagName:k,allowedTags:z}),r.hasChildNodes()&&!Tn(r.firstElementChild)&&ve(/<[/\w]/g,r.innerHTML)&&ve(/<[/\w]/g,r.textContent)||r.nodeType===pt.progressingInstruction||ee&&r.nodeType===pt.comment&&ve(/<[/\w]/g,r.data))return $e(r),!0;if(!z[k]||pe[k]){if(!pe[k]&&An(k)&&(j.tagNameCheck instanceof RegExp&&ve(j.tagNameCheck,k)||j.tagNameCheck instanceof Function&&j.tagNameCheck(k)))return!1;if(Ve&&!Ke[k]){const oe=b(r)||r.parentNode,he=f(r)||r.childNodes;if(he&&oe){const ue=he.length;for(let xe=ue-1;xe>=0;--xe){const Re=q(he[xe],!0);Re.__removalCount=(r.__removalCount||0)+1,oe.insertBefore(Re,w(r))}}}return $e(r),!0}return r instanceof l&&!_s(r)||(k==="noscript"||k==="noembed"||k==="noframes")&&ve(/<\/no(script|embed|frames)/i,r.innerHTML)?($e(r),!0):(U&&r.nodeType===pt.text&&(x=r.textContent,Pt([E,$,M],oe=>{x=dt(x,oe," ")}),r.textContent!==x&&(ct(t.removed,{element:r.cloneNode()}),r.textContent=x)),qe(y.afterSanitizeElements,r,null),!1)},Cn=function(r,x,k){if(H&&(x==="id"||x==="name")&&(k in n||k in gs))return!1;if(!(g&&!be[x]&&ve(W,x))){if(!(P&&ve(Z,x))){if(!Q[x]||be[x]){if(!(An(r)&&(j.tagNameCheck instanceof RegExp&&ve(j.tagNameCheck,r)||j.tagNameCheck instanceof Function&&j.tagNameCheck(r))&&(j.attributeNameCheck instanceof RegExp&&ve(j.attributeNameCheck,x)||j.attributeNameCheck instanceof Function&&j.attributeNameCheck(x))||x==="is"&&j.allowCustomizedBuiltInElements&&(j.tagNameCheck instanceof RegExp&&ve(j.tagNameCheck,k)||j.tagNameCheck instanceof Function&&j.tagNameCheck(k))))return!1}else if(!Ft[x]){if(!ve(ae,dt(k,le,""))){if(!((x==="src"||x==="xlink:href"||x==="href")&&r!=="script"&&hi(k,"data:")===0&&_n[r])){if(!(C&&!ve(te,dt(k,le,"")))){if(k)return!1}}}}}}return!0},An=function(r){return r!=="annotation-xml"&&qn(r,ne)},In=function(r){qe(y.beforeSanitizeAttributes,r,null);const{attributes:x}=r;if(!x||Bt(r))return;const k={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:Q,forceKeepAttr:void 0};let oe=x.length;for(;oe--;){const he=x[oe],{name:ue,namespaceURI:xe,value:Re}=he,at=de(ue);let ye=ue==="value"?Re:gi(Re);if(k.attrName=at,k.attrValue=ye,k.keepAttr=!0,k.forceKeepAttr=void 0,qe(y.uponSanitizeAttribute,r,k),ye=k.attrValue,ie&&(at==="id"||at==="name")&&(Et(ue,r),ye=re+ye),ee&&ve(/((--!?|])>)|<\/(style|title)/i,ye)){Et(ue,r);continue}if(k.forceKeepAttr||(Et(ue,r),!k.keepAttr))continue;if(!O&&ve(/\/>/i,ye)){Et(ue,r);continue}U&&Pt([E,$,M],Nn=>{ye=dt(ye,Nn," ")});const Pn=de(r.nodeName);if(Cn(Pn,at,ye)){if(L&&typeof I=="object"&&typeof I.getAttributeType=="function"&&!xe)switch(I.getAttributeType(Pn,at)){case"TrustedHTML":{ye=L.createHTML(ye);break}case"TrustedScriptURL":{ye=L.createScriptURL(ye);break}}try{xe?r.setAttributeNS(xe,ue,ye):r.setAttribute(ue,ye),Bt(r)?$e(r):Un(t.removed)}catch{}}}qe(y.afterSanitizeAttributes,r,null)},bs=function D(r){let x=null;const k=xn(r);for(qe(y.beforeSanitizeShadowDOM,r,null);x=k.nextNode();)qe(y.uponSanitizeShadowNode,x,null),Ln(x),In(x),x.content instanceof o&&D(x.content);qe(y.afterSanitizeShadowDOM,r,null)};return t.sanitize=function(D){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},x=null,k=null,oe=null,he=null;if(Ut=!D,Ut&&(D="<!-->"),typeof D!="string"&&!Tn(D))if(typeof D.toString=="function"){if(D=D.toString(),typeof D!="string")throw ut("dirty is not a string, aborting")}else throw ut("toString is not a function");if(!t.isSupported)return D;if(ce||Ht(r),t.removed=[],typeof D=="string"&&(Fe=!1),Fe){if(D.nodeName){const Re=de(D.nodeName);if(!z[Re]||pe[Re])throw ut("root node is forbidden and cannot be sanitized in-place")}}else if(D instanceof c)x=En("<!---->"),k=x.ownerDocument.importNode(D,!0),k.nodeType===pt.element&&k.nodeName==="BODY"||k.nodeName==="HTML"?x=k:x.appendChild(k);else{if(!Y&&!U&&!J&&D.indexOf("<")===-1)return L&&N?L.createHTML(D):D;if(x=En(D),!x)return Y?null:N?_:""}x&&F&&$e(x.firstChild);const ue=xn(Fe?D:x);for(;oe=ue.nextNode();)Ln(oe),In(oe),oe.content instanceof o&&bs(oe.content);if(Fe)return D;if(Y){if(fe)for(he=p.call(x.ownerDocument);x.firstChild;)he.appendChild(x.firstChild);else he=x;return(Q.shadowroot||Q.shadowrootmode)&&(he=h.call(s,he,!0)),he}let xe=J?x.outerHTML:x.innerHTML;return J&&z["!doctype"]&&x.ownerDocument&&x.ownerDocument.doctype&&x.ownerDocument.doctype.name&&ve(ls,x.ownerDocument.doctype.name)&&(xe="<!DOCTYPE "+x.ownerDocument.doctype.name+`>
`+xe),U&&Pt([E,$,M],Re=>{xe=dt(xe,Re," ")}),L&&N?L.createHTML(xe):xe},t.setConfig=function(){let D=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ht(D),ce=!0},t.clearConfig=function(){Qe=null,ce=!1},t.isValidAttribute=function(D,r,x){Qe||Ht({});const k=de(D),oe=de(r);return Cn(k,oe,x)},t.addHook=function(D,r){typeof r=="function"&&ct(y[D],r)},t.removeHook=function(D){return Un(y[D])},t.removeHooks=function(D){y[D]=[]},t.removeAllHooks=function(){y=Vn()},t}var ds=cs();function us(e,t,n,s){const i=document.createElement("div");i.className="item card",n!=null&&n.has(e.name)?i.classList.add("active"):i.classList.remove("active");const o=document.createElement("button");o.className="icon-grid-size fullsize-button card-button";const a=document.createElement("button");a.className="icon-full-screen fullScreen-button card-button";const c=document.createElement("button");c.className="icon-tile tile-button card-button";const l=document.createElement("button");l.className="icon-info info-button card-button";const u=document.createElement("button");u.className="edit-meta edit-button card-button";const m=document.createElement("button");m.className="copy-path copy-path-button card-button";const v=document.createElement("button");v.className="icon-delete delete-button card-button";const S=document.createElement("button");S.className="icon-send-params send-params-button card-button";const I=document.createElement("div");I.className="item-info";const T=document.createElement("span");T.className="item-info-title",T.textContent=e.name;const q=document.createElement("div");q.className="item-info-description";const A=document.createElement("p");A.textContent=e.prompt;const w=document.createElement("p");w.textContent=e.negative;const f=document.createElement("p");f.textContent=e.tags;const b=document.createElement("p");b.textContent=e.extra,q.appendChild(A),q.appendChild(w),q.appendChild(f),q.appendChild(b),I.appendChild(T),I.appendChild(q);const L=document.createElement("div");L.className="item-actions-row";const _=document.createElement("div");_.className="item-actions";const R=document.createElement("div");R.className="item-actions-top";const X=document.createElement("div");X.className="item-spacer",R.appendChild(S),R.appendChild(X),R.appendChild(o),R.appendChild(a),_.appendChild(c),_.appendChild(l),_.appendChild(m),_.appendChild(u),_.appendChild(v),L.appendChild(R),L.appendChild(_),i.appendChild(L);const p=e[t],d=e.timestamp||"";if(p){const h=document.createElement("div");h.style.backgroundImage=`url('${s}${encodeURIComponent(p)}${d}')`,h.className="item-img",i.appendChild(h)}return i.appendChild(I),i}function Ni(e,t,n,s){const i=document.createElement("div");i.className="item card",n!=null&&n.has(e.name)?i.classList.add("active"):i.classList.remove("active");const o=document.createElement("button");o.className="icon-grid-size fullsize-button card-button";const a=document.createElement("button");a.className="icon-full-screen fullScreen-button card-button";const c=document.createElement("button");c.className="icon-tile tile-button card-button";const l=document.createElement("button");l.className="icon-info info-button card-button";const u=document.createElement("button");u.className="edit-meta edit-button card-button";const m=document.createElement("button");m.className="copy-path copy-path-button card-button";const v=document.createElement("button");v.className="icon-send-params send-params-button card-button";const S=document.createElement("div");S.className="item-info";const I=document.createElement("span");I.className="item-info-title",I.textContent=e.name;const T=document.createElement("div");if(T.className="item-info-description",e.activation_text){const R=document.createElement("p");R.textContent=e.activation_text;const X=document.createElement("p");X.textContent=e.negative_prompt,T.appendChild(R),T.appendChild(X)}const q=document.createElement("p");q.textContent=e.tags,T.appendChild(q),S.appendChild(I),S.appendChild(T);const A=document.createElement("div");A.className="item-actions-row";const w=document.createElement("div");w.className="item-actions";const f=document.createElement("div");f.className="item-actions-top";const b=document.createElement("div");if(b.className="item-spacer",f.appendChild(v),f.appendChild(b),f.appendChild(o),f.appendChild(a),w.appendChild(l),w.appendChild(m),w.appendChild(u),e.metadata_exists){const R=document.createElement("button");R.className="show-meta metadata-button card-button",w.appendChild(R)}A.appendChild(f),A.appendChild(w),i.appendChild(A);const L=e[t],_=e.timestamp||"";if(L){const R=document.createElement("div");R.style.backgroundImage=`url('${s}${encodeURIComponent(L)}${_}')`,R.className="item-img",i.appendChild(R)}return i.appendChild(S),i}const Oi=["clipSkip","cfgScale","sampler","steps","seed","Size"];function ki(e,t){const n=document.createElement("div");n.className="item card";const s=document.createElement("button");s.className="icon-grid-size fullsize-button card-button";const i=document.createElement("button");i.className="icon-full-screen fullScreen-button card-button";const o=document.createElement("button");o.className="icon-tile tile-button card-button";const a=document.createElement("button");a.className="icon-info info-button card-button";const c=document.createElement("button");c.className="icon-stylez civit-add2styles-button card-button";const l=document.createElement("button");l.className="icon-link civit-link-button card-button";const u=document.createElement("button");u.className="icon-send-params send-params-button card-button";const m=document.createElement("div");m.className="item-info";const v=document.createElement("button");v.className="item-info-title",v.textContent=e.username;const S=document.createElement("div");S.className="item-info-description";const I=[];e.baseModel&&I.push(`baseModel: ${e.baseModel}`);const T=e.meta;if(T){if(T.prompt){const _=document.createElement("p");_.textContent="Prompt: "+T.prompt,S.appendChild(_)}if(T.negativePrompt){const _=document.createElement("p");_.textContent="Negative prompt: "+T.negativePrompt,S.appendChild(_)}Oi.forEach(_=>{T[_]!==void 0&&I.push(`${_}: ${T[_]}`)});const L=document.createElement("p");L.textContent=I.join(", "),S.appendChild(L),T.civitaiResources&&T.civitaiResources.forEach(_=>{const R=_.type?_.type:"Unknown Type",X=_.weight?_.weight:"",p=_.name?_.name:"",d=_.modelVersionId?_.modelVersionId:null,h=_.modelVersionName;if(d){const y=document.createElement("p");y.textContent=`${R}: ${X} ${p}`;const E=document.createElement("a");E.textContent=`${h||"Model Id: "+d}`,E.href=`https://civitai.com/api/v1/models/${d}`,E.target="_blank",y.appendChild(E),S.appendChild(y)}})}m.appendChild(v),m.appendChild(S);const q=document.createElement("div");q.className="item-actions-row";const A=document.createElement("div");A.className="item-actions";const w=document.createElement("div");w.className="item-actions-top";const f=document.createElement("div");f.className="item-spacer",w.appendChild(u),w.appendChild(f),w.appendChild(s),w.appendChild(i),A.appendChild(a),A.appendChild(l),A.appendChild(c),q.appendChild(w),q.appendChild(A),n.appendChild(q);let b=e.url;if(b){if(t=="thumbnail"){const _=b.split("width="),R=_[1].split("/")[1];b=_[0]+"width=320/"+R}const L=document.createElement("div");L.style.backgroundImage=`url('${b}')`,L.className="item-img",n.appendChild(L)}return n.appendChild(m),n}function Mi(e,t){var w,f;const n=document.createElement("div");n.className="item card";const s=document.createElement("button");s.className="icon-grid-size fullsize-button card-button";const i=document.createElement("button");i.className="icon-full-screen fullScreen-button card-button";const o=document.createElement("button");o.className="icon-tile tile-button card-button";const a=document.createElement("button");a.className="icon-info info-button card-button";const c=document.createElement("button");c.className="icon-link civit-link-button card-button";const l=document.createElement("button");l.className="icon-send-params send-params-button card-button";const u=document.createElement("div");u.className="item-info";const m=document.createElement("span");m.className="item-info-title",m.textContent=e.name;const v=document.createElement("span");v.textContent=e.type,v.className=`extra-type ${e.type}`;const S=document.createElement("div");S.innerHTML=ds.sanitize(e.description),S.className="item-info-description",u.appendChild(m),u.appendChild(S);const I=document.createElement("div");I.className="item-actions-row";const T=document.createElement("div");T.className="item-actions";const q=document.createElement("div");q.className="item-spacer",T.appendChild(l),T.appendChild(q),T.appendChild(s),T.appendChild(i),T.appendChild(a),T.appendChild(c),I.appendChild(T),n.appendChild(v),n.appendChild(I);let A=(f=(w=e.modelVersions[0])==null?void 0:w.images[0])==null?void 0:f.url;if(A){{const L=A.split("width="),_=L[1].split("/")[1];A=L[0]+"width=320/"+_}const b=document.createElement("div");b.style.backgroundImage=`url(${encodeURI(A)})`,b.className="item-img",n.appendChild(b)}return n.appendChild(u),n}function $i(e){const t=e/1024;return t>=1024?`${(t/1024).toFixed(2)} GB`:`${t.toFixed(2)} MB`}function Ri(e,t,n){const s=document.createElement("div");s.className="item card";const i=document.createElement("button");i.className="icon-grid-size fullsize-button card-button";const o=document.createElement("button");o.className="icon-full-screen fullScreen-button card-button";const a=document.createElement("button");a.className="icon-tile tile-button card-button";const c=document.createElement("button");c.className="icon-info info-button card-button";const l=document.createElement("button");l.className="icon-link civit-link-button card-button";const u=document.createElement("button");u.className="icon-send-params send-params-button card-button";const m=document.createElement("div");m.className="item-info";const v=document.createElement("span");v.className="item-info-title",v.textContent=t.name;const S=document.createElement("span");S.textContent=t.type,S.className=`extra-type ${t.type}`;const I=document.createElement("select");I.className="baseModel-select";const T=t.modelVersions;T.forEach((d,h)=>{const y=document.createElement("option");y.value=h,y.textContent=`${d.baseModel} | ${d.name} | ${d.baseModelType}`,h===n&&(y.selected=!0),I.appendChild(y)});const q=T[n].files[0].downloadUrl,A=T[n].files[0].name,w=T[n].files[0].sizeKB,f=document.createElement("a");f.target="_blank",f.setAttribute("data-url",q),f.className="model-sdownload",f.textContent=`${A} - ${$i(w)}`;let b=T[n].description;n===0&&(b=(t.description||"")+(T[n].description||""));const L=document.createElement("div");L.innerHTML=ds.sanitize(b),L.className="item-info-description",m.appendChild(v),m.appendChild(I),m.appendChild(f);const _=e.url;if(_){const d=document.createElement("a");d.className="download-image-button";const h=_.split(".").pop().split("?")[0],y=`${A.split(".")[0]}.${h}`;d.textContent=`${y}`,d.setAttribute("data-url",_),d.setAttribute("data-filename",y),m.appendChild(d)}m.appendChild(L);const R=document.createElement("div");R.className="item-actions-row";const X=document.createElement("div");X.className="item-actions";const p=document.createElement("div");if(p.className="item-spacer",X.appendChild(u),X.appendChild(p),X.appendChild(i),X.appendChild(o),X.appendChild(c),X.appendChild(l),R.appendChild(X),s.appendChild(S),s.appendChild(R),_){const d=document.createElement("div");d.style.backgroundImage=`url(${_})`,d.className="item-img",s.appendChild(d)}return s.appendChild(m),s}async function Di(){const e=document.querySelector("#civitai_cardholder_images"),t=document.querySelector("#civit_search_images"),n=document.querySelector("#civit_search_images_clear"),s=100,i="/sd_webui_ux/civitai_proxy/images",o={"#civit_nsfw_images":"nsfw","#civit_sort_images":"sort","#civit_period_images":"period","#civit_search_images":"username"},a={limit:s,page:1},c={title:"username",url:"url",dataPath:"items"};let l="thumbnail";const u=new Ye(e,[],18,c,i,a),m=bt(o,a,u);u.createItemElement=I=>ki(I,l);function v(I,T,q){const A=window.UIUX.FOCUS_PROMPT;if(I.classList.contains("copy-path"))navigator.clipboard.writeText(T.filename);else if(I.classList.contains("fullsize-button"))u.scrollToId(T.id),u.isFullSize?(l="thumbnail",u.setFullSize(!1),u.setLayout("vertical"),I.classList.remove("active")):(l="original",u.setFullSize(!0),u.setLayout("vertical"),I.classList.add("active"));else if(I.classList.contains("info-button"))u.setInfo(!u.isInfo);else if(I.classList.contains("fullScreen-button"))u.scrollToId(T.id),u.setFullScreen(!u.isFullScreen);else if(I.classList.contains("send-params-button")){const w=`${T.url}`;st(w,`#pnginfo_send_${A} button`)}else I.classList.contains("item-info-title")?(t.value=I.textContent,je(t)):I.classList.contains("civit-link-button")?window.open(`https://civitai.com/images/${T.id}`,"_blank"):I.classList.contains("civit-add2styles-button")}u.clickHandler=function(I){if(u.dragged||u.scrollDelta)return;const T=I.target.closest(".item.card"),q=T==null?void 0:T.dataset.id;if(q){const A=this.data.find(w=>w.id.toString()===q);console.log(q,I.target,A),A&&v(I.target,A)}I.preventDefault(),I.stopPropagation()};function S(I){t.value="",je(t)}n.addEventListener("click",S),u.updateParamsAndFetch(m,0)}async function zi(){const e=document.querySelector("#civitai_cardholder_models"),t=document.querySelector("#civit_search_models"),n=document.querySelector("#civit_search_models_clear"),s=100,i="/sd_webui_ux/civitai_proxy/models",o={"#civit_nsfw_models":"nsfw","#civit_type_models":"types","#civit_sort_models":"sort","#civit_period_models":"period","#civit_search_models":"query"},a={limit:s,page:1},c={title:"username",url:"url",dataPath:"items"};let l,u=0;const m=new Ye(e,[],18,c,i,a),v=bt(o,a,m);function S(f,b,L){const _=window.UIUX.FOCUS_PROMPT;if(f.classList.contains("civit-link-button"))window.open(`https://civitai.com/models/${b.id}`,"_blank");else if(f.classList.contains("fullsize-button"))m.showDetail(),l=b,u=0,T.setData(b.modelVersions[u].images),T.setFullSize(!0),T.setLayout("vertical"),T.scrollToStart();else if(f.classList.contains("info-button"))m.setInfo(!m.isInfo);else if(f.classList.contains("fullScreen-button"))m.scrollToId(b.id),m.setFullScreen(!m.isFullScreen);else if(f.classList.contains("send-params-button")){const R=`${b.modelVersions[0].images[0].url}`;st(R,`#pnginfo_send_${_} button`)}else f.classList.contains("item-info-title")&&(t.value=f.textContent,je(t))}m.createItemElement=f=>Mi(f),m.clickHandler=function(f){if(m.dragged||m.scrollDelta)return;const b=f.target.closest(".item.card"),L=b==null?void 0:b.dataset.id;if(L){const _=this.data.find(R=>R.id.toString()===L);console.log(L,f.target,_),_&&S(f.target,_)}f.preventDefault(),f.stopPropagation()};const I=e.parentElement.querySelector(".ae-virtual-detail-content"),T=new Ye(I,[],8);T.createItemElement=f=>Ri(f,l,u),T.clickHandler=function(f){if(T.dragged||T.scrollDelta)return;const b=f.target.closest(".item.card"),L=b==null?void 0:b.dataset.id;if(L){const _=this.data.find(R=>R.id.toString()===L);_&&q(f.target,_)}f.preventDefault(),f.stopPropagation()},T.changeHandler=function(f){const b=f.target;b.classList.contains("baseModel-select")&&(u=parseInt(b.value),this.setData(l.modelVersions[u].images))};function q(f,b,L){const _=window.UIUX.FOCUS_PROMPT;if(f.classList.contains("civit-link-button"))window.open(`https://civitai.com/models/${l.id}?modelVersionId=${l.modelVersions[u].id}`,"_blank");else if(f.classList.contains("fullsize-button"))m.hideDetail();else if(f.classList.contains("info-button"))T.setInfo(!T.isInfo);else if(f.classList.contains("fullScreen-button"))T.scrollToId(b.id),T.setFullScreen(!T.isFullScreen);else if(f.classList.contains("send-params-button")){const R=`${b.url}`;st(R,`#pnginfo_send_${_} button`)}else f.classList.contains("item-info-title")||(f.classList.contains("download-image-button")?A(f.dataset.url,f.dataset.filename):f.classList.contains("model-sdownload")&&A(f.dataset.url))}function A(f,b){const L=document.createElement("a");L.target="_blank",L.href=f,b&&(L.download=b),document.body.appendChild(L),L.click(),document.body.removeChild(L)}function w(f){t.value="",je(t)}n.addEventListener("click",w),m.updateParamsAndFetch(v,0)}function _e(e,t,n,s=""){this.container=document.querySelector(e),this.fetchUrl=t,this.tableName=n,this.rootPath=s.replace(/\\/g,"/").toLowerCase(),this.selected}_e.prototype.initialize=async function(){this.container.innerHTML="";const e=await this.fetchData(this.rootPath),t=this.buildTree(e),n=this.createTreeView(t);this.container.appendChild(n),this.attachEventListeners(),this.itemMap=e.reduce((s,i)=>(s[i.id]=i,s),{})};_e.prototype.updateSelectedItems=function(){var e;this.container.querySelectorAll(".li-file.active").forEach(t=>{t.classList.remove("active")}),(e=this.selected)==null||e.forEach(t=>{const n=this.container.querySelector(`.li-file[data-name="${t}"]`);n&&n.classList.add("active")})};_e.prototype.fetchData=async function(e){const n=await(await fetch(`${this.fetchUrl}?table_name=${this.tableName}&path=${encodeURIComponent(e)}`)).json();return this.data=n.data,this.subpaths=n.unique_subpaths,this.subpaths=this.subpaths.map(s=>{const i=s.split(e);return{path:s,relativePath:i[1],basePath:`${i[0]}${e}`}}),console.log(this.subpaths),console.log("tree data length:",this.data.length),n.data};_e.prototype.buildTree=function(e){const t={},n=this.rootPath;t[n]={};const s=t[n];return e.forEach(i=>{const o=i.filename.replace(/\\/g,"/").toLowerCase(),a=o.indexOf(n);if(a===-1)return;const l=o.slice(a+n.length).replace(/^\//,"").split("/").filter(Boolean);let u=s;for(let m=0;m<l.length;m++){const v=l[m];u[v]||(m===l.length-1?u[v]=i:u[v]={}),u=u[v]}}),t};_e.prototype.createFileItem=function(e,t){const n=document.createElement("li");return n.dataset.name=e[t].name,n.dataset.id=e[t].id,n.innerHTML=`<summary class="tree-file">${e[t].name}</summary>`,n.classList.add("li-file"),n};_e.prototype.createFolderItem=function(e,t,n){n+="/"+t,n=n.replace(/\/{2,}/g,"/");const s=document.createElement("li");s.innerHTML=`<summary class="tree-folder caret" data-path="${n}">${t}</summary>`;const i=this.createTreeView(e[t],n);return i.classList.add("nested"),s.appendChild(i),s};_e.prototype.createTreeView=function(e,t=""){const n=document.createElement("ul");n.classList.add("tree-view");for(const s in e){let i;typeof e[s]=="object"&&!Array.isArray(e[s])?s.includes(".safetensors")||s.includes(".pt")||s.includes(".png")||s.includes(".jpg")||s.includes(".webp")?i=this.createFileItem(e,s):i=this.createFolderItem(e,s,t):i=this.createFileItem(e,s),n.appendChild(i)}return n};_e.prototype.attachEventListeners=function(){this.eventListenerAdded||(this.container.addEventListener("click",async e=>{const t=e.target,n=t.closest("li[data-id]");if(t.tagName==="BUTTON"){const i=n.dataset.id,o=this.getItemProperties(i);this.onFileClicked(t,o)}else if(n){const i=n.dataset.id,o=this.getItemProperties(i);this.onFileClicked(n,o)}else if(t.classList.contains("caret")){t.classList.toggle("caret-down");const i=t.nextElementSibling;i.classList.contains("nested")&&i.classList.toggle("active"),this.onFolderClicked(t,t.getAttribute("data-path"),i.classList.contains("active"))}e.stopPropagation()}),this.eventListenerAdded=!0)};_e.prototype.getItemProperties=function(e){return this.itemMap[e]};_e.prototype.update=async function(){const e=[];this.container.querySelectorAll(".tree-folder.caret-down").forEach(n=>{e.push(n.dataset.path)});const t=this.container.parentElement.scrollTop;await this.initialize(),e.forEach(n=>{const s=this.container.querySelector(`.tree-folder[data-path="${n}"]`);s&&s.click()}),this.container.parentElement.scrollTop=t,this.attachEventListeners()};_e.prototype.updateDataById=function(e,t){const n=this.itemMap[t];if(n)for(const[s,i]of Object.entries(e))n[s]=i;else console.error(`Item with ID ${t} not found.`)};_e.prototype.onFolderClicked=function(e,t,n){};_e.prototype.onFileClicked=function(e,t){};function me(e,t,n,s,i="Submit"){this.url=e,this.table_name=t,this.itemData=n,this.container=s,this.submit_label=i,this.form=document.createElement("form"),this.form.setAttribute("id","userMetadataForm"),this.form.classList.add("flexbox","padding","col","shrink")}me.prototype.formatFileSize=function(e){return typeof e!="number"?"0 bytes":e>=1073741824?(e/1073741824).toFixed(2)+" GB":e>=1048576?(e/1048576).toFixed(2)+" MB":e>=1024?(e/1024).toFixed(2)+" KB":e+" bytes"};me.prototype.formatDate=function(e){return typeof e!="number"?"":new Date(e*1e3).toLocaleDateString()};me.prototype.formatFilename=function(e){return typeof e!="string"?"":e.replace(/\\/g,"/").split("/").pop()};me.prototype.createElement=function(e,t,n,s={}){const i={textarea:{tag:"textarea",attributes:{...s,rows:s.rows||1,textContent:n||""}},select:{tag:"select",attributes:{id:s.id,class:s.class,name:s.name},children:Array.isArray(s.options)?s.options.map(l=>({option:{type:"option",value:l.value,textContent:l.textContent,selected:l.value===s.value}})):[]},option:{tag:"option",attributes:{...s}},input:{tag:"input",attributes:{...s,type:"text",value:n||""}},file:{tag:"input",attributes:{type:"file"}},number:{tag:"input",attributes:{type:"number",value:n}},checkbox:{tag:"input",attributes:{type:"checkbox",checked:n}},radio:{tag:"input",attributes:{type:"radio",checked:n}},slider:{tag:"input",attributes:{type:"range",value:n}},img:{tag:"img",attributes:{src:s.req+n,alt:t,class:"thumbnail-image"}},button:{tag:"button",textContent:n,attributes:{type:"button",id:s.id,class:"ae-button",name:t}},placeholder:{tag:"div",attributes:s},row:{tag:"div",attributes:{id:s.id,class:`flexbox row ${s.class||""}`},children:s.children},col:{tag:"div",attributes:{id:s.id,class:`flexbox col ${s.class||""}`},children:s.children},panel:{tag:"div",attributes:{id:s.id,class:`panel padding ${s.class||""}`},children:s.children},default:{tag:"input",attributes:{type:"text",value:n||""}}},o=i[e]||i.default,a=document.createElement(o.tag);return((l,u)=>{Object.entries(u).forEach(([m,v])=>{typeof m=="string"&&m.trim()!==""?m==="textContent"?l.textContent=v:m==="checked"?l.checked=!!v:m==="selected"?l.selected=!!v:(typeof v=="string"||typeof v=="number")&&l.setAttribute(m,v):console.warn(`Invalid attribute name: ${m}`)})})(a,o.attributes),o.children&&o.children.forEach(l=>{const u=Object.keys(l)[0],m=l[u],v=m.value!==void 0?m.value:this.itemData[u]||"",S=this.createElement(m.type,u,v,m);a.appendChild(S)}),a};me.prototype.addElementToForm=function(e,t){const n=document.createElement("div");n.classList.add("panel","col","padding"),t.id&&(n.id=t.id);const s=document.createElement("label");s.setAttribute("for",e),s.classList.add("flexbox"),s.textContent=t.label||e.replace("_"," ").toUpperCase();const i=this.createElement(t.type,e,this.itemData[e],t);n.appendChild(s),n.appendChild(i),this.form.appendChild(n)};me.prototype.createForm=function(e){Object.entries(e).forEach(([i,o])=>{(this.itemData.hasOwnProperty(i)||o.draw==="true")&&this.addElementToForm(i,o)});const t=document.createElement("div");t.classList.add("panel","row","flex-end");const n=document.createElement("button");n.setAttribute("type","submit"),n.textContent=this.submit_label,n.classList.add("ae-submit-button"),t.appendChild(n);const s=document.createElement("button");if(s.setAttribute("type","button"),s.textContent="Cancel",s.classList.add("ae-submit-button","cancel"),t.appendChild(s),this.itemData.id){const i=document.createElement("button");i.setAttribute("type","button"),i.textContent="Delete",i.classList.add("ae-submit-button","delete"),t.appendChild(i)}return this.form.appendChild(t),this.form.addEventListener("submit",i=>this.handleSubmit(i)),this.form};me.prototype.createValueElement=function(e,t,n,s,i){let o=`?t=${new Date().getTime()}`;i&&i.indexOf("filename=")!==-1&&(o=`&t=${new Date().getTime()}`);const a={filename:{textContent:this.formatFilename(n)},filesize:{textContent:this.formatFileSize(n)},"date-format":{textContent:this.formatDate(n)},img:{tag:"img",attributes:{src:i+n+o,alt:t,class:"thumbnail-image"}},button:{tag:"button",textContent:s||"button",attributes:{class:`ae-button ${t}`,name:t}},default:{textContent:n||""}},c=a[e]||a.default;let l;return c.tag?(l=document.createElement(c.tag),Object.entries(c.attributes).forEach(([u,m])=>{l.setAttribute(u,m)}),c.textContent&&(l.textContent=c.textContent)):(l=document.createElement("span"),l.textContent=c.textContent),l};me.prototype.createTable=function(e){const t=document.createElement("table");return t.classList.add("non-editable-table","panel"),Object.entries(e).forEach(([n,s])=>{const i=document.createElement("tr"),o=document.createElement("td");o.textContent=n.replace("_"," ").toUpperCase(),i.appendChild(o);const a=document.createElement("td"),c=this.createValueElement(s.type,n,this.itemData[n]);a.appendChild(c),i.appendChild(a),t.appendChild(i)}),t};me.prototype.createHtmlElement=function(e){const t=document.createElement("div");return t.classList.add("non-editable-div","flexbox","col","shrink"),Object.entries(e).forEach(([n,s])=>{const i=document.createElement("div");if(i.classList.add("panel",n),s.showLabel!==!1){const a=document.createElement("label");a.textContent=n.replace("_"," ").toUpperCase(),i.appendChild(a)}const o=this.createValueElement(s.type,n,this.itemData[n],s.label||"",s.api);i.appendChild(o),t.appendChild(i)}),t};me.prototype.buildTags=function(e){const t=/[-_\w']+/g;function n(o){return Object.keys(o).reduce((c,l)=>c+l.length,0)/Object.keys(o).length>=16}const s={},i=e.ss_tag_frequency||{};for(const o of Object.values(i))for(const[a,c]of Object.entries(o)){const l=a.trim();s[l]=(s[l]||0)+parseInt(c,10)}if(Object.keys(s).length>0&&n(s)){const o={};for(const[a,c]of Object.entries(s)){const l=a.match(t)||[];for(const u of l)u.length>=3&&(o[u]=(o[u]||0)+c)}return Object.entries(o).sort(([,a],[,c])=>c-a).map(([a,c])=>[a,c])}return Object.entries(s).sort(([,o],[,a])=>a-o).map(([o,a])=>[o,a])};me.prototype.createTagsElement=function(e,t){const n=this.buildTags(e);if(n.length>0){const s=document.createElement("div");s.classList.add("non-editable-tags","flexbox","shrink");const i=document.createElement("div");if(i.classList.add("panel","flexbox","row","padding"),t){const o=document.createElement("label");o.textContent=t.toUpperCase(),i.appendChild(o)}return Object.entries(n).forEach(o=>{const a=document.createElement("button");a.type="button",a.textContent=o[1][0];const c=document.createElement("span");c.classList.add("tag-num"),c.textContent=o[1][1],a.appendChild(c),i.appendChild(a)}),s.appendChild(i),s}return!1};me.prototype.afterFormSubmit=function(e,t,n){};me.prototype.beforeFormSubmit=function(e){return e};me.prototype.handleSubmit=async function(e){e.preventDefault();const t=new FormData(this.form),n=Object.fromEntries(t.entries());let s=n;s.table_name=this.table_name,s.name=this.itemData.name,s=this.beforeFormSubmit(n);let i;s.file&&(i=s.file,delete s.file);const o=new FormData;o.append("payload",JSON.stringify(s)),i&&o.append("file",i);try{const a=await fetch(this.url,{method:"POST",body:o});if(!a.ok)throw new Error(`HTTP error! Status: ${a.status}`);const c=await a.json();await this.afterFormSubmit(n,c.data,c.message)}catch(a){console.error("Failed to fetch data:",a)}};async function Fi(){zt("checkpoints","checkpoint","stable-diffusion/")}async function Ui(){zt("textual_inversion","textualinversion","embeddings/")}async function qi(){zt("lora","lora","lora/")}async function Hi(){zt("hypernetworks","hypernetwork","hypernetworks/")}function Bi(e,t){const n=e.parentElement.querySelector(".ae-virtual-detail-content");n.innerHTML="",n.appendChild(t)}async function ji(e,t,n,s){const i=`/sd_webui_ux/get_internal_metadata?type=${encodeURIComponent(e)}&name=${encodeURIComponent(t)}`;is(i,function(o){console.log(o),n.showDetail();const a=window.extraNetworksFlattenMetadata(o),c=window.createVisualizationTable(a,0);Bi(s,c)})}const We={};async function zt(e,t,n){const s=document.querySelector(`#${e}_cardholder`),i=document.querySelector(`#${e}_search`);document.querySelector(`#${e}_sort`);const o=document.querySelector(`#${e}_order`);document.querySelector(`#${e}_sd_version`);const a=document.querySelector(`#${e}_refresh`),c=document.querySelector(`#${e}_rebuild`),l=document.querySelector(`#${e}_clear`),u=document.querySelector("#refresh_database");We[`txt2img_${t}`]=[],We[`img2img_${t}`]=[];const m=100,v="/sd_webui_ux/get_items_from_db",S="GET",I={table_name:t,skip:0,limit:m,sort_by:"name",order:"asc",search_term:""},T={title:"name",url:"preview",dataPath:"items"},q={[`#${e}_search`]:"search_term",[`#${e}_sort`]:"sort_by",[`#${e}_search_in`]:"search_columns",[`#${e}_sd_version`]:"sd_version"},A=d=>(d.skip=0,d),w=new Ye(s,[],18,T,v,I,S),f=bt(q,I,w,A);w.setNextCursor=function(d){d&&this.data.length>0?this.params.skip=this.params.cursor=d:delete this.params.cursor};let b="thumbnail";w.createItemElement=d=>Ni(d,b,w.selected,"/sd_extra_networks/thumb?filename=");function L(d,h,y){var W;const E=window.UIUX.FOCUS_PROMPT;let $=((W=h.prompt)==null?void 0:W.replace("opts.extra_networks_default_multiplier",h.preferred_weight>0?h.preferred_weight:opts.extra_networks_default_multiplier))||"";$+=h.activation_text||"";const M=h.negative_prompt||"";if(d.classList.contains("copy-path"))navigator.clipboard.writeText(h.filename);else if(d.classList.contains("fullsize-button"))w.scrollToId(h.id),w.isFullSize?(b="thumbnail",w.setFullSize(!1),w.setLayout("vertical"),d.classList.remove("active")):(b="local_preview",w.setFullSize(!0),w.setLayout("vertical"),d.classList.add("active"));else if(d.classList.contains("info-button"))w.setInfo(!w.isInfo);else if(d.classList.contains("fullScreen-button"))w.scrollToId(h.id),w.setFullScreen(!w.isFullScreen);else if(d.classList.contains("show-meta"))ji(h.type,h.name,w,s);else if(d.classList.contains("edit-meta"))p(h,h.id);else if(d.classList.contains("send-params-button")){const Z=`/sd_extra_networks/thumb?filename=${encodeURIComponent(h.preview||h.local_preview)}`;st(Z,`#pnginfo_send_${E} button`)}else if(h.type==="Checkpoint"){if(w.isFullSize)return;window.selectCheckpoint(h.name)}else if(h.type==="TextualInversion"){if(w.isFullSize)return;window.cardClicked(E,$,M,!0),We[`${E}_textualinversion`].push({id:h.id,name:h.name,value:$})}else if(h.type==="LORA"){if(w.isFullSize)return;window.cardClicked(E,$,M,!1),We[`${E}_lora`].push({id:h.id,name:h.name,value:`<lora:${$.split(":")[1]}`})}else if(h.type==="Hypernetwork"){if(w.isFullSize)return;window.cardClicked(E,$,M,!1),We[`${E}_hypernetwork`].push({id:h.id,name:h.name,value:$})}}w.clickHandler=function(d){if(w.dragged||w.scrollDelta)return;const h=d.target.closest(".item.card"),y=h==null?void 0:h.dataset.id;if(y){const E=this.data.find($=>$.id.toString()===y);E&&L(d.target,E)}d.stopPropagation()},c.addEventListener("click",d=>{ze("/sd_webui_ux/generate-thumbnails",{table_name:t},function(h){console.log(h),setTimeout(()=>{f.skip=0,w.updateParamsAndFetch(f,0)},1e3)})}),o.addEventListener("click",d=>{const h=o.classList.contains("active");f.skip=0,f.order=h?"desc":"asc",w.updateParamsAndFetch(f,0)}),l.addEventListener("click",d=>{i.value="",je(i)}),w.updateParamsAndFetch(f,0);const _=new _e(`#${e}_tree_view`,"/sd_webui_ux/get_items_by_path",t,n);_.initialize(),_.createFileItem=function(d,h){var W;const y=document.createElement("li");y.dataset.name=d[h].name,y.dataset.id=d[h].id,(W=this.selected)!=null&&W.has(d[h].name)&&y.classList.add("active"),y.innerHTML=`<summary class="tree-file">${d[h].name}</summary>`,y.classList.add("li-file");const E=document.createElement("button");E.className="edit-meta edit-button card-button";const $=document.createElement("button");$.className="copy-path copy-path-button card-button";const M=document.createElement("div");if(M.className="item-actions",M.appendChild($),d[h].metadata_exists){const Z=document.createElement("button");Z.className="show-meta metadata-button card-button",M.appendChild(Z)}return M.appendChild(E),y.appendChild(M),y},_.onFolderClicked=function(d,h,y){},_.onFileClicked=function(d,h){L(d,h,h.id)},a.addEventListener("click",d=>{u.click(),setTimeout(()=>{f.skip=0,w.updateParamsAndFetch(f,0),_.initialize()},1e3)});function R(d){const h=window.UIUX.FOCUS_PROMPT,y=We[`${h}_${t}`];setTimeout(()=>{let E="";document.querySelectorAll(`#${h}_prompt textarea, #${h}_neg_prompt textarea`).forEach(W=>{E+=W.value});const $=y.filter(W=>W&&W.value&&E.includes(W.value));We[`${h}_${t}`]=$;const M=new Set($.map(W=>W.name));w.selected=_.selected=M,w.renderItems(),_.updateSelectedItems()},100)}function X(d){const h=window.UIUX.FOCUS_PROMPT;let y="";if(document.querySelectorAll(`#${h}_prompt textarea, #${h}_neg_prompt textarea`).forEach(M=>{y+=` ${M.value}`}),y.length>2){let M=function(te){return te.replace(/[()]+|:[0-9]+(.[0-9]+)?/g,"").trim()};var E=M;let Z=y.trim().split(/[\s,.]+/).map(M).filter(Boolean);if(t==="lora"||t==="hypernetwork"){let le=function(ae){if(ae.includes(`${te}:`)){const z=ae.split(`${te}:`)[1].split(":")[0];return`<${te}:${z}:opts.extra_networks_default_multiplier>`}return""};var $=le;const te=t==="lora"?"lora":"hypernet";Z=y.trim().split("<").map(le).filter(Boolean)}Z.length>0&&ze("/sd_webui_ux/search_words_in_tables_columns",{tables:t,columns:"prompt",words:Z},function(ne){const z=ne[t].map(K=>{let Q=K.prompt;return(t==="lora"||t==="hypernetwork")&&(Q=`<${t==="lora"?"lora":"hypernet"}:${K.prompt.split(":")[1]}`),{id:K.id,name:K.name,value:Q}});We[`${h}_${t}`]=z,w.selected=_.selected=new Set(z.map(K=>K.name)),w.renderItems(),_.updateSelectedItems()})}else w.selected=_.selected=new Set,w.renderItems(),_.updateSelectedItems()}t!=="checkpoint"?document.querySelectorAll("#txt2img_prompt textarea, #img2img_prompt textarea, #txt2img_neg_prompt textarea, #img2img_neg_prompt textarea").forEach(d=>{d.addEventListener("input",R),d.addEventListener("focus",X)}):li(w,_);function p(d,h){const y={local_preview:{type:"input",name:"local_preview"},sd_version:{type:"select",name:"sd_version",label:"SD Version",value:d.sd_version,options:mn},preferred_weight:{type:"number",name:"preferred_weight",label:"Preferred Weight"},activation_text:{type:"textarea",name:"activation_text",label:"Activation Text",rows:4},negative_prompt:{type:"textarea",name:"negative_prompt",label:"Negative Prompt",rows:2},description:{type:"textarea",name:"description",label:"Description",rows:2},tags:{type:"textarea",name:"tags",label:"Tags"},notes:{type:"textarea",name:"notes",label:"Notes",rows:2}},E={filename:{type:"filename"},filesize:{type:"filesize"},type:{type:"text"},hash:{type:"text"},date_created:{type:"date-format"},date_modified:{type:"date-format"}},$={thumbnail:{type:"img",api:"/sd_extra_networks/thumb?filename=",showLabel:!1},replace_preview:{type:"button",label:"Replace Preview",showLabel:!1},browse_preview:{type:"button",label:"Browse Preview",showLabel:!1}},M=`/sd_webui_ux/get_internal_metadata?type=${encodeURIComponent(d.type)}&name=${encodeURIComponent(d.name)}`;is(M,function(W){var ce;const Z=W,te="/sd_webui_ux/update_user_metadata",le=document.getElementById("formContainer"),ne=new me(te,t,d,le),ae=ne.createForm(y),z=ne.createTable(E),K=ne.createHtmlElement($),Q=ne.createTagsElement(Z,"Train Tags");if(Q){(ce=ae.children[2])==null||ce.insertAdjacentElement("afterend",Q);let F=ae.querySelector("#activation_text");ae.addEventListener("click",Y=>{const fe=Y.target.closest("textarea");fe&&(F=fe);const N=Y.target.closest("button[type=button]");if(N){const H=N.childNodes[0].textContent.trim(),ie=F.value;ie.includes(H)?F.value=ie.split(",").map(re=>re.trim()).filter(re=>re!==H).join(", "):F.value+=(ie?", ":"")+H}})}const se=document.createElement("div");se.classList.add("non-editable-info","flexbox","padding","shrink"),se.appendChild(K),se.appendChild(z),w.showDetail();const j=s.parentElement.querySelector(".ae-virtual-detail-content");j.innerHTML="",j.appendChild(se),j.appendChild(ae);function pe(F){const Y=F.lastIndexOf(".");return Y===-1?F:F.substring(0,Y)}function be(F){const Y=F.lastIndexOf("/"),fe=F.substring(0,Y),N=F.substring(Y+1),H=N.lastIndexOf("."),ie=N.substring(0,H);return{path:fe,filename:N,filename_no_ext:ie}}let P,g;ne.beforeFormSubmit=function(F){return F.id=d.id,F.type=d.type,F.name=d.name,F.prompt=d.prompt,F.filename=d.filename,P&&(F.source_file=P),g&&(F.file=g),console.log(F),F};let C=d.local_preview;ne.afterFormSubmit=function(F){w.hideDetail();const Y=be(C),fe=new Date().getTime();F.thumbnail=`${Y.path}/thumbnails/${Y.filename_no_ext}.thumb.webp`,F.timestamp=`&t=${fe}`,w.updateDataById(F,h),_.update()};const O=K.querySelector("button.replace_preview"),U=K.querySelector(".thumbnail-image");O.addEventListener("click",F=>{const Y=window.UIUX.FOCUS_PROMPT,fe=document.querySelector(`#${Y}_gallery [data-testid="detailed-image"]`);fe&&(P=fe.src.split("file=")[1].split("?")[0],U.style.filter="grayscale(1)")});const ee=document.createElement("input");ee.type="file",ee.accept="image/jpeg, image/png, image/webp, image/gif",ee.addEventListener("change",F=>{const Y=F.target.files[0];Y&&(g=Y,U.style.filter="grayscale(1)")}),K.querySelector("button.browse_preview").addEventListener("click",F=>{ee.click()})})}}async function Wi(){Gi("styles","styles","styles_data/")}const et={};let V,Se,ke,sn;async function Gi(e,t,n){sn=document.querySelector(`#${e}_cardholder`);const s=document.querySelector(`#${e}_search`);document.querySelector(`#${e}_sort`);const i=document.querySelector(`#${e}_order`);document.querySelector(`#${e}_sd_version`);const o=document.querySelector(`#${e}_refresh`),a=document.querySelector(`#${e}_rebuild`),c=document.querySelector(`#${e}_clear`),l=document.querySelector("#refresh_styles_database");et[`txt2img_${t}`]=[],et[`img2img_${t}`]=[];const u=100,m="/sd_webui_ux/get_items_from_db",v="GET",S={table_name:t,skip:0,limit:u,sort_by:"name",order:"asc",search_term:""},I={title:"name",url:"preview",dataPath:"items"},T={[`#${e}_search`]:"search_term",[`#${e}_sort`]:"sort_by",[`#${e}_search_in`]:"search_columns",[`#${e}_sd_version`]:"sd_version"},q=p=>(p.skip=0,p);V=new Ye(sn,[],18,I,m,S,v),ke=bt(T,S,V,q),V.setNextCursor=function(p){p&&this.data.length>0?this.params.skip=this.params.cursor=p:delete this.params.cursor};let A="thumbnail";V.createItemElement=p=>us(p,A,V.selected,"/sd_styles/thumb/"),V.clickHandler=function(p){if(V.dragged||V.scrollDelta)return;const d=p.target.closest(".item.card"),h=d==null?void 0:d.dataset.id;if(h){const y=this.data.find(E=>E.id.toString()===h);y&&b(p.target,y)}p.preventDefault(),p.stopPropagation()},a.addEventListener("click",p=>{ze("/sd_webui_ux/generate-thumbnails",{table_name:t},function(d){setTimeout(()=>{ke.skip=0,V.updateParamsAndFetch(ke,0)},1e3)})}),i.addEventListener("click",p=>{const d=i.classList.contains("active");ke.skip=0,ke.order=d?"desc":"asc",V.updateParamsAndFetch(ke,0)}),c.addEventListener("click",p=>{s.value="",je(s)}),V.updateParamsAndFetch(ke,0),Se=new _e(`#${e}_tree_view`,"/sd_webui_ux/get_items_by_path",t,n),Se.initialize(),Se.createFileItem=function(p,d){var M;const h=document.createElement("li");h.dataset.name=p[d].name,h.dataset.id=p[d].id,(M=this.selected)!=null&&M.has(p[d].name)&&h.classList.add("active"),h.innerHTML=`<summary class="tree-file">${p[d].name}</summary>`,h.classList.add("li-file");const y=document.createElement("button");y.className="edit-meta edit-button card-button";const E=document.createElement("button");E.className="copy-path copy-path-button card-button";const $=document.createElement("div");return $.className="item-actions",$.appendChild(E),$.appendChild(y),h.appendChild($),h},Se.onFolderClicked=function(p,d,h){},Se.onFileClicked=function(p,d){b(p,d,d.id)},o.addEventListener("click",p=>{l.click(),setTimeout(()=>{ke.skip=0,V.updateParamsAndFetch(ke,0),Se.initialize()},1e3)});function w(p){const d=window.UIUX.FOCUS_PROMPT,h=et[`${d}_${t}`];setTimeout(()=>{let y="";document.querySelectorAll(`#${d}_prompt textarea, #${d}_neg_prompt textarea`).forEach(M=>{y+=M.value});const E=h.filter(M=>M&&M.value&&y.includes(M.value));et[`${d}_${t}`]=E;const $=new Set(E.map(M=>M.name));V.selected=Se.selected=$,V.renderItems(),Se.updateSelectedItems()},100)}function f(p){const d=window.UIUX.FOCUS_PROMPT;let h="";if(document.querySelectorAll(`#${d}_prompt textarea`).forEach(E=>{h+=`${E.value}`}),h.length>2){let E=function(Z){return Z.replace(/[()]+|:[0-9]+(.[0-9]+)?/g,"").trim()};var y=E;const W=h.trim().split(". ").map(E).filter(Boolean).map(Z=>". "+Z);W.length>0&&ze("/sd_webui_ux/search_words_in_tables_columns",{words:W,tables:t,columns:"prompt",threshold:1},function(le){const ne=le[t];console.log(ne);const ae=ne.map(z=>({id:z.id,name:z.name,value:z.prompt}));et[`${d}_${t}`]=ae,V.selected=Se.selected=new Set(ae.map(z=>z.name))})}else V.selected=Se.selected=new Set;V.renderItems(),Se.updateSelectedItems()}document.querySelectorAll("#txt2img_prompt textarea, #img2img_prompt textarea, #txt2img_neg_prompt textarea, #img2img_neg_prompt textarea").forEach(p=>{p.addEventListener("input",w),p.addEventListener("focus",f)});function b(p,d,h){const y=window.UIUX.FOCUS_PROMPT,E=d.prompt||"",$=d.negative||"";if(p.classList.contains("copy-path"))navigator.clipboard.writeText(d.filename);else if(p.classList.contains("fullsize-button"))V.scrollToId(d.id),V.isFullSize?(A="thumbnail",V.setFullSize(!1),V.setLayout("vertical"),p.classList.remove("active")):(A="local_preview",V.setFullSize(!0),V.setLayout("vertical"),p.classList.add("active"));else if(p.classList.contains("tile-button"))V.setTileable(!V.isTileable);else if(p.classList.contains("info-button"))V.setInfo(!V.isInfo);else if(p.classList.contains("fullScreen-button"))V.scrollToId(d.id),V.setFullScreen(!V.isFullScreen);else if(p.classList.contains("edit-meta"))_(d,d.id);else if(p.classList.contains("delete-button"))L(d,d.id);else if(p.classList.contains("send-params-button")){const M=`/sd_styles/thumb/${encodeURIComponent(d.local_preview)}`;st(M,`#pnginfo_send_${y} button`)}else if(d.type==="Style"){if(V.isFullSize)return;window.cardClicked(y,E,$,!0),et[`${y}_styles`].push({id:d.id,name:d.name,value:E})}}function L(p,d){const h="/sd_webui_ux/delete_item",y={table_name:t,item_id:p.id};ze(h,y,function(E){V.removeDataById(p.id),Se.update()})}function _(p,d){const h="styles",y=Se.subpaths,E=new Set(y.map(N=>N.relativePath)),$=Array.from(E);let M=[{value:"None",textContent:"None"}],W;$.forEach(N=>{var H;(H=p.filename)!=null&&H.includes(`${N}/`)&&(W=N),M.push({value:N,textContent:N})});const Z={local_preview:{type:"input",id:"local_preview_path",name:"local_preview",label:"Local Preview"},row:{type:"row",draw:"true",id:"parent_folder_select_row",label:"Parent Category / Filename",children:[{parent_folder:{type:"select",id:"parent_folder_select",class:"grow",value:W,options:M}},{save_path:{type:"input",id:"parent_folder_save",class:"grow",value:p.name,label:"Style Name"}}]},sd_version:{type:"select",name:"sd_version",label:"SD Version",value:p.sd_version,options:mn},prompt:{type:"textarea",name:"prompt",label:"Prompt",rows:4},negative:{type:"textarea",name:"negative",label:"Negative Prompt",rows:2},tags:{type:"textarea",name:"tags",label:"Tags"},description:{type:"textarea",name:"description",label:"Description",rows:2}},te={filename:{type:"filename",label:"Filename"},filesize:{type:"filesize",label:"Filesize"},type:{type:"text",label:"Type"},hash:{type:"text",label:"Hash"},date_created:{type:"date-format",label:"Date Created"},date_modified:{type:"date-format",label:"Date Modified"}},le={thumbnail:{type:"img",api:"/sd_styles/thumb/",showLabel:!1},replace_preview:{type:"button",label:"Replace Preview",showLabel:!1}},ne="/sd_webui_ux/update_user_metadata",ae=document.getElementById("formContainer"),z=new me(ne,h,p,ae),K=z.createForm(Z),Q=z.createTable(te),se=z.createHtmlElement(le),j=document.createElement("div");j.classList.add("non-editable-info","flexbox","padding","shrink"),j.appendChild(se),j.appendChild(Q),V.showDetail();const pe=sn.parentElement.querySelector(".ae-virtual-detail-content");pe.innerHTML="",pe.appendChild(j),pe.appendChild(K);const be=K.querySelector("#parent_folder_select"),P=K.querySelector("#parent_folder_select_row label"),g=K.querySelector("#parent_folder_save"),C=K.querySelector("#local_preview_path input"),O=K.querySelector("button.delete");let U;const ee=N=>N.replace(/\/{2,}/g,"/"),J=N=>{const H=be.value!=="None"?be.value:"",ie=g.value,re=`${H}/${ie}`;P.textContent=`Style will be saved: ${ee(re)}.png`,U=ee(`${y[0].basePath}/${re}.png`),C.value=U};be.addEventListener("change",J),g.addEventListener("input",J),J();function ce(N){const H=N.lastIndexOf("/"),ie=N.substring(0,H),re=N.substring(H+1),Ve=re.lastIndexOf("."),Fe=re.substring(0,Ve);return{path:ie,filename:re,filename_no_ext:Fe}}let F;z.beforeFormSubmit=function(N){return N.name=ce(U).filename_no_ext,N.filename=U,N.type="Style",p.id&&(N.id=p.id),F&&(N.source_file=F),N},z.afterFormSubmit=function(N,H){V.hideDetail(),V.updateDataById(H,H.id),Se.update()};function Y(){const N=window.UIUX.FOCUS_PROMPT,H=document.querySelector(`#${N}_gallery [data-testid="detailed-image"]`);if(H){const ie=se.querySelector(".thumbnail-image");F=H.src.split("file=")[1].split("?")[0],ie.style.filter="grayscale(1)"}}se.querySelector("button.replace_preview").addEventListener("click",N=>{Y()}),p.id||Y(),p.id&&O.addEventListener("click",N=>{const H="/sd_webui_ux/delete_item",ie={table_name:h,item_id:p.id};ze(H,ie,function(re){console.log(re),V.hideDetail(),ke.skip=0,V.updateParamsAndFetch(ke,0),Se.update()})})}function R(){const p=window.UIUX.FOCUS_PROMPT,d=document.querySelector(`#${p}_prompt textarea`),h=document.querySelector(`#${p}_neg_prompt textarea`),y=$=>$.replace(/\s{2,}/g," ").replace(/(\. )\1+/g,". "),E={};E.prompt=y(". "+d.value),E.negative=y(". "+h.value),E.name="Untitled",E.description="",E.tags="",E.local_preview="",_(E)}document.querySelector("#layout_db_styles button.create-style").addEventListener("click",p=>{R()})}async function Vi(){Xi("output_images","images","outputs/")}const tt={};let B,we,De,on;async function Xi(e,t,n){on=document.querySelector(`#${e}_cardholder`);const s=document.querySelector(`#${e}_search`),i=document.querySelector(`#${e}_sort`);i.value="date_created";const o=document.querySelector(`#${e}_order`);document.querySelector(`#${e}_sd_version`);const a=document.querySelector(`#${e}_refresh`),c=document.querySelector(`#${e}_rebuild`),l=document.querySelector(`#${e}_clear`);document.querySelector("#refresh_output_images_database"),tt[`txt2img_${t}`]=[],tt[`img2img_${t}`]=[];const u=100,m="/sd_webui_ux/get_items_from_db",v="GET",S={table_name:t,skip:0,limit:u,sort_by:"date_created",order:"desc",search_term:""},I={title:"name",url:"preview",dataPath:"items"},T={[`#${e}_search`]:"search_term",[`#${e}_sort`]:"sort_by",[`#${e}_search_in`]:"search_columns",[`#${e}_sd_version`]:"sd_version"},q=p=>(p.skip=0,p);B=new Ye(on,[],18,I,m,S,v),De=bt(T,S,B,q),B.setNextCursor=function(p){p&&this.data.length>0?this.params.skip=this.params.cursor=p:delete this.params.cursor};let A="thumbnail";B.createItemElement=p=>us(p,A,B.selected,"/sd_image/thumb/"),B.clickHandler=function(p){if(B.dragged||B.scrollDelta)return;const d=p.target.closest(".item.card"),h=d==null?void 0:d.dataset.id;if(h){const y=this.data.find(E=>E.id.toString()===h);y&&b(p.target,y)}p.preventDefault(),p.stopPropagation()},c.addEventListener("click",p=>{ze("/sd_webui_ux/generate-thumbnails",{table_name:t},function(d){setTimeout(()=>{De.skip=0,B.updateParamsAndFetch(De,0)},1e3)})}),o.addEventListener("click",p=>{const d=o.classList.contains("active");De.skip=0,De.order=d?"desc":"asc",B.updateParamsAndFetch(De,0)}),l.addEventListener("click",p=>{s.value="",je(s)}),o.click(),we=new _e(`#${e}_tree_view`,"/sd_webui_ux/get_items_by_path",t,n),we.initialize(),we.createFileItem=function(p,d){var M;const h=document.createElement("li");h.dataset.name=p[d].name,h.dataset.id=p[d].id,(M=this.selected)!=null&&M.has(p[d].name)&&h.classList.add("active"),h.innerHTML=`<summary class="tree-file">${p[d].name}</summary>`,h.classList.add("li-file");const y=document.createElement("button");y.className="edit-meta edit-button card-button";const E=document.createElement("button");E.className="copy-path copy-path-button card-button";const $=document.createElement("div");return $.className="item-actions",$.appendChild(E),$.appendChild(y),h.appendChild($),h},we.onFolderClicked=function(p,d,h){},we.onFileClicked=function(p,d){b(p,d,d.id)},a.addEventListener("click",async p=>{try{const d=await fetch("/sd_webui_ux/import_update_table",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({table_name:"images"})});if(!d.ok)throw new Error("Network error");const h=d.body.getReader(),y=new TextDecoder;for(B.showLoadingIndicator();;){const{done:E,value:$}=await h.read();if(E)break;const W=y.decode($).split(`
`).filter(Z=>Z.trim());for(const Z of W)try{const te=JSON.parse(Z);B.updateLoadingIndicator(Math.round(te.progress)),console.log(`Status: ${te.status}, Processed ${te.processed}/${te.total} (${te.progress}%)`)}catch(te){console.error("Error parsing JSON:",te)}}B.hideLoadingIndicator(),De.skip=0,await B.updateParamsAndFetch(De,0),await we.initialize()}catch(d){console.error("Refresh error:",d),B.hideLoadingIndicator()}});function w(p){const d=window.UIUX.FOCUS_PROMPT,h=tt[`${d}_${t}`];setTimeout(()=>{let y="";document.querySelectorAll(`#${d}_prompt textarea, #${d}_neg_prompt textarea`).forEach(M=>{y+=M.value});const E=h.filter(M=>M&&M.value&&y.includes(M.value));tt[`${d}_${t}`]=E;const $=new Set(E.map(M=>M.name));B.selected=we.selected=$,B.renderItems(),we.updateSelectedItems()},100)}function f(p){const d=window.UIUX.FOCUS_PROMPT;let h="";if(document.querySelectorAll(`#${d}_prompt textarea`).forEach(E=>{h+=`${E.value}`}),h.length>2){let E=function(Z){return Z.replace(/[()]+|:[0-9]+(.[0-9]+)?/g,"").trim()};var y=E;const W=h.trim().split(". ").map(E).filter(Boolean).map(Z=>". "+Z);W.length>0&&ze("/sd_webui_ux/search_words_in_tables_columns",{words:W,tables:t,columns:"prompt",threshold:1},function(le){const ne=le[t];console.log(ne);const ae=ne.map(z=>({id:z.id,name:z.name,value:z.prompt}));tt[`${d}_${t}`]=ae,B.selected=we.selected=new Set(ae.map(z=>z.name))})}else B.selected=we.selected=new Set;B.renderItems(),we.updateSelectedItems()}document.querySelectorAll("#txt2img_prompt textarea, #img2img_prompt textarea, #txt2img_neg_prompt textarea, #img2img_neg_prompt textarea").forEach(p=>{p.addEventListener("input",w),p.addEventListener("focus",f)});function b(p,d,h){const y=window.UIUX.FOCUS_PROMPT,E=d.prompt||"",$=d.negative||"";if(p.classList.contains("copy-path"))navigator.clipboard.writeText(d.filename);else if(p.classList.contains("fullsize-button"))B.scrollToId(d.id),B.isFullSize?(A="thumbnail",B.setFullSize(!1),B.setLayout("vertical"),p.classList.remove("active")):(A="local_preview",B.setFullSize(!0),B.setLayout("horizontal"),p.classList.add("active"));else if(p.classList.contains("tile-button"))B.setTileable(!B.isTileable);else if(p.classList.contains("info-button"))B.setInfo(!B.isInfo);else if(p.classList.contains("fullScreen-button"))B.scrollToId(d.id),B.setFullScreen(!B.isFullScreen);else if(p.classList.contains("edit-meta"))_(d,d.id);else if(p.classList.contains("delete-button"))L(d,d.id);else if(p.classList.contains("send-params-button")){const M=`/sd_image/thumb/${encodeURIComponent(d.local_preview)}`;st(M,`#pnginfo_send_${y} button`)}else if(d.type==="Image"){if(B.isFullSize)return;window.cardClicked(y,E,$,!0),tt[`${y}_output_images`].push({id:d.id,name:d.name,value:E})}}function L(p,d){ze("/sd_webui_ux/delete_item",{table_name:t,item_id:d},function(E){B.removeDataById(d),we.update()})}function _(p,d){const h="images",y=we.subpaths,E=new Set(y.map(N=>N.relativePath)),$=Array.from(E);let M=[{value:"None",textContent:"None"}],W;$.forEach(N=>{var H;(H=p.filename)!=null&&H.includes(`${N}/`)&&(W=N),M.push({value:N,textContent:N})});const Z={local_preview:{type:"input",id:"local_preview_path",name:"local_preview",label:"Local Preview"},row:{type:"row",draw:"true",id:"parent_folder_select_row",label:"Parent Category / Filename",children:[{parent_folder:{type:"select",id:"parent_folder_select",class:"grow",value:W,options:M}},{save_path:{type:"input",id:"parent_folder_save",class:"grow",value:p.name,label:"Image Name"}}]},sd_version:{type:"select",name:"sd_version",label:"SD Version",value:p.sd_version,options:mn},prompt:{type:"textarea",name:"prompt",label:"Prompt",rows:4},negative:{type:"textarea",name:"negative",label:"Negative Prompt",rows:2},tags:{type:"textarea",name:"tags",label:"Tags"},description:{type:"textarea",name:"description",label:"Description",rows:2}},te={filename:{type:"filename",label:"Filename"},filesize:{type:"filesize",label:"Filesize"},type:{type:"text",label:"Type"},hash:{type:"text",label:"Hash"},date_created:{type:"date-format",label:"Date Created"},date_modified:{type:"date-format",label:"Date Modified"}},le={thumbnail:{type:"img",api:"/sd_image/thumb/",showLabel:!1},replace_preview:{type:"button",label:"Replace Preview",showLabel:!1}},ne="/sd_webui_ux/update_user_metadata",ae=document.getElementById("formContainer"),z=new me(ne,h,p,ae),K=z.createForm(Z),Q=z.createTable(te),se=z.createHtmlElement(le),j=document.createElement("div");j.classList.add("non-editable-info","flexbox","padding","shrink"),j.appendChild(se),j.appendChild(Q),B.showDetail();const pe=on.parentElement.querySelector(".ae-virtual-detail-content");pe.innerHTML="",pe.appendChild(j),pe.appendChild(K);const be=K.querySelector("#parent_folder_select"),P=K.querySelector("#parent_folder_select_row label"),g=K.querySelector("#parent_folder_save"),C=K.querySelector("#local_preview_path input"),O=K.querySelector("button.delete");let U;const ee=N=>N.replace(/\/{2,}/g,"/"),J=N=>{const H=be.value!=="None"?be.value:"",ie=g.value,re=`${H}/${ie}`;P.textContent=`Image will be saved: ${ee(re)}.png`,U=ee(`${y[0].basePath}/${re}.png`),C.value=U};be.addEventListener("change",J),g.addEventListener("input",J),J();function ce(N){const H=N.lastIndexOf("/"),ie=N.substring(0,H),re=N.substring(H+1),Ve=re.lastIndexOf("."),Fe=re.substring(0,Ve);return{path:ie,filename:re,filename_no_ext:Fe}}let F;z.beforeFormSubmit=function(N){return N.name=ce(U).filename_no_ext,N.filename=U,N.type="Image",p.id&&(N.id=p.id),F&&(N.source_file=F),N},z.afterFormSubmit=function(N,H){B.hideDetail(),B.updateDataById(H,H.id),we.update()};function Y(){const N=window.UIUX.FOCUS_PROMPT,H=document.querySelector(`#${N}_gallery [data-testid="detailed-image"]`);if(H){const ie=se.querySelector(".thumbnail-image");F=H.src.split("file=")[1].split("?")[0],ie.style.filter="grayscale(1)"}}se.querySelector("button.replace_preview").addEventListener("click",N=>{Y()}),p.id||Y(),p.id&&O.addEventListener("click",N=>{const H="/sd_webui_ux/delete_item",ie={table_name:h,item_id:p.id};ze(H,ie,function(re){console.log(re),B.hideDetail(),De.skip=0,B.updateParamsAndFetch(De,0),we.update()})})}function R(){const p=window.UIUX.FOCUS_PROMPT,d=document.querySelector(`#${p}_prompt textarea`),h=document.querySelector(`#${p}_neg_prompt textarea`),y=$=>$.replace(/\s{2,}/g," ").replace(/(\. )\1+/g,". "),E={};E.prompt=y(". "+d.value),E.negative=y(". "+h.value),E.name="Untitled",E.description="",E.tags="",E.local_preview="",_(E)}document.querySelector("#layout_db_output_images button.create-style").addEventListener("click",p=>{R()})}function Yi(e){const t=document.querySelector("#logger_screen");t&&(document.querySelector("#container-console-log").append(getLoggerUiUx()),t.remove()),console.log("Finishing optimizations for Extra Networks"),ri(),ai(),ii(),oi(),document.querySelectorAll("#txt2img_styles_edit_button, #img2img_styles_edit_button").forEach(a=>{a.addEventListener("click",function(c){window.popup_trigger.click()})});function n(a){Mn.FOCUS_PROMPT=a.includes("txt2img")?"txt2img":"img2img"}if(document.querySelectorAll("#txt2img_prompt textarea, #img2img_prompt textarea, #txt2img_neg_prompt textarea, #img2img_neg_prompt textarea").forEach(a=>{a.addEventListener("focus",c=>{const l=c.target.closest(".gradio-textbox").id;n(l)})}),document.querySelectorAll("#about_tabitem img").forEach(a=>{const c=a.getAttribute("data-src");c&&(a.src=c.replace("file=extensions/sd-webui-ux/assets/",`${Dt}`))}),window.UIUX=Mn,$t.setItem("UiUxComplete","true"),window.opts.uiux_enable_theme_editor&&ui(),window.opts.uiux_enable_civitai_explorer){document.querySelector("#civitai_explorer_nav").classList.remove("hidden");const c=document.querySelector("#civitai_nav_images"),l=document.querySelector("#civitai_nav_models");c.addEventListener("click",()=>{Di()},{once:!0}),l.addEventListener("click",()=>{zi()},{once:!0})}const s=document.querySelector("#textual_inversion_nav"),i=document.querySelector("#lora_nav"),o=document.querySelector("#hypernetwork_nav");if(setTimeout(()=>{Fi()},500),s.addEventListener("click",()=>{Ui()},{once:!0}),i.addEventListener("click",()=>{qi()},{once:!0}),o.addEventListener("click",()=>{Hi()},{once:!0}),window.opts.uiux_enable_sd_styles){const a=document.querySelector("#sd_styles_nav");a.classList.remove("hidden"),a.addEventListener("click",()=>{Wi()},{once:!0})}if(window.opts.uiux_enable_sd_output_images){const a=document.querySelector("#sd_output_images_nav");a.classList.remove("hidden"),a.addEventListener("click",()=>{Vi()},{once:!0})}}async function Zi(){const e=it(),t=Ge();await Ss(),t.insertAdjacentElement("afterbegin",e);const n=Vs((s,i)=>{s==="UiUxReady"&&i==="true"&&(Yi(),n())},"UiUxReady");(async()=>await ns(e))(),zs(),setTimeout(()=>{ws("#infinite_image_browsing_container_wrapper iframe",["user.css","uiux-iibrowser.css"])},3e3)}async function Ki(){try{Os(),console.log("Starting DOM Optimizations"),ei(),Qs(),console.log("Finishing DOM Optimizations"),Es(Ps),Be.gradio_major>3&&xs("style.css","style-gradio-4.css",document.body),(async()=>(await Rs(),await Zi()))()}catch(e){console.error("Error in run sequence:",e)}}function Ji(){if(localStorage.setItem("UiUxReady","false"),localStorage.setItem("UiUxComplete","false"),!document.getElementById("logger_screen")){const n=document.createElement("div");n.id="logger_screen",n.style="position: fixed; inset: 0; background-color: black; z-index: 99999; display: flex; flex-direction: column; overflow:auto;";const s=document.createElement("div");s.id="loggerUiUx",n.append(s),document.body.append(n)}const e=new MutationObserver(async()=>{if(Kn()&&window.opts&&Object.keys(window.opts).length){e.disconnect();try{await Ki()}catch(s){console.error("Error running the function:",s)}}}),t=Ge();t?e.observe(t,{childList:!0,subtree:!0}):console.error("getGradioApp() did not return a valid target for observation")}Ji();
