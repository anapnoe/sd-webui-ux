async function Ne(t,e,i){const s=document.querySelector(i),n=`
        <button tabItemId="#split-app, #${t}_tabitem" 
                tabGroup="main_group" 
                data-click="#tabs" 
                onclick="mainTabs(this, '#${t}')" 
                class="xtabs-tab">
            <div class="icon-letters">${e.slice(0,2)}</div>
            <span>${e}</span>
        </button>`,o=document.createElement("div");o.innerHTML=n;const a=o.firstElementChild;s.append(a)}async function Ue(t){const e=document.querySelector("#split-left"),i=`
        <div id="${t}_tabitem" class="xtabs-item other">
            <div data-parent-selector="gradio-app" data-selector="#${t} > div" class="portal"></div>
        </div>`,s=document.createElement("div");s.innerHTML=i;const n=s.firstElementChild;e.append(n)}async function Fe(){let t=["tab_txt2img","tab_img2img","tab_extras","tab_pnginfo","tab_train","tab_modelmerger","tab_settings","tab_extensions","tab_deforum_interface","tab_infinite-image-browsing","tab_anapnoe_dock","tab_anapnoe_sd_uiux_core","tab_space","tab_stylez","tab_anapnoe_sd_uiux_civitai","tab_anapnoe_sd_uiux_db_extra_networks","tab_anapnoe_sd_uiux_db_styles"];const e=document.querySelectorAll("#tabs > .tabitem");for(const i of e){const s=i.id,n=s.split("tab_")[1];!t.includes(s)&&!s.startsWith("tab_ui_theme")&&await Promise.all([Ne(s,n,"#other_extensions"),Ue(s)])}}function De(t,e){const i=document.querySelector(t);if(i){const s=n=>{e.forEach(o=>{const a=document.querySelector(`link[rel="stylesheet"][href*="${o}"]`);if(a){const c=a.cloneNode();n.appendChild(c)}})};i.contentDocument.readyState==="complete"?s(i.contentDocument.head):i.addEventListener("load",n=>{s(n.target.contentDocument.head)},{once:!0})}}function ae(t,e,i){for(const s of t)if(!e.querySelector(`link[rel="stylesheet"][href*="${he}${s}"]`)){const o=document.createElement("link");o.rel="stylesheet",o.href=`${he}${s}`,o.onload=()=>{console.log(`Stylesheet ${s} loaded successfully.`)},o.onerror=()=>{console.error(`Error loading stylesheet ${s}.`)},i?e.insertBefore(o,i.nextSibling):e.appendChild(o)}}function Re(t){const e=document.body,i=e.querySelector('link[rel="stylesheet"][href*="sd-webui-ux"]');i?ae(t,e,i):(ae(t,e),console.warn("The sd-webui-ux/style.css is not found in the body."))}function He(t,e,i){const n=Array.from(i.querySelectorAll(`link[rel="stylesheet"][href*="${t}"]`)).find(o=>o.href.includes("sd-webui-ux")&&o.href.includes(t));n?(ae([e],i,n),n.parentNode.removeChild(n),console.log(`Removed existing stylesheet: ${t}`)):console.warn(`No existing stylesheet found: ${t}`)}const ce=window.basePath.includes("builtin"),le="anapnoe/stable-diffusion-webui-ux",Be="AUTOMATIC1111/stable-diffusion-webui",je="#anapnoe_app",Xe="0.1.0",Ce=window.basePath,Xt=`${Ce}assets/`,he=`${Xt}css/`,Le=`${Xt}templates/`,We=`${Le}uiux-gradio-3/`,Ve=`${Le}forge-gradio-4/`,Te={"template-deforum-params.html":"deforum","template-deforum-results.html":"deforum","template-stylez.html":"Stylez"},Ge=["uiux-icons.css","uiux-theme-editor.css","uiux-deforum.css","uiux-iibrowser.css","uiux-physton.css","uiux-virtual.css","uiux-tree.css","spotlight.css"];let Jt=null;const vt=()=>(Jt||(Jt=document.querySelector(je)),Jt);let Zt=null;const ke=()=>(Zt||(Zt=document.getElementById("tab_anapnoe_sd_uiux_core")),Zt);let Qt=null;const gt=()=>(Qt||(Qt=document.querySelector("gradio-app")),Qt);let te=null;const Ie=()=>(te||(te=document.getElementById("loggerUiUx")),te),ut={};let Ot=null;const Ye=()=>{if(!Ot){const t=gt().querySelector(".versions");if(!t){console.error("Versions element not found");return}Ot=t.innerHTML.replace(Be,le).replace(/\n/g,"").split("• "),Ot.forEach(n=>{const[o,a]=n.split(":").map(c=>c.trim());o&&a&&(ut[o]=a)});const i=ut.version.split(".")[0].includes("f")?"forge":"AUTOMATIC1111",s=parseInt(ut.gradio,10);ut.variant=i,ut.gradio_major=s}return Ot};let zt=null;const Ae=()=>(zt||(zt=We,ut.gradio_major>3&&ut.variant==="forge"&&(zt=Ve)),zt);let Et;async function Ke(){(function(i){console.oldLog=console.log,console.oldWarn=console.warn,Et=function(s,n){return function(...o){const c=o.slice(0,10);let r="",u,m;for(r+=`
                <div class="log-row"><span class="log-date">${new Date().toLocaleString().replace(",","")}</span>`,m=0;m<c.length;m++){u=c[m];const S=u.toString().toLowerCase();let y="";S.indexOf("remove")!==-1||S.indexOf("error")!==-1?y+=" log-remove":S.indexOf("loading")!==-1||S.indexOf("| ref")!==-1||S.indexOf("initial")!==-1||S.indexOf("optimiz")!==-1||S.indexOf("python")!==-1||S.indexOf("success")!==-1?y+=" log-load":S.indexOf("[")!==-1&&(y+=" log-object"),u.toString().indexOf(".css")!==-1||u.toString().indexOf(".html")!==-1?y+=" log-url":u.toString().indexOf(`
`)!==-1&&(r+="<br />"),r+=`
                    <span class="log-${typeof u} ${y}">`,typeof u=="object"&&typeof JSON=="object"&&typeof JSON.stringify=="function"?r+=JSON.stringify(u):r+=u,r+=" </span>"}i.innerHTML+=r+"</div>",n.apply(void 0,c)}},console.log=Et("log",console.oldLog),console.warn=Et("warn",console.oldWarn)})(Ie()),console.log(`
`,"╔═╗╔═╦╦═╗╔═╦═╦╦═╦═╗",`
`,"║╬╚╣║║║╬╚╣╬║║║║╬║╩╣",`
`,"╚══╩╩═╩══╣╔╩╩═╩═╩═╝",`
`,"─────────╚╝"),console.log(`Initialize Anapnoe UI/UX runtime engine version ${Xe}`),console.log("UI/UX Backend Optimizations:",ce),console.log(navigator.userAgent),console.log(Ye()),console.log("Console log enabled: ",window.opts.uiux_enable_console_log),console.log("Dev Mode enabled: ",window.opts.uiux_enable_dev_mode),console.log("Theme editor enabled: ",window.opts.uiux_enable_theme_editor),console.log("Maximum resolution output: ",window.opts.uiux_max_resolution_output),console.log("Ignore overrides: ",window.opts.uiux_ignore_overrides),console.log("Show ticks for input range slider: ",window.opts.uiux_show_input_range_ticks),console.log("Default layout: ",window.opts.uiux_default_layout),console.log("Disable transitions: ",window.opts.uiux_disable_transitions),console.log("Aside labels: ",window.opts.uiux_show_labels_aside),console.log("Main labels: ",window.opts.uiux_show_labels_main),console.log("Tabs labels: ",window.opts.uiux_show_labels_tabs),console.log("Hide extra info for labels, checkboxes: ",window.opts.uiux_hide_extra_info),navigator.userAgent.toLowerCase().includes("firefox")&&console.log("Go to the Firefox about:config page, then search and toggle layout. css.has-selector. enabled"),window.opts.uiux_enable_console_log||(console.log=function(){});let e=document.querySelector("link[rel~='icon']");e||(e=document.createElement("link"),e.rel="icon",document.head.appendChild(e)),e.href=`${Xt}favicon.svg/`}function Je(t){t?(console.log=Et("log",console.oldLog),console.warn=Et("warn",console.oldWarn)):console.log=function(){}}async function Ze(t){const e=[];return t.querySelectorAll(".template:not([status])").forEach(i=>{const s={},n=i.getAttribute("url");s.url=n||Ae();const o=i.getAttribute("key");s.key=o||void 0;const a=i.getAttribute("template")||i.id;if(a)!ce&&a.includes("about")?s.template=`${a}-extension.html`:s.template=`${a}.html`;else{console.warn("Template not found on element:",i);return}s.id=i.id,s.extensionEnabled=Qe(s.template),e.push(s)}),e}function Qe(t){const e=Te[t];return e?!!document.head.querySelector(`script[type="text/javascript"][src*="${e}"]`):!1}async function bt(t,e){const i=t[e],s=e<t.length;if(!i)return;let n;if(i.template in Te&&!i.extensionEnabled){console.log(`Skipping loading for extension template ${i.template} (extension disabled)`),await bt(t,e+1);return}if(s){if(i!=null&&i.parent?n=i.parent:i!=null&&i.id&&(n=document.querySelector(`#${i.id}`)),n){const a=`${i.url}${i.template}`;try{const c=await fetch(a);if(c.ok){const r=await c.text(),u=document.createElement("div");if(i.key){const S=r.replace(/\s*\{\{.*?\}\}\s*/g,i.key);u.innerHTML=S}else u.innerHTML=r;const m=await Ze(u);m.length>0&&(t=t.concat(m)),console.log("Template loaded",a),n.setAttribute("status","true"),n.append(u.firstElementChild),await bt(t,e+1)}else c.status===404&&(console.error("404 template:",a),n.setAttribute("status","error"),await bt(t,e+1))}catch(c){console.error("Error loading template:",c),n.setAttribute("status","error"),await bt(t,e+1)}}}else console.log("Template files merged successfully")}async function ti(){console.log("Loading Templates",ut.gradio);const t=[{url:Ae(),template:"template-app-root.html",parent:ke()}];await bt(t,0)}function _t(t){if(t){const e=new Event("input",{bubbles:!0,cancelable:!0});t.dispatchEvent(e)}}function ei(t){if(t){const e=new Event("change",{bubbles:!0,cancelable:!0});t.dispatchEvent(e)}}function ii(){const t=vt();t.addEventListener("animationend",e=>{e.animationName==="fade-out"&&e.target.classList.add("hidden")}),t.addEventListener("animationstart",e=>{const i=t.classList.contains("notransition");e.animationName==="fade-out"?i&&e.target.classList.add("hidden"):e.animationName==="fade-in"&&e.target.classList.remove("hidden")})}const Ft=new WeakMap;function $e(t){if(!(t instanceof Element))return 0;let e=0;const i=Ft.get(t);if(i)for(const s in i)e+=i[s].size;for(const s of t.children)e+=$e(s);return e}(function(){const t=EventTarget.prototype.addEventListener,e=EventTarget.prototype.removeEventListener;EventTarget.prototype.addEventListener=function(i,s,n){typeof n>"u"&&(n=!1);const o=Ft.get(this)||{};o[i]||(o[i]=new Set),o[i].add(s),Ft.set(this,o),t.call(this,i,s,n)},EventTarget.prototype.removeEventListener=function(i,s,n){const o=Ft.get(this);o&&o[i]&&(o[i].delete(s),o[i].size===0&&delete o[i]),e.call(this,i,s,n)},window.countEventListeners=$e})();const tt=typeof window<"u"?window:null,de=tt===null,Tt=de?void 0:tt.document,st="addEventListener",nt="removeEventListener",ee="getBoundingClientRect",wt="_a",ot="_b",dt="_c",Pt="horizontal",at=()=>!1,si=de?"calc":`${["","-webkit-","-moz-","-o-"].filter(t=>{const e=Tt.createElement("div");return e.style.cssText=`width:${t}calc(9px)`,!!e.style.length}).shift()}calc`,qe=t=>typeof t=="string"||t instanceof String,me=t=>{if(qe(t)){const e=Tt.querySelector(t);if(!e)throw new Error(`Selector ${t} did not match a DOM element`);return e}return t},Y=(t,e,i)=>{const s=t[e];return s!==void 0?s:i},Mt=(t,e,i,s)=>{if(e){if(s==="end")return 0;if(s==="center")return t/2}else if(i){if(s==="start")return 0;if(s==="center")return t/2}return t},ni=(t,e)=>{const i=Tt.createElement("div");return i.className=`gutter gutter-${e}`,i},oi=(t,e,i)=>{const s={};return qe(e)?s[t]=e:s[t]=`${si}(${e}% - ${i}px)`,s},ai=(t,e)=>({[t]:`${e}px`}),ri=(t,e={})=>{if(de)return{};let i=t,s,n,o,a,c,r;Array.from&&(i=Array.from(i));const m=me(i[0]).parentNode,S=getComputedStyle?getComputedStyle(m):null,y=S?S.flexDirection:null;let k=Y(e,"sizes")||i.map(()=>100/i.length);const O=Y(e,"minSize",100),U=Array.isArray(O)?O:i.map(()=>O),E=Y(e,"maxSize",1/0),g=Array.isArray(E)?E:i.map(()=>E),f=Y(e,"expandToMin",!1),b=Y(e,"gutterSize",10),x=Y(e,"gutterAlign","center"),P=Y(e,"snapOffset",30),F=Array.isArray(P)?P:i.map(()=>P),D=Y(e,"dragInterval",1),p=Y(e,"direction",Pt),l=Y(e,"cursor",p===Pt?"col-resize":"row-resize"),v=Y(e,"gutter",ni),A=Y(e,"elementStyle",oi),L=Y(e,"gutterStyle",ai);p===Pt?(s="width",n="clientX",o="left",a="right",c="clientWidth"):p==="vertical"&&(s="height",n="clientY",o="top",a="bottom",c="clientHeight");function T(_,d,h,w){const M=A(s,d,h,w);Object.keys(M).forEach(j=>{_.style[j]=M[j]})}function $(_,d,h){const w=L(s,d,h);Object.keys(w).forEach(M=>{_.style[M]=w[M]})}function q(){return r.map(_=>_.size)}function z(_){return"touches"in _?_.touches[0][n]:_[n]}function N(_){const d=r[this.a],h=r[this.b],w=d.size+h.size;d.size=_/this.size*w,h.size=w-_/this.size*w,T(d.element,d.size,this[ot],d.i),T(h.element,h.size,this[dt],h.i)}function R(_){let d;const h=r[this.a],w=r[this.b];this.dragging&&(d=z(_)-this.start+(this[ot]-this.dragOffset),D>1&&(d=Math.round(d/D)*D),d<=h.minSize+h.snapOffset+this[ot]?d=h.minSize+this[ot]:d>=this.size-(w.minSize+w.snapOffset+this[dt])&&(d=this.size-(w.minSize+this[dt])),d>=h.maxSize-h.snapOffset+this[ot]?d=h.maxSize+this[ot]:d<=this.size-(w.maxSize-w.snapOffset+this[dt])&&(d=this.size-(w.maxSize+this[dt])),N.call(this,d),Y(e,"onDrag",at)(q()))}function H(){const _=r[this.a].element,d=r[this.b].element,h=_[ee](),w=d[ee]();this.size=h[s]+w[s]+this[ot]+this[dt],this.start=h[o],this.end=h[a]}function K(_){if(!getComputedStyle)return null;const d=getComputedStyle(_);if(!d)return null;let h=_[c];return h===0?null:(p===Pt?h-=parseFloat(d.paddingLeft)+parseFloat(d.paddingRight):h-=parseFloat(d.paddingTop)+parseFloat(d.paddingBottom),h)}function B(_){const d=K(m);if(d===null||U.reduce((j,V)=>j+V,0)>d)return _;let h=0;const w=[],M=_.map((j,V)=>{const it=d*j/100,$t=Mt(b,V===0,V===_.length-1,x),qt=U[V]+$t;return it<qt?(h+=qt-it,w.push(0),qt):(w.push(it-qt),it)});return h===0?_:M.map((j,V)=>{let it=j;if(h>0&&w[V]-h>0){const $t=Math.min(h,w[V]-h);h-=$t,it=j-$t}return it/d*100})}function mt(){const _=this,d=r[_.a].element,h=r[_.b].element;_.dragging&&Y(e,"onDragEnd",at)(q()),_.dragging=!1,tt[nt]("mouseup",_.stop),tt[nt]("touchend",_.stop),tt[nt]("touchcancel",_.stop),tt[nt]("mousemove",_.move),tt[nt]("touchmove",_.move),_.stop=null,_.move=null,d[nt]("selectstart",at),d[nt]("dragstart",at),h[nt]("selectstart",at),h[nt]("dragstart",at),d.style.userSelect="",d.style.webkitUserSelect="",d.style.MozUserSelect="",d.style.pointerEvents="",h.style.userSelect="",h.style.webkitUserSelect="",h.style.MozUserSelect="",h.style.pointerEvents="",_.gutter.style.cursor="",_.parent.style.cursor="",Tt.body.style.cursor=""}function G(_){if("button"in _&&_.button!==0)return;const d=this,h=r[d.a].element,w=r[d.b].element;d.dragging||Y(e,"onDragStart",at)(q()),_.preventDefault(),d.dragging=!0,d.move=R.bind(d),d.stop=mt.bind(d),tt[st]("mouseup",d.stop),tt[st]("touchend",d.stop),tt[st]("touchcancel",d.stop),tt[st]("mousemove",d.move),tt[st]("touchmove",d.move),h[st]("selectstart",at),h[st]("dragstart",at),w[st]("selectstart",at),w[st]("dragstart",at),h.style.userSelect="none",h.style.webkitUserSelect="none",h.style.MozUserSelect="none",h.style.pointerEvents="none",w.style.userSelect="none",w.style.webkitUserSelect="none",w.style.MozUserSelect="none",w.style.pointerEvents="none",d.gutter.style.cursor=l,d.parent.style.cursor=l,Tt.body.style.cursor=l,H.call(d),d.dragOffset=z(_)-d.end}k=B(k);const W=[];r=i.map((_,d)=>{const h={element:me(_),size:k[d],minSize:U[d],maxSize:g[d],snapOffset:F[d],i:d};let w;if(d>0&&(w={a:d-1,b:d,dragging:!1,direction:p,parent:m},w[ot]=Mt(b,d-1===0,!1,x),w[dt]=Mt(b,!1,d===i.length-1,x),y==="row-reverse"||y==="column-reverse")){const M=w.a;w.a=w.b,w.b=M}if(d>0){const M=v(d,p,h.element);$(M,b,d),w[wt]=G.bind(w),M[st]("mousedown",w[wt]),M[st]("touchstart",w[wt]),m.insertBefore(M,h.element),w.gutter=M}return T(h.element,h.size,Mt(b,d===0,d===i.length-1,x),d),d>0&&W.push(w),h});function ct(_){const d=_.i===W.length,h=d?W[_.i-1]:W[_.i];H.call(h);const w=d?h.size-_.minSize-h[dt]:_.minSize+h[ot];N.call(h,w)}r.forEach(_=>{const d=_.element[ee]()[s];d<_.minSize&&(f?ct(_):_.minSize=d)});function lt(_){const d=B(_);d.forEach((h,w)=>{if(w>0){const M=W[w-1],j=r[M.a],V=r[M.b];j.size=d[w-1],V.size=h,T(j.element,j.size,M[ot],j.i),T(V.element,V.size,M[dt],V.i)}})}function At(_,d){W.forEach(h=>{if(d!==!0?h.parent.removeChild(h.gutter):(h.gutter[nt]("mousedown",h[wt]),h.gutter[nt]("touchstart",h[wt])),_!==!0){const w=A(s,h.a.size,h[ot]);Object.keys(w).forEach(M=>{r[h.a].element.style[M]="",r[h.b].element.style[M]=""})}})}return{setSizes:lt,getSizes:q,collapse(_){ct(r[_])},destroy:At,parent:m,pairs:W}};class Ct{constructor(){return Ct.instance||(this.splitInstances={},Ct.instance=this),Ct.instance}set(e){Object.assign(this.splitInstances,e)}get(){return this.splitInstances}}const ue=new Ct;Object.freeze(ue);function ci(t){ue.set(t)}function li(){return ue.get()}async function di(t){const e=[];await Promise.all(Array.from(t.querySelectorAll("div.split")).map(async i=>{const s=i.id,n=t.querySelector(`#${s}`),o=(n==null?void 0:n.getAttribute("direction"))==="vertical"?"vertical":"horizontal",a=(n==null?void 0:n.getAttribute("gutterSize"))||"8",c=t.querySelectorAll(`#${s} > div.split-container`),r=Array.from(c).map(y=>{const k=y.getAttribute("data-initSize")?parseInt(y.getAttribute("data-initSize")):100/c.length,O=y.getAttribute("data-minSize")?parseInt(y.getAttribute("data-minSize")):1/0;return{id:`#${y.id}`,initSize:k,minSize:O}}),u=r.map(y=>y.id),m=r.map(y=>y.initSize),S=r.map(y=>y.minSize);console.log("Split component",u,m,S,o,a),e[s]=ri(u,{sizes:m,minSize:S,direction:o,gutterSize:parseInt(a),snapOffset:0,dragInterval:1,elementStyle:(y,k,O)=>({"flex-basis":`calc(${k}% - ${O}px)`}),gutterStyle:(y,k)=>({"flex-basis":`${k}px`,"min-width":`${k}px`,"min-height":`${k}px`})})})),ci(e)}const Ht={setItem:function(t,e){localStorage.setItem(t,e),this.notifyChange(t,e)},getItem:function(t){return localStorage.getItem(t)},removeItem:function(t){localStorage.removeItem(t),this.notifyChange(t,null)},notifyChange:function(t,e){const i=new CustomEvent("localStorageChange",{detail:{key:t,value:e}});window.dispatchEvent(i)}};function ui(t,e){const i=Ht.getItem(e);t(e,i);const s=n=>{t(n.detail.key,n.detail.value)};return window.addEventListener("localStorageChange",s),()=>{window.removeEventListener("localStorageChange",s)}}let ie=0;function pi(t,e){const i=t.querySelectorAll("td:last-child"),s=document.createElement("style");let n=1,o="";i.forEach((a,c)=>{const r=parseFloat(a.textContent.trim());if(a.id=`td_${c}`,!isNaN(r)){let u;c===0?(n=r,u=100):u=r/n*100,o+=`#td_${c}::before { min-width: ${u}%; }`}}),s.textContent=o,e.appendChild(s)}function hi(t,e){t.querySelectorAll(`${e}, style`).forEach(s=>{t.removeChild(s)})}function mi(t,e){const i=t.getAttribute("append-index");Array.from(t.children).forEach(n=>{if(n!==e)if(e.className.includes("gradio-accordion"))if(i){const o=parseInt(i,10);let a=e.children[2].children[o];e.children[2].insertBefore(n,a)}else e.children[2].append(n);else e.append(n)})}async function pe(t,e,i=0,s,n,o=!1){var m;const a=t.getAttribute("data-selector"),c=t.getAttribute("data-parent-selector");let r;if(i%2===0?r=document.querySelector(`${c} ${a}`):r=e.querySelector(`${a}`),r&&t){t.classList.contains("dynamic")&&(hi(t,a),a.includes("popup-table")&&pi(r,t)),t.append(r),o&&ie++,console.log("register | Ref",s,c,a),t.getAttribute("droppable")&&mi(t,r);const y=t.getAttribute("show-button");y&&((m=document.querySelector(y))==null||m.classList.remove("hidden"))}else if(i<2){const S=t.getAttribute("data-timeout"),y=S?parseInt(S):500;await new Promise(k=>setTimeout(k,y)),console.log(i+1,"retry | ",y," | Ref",s,c,a),await pe(t,e,i+1,s,n,o)}else t.classList.contains("dynamic")?console.error("error | Ref",s,c,a):console.warn("dynamic | Ref",s,c,a),o&&ie++;ie===n&&o&&Ht.getItem("UiUxReady")==="false"&&(console.log("Runtime components initialized"),Ht.setItem("UiUxReady","true"))}async function fi(t){await Promise.all(Array.from(t.querySelectorAll(".portal:not(.dynamic)")).map(async(e,i,s)=>{pe(e,t,0,i,s.length,!0)}))}async function gi(t){const e=vt();await Promise.all(Array.from(t.querySelectorAll(".xtabs-tab")).map(async s=>{if(s.addEventListener("click",()=>{const o=s.parentElement,a=s.getAttribute("tabGroup");s.getAttribute("data-click");const c=s.getAttribute("toggle"),r=s.classList.contains("active");function u(m){m.classList.remove("active");const S=m.getAttribute("tabItemId");e.querySelectorAll(S).forEach(y=>{y.classList.remove("fade-in"),y.classList.add("fade-out")})}if((!c||c&&r)&&(a?e.querySelectorAll(`[tabGroup="${a}"]`).forEach(m=>{m.classList.contains("active")&&u(m)}):o&&[].slice.call(o.children).forEach(S=>{S.classList.contains("active")&&u(S)})),!c||c&&!r){const m=s.getAttribute("tabItemId");e.querySelectorAll(m).forEach(S=>{S.classList.remove("fade-out"),S.classList.add("fade-in"),S.querySelectorAll(".portal.dynamic").forEach((y,k,O)=>{pe(y,document,0,k,O.length)})}),s.classList.add("active"),i(s)}}),!s.getAttribute("active")){const o=s.getAttribute("tabItemId");e.querySelectorAll(o).forEach(a=>{a.classList.remove("fade-in"),a.classList.add("fade-out")})}})),await Promise.all(Array.from(t.querySelectorAll(".xtabs-tab[active]")).map(async s=>{s.classList.add("active");const n=s.getAttribute("tabItemId");s.getAttribute("data-click"),e.querySelectorAll(n).forEach(o=>{o.classList.remove("fade-out"),o.classList.add("fade-in")}),i(s)}));function i(s,n,o){const a=s.closest(".accordion-bar");if(a){const c=a.parentElement;if(c.className.indexOf("expand")===-1){let r=a;const u=c.getAttribute("iconTrigger");if(u){const m=t.querySelector(u);m&&(r=m)}r.click()}}}}const fe={DEFAULT_PATH:Ce,FOCUS_PROMPT:"txt2img",loadCurrentTemplate:bt,initUiUxComponents:Oe};async function _i(){document.head.querySelectorAll(`
        [rel="stylesheet"][href*="/assets/"],
        [rel="stylesheet"][href*="theme.css"],
        [rel="stylesheet"][href*="index"]`).forEach(s=>{s.remove(),console.log("Remove stylesheet",s.getAttribute("href"))}),document.body.querySelectorAll(`
        [rel="stylesheet"][href*="file=style.css"]`).forEach(s=>{s.remove(),console.log("Remove stylesheet",s.getAttribute("href"))});const t=document.querySelectorAll('.styler, [class*="svelte"]:not(input)'),e=t.length;let i=0;t.forEach(s=>{s.style.display!=="none"&&s.style.display!=="block"&&(s.removeAttribute("style"),i++),[...s.classList].filter(n=>n.match(/^svelte.*/)).forEach(n=>s.classList.remove(n))}),console.log("Remove inline styles from DOM","Total Selectors:",e,"Removed Selectors:",i)}async function yi(){var t,e,i,s,n,o,a,c;if(!ce){const r=gt();console.log("Remove Extra Networks Instances"),(t=r.querySelector("#img2img_textual_inversion_cards_html"))==null||t.remove(),(e=r.querySelector("#img2img_checkpoints_cards_html"))==null||e.remove(),(i=r.querySelector("#img2img_hypernetworks_cards_html"))==null||i.remove(),(s=r.querySelector("#img2img_lora_cards_html"))==null||s.remove(),(n=r.querySelector("#txt2img_textual_inversion_cards_html"))==null||n.remove(),(o=r.querySelector("#txt2img_checkpoints_cards_html"))==null||o.remove(),(a=r.querySelector("#txt2img_hypernetworks_cards_html"))==null||a.remove(),(c=r.querySelector("#txt2img_lora_cards_html"))==null||c.remove(),console.log("Remove element #img2img_textual_inversion_cards_html"),console.log("Remove element #img2img_checkpoints_cards_html"),console.log("Remove element #img2img_hypernetworks_cards_html"),console.log("Remove element #img2img_lora_cards_html"),console.log("Remove element #txt2img_textual_inversion_cards_html"),console.log("Remove element #txt2img_checkpoints_cards_html"),console.log("Remove element #txt2img_hypernetworks_cards_html"),console.log("Remove element #txt2img_lora_cards_html")}}async function bi(t){await Promise.all(Array.from(t.querySelectorAll(".ae-button")).map(async e=>{const i=e.getAttribute("toggle"),s=e.getAttribute("active"),n=e.querySelector("input");n&&(n.checked===!0&&!s||n.checked===!1&&s)&&n.click(),s?e.classList.add("active"):e.classList.remove("active"),i&&e.addEventListener("click",o=>{const a=e.querySelector("input");a?(a.click(),a.checked===!0?e.classList.add("active"):a.checked===!1&&e.classList.remove("active")):e.classList.toggle("active")})}))}async function vi(t){const e=li();await Promise.all(Array.from(t.querySelectorAll(".accordion-bar")).map(async i=>{const s=i.parentElement,n=s.closest(".split-container");let o=i;const a=s.getAttribute("iconTrigger");if(a){const c=t.querySelector(a);c&&(o=c,i.classList.add("pointer-events-none"))}if(s.className.indexOf("accordion-vertical")!==-1&&n.className.indexOf("split")!==-1){s.classList.add("expand");const c=n.parentElement.id,r=e[c];n.setAttribute("data-sizes",JSON.stringify(r.getSizes())),o==null||o.addEventListener("click",()=>{if(s.classList.toggle("expand"),n.className.indexOf("v-expand")!==-1)n.classList.remove("v-expand"),r.setSizes(JSON.parse(n.getAttribute("data-sizes")));else{n.classList.add("v-expand");let u=r.getSizes();n.setAttribute("data-sizes",JSON.stringify(u)),console.log(u),u[u.length-1]=0,u[u.length-2]=100;const m=parseFloat(window.getComputedStyle(i,null).getPropertyValue("padding-left"))*2;n.style.minWidth=i.offsetWidth+m+"px",r.setSizes(u)}})}else o==null||o.addEventListener("click",()=>{s.classList.toggle("expand")})}))}async function Oe(t){var i;await di(t),await fi(t),await vi(t),await gi(t),await bi(t),document.querySelector("#container-console-log").append(Ie()),(i=document.querySelector("#logger_screen"))==null||i.remove()}async function wi(t=le,e=1){return await(await fetch(`https://api.github.com/repos/${t}/contributors?per_page=100&page=${e}`,{method:"GET",headers:{"Content-Type":"application/json"}})).json()}async function ze(t=le,e=1,i=[]){const s=await wi(t,e);return i=i.concat(s),s.length===100?ze(t,e+1,i):i}function xi(){const t=document.querySelector("#contributors"),e=document.querySelector("#contributors_tabitem"),i=document.createElement("div");i.id="contributors_grid",i.innerHTML=`Kindly allow us a moment to retrieve the contributors. 
    We're grateful for the many individuals who have generously put their time and effort to make this possible.`,e.append(i),t.addEventListener("click",s=>{t.getAttribute("data-visited")||(t.setAttribute("data-visited","true"),ze().then(o=>{i.innerHTML="";for(let a=0;a<o.length;a++){const c=o[a].login,r=o[a].html_url,u=o[a].avatar_url;i.innerHTML+=`
                        <a href="${r}" target="_blank" rel="noopener noreferrer nofollow" class="contributor-button flexbox col">
                            <figure><img src="${u}" lazy="true"></figure>
                            <div class="contributor-name">
                                ${c}
                            </div>
                        </a>`}}))})}const ge=()=>window.innerWidth<=768,Nt=t=>{var i;const e=vt();e.querySelectorAll("[mobile]").forEach(s=>{if(t){if(s.childElementCount===0){const n=s.getAttribute("mobile");if(n){const o=e.querySelector(n);o&&(s.setAttribute("mobile-restore",`#${o.parentElement.id}`),s.append(o))}}}else if(s.childElementCount>0){const n=s.getAttribute("mobile-restore");if(n){const o=e.querySelector(n);o&&o.append(s.firstElementChild)}}}),t?((i=e.querySelector(".accordion-vertical.expand #mask-icon-acc-arrow"))==null||i.click(),e.classList.add("default-mobile")):e.classList.remove("default-mobile")},Si=()=>{const t=vt(),e=window.opts.uiux_default_layout;t.classList.add(`default-${e.toLowerCase()}`),e==="Auto"?(window.addEventListener("resize",i=>{const s=ge();Nt(s)}),Nt(ge())):Nt(e==="Mobile")};function Ei(){const t=vt(),e=gt();if(!t||!e){console.warn(`Required elements not found: ${t?"":"anapnoeApp"} ${e?"":"gradioApp"}`);return}e.querySelector("#setting_uiux_mobile_scale input[type=range]").classList.add("hidden");const s=e.querySelector("#setting_uiux_mobile_scale input[type=number]");function n(f){document.head.querySelector('meta[name="viewport"]').setAttribute("content",`width=device-width, initial-scale=1, shrink-to-fit=no, maximum-scale=${f}`)}s.addEventListener("change",f=>{s.value=f.target.value,_t(s),n(f.target.value)}),n(window.opts.uiux_mobile_scale);function o(f){e.querySelectorAll('[id$="2img_width"] input,[id$="2img_height"] input').forEach(b=>{b.max=f})}e.querySelector("#setting_uiux_max_resolution_output").addEventListener("input",f=>{let b=parseInt(f.target.value);b=Math.min(Math.max(b,512),16384),o(b)}),o(window.opts.uiux_max_resolution_output);function a(f){f.forEach(b=>{const x=b.step/(b.max-b.min)*100,P=`max(3px, calc(${x}% - 1px))`,F=`max(4px, calc(${x}% + 0px))`;b.style.setProperty("--ae-slider-bg-overlay",`repeating-linear-gradient(90deg, transparent, transparent ${P}, var(--ae-input-border-color) ${P}, var(--ae-input-border-color) ${F})`)})}function c(f,b){const P=e.querySelectorAll("input[type='range']");f?a(P):b&&P.forEach(F=>{F.style.setProperty("--ae-slider-bg-overlay","transparent")})}e.querySelector("#setting_uiux_show_input_range_ticks input").addEventListener("click",f=>{c(f.target.checked,!0)}),c(window.opts.uiux_show_input_range_ticks);function u(){const f=Array.from(e.querySelectorAll("#setting_uiux_ignore_overrides input:checked")).map(x=>x.nextElementSibling.innerHTML);e.querySelectorAll("[id$='2img_override_settings'] .token").forEach(x=>{var D;const[P,F]=x.querySelector("span").textContent.split(":").map(p=>p.trim());f.includes(P)&&(e.querySelector("[id$='2img_override_settings']").classList.add("show"),(D=x.querySelector(".token-remove"))==null||D.click())})}e.querySelector("#setting_uiux_ignore_overrides").addEventListener("click",()=>{setTimeout(u,100)});const m=new MutationObserver(f=>{f.forEach(b=>{b.type==="attributes"&&b.attributeName==="class"&&setTimeout(u,1e3)})}),S=new MutationObserver(f=>{f.forEach(b=>{b.addedNodes.length&&setTimeout(u,1e3)})});document.querySelectorAll("#txt2img_override_settings .wrap-inner, #img2img_override_settings .wrap_inner").forEach(f=>S.observe(f,{childList:!0})),document.querySelectorAll("#txt2img_nav, #img2img_nav").forEach(f=>m.observe(f,{attributes:!0}));function O(f,b){const x=e.querySelector(`${f} input`);if(x){const P=f.split("#setting_")[1],F=window.opts[P];t.classList.toggle(b,F),localStorage.setItem(P,F),x.addEventListener("click",D=>{localStorage.setItem(P,D.target.checked),t.classList.toggle(b,D.target.checked),P==="uiux_enable_console_log"&&Je(D.target.checked)})}}const U=[{key:"#setting_uiux_no_slider_layout",className:"no-slider-layout"},{key:"#setting_uiux_show_labels_aside",className:"aside-labels"},{key:"#setting_uiux_show_labels_main",className:"main-labels"},{key:"#setting_uiux_show_labels_tabs",className:"tab-labels"},{key:"#setting_uiux_hide_extra_info",className:"no-extra-info"},{key:"#setting_uiux_disable_transitions",className:"notransition"},{key:"#setting_uiux_enable_console_log",className:"debug-log"}];for(const{key:f,className:b}of U)O(f,b);function E(f,b){t.style.setProperty(f,b)}const g=["#setting_uiux_exnet_fit_size","#setting_uiux_exnet_aspect_ratio_x","#setting_uiux_exnet_aspect_ratio_y","#setting_uiux_exnet_header_size","#setting_uiux_min_wrap_size","#setting_uiux_exnet_image_tint"];for(const f of g){const b=document.querySelector(`${f} input[type=number]`),x=document.querySelector(`${f} input[type=range]`);if(x&&x.classList.add("hidden"),b){const P=f.split("#setting_")[1],F=`--ae-${P}`,D=window.opts[P];E(F,D),b.addEventListener("change",p=>{_t(b),E(F,p.target.value)})}}}function Ci(){["#txt2img","#img2img","#deforum"].forEach(e=>{var s;const i=document.querySelector(`${e}_generate`);if(i){(s=document.querySelector(`${e}_nav`))==null||s.classList.remove("hidden");const n=document.querySelector(`${e}_interrupt`),o=n.closest(".portal"),a=i.closest(".ae-button"),c=document.querySelector(`${e}_skip`).closest(".portal"),r=document.querySelector(`${e}_loop`);n.addEventListener("click",()=>{r==null||r.classList.add("stop")}),new MutationObserver(m=>{m.forEach(S=>{n.style.display==="none"?(document.querySelector(".progressDiv .progress")&&(o.classList.remove("disable"),setTimeout(()=>n.click(),500)),r?r.className.indexOf("stop")!==-1||r.className.indexOf("active")===-1?(r.classList.remove("stop"),o.classList.add("disable"),c==null||c.classList.add("disable"),a.classList.remove("active")):r.className.indexOf("active")!==-1&&i.click():(o.classList.add("disable"),a.classList.remove("active"))):(o.classList.remove("disable"),c==null||c.classList.remove("disable"),a.classList.add("active"))})}).observe(n,{attributes:!0,attributeFilter:["style"]})}})}function Li(t,e){const i=document.querySelector("#setting_sd_model_checkpoint .wrap .secondary-wrap input")||document.querySelector(".gradio-dropdown.model_selection .wrap .secondary-wrap input"),s=document.querySelector("#setting_sd_model_checkpoint .wrap")||document.querySelector(".gradio-dropdown.model_selection .wrap"),n=document.querySelector("#checkpoints_main_footer_db .model-selected");document.querySelector("#checkpoints_main_footer_db .model-preloader").append(s);let a="";const c=u=>{if(a!==u){const m=u.split(".").slice(0,-1).join();t.selected=e.selected=new Set([m]),t.renderItems(),e.updateSelectedItems(),n.textContent=u,console.log("Checkpoint:",u,m),a=u}};c(i.value);const r=new MutationObserver(function(u){u.forEach(function(m){setTimeout(()=>c(i.value),1e3)})});r.observe(i,{attributes:!0}),r.observe(s,{childList:!0,subtree:!0})}function Wt(t,e,i,s=null){return Object.keys(t).forEach(n=>{const o=document.querySelector(`${n}`);if(o){const a=t[n],c=o.tagName==="SELECT"&&o.multiple||o.tagName==="SELECT"||o.type==="checkbox"||o.type==="radio"||o.type!=="range"&&o.type!=="color"&&o.type!=="text"?"change":"input",r=()=>{let u;o.tagName==="SELECT"&&o.multiple?(u=Array.from(o.selectedOptions).map(S=>S.value),e[a]=u):o.type==="checkbox"||o.type==="radio"?u=o.checked:u=o.value;const m=s?s({[a]:u}):{[a]:u};i.updateParamsAndFetch(m,1e3)};o.addEventListener(c,r)}else console.warn(`Input element with id ${n} not found.`)}),e}function _e(t){let e=t.startsWith("#")?t.slice(1):t,i=1;if(e.length===8?(i=parseInt(e.slice(6,8),16)/255,e=e.slice(0,6)):e.length===3&&(e=e.split("").map(n=>n+n).join("")),e.length!==6)throw new Error("Invalid HEX color.");const s=e.match(/.{2}/g).map(n=>parseInt(n,16));return s.push(i),s}function Dt(t){const e=t[0]/255,i=t[1]/255,s=t[2]/255,n=Math.max(e,i,s),o=Math.min(e,i,s),a=n-o,c=n+o,r=o===n?0:e===n?(60*(i-s)/a+360)%360:i===n?60*(s-e)/a+120:60*(e-i)/a+240,u=.5*c,m=u===0?0:u===1?1:u<=.5?a/c:a/(2-c),S=t.length===4?t[3]:1;return[Math.round(r),Math.round(m*100),Math.round(u*100),S]}function re(t,e,i,s=1){i/=100;const n=(s*255|256).toString(16).slice(1),o=a=>{const c=(a+t/30)%12,r=i-e*Math.min(i,1-i)/100*Math.max(Math.min(c-3,9-c,1),-1);return Math.round(255*Math.max(0,Math.min(r,1))).toString(16).padStart(2,"0")};return`#${o(0)}${o(8)}${o(4)}${n}`}function ye(t){t.startsWith("#")&&(t=t.slice(1));let e=1;if(t.length===8&&(e=parseInt(t.slice(6,8),16)/255,t=t.slice(0,6)),t.length===3&&(t=t.split("").map(o=>o+o).join("")),t.length!==6)throw new Error("Invalid HEX color.");const i=(255-parseInt(t.slice(0,2),16)).toString(16),s=(255-parseInt(t.slice(2,4),16)).toString(16),n=(255-parseInt(t.slice(4,6),16)).toString(16);return`#${Ut(i)}${Ut(s)}${Ut(n)}${Ut(Math.round(e*255).toString(16))}`}function Ut(t,e=2){return(new Array(e).join("0")+t).slice(-e)}const Q={};let kt,xt=[0,0,0,0];const Bt=t=>t.match(/[\d.]+/g).map(Number);function Ti(t,e,i,s){let n;if(i.includes("#")){let m=i.replace(/\s+/g,"");kt&&(m=ye(m),Q[e]=m),n=Dt(_e(m))}else if((i.includes("hsl")||i.includes("rgb"))&&(n=i.includes("rgb")?Dt(Bt(i)):Bt(i),kt)){const m=re(n[0],n[1],n[2],n[3]);Q[e]=ye(m),n=Dt(_e(Q[e]))}const o=((Number(n[0])||0)+(Number(s[0])||0))%360,a=Math.min(Math.max((Number(n[1])||0)+(Number(s[1])||0),0),100),c=Math.min(Math.max((Number(n[2])||0)+(Number(s[2])||0),0),100),r=Math.min(Math.max((Number(n[3])||1)+(Number(s[3])||0),0),1),u=re(o,a,c,r).slice(0,-2);return t.value=u,`hsla(${o}, ${a}%, ${c}%, ${r})`}function se(t){let e="";for(const n in Q){const o=Q[n];if(n!=""&&o&&o.length>0){const a=document.body.querySelector(`#${n} input`)||document.body.querySelector(`#${n} textarea`);if(a)if((a.type||"text")==="color"){const r=Ti(a,n,o,t);e+=`${n}:${r};`}else e+=`${n}:${Q[n]};`}}kt=!1;const i=document.body.querySelector("#preview-styles");i.innerHTML=`:root {${e}}`,i.innerHTML+="@media only screen and (max-width: 860px) { :root { --ae-outside-gap-size: var(--ae-mobile-outside-gap-size); --ae-inside-padding-size: var(--ae-mobile-inside-padding-size); } }";const s=document.body.querySelector("#theme_vars textarea");s.value=e,window.updateInput(s)}function ne(t){let e="";for(let o=0;o<t.length-1;o++){const[a,c]=t[o].split(":").map(m=>m.trim()),r=a.replace(/\s+/g,"");Q[r]=c,e+=`${r}:${c};`,document.body.querySelectorAll(`#${r} input, #${r} textarea`).forEach(m=>{const S=m.type||"text";if(S==="color")if(c.includes("hsl")||c.includes("rgb")){let y;c.includes("rgb")?y=Dt(Bt(c)):y=Bt(c),m.value=re(y[0],y[1],y[2],y[3]).slice(0,-2)}else m.value=c;else S==="number"||S==="range"?m.value=parseFloat(c)||0:(S==="textarea"||S==="text")&&(m.value=c)})}const i=document.body.querySelector("#preview-styles");if(i)i.innerHTML=`:root {${e}}`,i.innerHTML+="@media only screen and (max-width: 860px) { :root { --ae-outside-gap-size: var(--ae-mobile-outside-gap-size); --ae-inside-padding-size: var(--ae-mobile-inside-padding-size); } }";else{const o=document.createElement("style");o.id="preview-styles",o.innerHTML=`:root {${e}}`,o.innerHTML+="@media only screen and (max-width: 860px) { :root { --ae-outside-gap-size: var(--ae-mobile-outside-gap-size); --ae-inside-padding-size: var(--ae-mobile-inside-padding-size); } }",document.body.appendChild(o)}const s=document.body.querySelector("#theme_vars textarea"),n=document.body.querySelector("#theme_css textarea");s.value=e,window.updateInput(s),window.updateInput(n)}function ki(t){const e=t.split("/*BREAKPOINT_CSS_CONTENT*/");let i=e[0].split("}")[0].split("{")[1].replace(/\n|\r/g,"");i=i.replace(/;+/,";").trim();const s=i.split(";"),n=document.body.querySelector("#theme_vars textarea"),o=document.body.querySelector("#theme_css textarea");n.value=i,window.updateInput(n);const a=e[1]!==void 0?e[1]:"";o.value=`/*BREAKPOINT_CSS_CONTENT*/${a}/*BREAKPOINT_CSS_CONTENT*/`,ne(s);const c=document.body.querySelector("#preview-styles");if(!c){const E=document.createElement("style");E.id="preview-styles",E.innerHTML=t,document.body.appendChild(E)}let r;function u(E){let g=E.value,f=E.parentElement,b=E.type||"text";b==="range"||b==="number"?(f=E.closest(".gradio-slider")||E.closest(".gradio-number"),g+=f.id.indexOf("angle")!==-1?"deg":f.id.indexOf("slider-height")===-1?"px":"",Q[f.id]=g):b==="color"?(f=E.closest(".gradio-colorpicker"),Q[f.id]=g):b==="textarea"?(f=E.closest(".gradio-textbox"),g.length>0?Q[f.id]=g:delete Q[f.id]):b==="text"&&(f=E.closest(".gradio-dropdown"),f&&(Q[f.id]=g)),r!=null&&clearInterval(r),r=setTimeout(()=>{let x=Object.entries(Q).map(([P,F])=>`${P}:${F};`).join("");n.value=x,c.innerHTML=`:root {${x}}@media only screen and (max-width: 860px) { :root { --ae-outside-gap-size: var(--ae-mobile-outside-gap-size); --ae-inside-padding-size: var(--ae-mobile-inside-padding-size); } }`,window.updateInput(n),se(xt)},1e3)}document.body.querySelectorAll("#ui_theme_settings input, #ui_theme_settings textarea").forEach(E=>{E.addEventListener("input",g=>{u(g.currentTarget)})});const m=new MutationObserver(E=>{E.forEach(g=>{g.removedNodes.forEach(f=>{f.nodeType===1&&f.matches("ul")&&u(g.target.querySelector(".secondary-wrap input"))})})});document.body.querySelectorAll("#ui_theme_settings .gradio-dropdown").forEach(E=>{m.observe(E,{childList:!0,subtree:!0})}),document.getElementById("theme_reset_btn").addEventListener("click",E=>{E.preventDefault(),document.body.querySelectorAll("#ui_theme_hsv input").forEach(g=>{g.value=0}),xt=[0,0,0],ne(s)});let y;function k(){if(i!==n.value){clearInterval(y),i=n.value.replace(/\n|\r/g,""),i=i.split(":root{")[0],n.value=i;const E=i.split(";");ne(E)}}document.body.querySelector("#themes_drop_down input").addEventListener("click",E=>{y!==null&&clearInterval(y),n.value=i,y=setInterval(k,500)}),document.body.querySelectorAll("#theme_hue input, #theme_sat input, #theme_brt input").forEach((E,g)=>{E.addEventListener("change",f=>{f.preventDefault(),xt[Math.floor(g/2)]=f.currentTarget.value,se(xt)})}),document.getElementById("theme_invert_btn").addEventListener("click",E=>{E.preventDefault(),kt=!kt,se(xt)})}function be(t){var s;const i=(s=Array.from(t.sheet.cssRules).filter(n=>n instanceof CSSStyleRule&&n.selectorText===":root")[0])==null?void 0:s.cssText;i&&ki(i)}function Ii(){const t=document.querySelector('[rel="stylesheet"][href*="user"]');if(gt().querySelector('[id^="tab_ui_theme"]')&&t){be(t);return}const i=new MutationObserver(()=>{const s=document.querySelector('[rel="stylesheet"][href*="user"]');if(gt().querySelector('[id^="tab_ui_theme"]'))if(s)i.disconnect(),setTimeout(()=>{be(s)},500);else{var o=document.createElement("link");o.rel="stylesheet",o.type="text/css",o.href="./file=user.css",document.head.appendChild(o)}});i.observe(gt(),{childList:!0,subtree:!0})}function I(t,e,i=10,s={title:"username",url:"url"},n="",o={},a="POST"){this.container=t,this.originalData=e,this.data=e,this.itemsPerPage=i,this.limit=o.limit,this.apiUrl=n,this.method=a,this.params=o,this.keys=s,this.startIndex=0,this.renderedItems={},this.lastScrollTop=0,this.isFetching=!1,this.useDataFetching=!0,this.isInit=!1,this.resolvedRenderMethod=this.renderItems,this.selected,this.createContainer(),this.createSentinels(),this.createDetail(),this.initialize()}I.prototype.initialize=function(){(!this.apiUrl||this.apiUrl.includes(".json"))&&(this.useDataFetching=!1),this.isInit?this.data.length>0?(this.itemsWrapper.classList.remove("hidden"),this.updateDimensions()):this.itemsWrapper.classList.add("hidden"):this.data.length>0&&(this.isInit=!0,this.setupScrollListener(),this.resolvedRenderMethod(),this.setupResizeObserver(),this.setupKeyboardListener(),this.setupClickListener())};I.prototype.createContainer=function(){this.container.style.position="relative",this.container.style.overflow="auto",this.itemsWrapper=document.createElement("div"),this.itemsWrapper.className="ae-virtual-wrapper",this.container.appendChild(this.itemsWrapper)};I.prototype.createSentinel=function(){const t=document.createElement("div");return t.classList.add("sentinel"),t};I.prototype.createSentinels=function(){this.topSentinel=this.createSentinel(),this.bottomSentinel=this.createSentinel(),this.totalHeightSentinel=this.createSentinel(),this.container.append(this.topSentinel,this.bottomSentinel,this.totalHeightSentinel)};I.prototype.createDetail=function(){this.detail=document.createElement("div"),this.detail.className="ae-virtual-detail";const t=document.createElement("button");t.className="ae-button close";const e=document.createElement("div");e.className="mask-icon icon-cancel",t.appendChild(e),this.detail.appendChild(t);const i=document.createElement("div");i.className="ae-virtual-detail-content",this.detail.appendChild(i),this.container.parentElement.appendChild(this.detail),t.addEventListener("click",this.hideDetail.bind(this)),this.hideDetail()};I.prototype.createItemElement=function(t,e){const i=document.createElement("div");i.className="item card";const s=t[this.keys.url];s&&(i.style.backgroundImage=`url(${s})`);const n=document.createElement("span");return n.textContent=t[this.keys.title],n.className="title",i.appendChild(n),i};I.prototype.getItemsToRender=function(){const t=Math.max(0,this.startIndex),e=Math.min(this.data.length,this.startIndex+this.itemsPerPage);return this.data.slice(t,e)};I.prototype.renderItems=function(){this.itemsWrapper.innerHTML="";const t=this.getItemsToRender(),e=document.createDocumentFragment();t.forEach((i,s)=>{const n=this.startIndex+s,o=this.createItemElement(i,n);o.dataset.index=n,o.dataset.id=i.id,e.appendChild(o)}),this.itemsWrapper.appendChild(e),this.updateSentinels()};I.prototype.forceRenderItems=function(){this.itemsWrapper.innerHTML="",this.renderedItems={};const t=this.getItemsToRender(),e=document.createDocumentFragment();t.forEach((i,s)=>{const n=this.startIndex+s,o=this.createItemElement(i);o.dataset.index=n,o.dataset.id=i.id,e.appendChild(o),this.renderedItems[n]=o}),this.itemsWrapper.appendChild(e),this.updateSentinels()};I.prototype.renderItemsByIndex=function(t="down"){const e=this.getItemsToRender(),i=document.createDocumentFragment();e.forEach((s,n)=>{const o=this.startIndex+n;if(!this.renderedItems[o]){const a=this.createItemElement(s);a.dataset.index=o,a.dataset.id=s.id,i.appendChild(a),this.renderedItems[o]=a}}),t==="down"?this.itemsWrapper.appendChild(i):this.itemsWrapper.insertBefore(i,this.itemsWrapper.firstChild),this.cleanupRenderedItems(),this.updateSentinels()};I.prototype.cleanupRenderedItems=function(){const t=Object.keys(this.renderedItems),e=this.startIndex+this.itemsPerPage;for(let i=0;i<t.length;i++){const s=parseInt(t[i],10);if(s<this.startIndex||s>e){const n=this.renderedItems[s];this.itemsWrapper.removeChild(n),delete this.renderedItems[s]}}};I.prototype.updateSentinels=function(){const t=Math.max(0,this.startIndex),e=Math.min(this.data.length,this.startIndex+this.itemsPerPage),i=t/this.itemsPerRow*this.itemHeight;let s=e/this.itemsPerRow*this.itemHeight;s=Math.min(s,this.totalHeight),this.topSentinel.style.transform=`translateY(${i}px)`,this.bottomSentinel.style.transform=`translateY(${s}px)`,this.itemsWrapper.style.transform=`translateY(${i}px)`};I.prototype.updateDimensions=function(){const t=this.itemsWrapper.querySelector(".item");t&&(this.itemHeight=t.offsetHeight,this.itemWidth=t.offsetWidth,this.containerWidth=this.container.offsetWidth,this.containerHeight=this.container.parentElement.offsetHeight,this.containerHeight&&(this.container.style.height=`${this.containerHeight}px`,this.data.length&&(this.itemsPerRow=Math.floor(this.containerWidth/this.itemWidth),this.totalRows=Math.ceil(this.data.length/this.itemsPerRow),this.rowsInView=Math.ceil(this.containerHeight/this.itemHeight),this.itemsPerPage=Math.max(this.itemsPerPage,this.rowsInView*this.itemsPerRow),this.totalHeight=this.totalRows*this.itemHeight,this.totalHeightSentinel.style.transform=`translateY(${this.totalHeight}px)`,this.maxStartIndex=Math.max(this.data.length-this.itemsPerPage,0),this.scrollHandler())))};I.prototype.scrollHandler=function(){this.scrollTimeout&&cancelAnimationFrame(this.scrollTimeout),this.scrollTimeout=requestAnimationFrame(()=>{const t=this.container.scrollTop,e=Math.floor(t/this.itemHeight);this.startIndex=e*this.itemsPerRow;const i=t>this.lastScrollTop?"down":"up";this.lastScrollTop=t,i==="down"&&this.useDataFetching&&!this.isFetching&&this.params.cursor&&this.startIndex>=this.maxStartIndex&&(this.isFetching=!0,this.fetchUpdateData()),this.resolvedRenderMethod(i)})};I.prototype.clickHandler=function(t){const{target:e,currentTarget:i}=t,s=e.closest(".item.card").dataset.index,n=this.data[s];console.log(n)};I.prototype.setupScrollListener=function(){this.container.addEventListener("scroll",this.throttle(this.scrollHandler.bind(this),100))};I.prototype.setupResizeObserver=function(){let t;new ResizeObserver(()=>{clearTimeout(t),t=setTimeout(()=>{this.updateDimensions()},100)}).observe(this.container)};I.prototype.setupKeyboardListener=function(){document.addEventListener("keydown",this.handleKeyPress.bind(this))};I.prototype.setupClickListener=function(){this.container.addEventListener("click",this.clickHandler.bind(this))};I.prototype.handleKeyPress=function(t){switch(t.key){case"ArrowDown":this.scrollBy(1);break;case"ArrowUp":this.scrollBy(-1);break;case"Home":this.scrollToStart();break;case"End":this.scrollToEnd();break}};I.prototype.scrollBy=function(t){this.container.scrollTop+=t*this.itemHeight};I.prototype.scrollToStart=function(){this.startIndex=0,this.container.scrollTop=0};I.prototype.scrollToEnd=function(){this.startIndex=Math.max(0,this.data.length-this.itemsPerPage),this.container.scrollTop=this.startIndex*this.itemHeight};I.prototype.debounce=function(t,e=1e3){return(function(...i){const s=this,n=typeof i[i.length-1]=="number"?i.pop():e,o=()=>{this.timeout=null,t.apply(s,i)};clearTimeout(this.timeout),this.timeout=setTimeout(o,n)}).bind(this)};I.prototype.throttle=function(t,e){let i,s;return function(){const n=this,o=arguments;s?(clearTimeout(i),i=setTimeout(function(){Date.now()-s>=e&&(t.apply(n,o),s=Date.now())},e-(Date.now()-s))):(t.apply(n,o),s=Date.now())}};I.prototype.setNextCursor=function(t){t&&this.data.length>0?(this.params.cursor=t,this.params.page=Math.floor(this.data.length/this.params.limit)+1||1):this.params.cursor&&delete this.params.cursor,this.params.limit&&this.data.length>0?this.params.page=Math.floor(this.data.length/this.params.limit)+1:delete this.params.page};I.prototype.getValueByPath=function(t,e){return e?e.split(".").reduce((s,n)=>{if(s!=null)return s[n]},t):t};I.prototype.setData=function(t){this.originalData=t,this.data=t,this.container.scrollTop=0,this.lastScrollTop=0,this.initialize()};I.prototype.appendData=function(t){this.originalData.push(...t),this.data=this.originalData,this.isFetching=!1;const e=this.startIndex*this.itemHeight;this.container.scrollTop=e,this.updateDimensions()};I.prototype.updateDataByIndex=function(t,e){const i=this.originalData[e];for(const[s,n]of Object.entries(t))i[s]=n;this.originalData[e]=i,this.data=this.originalData,this.renderItems()};I.prototype.updateDataById=function(t,e){const i=this.originalData.find(s=>s.id===e);if(i){for(const[s,n]of Object.entries(t))i[s]=n;this.data=this.originalData,this.renderItems()}else console.error(`Item with ID ${e} not found.`)};I.prototype.setSelectedItems=function(t){this.selected=t,this.renderItems()};I.prototype.fetchData=async function(t){return new Promise((e,i)=>{const s=new XMLHttpRequest;let n=this.apiUrl;if(this.method.toUpperCase()==="GET"&&this.params){const o=new URLSearchParams;Object.keys(this.params).forEach(a=>{const c=this.params[a];Array.isArray(c)?c.forEach(r=>o.append(a,r)):o.append(a,c)}),n+="?"+o.toString()}s.open(this.method,n,!0),s.setRequestHeader("Accept","application/json"),s.onprogress=function(o){if(o.lengthComputable){const a=parseInt(o.loaded/o.total*100);t(a)}},s.onload=function(){if(s.status===200){const o=JSON.parse(s.responseText);e(o)}else i(s.status)},s.onerror=function(){i(s.status)},this.method.toUpperCase()==="POST"?(s.setRequestHeader("Content-Type","application/json"),s.send(JSON.stringify(this.params))):s.send()})};I.prototype.fetchUpdateData=async function(t=!1){var i;this.showLoadingIndicator();const e=await this.fetchData(s=>this.updateLoadingIndicator(s));if(e){const s=this.getValueByPath(e,this.keys.dataPath)||e;t?this.setData(s):this.appendData(s),this.setNextCursor(((i=e.metadata)==null?void 0:i.nextCursor)||e.nextCursor)}else console.error(`Error fetching data: ${error}`);this.hideLoadingIndicator()};I.prototype.updateParamsAndFetch=async function(t,e=1e3){Object.assign(this.params,t),Object.keys(this.params).forEach(s=>{this.params[s]||delete this.params[s]}),this.startIndex=0,delete this.params.cursor,this.originalData=[],this.data=this.originalData,this.debounce(this.fetchUpdateData.bind(this,!0),e)()};I.prototype.showLoadingIndicator=function(){this.loadingIndicator||(this.loadingIndicator=document.createElement("div"),this.loadingIndicator.className="loading-indicator",this.container.parentElement.appendChild(this.loadingIndicator),this.hideLoadingIndicator(),this.isFetching=!1),this.loadingIndicator.innerHTML="Loading... 0%",this.loadingIndicator.style.display="flex"};I.prototype.updateLoadingIndicator=function(t){this.loadingIndicator&&(this.loadingIndicator.innerHTML=`Loading... ${t}%`)};I.prototype.hideLoadingIndicator=function(){this.loadingIndicator&&(this.loadingIndicator.style.display="none")};I.prototype.showDetail=function(){this.detail.classList.remove("hidden")};I.prototype.hideDetail=function(){this.detail&&this.detail.classList.add("hidden")};I.prototype.filterItems=function(t,e={}){this.startIndex=0,this.data=this.originalData.filter(i=>{let s=!0;t&&(s=s&&i[this.keys.title].toLowerCase().includes(t.toLowerCase()));for(const[n,o]of Object.entries(e))if(i[n]!==void 0&&o!==void 0)if(Array.isArray(i[n])){const a=i[n];s=s&&a.some(c=>typeof c=="string"&&c.toLowerCase().includes(o.toLowerCase()))}else typeof i[n]=="string"&&(s=s&&i[n].toLowerCase().includes(o.toLowerCase()));return s}),this.updateDimensions(),this.forceRenderItems()};I.prototype.sortItems=function(t,e=!1){this.startIndex=0;const i=this,s=[...this.data];function n(o,a){const c=i.getValueByPath(o,t),r=i.getValueByPath(a,t);return!isNaN(c)&&!isNaN(r)?e?r-c:c-r:e?r<c?-1:r>c?1:0:c<r?-1:c>r?1:0}s.sort(n),this.data=s,this.updateDimensions(),this.forceRenderItems()};function rt(t,e){t.classList.add(e)}function pt(t,e){t.classList.remove(e)}function Vt(t,e,i){i?rt(t,e):pt(t,e)}function X(t,e,i){i=""+i,t["_s_"+e]!==i&&(t.style.setProperty(e,i),t["_s_"+e]=i)}let ve=0;function Gt(t,e){e&&(X(t,"transition","none"),e()),ve||(ve=t.clientTop&&0),e&&X(t,"transition","")}function we(t,e){t.firstChild.nodeValue=e}function Pe(t,e){return(e||document).getElementsByClassName(t)}function Rt(t,e,i,s){et(!0,t,e,i,s)}function et(t,e,i,s,n){e[(t?"add":"remove")+"EventListener"](i,s,n||n===!1?n:!0)}function Yt(t,e){t.stopPropagation(),e&&t.preventDefault()}function Ai(t,e){const i=It("a"),s=e.src;i.href=s,i.download=s.substring(s.lastIndexOf("/")+1),t.appendChild(i),i.click(),t.removeChild(i)}function It(t){return document.createElement(t)}function Lt(t,e){X(t,"display",e?"":"none")}function St(t,e){X(t,"visibility",e?"":"hidden")}function ht(t,e){X(t,"transition",e?"":"none")}const oe={},$i=It("video");function xe(t,e,i,s){let n,o;if(s!=="node"){const a=Object.keys(i);for(let c=0,r;c<a.length;c++)if(r=a[c],r.length>3&&r.indexOf("src")===0)if(s==="video"){const u=oe[r];if(u){if(u>0){n=i[r];break}}else if($i.canPlayType("video/"+r.substring(3).replace("-","").toLowerCase())){oe[r]=1,n=i[r];break}else oe[r]=-1}else{const u=parseInt(r.substring(4),10);if(u){const m=Math.abs(e-u);(!o||m<o)&&(o=m,n=i[r])}}}return n||i.src||i.href||t.src||t.href}function C(t,e={}){this.controls=["info","theme","download","play","page","close","autofit","zoom-in","zoom-out","prev","next","fullscreen"],this.controls_default={info:1,page:1,close:1,autofit:1,"zoom-in":1,"zoom-out":1,prev:1,next:1,fullscreen:1},this.keycodes={BACKSPACE:8,ESCAPE:27,SPACEBAR:32,LEFT:37,RIGHT:39,UP:38,NUMBLOCK_PLUS:107,PLUS:187,DOWN:40,NUMBLOCK_MINUS:109,MINUS:189,INFO:73},this.controls_dom={},this.connection=navigator.connection,this.dpr=window.devicePixelRatio||1,this.widget=It("div"),this.init(t,e)}C.prototype.init=function(t,e){this.parentEl||(this.doc=document.body,this.parentEl=t||document.body,this.scale=1,this.x=0,this.y=0,e&&(this.options=e),this.widget.innerHTML="<div class=spl-spinner></div><div class=spl-track><div class=spl-scene><div class=spl-pane></div></div></div><div class=spl-header><div class=spl-page> </div></div><div class=spl-progress></div><div class=spl-footer><div class=spl-title> </div><div class=spl-more> </div><div class=spl-description> </div><div class=spl-button> </div></div><div class=spl-prev></div><div class=spl-next></div>",this.widget.classList.add("spotlight"),this.slider=this.getOneByClass("scene"),this.header=this.getOneByClass("header"),this.footer=this.getOneByClass("footer"),this.title=this.getOneByClass("title"),this.description=this.getOneByClass("description"),this.button=this.getOneByClass("button"),this.page_prev=this.getOneByClass("prev"),this.page_next=this.getOneByClass("next"),this.page=this.getOneByClass("page"),this.progress=this.getOneByClass("progress"),this.spinner=this.getOneByClass("spinner"),this.panes=[this.getOneByClass("pane")],this.track=this.getOneByClass("track"),this.addControl("close",this.close.bind(this)),this.doc[this.prefix_request="requestFullscreen"]||this.doc[this.prefix_request="msRequestFullscreen"]||this.doc[this.prefix_request="webkitRequestFullscreen"]||this.doc[this.prefix_request="mozRequestFullscreen"]||(this.prefix_request=""),this.prefix_request?(this.prefix_exit=this.prefix_request.replace("request","exit").replace("mozRequest","mozCancel").replace("Request","Exit"),this.maximize=this.addControl("fullscreen",this.fullscreen.bind(this))):this.controls.pop(),this.addControl("info",this.info.bind(this)),this.addControl("autofit",this.autofit.bind(this)),this.addControl("zoom-in",this.zoom_in.bind(this)),this.addControl("zoom-out",this.zoom_out.bind(this)),this.addControl("theme",this.theme.bind(this)),this.player=this.addControl("play",this.play.bind(this)),this.addControl("download",this.download.bind(this)),Rt(this.page_prev,"click",this.prev.bind(this)),Rt(this.page_next,"click",this.next.bind(this)),Rt(this.button,"click",()=>{this.options_click?this.options_click(this.current_slide,this.options):this.options_href&&(location.href=this.options_href)}))};C.prototype.getOneByClass=function(t){return this.controls_dom[t]=Pe("spl-"+t,this.widget)[0]};C.prototype.addControl=function(t,e){const i=It("div");return i.className="spl-"+t,Rt(i,"click",e),this.header.appendChild(i),this.controls_dom[t]=i};C.prototype.removeControl=function(t){const e=this.controls_dom[t];e&&(this.header.removeChild(e),this.controls_dom[t]=null)};C.prototype.dispatch=function(t){const e=t.target.closest(".spotlight");if(e){Yt(t,!0);const i=e.closest(".spotlight-group");this.anchors=Pe("spotlight",i);for(let s=0;s<this.anchors.length;s++)if(this.anchors[s]===e){this.options_group=i&&i.dataset,this.init_gallery(s+1);break}}};C.prototype.show=function(t,e,i){this.anchors=t,e&&(this.options_group=e,this.options_onshow=e.onshow,this.options_onchange=e.onchange,this.options_onclose=e.onclose,this.index=i||e.index),this.init_gallery(i)};C.prototype.init_gallery=function(t){if(this.slide_count=this.anchors.length,this.slide_count){this.parentEl||this.init(),this.options_onshow&&this.options_onshow(t);const e=this.panes[0],i=e.parentNode;for(let s=this.panes.length;s<this.slide_count;s++){const n=e.cloneNode(!1);X(n,"left",s*100+"%"),i.appendChild(n),this.panes[s]=n}this.panel||(this.parentEl.appendChild(this.widget),this.update_widget_viewport()),this.current_slide=t||1,ht(this.slider),this.setup_page(!0),this.prefix_request&&this.detect_fullscreen(),this.show_gallery()}};C.prototype.parse_option=function(t,e){let i=this.options[t];return typeof i<"u"?(i=""+i,i!=="false"&&(i||e)):e};C.prototype.apply_options=function(t){this.options={},this.options_group&&Object.assign(this.options,this.options_group),Object.assign(this.options,t.dataset||t),this.options_media=this.options.media,this.options_click=this.options.onclick,this.options_theme=this.options.theme,this.options_class=this.options.class,this.options_autohide=this.parse_option("autohide",!0),this.options_infinite=this.parse_option("infinite"),this.options_progress=this.parse_option("progress",!0),this.options_autoslide=this.parse_option("autoslide"),this.options_preload=this.parse_option("preload",!0),this.options_href=this.options.buttonHref,this.delay=this.options_autoslide&&parseFloat(this.options_autoslide)||7,this.toggle_theme||this.options_theme&&this.theme(this.options_theme),this.options_class&&rt(this.widget,this.options_class),this.options_class&&Gt(this.widget);const e=this.options.control;if(e){const s=typeof e=="string"?e.split(","):e;for(let n=0;n<this.controls.length;n++)this.options[this.controls[n]]=!1;for(let n=0;n<s.length;n++){const o=s[n].trim();o==="zoom"?this.options["zoom-in"]=this.options["zoom-out"]=!0:this.options[o]=!0}}const i=this.options.animation;if(this.animation_scale=this.animation_fade=this.animation_slide=!i,this.animation_custom=!1,i){const s=typeof i=="string"?i.split(","):i;for(let n=0;n<s.length;n++){const o=s[n].trim();o==="scale"?this.animation_scale=!0:o==="fade"?this.animation_fade=!0:o==="slide"?this.animation_slide=!0:o&&(this.animation_custom=o)}}this.options_fit=this.options.fit};C.prototype.prepare_animation=function(t){t?Gt(this.media,this.prepare_animation):(X(this.media,"opacity",this.animation_fade?0:1),this.update_scroll(this.animation_scale&&.8),this.animation_custom&&rt(this.media,this.animation_custom))};C.prototype.init_slide=function(t){if(this.panel=this.panes[t-1],this.media=this.panel.firstChild,this.current_slide=t,this.media)this.disable_autoresizer(),this.options_fit&&rt(this.media,this.options_fit),this.animation_custom&&pt(this.media,this.animation_custom),this.animation_fade&&X(this.media,"opacity",1),this.animation_scale&&X(this.media,"transform",""),X(this.media,"visibility","visible"),this.options_autoslide&&this.animate_bar(this.playing);else{const e=this.gallery.media,i=this.parse_option("spinner",!0);if(e==="node"){this.media=this.gallery.src,typeof this.media=="string"&&(this.media=document.querySelector(this.media)),this.media&&(this.media._root||(this.media._root=this.media.parentNode),this.update_media_viewport(),this.panel.appendChild(this.media),this.init_slide(t));return}else this.toggle_spinner(i,!0),this.media=It("img"),this.media.onload=()=>{this.media.onerror=null,this.toggle_spinner(i),this.init_slide(t),this.update_media_viewport()},this.media.src=this.gallery.src,this.panel.appendChild(this.media);this.media&&(i||X(this.media,"visibility","visible"),this.media.onerror=()=>{this.checkout(this.media),rt(this.spinner,"error"),this.toggle_spinner(i)})}};C.prototype.toggle_spinner=function(t,e){t&&Vt(this.spinner,"spin",e)};C.prototype.has_fullscreen=function(){return document.fullscreen||document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement};C.prototype.resize_listener=function(){if(this.update_widget_viewport(),this.media&&this.update_media_viewport(),this.prefix_request){const t=this.has_fullscreen();Vt(this.maximize,"on",t),t||this.detect_fullscreen()}};C.prototype.detect_fullscreen=function(){Lt(this.maximize,screen.availHeight-window.innerHeight>0)};C.prototype.update_widget_viewport=function(){this.viewport_w=this.widget.clientWidth,this.viewport_h=this.widget.clientHeight};C.prototype.update_media_viewport=function(){this.media_w=this.media.clientWidth,this.media_h=this.media.clientHeight};C.prototype.update_scroll=function(t){X(this.media,"transform","translate(-50%, -50%) scale("+(t||this.scale)+")")};C.prototype.update_panel=function(t,e){X(this.panel,"transform",t||e?"translate("+t+"px, "+e+"px)":"")};C.prototype.update_slider=function(t,e,i){e?Gt(this.slider,()=>{this.update_slider(t,!1,i)}):X(this.slider,"transform","translateX("+(-t*100+(i||0))+"%)")};C.prototype.toggle_listener_track=function(t){const e=this.track;window.activeElement=e,et(t,e,"wheel",this.wheel_listener.bind(this),{passive:!1}),et(t,e,"mousedown",this.start.bind(this)),et(t,e,"mousemove",this.move.bind(this)),et(t,e,"mouseleave",this.end.bind(this)),et(t,e,"mouseup",this.end.bind(this)),et(t,e,"touchstart",this.start.bind(this),{passive:!1}),et(t,e,"touchmove",this.move.bind(this),{passive:!0}),et(t,e,"touchend",this.end.bind(this)),et(t,e,"resize",this.resize_listener.bind(this))};C.prototype.toggle_listener_widget=function(t){const e=this.parentEl;et(t,e,"resize",this.resize_listener.bind(this)),this.toggle_listener_track(t)};C.prototype.toggle_listener=function(t){et(t,window,"keydown",this.key_listener.bind(this)),this.toggle_listener_widget(t)};C.prototype.history_listener=function(t){this.panel&&t.state.spl&&this.close(!0)};C.prototype.key_listener=function(t){if(this.panel&&window.activeElement&&window.activeElement===this.track){const e=this.options["zoom-in"]!==!1;switch(t.keyCode){case this.keycodes.BACKSPACE:e&&this.autofit();break;case this.keycodes.ESCAPE:this.close();break;case this.keycodes.SPACEBAR:this.options_autoslide&&this.play();break;case this.keycodes.LEFT:this.prev();break;case this.keycodes.RIGHT:this.next();break;case this.keycodes.UP:case this.keycodes.NUMBLOCK_PLUS:case this.keycodes.PLUS:e&&this.zoom_in();break;case this.keycodes.DOWN:case this.keycodes.NUMBLOCK_MINUS:case this.keycodes.MINUS:e&&this.zoom_out();break;case this.keycodes.INFO:this.info();break}}};C.prototype.wheel_listener=function(t){if(this.panel&&this.options["zoom-in"]!==!1){let e=t.deltaY;e=(e<0?1:e?-1:0)*.5;const i=this.widget.getBoundingClientRect(),s=t.clientX-i.left,n=t.clientY-i.top;e<0?this.zoom_out(t,s,n):this.zoom_in(t,s,n)}};C.prototype.play=function(t,e){(typeof t=="boolean"?t:!this.playing)===!this.playing&&(this.playing=this.playing?clearTimeout(this.playing):1,Vt(this.player,"on",this.playing),e||this.animate_bar(this.playing))};C.prototype.animate_bar=function(t){this.options_progress&&(Gt(this.progress,function(){X(this.progress,"transition-duration",""),X(this.progress,"transform","")}),t&&(X(this.progress,"transition-duration",this.delay+"s"),X(this.progress,"transform","translateX(0)"))),t&&(this.playing=setTimeout(this.next,this.delay*1e3))};C.prototype.autohide=function(){this.options_autohide&&(this.hide_cooldown=Date.now()+2950,this.hide||(rt(this.widget,"menu"),this.schedule(3e3)))};C.prototype.schedule=function(t){this.hide=setTimeout(()=>{const e=Date.now();e>=this.hide_cooldown?(pt(this.widget,"menu"),this.hide=0):this.schedule(this.hide_cooldown-e)},t)};C.prototype.menu=function(t){typeof t=="boolean"&&(this.hide=t?this.hide:0),this.hide?(this.hide=clearTimeout(this.hide),pt(this.widget,"menu")):this.autohide()};C.prototype.start=function(t){Yt(t,!0),this.is_down=!0,this.dragged=!1,this.is_sliding_up=!1;let e=t,i=t.touches;this.prev_touches=i,i&&(i=i[0])&&(e=i),this.slidable=this.media_w*this.scale<=this.viewport_w&&this.media_h*this.scale<=this.viewport_h,this.startX=e.pageX,this.startY=e.pageY,window.activeElement=this.track,ht(this.panel)};C.prototype.end=function(t){if(Yt(t),this.is_down){if(!this.dragged)this.menu();else{if(this.slidable&&this.dragged){const e=this.x<-(this.viewport_w/7)&&(this.current_slide<this.slide_count||this.options_infinite),i=e||this.x>this.viewport_w/7&&(this.current_slide>1||this.options_infinite);(e||i)&&(this.update_slider(this.current_slide-1,!0,this.x/this.viewport_w*100),e&&this.next()||i&&this.prev()),this.is_sliding_up&&this.y<-(this.viewport_h/4)?this.close():(this.x=0,this.y=0),this.update_panel()}ht(this.panel,!0)}this.is_down=!1}};C.prototype.distance=function(t){const e=this.widget.getBoundingClientRect(),i=t[0].clientX-e.left,s=t[0].clientY-e.top,n=t[1].clientX-e.left,o=t[1].clientY-e.top;return Math.sqrt(Math.pow(i-n,2)+Math.pow(s-o,2))};C.prototype.center_of=function(t){const e=this.widget.getBoundingClientRect(),i=t[0].clientX-e.left,s=t[0].clientY-e.top,n=t[1].clientX-e.left,o=t[1].clientY-e.top;return[(i+n)*.5,(s+o)*.5]};C.prototype.scale_touches=function(t){if(this.options["zoom-in"]!==!1&&t&&t.length===2&&this.prev_touches&&this.prev_touches.length===2){const e=this.distance(t)/this.distance(this.prev_touches),i=this.center_of(t);this.centered_zoom(e,i[0],i[1],!1)}return this.prev_touches=t,t&&t[0]};C.prototype.move=function(t){if(Yt(t),this.is_down){let e=this.scale_touches(t.touches);if(e&&(t=e),!this.dragged){const i=this.startX-t.pageX,s=this.startY-t.pageY;this.is_sliding_up=this.slidable&&s>Math.abs(i)*1.15}if(this.is_sliding_up)this.y-=this.startY-(this.startY=t.pageY);else if(this.slidable)this.x-=this.startX-(this.startX=t.pageX);else{let i=(this.media_w*this.scale-this.viewport_w)/2,s=Math.abs(i);i>0&&(this.x-=this.startX-(this.startX=t.pageX)),this.x>s?this.x=s:this.x<-s&&(this.x=-s),i=(this.media_h*this.scale-this.viewport_h)/2,s=Math.abs(i),i>0&&(this.y-=this.startY-(this.startY=t.pageY)),this.y>s?this.y=s:this.y<-s&&(this.y=-s)}this.dragged=!0,this.update_panel(this.x,this.y)}else this.autohide()};C.prototype.fullscreen=function(t){console.log("fullscreen",t);const e=this.has_fullscreen();(typeof t!="boolean"||t!==!!e)&&(e?document[this.prefix_exit]():this.widget[this.prefix_request]())};C.prototype.theme=function(t){typeof t!="string"&&(t=this.toggle_theme?"":this.options_theme||"white"),this.toggle_theme!==t&&(this.toggle_theme&&pt(this.widget,this.toggle_theme),t&&rt(this.widget,t),this.toggle_theme=t)};C.prototype.autofit=function(t){typeof t=="boolean"&&(this.toggle_autofit=!t),this.toggle_autofit=this.scale===1&&!this.toggle_autofit,Vt(this.media,"autofit",this.toggle_autofit),X(this.media,"transform",""),this.scale=1,this.x=0,this.y=0,this.update_media_viewport(),ht(this.panel),this.update_panel()};C.prototype.centered_zoom=function(t,e,i,s){let n=this.scale*t;if(ht(this.panel,s),ht(this.media,s),this.disable_autoresizer(),n<=1){this.x=this.y=0,this.update_panel(this.x,this.y),this.zoom(1);return}if(!(n>50)){if(i){const o=this.viewport_w/2,a=this.viewport_h/2;this.x=e-(e-this.x-o)*t-o,this.y=i-(i-this.y-a)*t-a}else this.x*=t,this.y*=t;this.update_panel(this.x,this.y),this.zoom(n)}};C.prototype.zoom_in=function(t,e,i){this.centered_zoom(1/.65,e,i,!0)};C.prototype.zoom_out=function(t,e,i){this.centered_zoom(.65,e,i,!0)};C.prototype.zoom=function(t){this.scale=t||1,this.update_scroll()};C.prototype.info=function(){this.footer_visible=!this.footer_visible,St(this.footer,this.footer_visible)};C.prototype.disable_autoresizer=function(){this.toggle_autofit&&this.autofit()};C.prototype.show_gallery=function(){window.history.pushState({spl:1},""),window.history.pushState({spl:2},""),ht(this.widget,!0),rt(this.parentEl,"hide-scrollbars"),rt(this.widget,"spotlight"),rt(this.widget,"show"),this.toggle_listener(!0),this.update_widget_viewport(),this.update_media_viewport(),ht(this.panel),this.update_panel(),this.autohide(),this.options_autoslide&&this.play(!0,!0)};C.prototype.download=function(){Ai(this.parentEl,this.media)};C.prototype.close=function(t){setTimeout(()=>{var e;console.log(this.parentEl,this.widget),(e=this.parentEl)==null||e.removeChild(this.widget),this.panel=this.media=this.gallery=this.options=this.options_group=this.anchors=this.options_onshow=this.options_onchange=this.options_onclose=this.options_click=null},200),pt(this.parentEl,"hide-scrollbars"),pt(this.widget,"show"),this.fullscreen(!1),this.toggle_listener(),window.history.go(t===!0?-1:-2),this.playing&&this.play(),this.media&&this.checkout(this.media),this.hide&&(this.hide=clearTimeout(this.hide)),this.toggle_theme&&this.theme(),this.options_class&&pt(this.widget,this.options_class),this.options_onclose&&this.options_onclose()};C.prototype.checkout=function(t){if(t._root)t._root.appendChild(t),t._root=null;else{const e=t.parentNode;e&&e.removeChild(t),t=t.src=t.onerror=""}};C.prototype.prev=function(t){if(t&&this.autohide(),this.slide_count>1){if(this.current_slide>1)return this.goto(this.current_slide-1);if(this.options_infinite)return this.update_slider(this.slide_count,!0),this.goto(this.slide_count)}};C.prototype.next=function(t){if(t&&this.autohide(),this.slide_count>1){if(this.current_slide<this.slide_count)return this.goto(this.current_slide+1);if(this.options_infinite)return this.update_slider(-1,!0),this.goto(1);this.playing&&this.play()}};C.prototype.goto=function(t){if(t!==this.current_slide){this.playing?(clearTimeout(this.playing),this.animate_bar()):this.autohide();const e=t>this.current_slide;return this.current_slide=t,this.setup_page(e),!0}};C.prototype.prepare=function(t){let e=this.anchors[this.current_slide-1];this.apply_options(e);const i=this.connection&&this.connection.downlink;let s=Math.max(this.viewport_h,this.viewport_w)*this.dpr;i&&i*1200<s&&(s=i*1200);let n;if(this.gallery={media:this.options_media,src:xe(e,s,this.options,this.options_media),title:this.parse_option("title",e.alt||e.title||(n=e.firstElementChild)&&(n.alt||n.title))},this.options_preload&&t&&(e=this.anchors[this.current_slide])){const o=e.dataset||e,a=o.media;(!a||a==="image")&&(this.gallery_next=xe(e,s,o,a))}for(let o=0;o<this.controls.length;o++){const a=this.controls[o];Lt(this.controls_dom[a],this.parse_option(a,this.controls_default[a]))}};C.prototype.setup_page=function(t){if(this.x=0,this.y=0,this.scale=1,this.media)if(this.media.onerror)this.checkout(this.media);else{let o=this.media;setTimeout(()=>{o&&this.media!==o&&(this.checkout(o),o=null)},650),this.prepare_animation(),this.update_panel()}this.footer&&St(this.footer,0),this.prepare(t),this.update_slider(this.current_slide-1),pt(this.spinner,"error"),this.init_slide(this.current_slide),ht(this.panel),this.update_panel();const e=this.gallery.title,i=this.parse_option("description"),s=this.parse_option("button"),n=e||i||s;n&&(this.title.innerHTML=e,this.description.innerHTML=i,s&&we(this.button,s),Lt(this.title,e),Lt(this.description,i),Lt(this.button,s),X(this.footer,"transform",this.options_autohide==="all"?"":"none")),this.options_autohide||rt(this.widget,"menu"),St(this.footer,this.footer_visible&&n),St(this.page_prev,this.options_infinite||this.current_slide>1),St(this.page_next,this.options_infinite||this.current_slide<this.slide_count),we(this.page,this.slide_count>1?this.current_slide+" / "+this.slide_count:""),this.options_onchange&&this.options_onchange(this.current_slide,this.options)};function jt(t,e){const i=document.querySelector(`#pnginfo_send_buttons ${e}`),s=document.querySelector('#pnginfo_image input[type="file"]'),n=new DataTransfer;s.files=n.files,fetch(t.src).then(o=>o.blob()).then(o=>{const a=new File([o],"image.jpg",{type:o.type}),c=new DataTransfer;c.items.add(a),s.files=c.files,ei(s),setTimeout(()=>{i.click()},1e3)}).catch(o=>console.error("Error fetching image:",o))}async function qi(){const t=document.querySelector("#civitai_cardholder_images"),e=document.querySelector("#civit_search_images"),i=document.querySelector("#civit_search_images_clear"),s=100,n="/sd_webui_ux/civitai_proxy/images",o={"#civit_nsfw_images":"nsfw","#civit_sort_images":"sort","#civit_period_images":"period","#civit_search_images":"username"},a={limit:s,page:1},c={title:"username",url:"url",dataPath:"items"},r=new I(t,[],18,c,n,a),u=Wt(o,a,r),m=["prompt","negativePrompt","clipSkip","cfgScale","sampler","steps","seed","Size"];function S(k){const O=t.parentElement.querySelector(".ae-virtual-detail-content");O.innerHTML="";var U=[];k.forEach(b=>{var D,p;const x=b.url,P=[];P.push(`<p><strong>baseModel:</strong> ${b.baseModel}</p>`),m.forEach(l=>{b.meta&&b.meta[l]!==void 0&&P.push(`<p><strong>${l}:</strong> ${b.meta[l]}</p>`)}),b.meta&&b.meta.civitaiResources&&((p=(D=b.meta)==null?void 0:D.civitaiResources)==null||p.forEach(l=>{const v=l.type?l.type:"Unknown Type",A=l.weight?l.weight:"",L=l.modelVersionId?l.modelVersionId:null,T=l.modelVersionName?l.modelVersionName:"Unnamed Model";L&&P.push(`
                        <p>${v} ${A}
                            <a href="https://civitai.com/api/v1/models/${L}" target="_blank">
                                ${T}
                            </a>
                        </p>
                    `)}));const F=P.join("");if(x){const l={title:`<button class="ae-button"><h2>${b.username}</h2></button>`,description:F,src:x};U.push(l)}});const E=new C(O);E.addControl("txt2img-send mask-icon icon-2txt2img",function(b){const x=O.querySelector("img");jt(x,"#pnginfo_send_txt2img button")}),E.addControl("img2img-send mask-icon icon-2img2img",function(b){const x=O.querySelector("img");jt(x,"#pnginfo_send_img2img button")}),E.show(U,{index:1,theme:"dark",autohide:!1,info:!0,control:["next","prev","page","spinner","info","autofit","zoom","fullscreen","close"]});const g=O.querySelector(".spl-title");function f(b){e.value=b.target.textContent,E.close(),_t(e)}g.removeEventListener("click",f),g.addEventListener("click",f)}r.clickHandler=function(k){const{target:O,currentTarget:U}=k,E=O.closest(".item.card").dataset.index,g=this.data[E];g&&(r.showDetail(),S([g]),console.log(g))};function y(k){e.value="",_t(e)}i.addEventListener("click",y),r.updateParamsAndFetch(u,0)}async function Oi(){const t=document.querySelector("#civitai_cardholder_models"),e=document.querySelector("#civit_search_models"),i=document.querySelector("#civit_search_models_clear"),s=100,n="/sd_webui_ux/civitai_proxy/models",o={"#civit_nsfw_models":"nsfw","#civit_type_models":"types","#civit_sort_models":"sort","#civit_period_models":"period","#civit_search_models":"query"},a={limit:s,page:1},c={title:"username",url:"url",dataPath:"items"},r=new I(t,[],18,c,n,a),u=Wt(o,a,r);r.createItemElement=function(y){var g,f;const k=document.createElement("div");k.className="item card";const O=(f=(g=y.modelVersions[0])==null?void 0:g.images[0])==null?void 0:f.url;O&&(k.style.backgroundImage=`url(${encodeURI(O)})`);const U=document.createElement("span");U.textContent=y.name,U.className="title";const E=document.createElement("span");return E.textContent=y.type,E.className=`extra-type ${y.type}`,k.appendChild(E),k.appendChild(U),k};function m(y,k,O){const U=t.parentElement.querySelector(".ae-virtual-detail-content");U.innerHTML="";var E=[];const g=[];g.push('<select class="baseModel">'),k.forEach((z,N)=>{const R=N===O?"selected":"";g.push(`<option value="${N}" ${R}>${z.baseModel} | ${z.name} | ${z.baseModelType}</option>`)}),g.push("</select>");const f=g.join(""),b=k[O].description?k[O].description:"",x=y.description+b,P=k[O].images;P&&P.forEach(z=>{const N=z.url;if(N){const R={title:`${y.name}`,description:`${x} <br> ${y.tags}`,src:N};E.push(R)}});const F=new C(U);F.show(E,{index:1,theme:"dark",autohide:!1,control:["next","prev","page","spinner","info","autofit","zoom","download","fullscreen","close"]}),F.addControl("txt2img-send mask-icon icon-2txt2img",function(z){const N=U.querySelector("img");jt(N,"#pnginfo_send_txt2img button")}),F.addControl("img2img-send mask-icon icon-2img2img",function(z){const N=U.querySelector("img");jt(N,"#pnginfo_send_img2img button")});const D=U.querySelector(".spl-more"),p=document.createElement("div");p.innerHTML=f;const l=p.firstChild;l.addEventListener("change",function(N){F.close(),setTimeout(()=>{m(y,k,parseInt(N.target.value))},300)});const v=document.createElement("span");v.innerHTML=y.type,v.className="model-type";function A(z){const N=z/1024;return N>=1024?`${(N/1024).toFixed(2)} GB`:`${N.toFixed(2)} MB`}const L=k[O].files[0].downloadUrl,T=k[O].files[0].name,$=k[O].files[0].sizeKB,q=document.createElement("a");q.target="_blank",q.href=L,q.textContent=`${T} - ${A($)}`,D.appendChild(v),D.appendChild(l),D.appendChild(q)}r.clickHandler=function(y){const{target:k,currentTarget:O}=y,U=k.closest(".item.card").dataset.index,E=this.data[U];E.modelVersions&&(r.showDetail(),m(E,E.modelVersions,0),console.log(E))};function S(y){e.value="",_t(e)}i.addEventListener("click",S),r.updateParamsAndFetch(u,0)}function Z(t,e,i,s=""){this.container=document.querySelector(t),this.fetchUrl=e,this.tableName=i,this.rootPath=s.replace(/\\/g,"/").toLowerCase(),this.selected}Z.prototype.initialize=async function(){this.container.innerHTML="";const t=await this.fetchData(this.rootPath),e=this.buildTree(t),i=this.createTreeView(e);this.container.appendChild(i),this.attachEventListeners(),this.itemMap=t.reduce((s,n)=>(s[n.id]=n,s),{})};Z.prototype.updateSelectedItems=function(){var t;this.container.querySelectorAll(".li-file.active").forEach(e=>{e.classList.remove("active")}),(t=this.selected)==null||t.forEach(e=>{const i=this.container.querySelector(`.li-file[data-name="${e}"]`);i&&i.classList.add("active")})};Z.prototype.fetchData=async function(t){const i=await(await fetch(`${this.fetchUrl}?table_name=${this.tableName}&path=${encodeURIComponent(t)}`)).json();return this.data=i.data,console.log("tree data length:",this.data.length),i.data};Z.prototype.buildTree=function(t){const e={},i=this.rootPath;e[i]={};const s=e[i];return t.forEach(n=>{const o=n.filename.replace(/\\/g,"/").toLowerCase(),a=o.indexOf(i);if(a===-1)return;const r=o.slice(a+i.length).replace(/^\//,"").split("/").filter(Boolean);let u=s;for(let m=0;m<r.length;m++){const S=r[m];u[S]||(m===r.length-1?u[S]=n:u[S]={}),u=u[S]}}),e};Z.prototype.createFileItem=function(t,e){const i=document.createElement("li");return i.dataset.name=t[e].name,i.dataset.id=t[e].id,i.innerHTML=`<summary class="tree-file">${t[e].name}</summary>`,i.classList.add("li-file"),i};Z.prototype.createFolderItem=function(t,e,i){const s=document.createElement("li");s.innerHTML=`<summary class="tree-folder caret" data-path="${i}${e}">${e}</summary>`;const n=this.createTreeView(t[e],`${i}/${e}`);return n.classList.add("nested"),s.appendChild(n),s};Z.prototype.createTreeView=function(t,e=""){const i=document.createElement("ul");i.classList.add("tree-view");for(const s in t){let n;typeof t[s]=="object"&&!Array.isArray(t[s])?s.includes(".safetensors")||s.includes(".pt")||s.includes(".png")||s.includes(".jpg")||s.includes(".webp")?n=this.createFileItem(t,s):n=this.createFolderItem(t,s,e):n=this.createFileItem(t,s),i.appendChild(n)}return i};Z.prototype.attachEventListeners=function(){this.eventListenerAdded||(this.container.addEventListener("click",async t=>{const e=t.target,i=e.closest("li[data-id]");if(e.tagName==="BUTTON"){const n=i.dataset.id,o=this.getItemProperties(n);this.onFileClicked(e,o)}else if(i){const n=i.dataset.id,o=this.getItemProperties(n);this.onFileClicked(i,o)}else if(e.classList.contains("caret")){e.classList.toggle("caret-down");const n=e.nextElementSibling;n.classList.contains("nested")&&n.classList.toggle("active"),this.onFolderClicked(e,e.getAttribute("data-path"),n.classList.contains("active"))}t.stopPropagation()}),this.eventListenerAdded=!0)};Z.prototype.getItemProperties=function(t){return this.itemMap[t]};Z.prototype.updateDataById=function(t,e){const i=this.itemMap[e];if(i)for(const[s,n]of Object.entries(t))i[s]=n;else console.error(`Item with ID ${e} not found.`)};Z.prototype.onFolderClicked=function(t,e,i){};Z.prototype.onFileClicked=function(t,e){};function J(t,e,i,s,n="Submit"){this.url=t,this.table_name=e,this.itemData=i,this.container=s,this.submit_label=n,this.form=document.createElement("form"),this.form.setAttribute("id","userMetadataForm"),this.form.classList.add("flexbox","padding","col","shrink")}J.prototype.formatFileSize=function(t){return typeof t!="number"?"0 bytes":t>=1073741824?(t/1073741824).toFixed(2)+" GB":t>=1048576?(t/1048576).toFixed(2)+" MB":t>=1024?(t/1024).toFixed(2)+" KB":t+" bytes"};J.prototype.formatDate=function(t){return typeof t!="number"?"":new Date(t*1e3).toLocaleDateString()};J.prototype.formatFilename=function(t){return typeof t!="string"?"":t.replace(/\\/g,"/").split("/").pop()};J.prototype.createElement=function(t,e,i,s={}){const n={textarea:{tag:"textarea",attributes:{rows:1,textContent:i||""}},select:{tag:"select",attributes:{},children:Array.isArray(s.options)?s.options.map(c=>({tag:"option",attributes:{value:c,textContent:c}})):[]},input:{tag:"input",attributes:{type:"text",value:i||""}},file:{tag:"input",attributes:{type:"file"}},number:{tag:"input",attributes:{type:"number",value:i}},checkbox:{tag:"input",attributes:{type:"checkbox",checked:i}},radio:{tag:"input",attributes:{type:"radio",checked:i}},slider:{tag:"input",attributes:{type:"range",value:i}},img:{tag:"img",attributes:{src:"file="+i,alt:e,class:"thumbnail-image"}},button:{tag:"button",textContent:i,attributes:{type:"button",class:"ae-button",name:e}},placeholder:{tag:"div",attributes:s},default:{tag:"input",attributes:{type:"text",value:i||""}}},o=n[t]||n.default,a=document.createElement(o.tag);return Object.entries(o.attributes).forEach(([c,r])=>{c==="textContent"?a.textContent=r:c==="checked"?a.checked=!!r:a.setAttribute(c,r)}),Object.entries(s).forEach(([c,r])=>{c==="textContent"?a.textContent=r:c==="checked"?a.checked=!!r:a.setAttribute(c,r)}),o.children&&o.children.forEach(c=>{const r=document.createElement(c.tag);Object.entries(c.attributes).forEach(([u,m])=>{u==="textContent"?r.textContent=m:r.setAttribute(u,m)}),c.attributes.value===i&&(r.selected=!0),a.appendChild(r)}),a.setAttribute("id",e),a.setAttribute("name",e),a};J.prototype.addElementToForm=function(t,e){const i=document.createElement("div");i.classList.add("panel","col","padding");const s=document.createElement("label");s.setAttribute("for",t),s.classList.add("flexbox"),s.textContent=t.replace("_"," ").toUpperCase();const n=this.createElement(e.type,t,this.itemData[t],e);i.appendChild(s),i.appendChild(n),this.form.appendChild(i)};J.prototype.createForm=function(t){Object.entries(t).forEach(([n,o])=>{(this.itemData.hasOwnProperty(n)||o.type==="placeholder")&&this.addElementToForm(n,o)});const e=document.createElement("div");e.classList.add("panel","row","flex-end");const i=document.createElement("button");i.setAttribute("type","submit"),i.textContent=this.submit_label,i.classList.add("ae-submit-button");const s=document.createElement("button");return s.setAttribute("type","button"),s.textContent="Cancel",s.classList.add("ae-submit-button"),e.appendChild(i),e.appendChild(s),this.form.appendChild(e),this.form.addEventListener("submit",n=>this.handleSubmit(n)),this.form};J.prototype.createValueElement=function(t,e,i,s){const n={filename:{textContent:this.formatFilename(i)},filesize:{textContent:this.formatFileSize(i)},"date-format":{textContent:this.formatDate(i)},img:{tag:"img",attributes:{src:"./file="+i,alt:e,class:"thumbnail-image"}},button:{tag:"button",textContent:s||"button",attributes:{class:`ae-button ${e}`,name:e}},default:{textContent:i||""}},o=n[t]||n.default;let a;return o.tag?(a=document.createElement(o.tag),Object.entries(o.attributes).forEach(([c,r])=>{a.setAttribute(c,r)}),o.textContent&&(a.textContent=o.textContent)):(a=document.createElement("span"),a.textContent=o.textContent),a};J.prototype.createTable=function(t){const e=document.createElement("table");return e.classList.add("non-editable-table","panel"),Object.entries(t).forEach(([i,s])=>{const n=document.createElement("tr"),o=document.createElement("td");o.textContent=i.replace("_"," ").toUpperCase(),n.appendChild(o);const a=document.createElement("td"),c=this.createValueElement(s.type,i,this.itemData[i]);a.appendChild(c),n.appendChild(a),e.appendChild(n)}),e};J.prototype.createHtmlElement=function(t){const e=document.createElement("div");return e.classList.add("non-editable-div","flexbox","col","shrink"),Object.entries(t).forEach(([i,s])=>{const n=document.createElement("div");if(n.classList.add("panel",i),s.showLabel!==!1){const a=document.createElement("label");a.textContent=i.replace("_"," ").toUpperCase(),n.appendChild(a)}const o=this.createValueElement(s.type,i,this.itemData[i],s.label||"");n.appendChild(o),e.appendChild(n)}),e};J.prototype.buildTags=function(t){const e=/[-_\w']+/g;function i(o){return Object.keys(o).reduce((c,r)=>c+r.length,0)/Object.keys(o).length>=16}const s={},n=t.ss_tag_frequency||{};for(const o of Object.values(n))for(const[a,c]of Object.entries(o)){const r=a.trim();s[r]=(s[r]||0)+parseInt(c,10)}if(Object.keys(s).length>0&&i(s)){const o={};for(const[a,c]of Object.entries(s)){const r=a.match(e)||[];for(const u of r)u.length>=3&&(o[u]=(o[u]||0)+c)}return Object.entries(o).sort(([,a],[,c])=>c-a).map(([a,c])=>[a,c])}return Object.entries(s).sort(([,o],[,a])=>a-o).map(([o,a])=>[o,a])};J.prototype.createTagsElement=function(t,e){const i=this.buildTags(t);if(i.length>0){const s=document.createElement("div");s.classList.add("non-editable-tags","flexbox","shrink");const n=document.createElement("div");if(n.classList.add("panel","flexbox","row","padding"),e){const o=document.createElement("label");o.textContent=e.toUpperCase(),n.appendChild(o)}return Object.entries(i).forEach(o=>{const a=document.createElement("button");a.type="button",a.textContent=o[1][0];const c=document.createElement("span");c.classList.add("tag-num"),c.textContent=o[1][1],a.appendChild(c),n.appendChild(a)}),s.appendChild(n),s}return!1};J.prototype.handleSubmit=async function(t){t.preventDefault();const e=new FormData(this.form),i={};for(const[n,o]of e.entries())i[n]=o;const s=i;s.table_name=this.table_name,s.name=this.itemData.name;try{const n=await fetch(this.url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!n.ok)throw new Error(`HTTP error! Status: ${n.status}`);const o=await n.json();this.afterFormSubmit(i,o)}catch(n){console.error("Failed to fetch data:",n)}};J.prototype.afterFormSubmit=function(t,e){};async function zi(){Kt("checkpoints","checkpoint","stable-diffusion/")}async function Pi(){Kt("textual_inversion","textualinversion","embeddings/")}async function Mi(){Kt("lora","lora","lora/")}async function Ni(){Kt("hypernetworks","hypernetwork","hypernetworks/")}function Ui(t){navigator.clipboard.writeText(t),console.log(t)}async function Me(t,e){try{const i=await fetch(t);if(!i.ok)throw new Error(`HTTP error! Status: ${i.status}`);const s=await i.json();e(s)}catch(i){console.error("Failed to fetch metadata:",i)}}async function Se(t,e,i){try{const s=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok)throw new Error(`HTTP error! Status: ${s.status}`);const n=await s.json();i(n)}catch(s){console.error("Failed to fetch data:",s)}}function Fi(t,e){const i=t.parentElement.querySelector(".ae-virtual-detail-content");i.innerHTML="",i.appendChild(e)}async function Di(t,e,i,s){const n=`/sd_webui_ux/get_internal_metadata?type=${encodeURIComponent(t)}&name=${encodeURIComponent(e)}`;Me(n,function(o){console.log(o),i.showDetail();const a=window.extraNetworksFlattenMetadata(o),c=window.createVisualizationTable(a,0);Fi(s,c)})}const ft={};async function Kt(t,e,i){const s=document.querySelector(`#${t}_cardholder`),n=document.querySelector(`#${t}_search`);document.querySelector(`#${t}_sort`);const o=document.querySelector(`#${t}_order`);document.querySelector(`#${t}_sd_version`);const a=document.querySelector(`#${t}_refresh`),c=document.querySelector(`#${t}_rebuild`),r=document.querySelector(`#${t}_clear`),u=document.querySelector("#refresh_database");ft[`txt2img_${e}`]=[],ft[`img2img_${e}`]=[];const m=100,S="/sd_webui_ux/get_items_from_db",y="GET",k={table_name:e,skip:0,limit:m,sort_by:"name",order:"asc",search_term:""},O={title:"name",url:"preview",dataPath:"items"},U={[`#${t}_search`]:"search_term",[`#${t}_sort`]:"sort_by",[`#${t}_search_in`]:"search_columns",[`#${t}_sd_version`]:"sd_version"},E=p=>(p.skip=0,p),g=new I(s,[],18,O,S,k,y),f=Wt(U,k,g,E);g.setNextCursor=function(p){p&&this.data.length>0?this.params.skip=this.params.cursor=p:delete this.params.cursor},g.createItemElement=function(p,l){var z;const v=document.createElement("div");v.className="item card",(z=this.selected)!=null&&z.has(p.name)?v.classList.add("active"):v.classList.remove("active");const A=p.thumbnail;A&&(v.style.backgroundImage=`url('./file=${A}')`);const L=document.createElement("span");L.textContent=p.name,L.className="title";const T=document.createElement("button");T.className="edit-meta edit-button card-button";const $=document.createElement("button");$.className="copy-path copy-path-button card-button";const q=document.createElement("div");if(q.className="item-actions",q.appendChild($),p.metadata_exists){const N=document.createElement("button");N.className="show-meta metadata-button card-button",q.appendChild(N)}return q.appendChild(T),v.appendChild(q),v.appendChild(L),v};function b(p,l,v){var $;const A=window.UIUX.FOCUS_PROMPT;let L=(($=l.prompt)==null?void 0:$.replace("opts.extra_networks_default_multiplier",l.preferred_weight>0?l.preferred_weight:opts.extra_networks_default_multiplier))||"";L+=l.activation_text||"";const T=l.negative_prompt||"";p.classList.contains("copy-path")?Ui(l.filename):p.classList.contains("show-meta")?Di(l.type,l.name,g,s):p.classList.contains("edit-meta")?D(l,l.id):l.type==="Checkpoint"?window.selectCheckpoint(l.name):l.type==="TextualInversion"?(window.cardClicked(A,L,T,!0),ft[`${A}_textualinversion`].push({id:l.id,name:l.name,value:L})):l.type==="LORA"?(window.cardClicked(A,L,T,!1),ft[`${A}_lora`].push({id:l.id,name:l.name,value:`<lora:${L.split(":")[1]}`})):l.type==="Hypernetwork"&&(window.cardClicked(A,L,T,!1),ft[`${A}_hypernetwork`].push({id:l.id,name:l.name,value:L}))}g.clickHandler=function(p){const{target:l,currentTarget:v}=p,A=l.closest(".item.card").dataset.id,L=this.data.find(T=>T.id.toString()===A);L&&b(l,L),p.stopPropagation()},c.addEventListener("click",p=>{Se("/sd_webui_ux/generate-thumbnails",{table_name:e},function(l){console.log(l),setTimeout(()=>{f.skip=0,g.updateParamsAndFetch(f,0)},1e3)})}),o.addEventListener("click",p=>{const l=o.classList.contains("active");f.skip=0,f.order=l?"desc":"asc",g.updateParamsAndFetch(f,0)}),r.addEventListener("click",p=>{n.value="",_t(n)}),g.updateParamsAndFetch(f,0);const x=new Z(`#${t}_tree_view`,"/sd_webui_ux/get_items_by_path",e,i);x.initialize(),x.createFileItem=function(p,l){var $;const v=document.createElement("li");v.dataset.name=p[l].name,v.dataset.id=p[l].id,($=this.selected)!=null&&$.has(p[l].name)&&v.classList.add("active"),v.innerHTML=`<summary class="tree-file">${p[l].name}</summary>`,v.classList.add("li-file");const A=document.createElement("button");A.className="edit-meta edit-button card-button";const L=document.createElement("button");L.className="copy-path copy-path-button card-button";const T=document.createElement("div");if(T.className="item-actions",T.appendChild(L),p[l].metadata_exists){const q=document.createElement("button");q.className="show-meta metadata-button card-button",T.appendChild(q)}return T.appendChild(A),v.appendChild(T),v},x.onFolderClicked=function(p,l,v){},x.onFileClicked=function(p,l){b(p,l,l.id)},a.addEventListener("click",p=>{u.click(),setTimeout(()=>{f.skip=0,g.updateParamsAndFetch(f,0),x.initialize()},1e3)});function P(p){const l=window.UIUX.FOCUS_PROMPT,v=ft[`${l}_${e}`];setTimeout(()=>{let A="";document.querySelectorAll(`#${l}_prompt textarea, #${l}_neg_prompt textarea`).forEach($=>{A+=$.value});const L=v.filter($=>$&&$.value&&A.includes($.value));ft[`${l}_${e}`]=L;const T=new Set(L.map($=>$.name));g.selected=x.selected=T,g.renderItems(),x.updateSelectedItems()},100)}function F(p){const l=window.UIUX.FOCUS_PROMPT;let v="";if(document.querySelectorAll(`#${l}_prompt textarea, #${l}_neg_prompt textarea`).forEach(T=>{v+=` ${T.value}`}),v.length>2){let T=function(z){return z.replace(/[()]+|:[0-9]+(.[0-9]+)?/g,"").trim()};var A=T;let q=v.trim().split(/[\s,.]+/).map(T).filter(Boolean);if(e==="lora"||e==="hypernetwork"){let N=function(H){if(H.includes(`${z}:`)){const K=H.split(`${z}:`)[1].split(":")[0];return`<${z}:${K}:opts.extra_networks_default_multiplier>`}return""};var L=N;const z=e==="lora"?"lora":"hypernet";q=v.trim().split("<").map(N).filter(Boolean)}q.length>0&&Se("/sd_webui_ux/search_words_in_tables_columns",{tables:e,columns:"prompt",words:q},function(R){const K=R[e].map(B=>{let mt=B.prompt;return(e==="lora"||e==="hypernetwork")&&(mt=`<${e==="lora"?"lora":"hypernet"}:${B.prompt.split(":")[1]}`),{id:B.id,name:B.name,value:mt}});ft[`${l}_${e}`]=K,g.selected=x.selected=new Set(K.map(B=>B.name)),g.renderItems(),x.updateSelectedItems()})}else g.selected=x.selected=new Set,g.renderItems(),x.updateSelectedItems()}e!=="checkpoint"?document.querySelectorAll("#txt2img_prompt textarea, #img2img_prompt textarea, #txt2img_neg_prompt textarea, #img2img_neg_prompt textarea").forEach(p=>{p.addEventListener("input",P),p.addEventListener("focus",F)}):Li(g,x);function D(p,l){const v={local_preview:{type:"input"},sd_version:{type:"select",options:["SD1","SD2","SD3","SDXL","PONY","FLUX","Unknown"]},preferred_weight:{type:"slider"},activation_text:{type:"textarea",rows:2},negative_prompt:{type:"textarea"},description:{type:"textarea",rows:4},notes:{type:"textarea",rows:2},tags:{type:"textarea"}},A={filename:{type:"filename"},filesize:{type:"filesize"},type:{type:"text"},hash:{type:"text"},date_created:{type:"date-format"},date_modified:{type:"date-format"}},L={thumbnail:{type:"img",showLabel:!1},replace_preview:{type:"button",label:"Replace Preview",showLabel:!1}},T=`/sd_webui_ux/get_internal_metadata?type=${encodeURIComponent(p.type)}&name=${encodeURIComponent(p.name)}`;Me(T,function($){var _;const q=$,z="/sd_webui_ux/update_user_metadata",N=document.getElementById("formContainer"),R=new J(z,e,p,N),H=R.createForm(v),K=R.createTable(A),B=R.createHtmlElement(L),mt=R.createTagsElement(q,"Train Tags");if(mt){(_=H.children[2])==null||_.insertAdjacentElement("afterend",mt);let d=H.querySelector("#activation_text");H.addEventListener("click",h=>{const w=h.target.closest("textarea");w&&(d=w);const M=h.target.closest("button[type=button]");if(M){const j=M.childNodes[0].textContent.trim(),V=d.value;V.includes(j)?d.value=V.split(",").map(it=>it.trim()).filter(it=>it!==j).join(", "):d.value+=(V?", ":"")+j}})}const G=document.createElement("div");G.classList.add("non-editable-info","flexbox","padding","shrink"),G.appendChild(B),G.appendChild(K),g.showDetail();const W=s.parentElement.querySelector(".ae-virtual-detail-content");W.innerHTML="",W.appendChild(G),W.appendChild(H);function ct(d){const h=d.lastIndexOf(".");return h===-1?d:d.substring(0,h)}function lt(d){const h=d.lastIndexOf("/"),w=d.substring(0,h),M=d.substring(h+1),j=M.lastIndexOf("."),V=M.substring(0,j);return{path:w,filename:M,filename_no_ext:V}}R.afterFormSubmit=function(d){g.hideDetail(),console.log(d);const h=lt(p.filename),w=new Date().getTime();d.thumbnail=`${h.path}/thumbnails/${h.filename_no_ext}.thumb.webp?t=${w}`,g.updateDataById(d,l),x.updateDataById(d,l)},B.querySelector("button.replace_preview").addEventListener("click",d=>{const h=window.UIUX.FOCUS_PROMPT,w=document.querySelector(`#${h}_gallery [data-testid="detailed-image"]`);if(w){const M=H.querySelector("#local_preview");M.value=w.src.split("file=")[1].split("?")[0]}})})}}async function Ri(){Bi("styles","styles","styles_data/")}function Hi(t){navigator.clipboard.writeText(t),console.log(t)}async function Ee(t,e,i){try{const s=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok)throw new Error(`HTTP error! Status: ${s.status}`);const n=await s.json();i(n)}catch(s){console.error("Failed to fetch data:",s)}}const yt={};async function Bi(t,e,i){const s=document.querySelector(`#${t}_cardholder`),n=document.querySelector(`#${t}_search`);document.querySelector(`#${t}_sort`);const o=document.querySelector(`#${t}_order`);document.querySelector(`#${t}_sd_version`);const a=document.querySelector(`#${t}_refresh`),c=document.querySelector(`#${t}_rebuild`),r=document.querySelector(`#${t}_clear`),u=document.querySelector("#refresh_styles_database");yt[`txt2img_${e}`]=[],yt[`img2img_${e}`]=[];const m=100,S="/sd_webui_ux/get_items_from_db",y="GET",k={table_name:e,skip:0,limit:m,sort_by:"name",order:"asc",search_term:""},O={title:"name",url:"preview",dataPath:"items"},U={[`#${t}_search`]:"search_term",[`#${t}_sort`]:"sort_by",[`#${t}_search_in`]:"search_columns",[`#${t}_sd_version`]:"sd_version"},E=p=>(p.skip=0,p),g=new I(s,[],18,O,S,k,y),f=Wt(U,k,g,E);g.setNextCursor=function(p){p&&this.data.length>0?this.params.skip=this.params.cursor=p:delete this.params.cursor},g.createItemElement=function(p,l){var z;const v=document.createElement("div");v.className="item card",(z=this.selected)!=null&&z.has(p.name)?v.classList.add("active"):v.classList.remove("active");const A=p.thumbnail;A&&(v.style.backgroundImage=`url('./file=${A}')`);const L=document.createElement("span");L.textContent=p.name,L.className="title";const T=document.createElement("button");T.className="edit-meta edit-button card-button";const $=document.createElement("button");$.className="copy-path copy-path-button card-button";const q=document.createElement("div");return q.className="item-actions",q.appendChild($),q.appendChild(T),v.appendChild(q),v.appendChild(L),v};function b(p,l,v){const A=window.UIUX.FOCUS_PROMPT,L=l.prompt||"",T=l.negative||"";p.classList.contains("copy-path")?Hi(l.filename):p.classList.contains("edit-meta")?D(l,l.id):l.type==="Style"&&(window.cardClicked(A,L,T,!0),yt[`${A}_styles`].push({id:l.id,name:l.name,value:L}))}g.clickHandler=function(p){const{target:l,currentTarget:v}=p,A=l.closest(".item.card").dataset.id,L=this.data.find(T=>T.id.toString()===A);L&&b(l,L),p.stopPropagation()},c.addEventListener("click",p=>{Ee("/sd_webui_ux/generate-thumbnails",{table_name:e},function(l){console.log(l),setTimeout(()=>{f.skip=0,g.updateParamsAndFetch(f,0)},1e3)})}),o.addEventListener("click",p=>{const l=o.classList.contains("active");f.skip=0,f.order=l?"desc":"asc",g.updateParamsAndFetch(f,0)}),r.addEventListener("click",p=>{n.value="",_t(n)}),g.updateParamsAndFetch(f,0);const x=new Z(`#${t}_tree_view`,"/sd_webui_ux/get_items_by_path",e,i);x.initialize(),x.createFileItem=function(p,l){var $;const v=document.createElement("li");v.dataset.name=p[l].name,v.dataset.id=p[l].id,($=this.selected)!=null&&$.has(p[l].name)&&v.classList.add("active"),v.innerHTML=`<summary class="tree-file">${p[l].name}</summary>`,v.classList.add("li-file");const A=document.createElement("button");A.className="edit-meta edit-button card-button";const L=document.createElement("button");L.className="copy-path copy-path-button card-button";const T=document.createElement("div");return T.className="item-actions",T.appendChild(L),T.appendChild(A),v.appendChild(T),v},x.onFolderClicked=function(p,l,v){},x.onFileClicked=function(p,l){b(p,l,l.id)},a.addEventListener("click",p=>{u.click(),setTimeout(()=>{f.skip=0,g.updateParamsAndFetch(f,0),x.initialize()},1e3)});function P(p){const l=window.UIUX.FOCUS_PROMPT,v=yt[`${l}_${e}`];setTimeout(()=>{let A="";document.querySelectorAll(`#${l}_prompt textarea, #${l}_neg_prompt textarea`).forEach($=>{A+=$.value});const L=v.filter($=>$&&$.value&&A.includes($.value));yt[`${l}_${e}`]=L;const T=new Set(L.map($=>$.name));g.selected=x.selected=T,g.renderItems(),x.updateSelectedItems()},100)}function F(p){const l=window.UIUX.FOCUS_PROMPT;let v="";if(document.querySelectorAll(`#${l}_prompt textarea`).forEach(L=>{v+=`${L.value}`}),v.length>2){let L=function(z){return z.replace(/[()]+|:[0-9]+(.[0-9]+)?/g,"").trim()};var A=L;const q=v.trim().split(". ").map(L).filter(Boolean).map(z=>". "+z);q.length>0&&Ee("/sd_webui_ux/search_words_in_tables_columns",{words:q,tables:e,columns:"prompt",threshold:1},function(R){const H=R[e];console.log(H);const K=H.map(B=>({id:B.id,name:B.name,value:B.prompt}));yt[`${l}_${e}`]=K,g.selected=x.selected=new Set(K.map(B=>B.name)),g.renderItems(),x.updateSelectedItems()})}else g.selected=x.selected=new Set,g.renderItems(),x.updateSelectedItems()}document.querySelectorAll("#txt2img_prompt textarea, #img2img_prompt textarea, #txt2img_neg_prompt textarea, #img2img_neg_prompt textarea").forEach(p=>{p.addEventListener("input",P),p.addEventListener("focus",F)});function D(p,l){const v={local_preview:{type:"input"},sd_version:{type:"select",options:["SD1","SD2","SD3","SDXL","PONY","FLUX","Unknown"]},prompt:{type:"textarea",rows:4},negative:{type:"textarea",rows:2},description:{type:"textarea",rows:2},notes:{type:"textarea",rows:2},tags:{type:"textarea"}},A={filename:{type:"filename"},filesize:{type:"filesize"},type:{type:"text"},hash:{type:"text"},date_created:{type:"date-format"},date_modified:{type:"date-format"}},L={thumbnail:{type:"img",showLabel:!1},replace_preview:{type:"button",label:"Replace Preview",showLabel:!1}},T="/sd_webui_ux/update_user_metadata",$=document.getElementById("formContainer"),q=new J(T,e,p,$),z=q.createForm(v),N=q.createTable(A),R=q.createHtmlElement(L),H=document.createElement("div");H.classList.add("non-editable-info","flexbox","padding","shrink"),H.appendChild(R),H.appendChild(N),g.showDetail();const K=s.parentElement.querySelector(".ae-virtual-detail-content");K.innerHTML="",K.appendChild(H),K.appendChild(z);function B(G){const W=G.lastIndexOf("/"),ct=G.substring(0,W),lt=G.substring(W+1),At=lt.lastIndexOf("."),_=lt.substring(0,At);return{path:ct,filename:lt,filename_no_ext:_}}q.afterFormSubmit=function(G){g.hideDetail(),console.log(G);const W=B(p.filename),ct=new Date().getTime();G.thumbnail=`${W.path}/thumbnails/${W.filename_no_ext}.thumb.webp?t=${ct}`,g.updateDataById(G,l),x.updateDataById(G,l)},R.querySelector("button.replace_preview").addEventListener("click",G=>{const W=window.UIUX.FOCUS_PROMPT,ct=document.querySelector(`#${W}_gallery [data-testid="detailed-image"]`);if(ct){const lt=z.querySelector("#local_preview");lt.value=ct.src.split("file=")[1].split("?")[0]}})}}function ji(t){const e=document.querySelector("#logger_screen");e&&(document.querySelector("#container-console-log").append(getLoggerUiUx()),e.remove()),console.log("Finishing optimizations for Extra Networks"),Ci(),Ei(),xi(),Si(),document.querySelectorAll("#txt2img_styles_edit_button, #img2img_styles_edit_button").forEach(a=>{a.addEventListener("click",function(c){window.popup_trigger.click()})});function i(a){fe.FOCUS_PROMPT=a.includes("txt2img")?"txt2img":"img2img"}if(document.querySelectorAll("#txt2img_prompt textarea, #img2img_prompt textarea, #txt2img_neg_prompt textarea, #img2img_neg_prompt textarea").forEach(a=>{a.addEventListener("focus",c=>{const r=c.target.closest(".gradio-textbox").id;i(r)})}),document.querySelectorAll("#about_tabitem img").forEach(a=>{const c=a.getAttribute("data-src");c&&(a.src=c.replace("file=extensions/sd-webui-ux/assets/",`${Xt}`))}),window.UIUX=fe,Ht.setItem("UiUxComplete","true"),window.opts.uiux_enable_theme_editor&&Ii(),window.opts.uiux_enable_civitai_explorer){document.querySelector("#civitai_explorer_nav").classList.remove("hidden");const c=document.querySelector("#civitai_nav_images"),r=document.querySelector("#civitai_nav_models");c.addEventListener("click",()=>{qi()},{once:!0}),r.addEventListener("click",()=>{Oi()},{once:!0})}const s=document.querySelector("#textual_inversion_nav"),n=document.querySelector("#lora_nav"),o=document.querySelector("#hypernetwork_nav");if(setTimeout(()=>{zi()},500),s.addEventListener("click",()=>{Pi()},{once:!0}),n.addEventListener("click",()=>{Mi()},{once:!0}),o.addEventListener("click",()=>{Ni()},{once:!0}),window.opts.uiux_enable_sd_styles){const a=document.querySelector("#sd_styles_nav");sd_styles_nav.classList.remove("hidden"),a.addEventListener("click",()=>{Ri()},{once:!0})}}async function Xi(){const t=vt(),e=gt();await Fe(),e.insertAdjacentElement("afterbegin",t);const i=ui((s,n)=>{s==="UiUxReady"&&n==="true"&&(ji(),i())},"UiUxReady");(async()=>await Oe(t))(),ii(),setTimeout(()=>{De("#infinite_image_browsing_container_wrapper iframe",["user.css","uiux-iibrowser.css"])},3e3)}async function Wi(){try{Ke(),console.log("Starting DOM Optimizations"),yi(),_i(),console.log("Finishing DOM Optimizations"),Re(Ge),ut.gradio_major>3&&He("style.css","style-gradio-4.css",document.body),(async()=>(await ti(),await Xi()))()}catch(t){console.error("Error in run sequence:",t)}}function Vi(){if(localStorage.setItem("UiUxReady","false"),localStorage.setItem("UiUxComplete","false"),!document.getElementById("logger_screen")){const i=document.createElement("div");i.id="logger_screen",i.style="position: fixed; inset: 0; background-color: black; z-index: 99999; display: flex; flex-direction: column; overflow:auto;";const s=document.createElement("div");s.id="loggerUiUx",i.append(s),document.body.append(i)}const t=new MutationObserver(async()=>{if(ke()&&window.opts&&Object.keys(window.opts).length){t.disconnect();try{await Wi()}catch(s){console.error("Error running the function:",s)}}}),e=gt();e?t.observe(e,{childList:!0,subtree:!0}):console.error("getGradioApp() did not return a valid target for observation")}Vi();
