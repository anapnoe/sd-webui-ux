async function Dt(e,t,i){const s=document.querySelector(i),n=`
        <button tabItemId="#split-app, #${e}_tabitem" 
                tabGroup="main_group" 
                data-click="#tabs" 
                onclick="mainTabs(this, '#${e}')" 
                class="xtabs-tab">
            <div class="icon-letters">${t.slice(0,2)}</div>
            <span>${t}</span>
        </button>`,o=document.createElement("div");o.innerHTML=n;const a=o.firstElementChild;s.append(a)}async function Rt(e){const t=document.querySelector("#split-left"),i=`
        <div id="${e}_tabitem" class="xtabs-item other">
            <div data-parent-selector="gradio-app" data-selector="#${e} > div" class="portal"></div>
        </div>`,s=document.createElement("div");s.innerHTML=i;const n=s.firstElementChild;t.append(n)}async function Ht(){let e=["tab_txt2img","tab_img2img","tab_extras","tab_pnginfo","tab_train","tab_modelmerger","tab_settings","tab_extensions","tab_deforum_interface","tab_infinite-image-browsing","tab_anapnoe_dock","tab_anapnoe_sd_uiux_core","tab_space","tab_stylez","tab_anapnoe_sd_uiux_civitai","tab_anapnoe_sd_uiux_db_extra_networks","tab_anapnoe_sd_uiux_db_styles"];const t=document.querySelectorAll("#tabs > .tabitem");for(const i of t){const s=i.id,n=s.split("tab_")[1];!e.includes(s)&&!s.startsWith("tab_ui_theme")&&await Promise.all([Dt(s,n,"#other_extensions"),Rt(s)])}}function Bt(e,t){const i=document.querySelector(e);if(i){const s=n=>{t.forEach(o=>{const a=document.querySelector(`link[rel="stylesheet"][href*="${o}"]`);if(a){const c=a.cloneNode();n.appendChild(c)}})};i.contentDocument.readyState==="complete"?s(i.contentDocument.head):i.addEventListener("load",n=>{s(n.target.contentDocument.head)},{once:!0})}}function lt(e,t,i){for(const s of e)if(!t.querySelector(`link[rel="stylesheet"][href*="${gt}${s}"]`)){const o=document.createElement("link");o.rel="stylesheet",o.href=`${gt}${s}`,o.onload=()=>{console.log(`Stylesheet ${s} loaded successfully.`)},o.onerror=()=>{console.error(`Error loading stylesheet ${s}.`)},i?t.insertBefore(o,i.nextSibling):t.appendChild(o)}}function jt(e){const t=document.body,i=t.querySelector('link[rel="stylesheet"][href*="sd-webui-ux"]');i?lt(e,t,i):(lt(e,t),console.warn("The sd-webui-ux/style.css is not found in the body."))}function Xt(e,t,i){const n=Array.from(i.querySelectorAll(`link[rel="stylesheet"][href*="${e}"]`)).find(o=>o.href.includes("sd-webui-ux")&&o.href.includes(e));n?(lt([t],i,n),n.parentNode.removeChild(n),console.log(`Removed existing stylesheet: ${e}`)):console.warn(`No existing stylesheet found: ${e}`)}const ut=window.basePath.includes("builtin"),pt="anapnoe/stable-diffusion-webui-ux",Vt="AUTOMATIC1111/stable-diffusion-webui",Wt="#anapnoe_app",Gt="0.1.0",Lt=window.basePath,Ge=`${Lt}assets/`,gt=`${Ge}css/`,Tt=`${Ge}templates/`,Yt=`${Tt}uiux-gradio-3/`,Kt=`${Tt}forge-gradio-4/`,kt={"template-deforum-params.html":"deforum","template-deforum-results.html":"deforum","template-stylez.html":"Stylez"},Jt=["uiux-icons.css","uiux-theme-editor.css","uiux-deforum.css","uiux-iibrowser.css","uiux-physton.css","uiux-virtual.css","uiux-tree.css","spotlight.css"];let et=null;const Ce=()=>(et||(et=document.querySelector(Wt)),et);let tt=null;const It=()=>(tt||(tt=document.getElementById("tab_anapnoe_sd_uiux_core")),tt);let it=null;const ye=()=>(it||(it=document.querySelector("gradio-app")),it);let st=null;const $t=()=>(st||(st=document.getElementById("loggerUiUx")),st),pe={};let ze=null;const Zt=()=>{if(!ze){const e=ye().querySelector(".versions");if(!e){console.error("Versions element not found");return}ze=e.innerHTML.replace(Vt,pt).replace(/\n/g,"").split("• "),ze.forEach(n=>{const[o,a]=n.split(":").map(c=>c.trim());o&&a&&(pe[o]=a)});const i=pe.version.split(".")[0].includes("f")?"forge":"AUTOMATIC1111",s=parseInt(pe.gradio,10);pe.variant=i,pe.gradio_major=s}return ze};let Me=null;const At=()=>(Me||(Me=Yt,pe.gradio_major>3&&pe.variant==="forge"&&(Me=Kt)),Me),Qt=[{value:"SD1",textContent:"SD1"},{value:"SD2",textContent:"SD2"},{value:"SD3",textContent:"SD3"},{value:"SDXL",textContent:"SDXL"},{value:"PONY",textContent:"PONY"},{value:"FLUX",textContent:"FLUX"},{value:"Unknown",textContent:"Unknown"}];let Ie;async function ei(){(function(i){console.oldLog=console.log,console.oldWarn=console.warn,Ie=function(s,n){return function(...o){const c=o.slice(0,10);let r="",d,h;for(r+=`
                <div class="log-row"><span class="log-date">${new Date().toLocaleString().replace(",","")}</span>`,h=0;h<c.length;h++){d=c[h];const b=d.toString().toLowerCase();let y="";b.indexOf("remove")!==-1||b.indexOf("error")!==-1?y+=" log-remove":b.indexOf("loading")!==-1||b.indexOf("| ref")!==-1||b.indexOf("initial")!==-1||b.indexOf("optimiz")!==-1||b.indexOf("python")!==-1||b.indexOf("success")!==-1?y+=" log-load":b.indexOf("[")!==-1&&(y+=" log-object"),d.toString().indexOf(".css")!==-1||d.toString().indexOf(".html")!==-1?y+=" log-url":d.toString().indexOf(`
`)!==-1&&(r+="<br />"),r+=`
                    <span class="log-${typeof d} ${y}">`,typeof d=="object"&&typeof JSON=="object"&&typeof JSON.stringify=="function"?r+=JSON.stringify(d):r+=d,r+=" </span>"}i.innerHTML+=r+"</div>",n.apply(void 0,c)}},console.log=Ie("log",console.oldLog),console.warn=Ie("warn",console.oldWarn)})($t()),console.log(`
`,"╔═╗╔═╦╦═╗╔═╦═╦╦═╦═╗",`
`,"║╬╚╣║║║╬╚╣╬║║║║╬║╩╣",`
`,"╚══╩╩═╩══╣╔╩╩═╩═╩═╝",`
`,"─────────╚╝"),console.log(`Initialize Anapnoe UI/UX runtime engine version ${Gt}`),console.log("UI/UX Backend Optimizations:",ut),console.log(navigator.userAgent),console.log(Zt()),console.log("Console log enabled: ",window.opts.uiux_enable_console_log),console.log("Dev Mode enabled: ",window.opts.uiux_enable_dev_mode),console.log("Theme editor enabled: ",window.opts.uiux_enable_theme_editor),console.log("Maximum resolution output: ",window.opts.uiux_max_resolution_output),console.log("Ignore overrides: ",window.opts.uiux_ignore_overrides),console.log("Show ticks for input range slider: ",window.opts.uiux_show_input_range_ticks),console.log("Default layout: ",window.opts.uiux_default_layout),console.log("Disable transitions: ",window.opts.uiux_disable_transitions),console.log("Aside labels: ",window.opts.uiux_show_labels_aside),console.log("Main labels: ",window.opts.uiux_show_labels_main),console.log("Tabs labels: ",window.opts.uiux_show_labels_tabs),console.log("Hide extra info for labels, checkboxes: ",window.opts.uiux_hide_extra_info),navigator.userAgent.toLowerCase().includes("firefox")&&console.log("Go to the Firefox about:config page, then search and toggle layout. css.has-selector. enabled"),window.opts.uiux_enable_console_log||(console.log=function(){});let t=document.querySelector("link[rel~='icon']");t||(t=document.createElement("link"),t.rel="icon",document.head.appendChild(t)),t.href=`${Ge}favicon.svg/`}function ti(e){e?(console.log=Ie("log",console.oldLog),console.warn=Ie("warn",console.oldWarn)):console.log=function(){}}async function ii(e){const t=[];return e.querySelectorAll(".template:not([status])").forEach(i=>{const s={},n=i.getAttribute("url");s.url=n||At();const o=i.getAttribute("key");s.key=o||void 0;const a=i.getAttribute("template")||i.id;if(a)!ut&&a.includes("about")?s.template=`${a}-extension.html`:s.template=`${a}.html`;else{console.warn("Template not found on element:",i);return}s.id=i.id,s.extensionEnabled=si(s.template),t.push(s)}),t}function si(e){const t=kt[e];return t?!!document.head.querySelector(`script[type="text/javascript"][src*="${t}"]`):!1}async function Ee(e,t){const i=e[t],s=t<e.length;if(!i)return;let n;if(i.template in kt&&!i.extensionEnabled){console.log(`Skipping loading for extension template ${i.template} (extension disabled)`),await Ee(e,t+1);return}if(s){if(i!=null&&i.parent?n=i.parent:i!=null&&i.id&&(n=document.querySelector(`#${i.id}`)),n){const a=`${i.url}${i.template}`;try{const c=await fetch(a);if(c.ok){const r=await c.text(),d=document.createElement("div");if(i.key){const b=r.replace(/\s*\{\{.*?\}\}\s*/g,i.key);d.innerHTML=b}else d.innerHTML=r;const h=await ii(d);h.length>0&&(e=e.concat(h)),console.log("Template loaded",a),n.setAttribute("status","true"),n.append(d.firstElementChild),await Ee(e,t+1)}else c.status===404&&(console.error("404 template:",a),n.setAttribute("status","error"),await Ee(e,t+1))}catch(c){console.error("Error loading template:",c),n.setAttribute("status","error"),await Ee(e,t+1)}}}else console.log("Template files merged successfully")}async function ni(){console.log("Loading Templates",pe.gradio);const e=[{url:At(),template:"template-app-root.html",parent:It()}];await Ee(e,0)}function xe(e){if(e){const t=new Event("input",{bubbles:!0,cancelable:!0});e.dispatchEvent(t)}}function oi(e){if(e){const t=new Event("change",{bubbles:!0,cancelable:!0});e.dispatchEvent(t)}}function ai(){const e=Ce();e.addEventListener("animationend",t=>{t.animationName==="fade-out"&&t.target.classList.add("hidden")}),e.addEventListener("animationstart",t=>{const i=e.classList.contains("notransition");t.animationName==="fade-out"?i&&t.target.classList.add("hidden"):t.animationName==="fade-in"&&t.target.classList.remove("hidden")})}const Re=new WeakMap;function qt(e){if(!(e instanceof Element))return 0;let t=0;const i=Re.get(e);if(i)for(const s in i)t+=i[s].size;for(const s of e.children)t+=qt(s);return t}(function(){const e=EventTarget.prototype.addEventListener,t=EventTarget.prototype.removeEventListener;EventTarget.prototype.addEventListener=function(i,s,n){typeof n>"u"&&(n=!1);const o=Re.get(this)||{};o[i]||(o[i]=new Set),o[i].add(s),Re.set(this,o),e.call(this,i,s,n)},EventTarget.prototype.removeEventListener=function(i,s,n){const o=Re.get(this);o&&o[i]&&(o[i].delete(s),o[i].size===0&&delete o[i]),t.call(this,i,s,n)},window.countEventListeners=qt})();const ie=typeof window<"u"?window:null,ht=ie===null,qe=ht?void 0:ie.document,oe="addEventListener",ae="removeEventListener",nt="getBoundingClientRect",Le="_a",re="_b",ue="_c",Ne="horizontal",ce=()=>!1,ri=ht?"calc":`${["","-webkit-","-moz-","-o-"].filter(e=>{const t=qe.createElement("div");return t.style.cssText=`width:${e}calc(9px)`,!!t.style.length}).shift()}calc`,Pt=e=>typeof e=="string"||e instanceof String,_t=e=>{if(Pt(e)){const t=qe.querySelector(e);if(!t)throw new Error(`Selector ${e} did not match a DOM element`);return t}return e},J=(e,t,i)=>{const s=e[t];return s!==void 0?s:i},Ue=(e,t,i,s)=>{if(t){if(s==="end")return 0;if(s==="center")return e/2}else if(i){if(s==="start")return 0;if(s==="center")return e/2}return e},ci=(e,t)=>{const i=qe.createElement("div");return i.className=`gutter gutter-${t}`,i},li=(e,t,i)=>{const s={};return Pt(t)?s[e]=t:s[e]=`${ri}(${t}% - ${i}px)`,s},di=(e,t)=>({[e]:`${t}px`}),ui=(e,t={})=>{if(ht)return{};let i=e,s,n,o,a,c,r;Array.from&&(i=Array.from(i));const h=_t(i[0]).parentNode,b=getComputedStyle?getComputedStyle(h):null,y=b?b.flexDirection:null;let k=J(t,"sizes")||i.map(()=>100/i.length);const z=J(t,"minSize",100),D=Array.isArray(z)?z:i.map(()=>z),E=J(t,"maxSize",1/0),_=Array.isArray(E)?E:i.map(()=>E),m=J(t,"expandToMin",!1),w=J(t,"gutterSize",10),S=J(t,"gutterAlign","center"),M=J(t,"snapOffset",30),H=Array.isArray(M)?M:i.map(()=>M),j=J(t,"dragInterval",1),u=J(t,"direction",Ne),l=J(t,"cursor",u===Ne?"col-resize":"row-resize"),x=J(t,"gutter",ci),$=J(t,"elementStyle",li),T=J(t,"gutterStyle",di);u===Ne?(s="width",n="clientX",o="left",a="right",c="clientWidth"):u==="vertical"&&(s="height",n="clientY",o="top",a="bottom",c="clientHeight");function L(v,p,f,g){const q=$(s,p,f,g);Object.keys(q).forEach(F=>{v.style[F]=q[F]})}function A(v,p,f){const g=T(s,p,f);Object.keys(g).forEach(q=>{v.style[q]=g[q]})}function U(){return r.map(v=>v.size)}function O(v){return"touches"in v?v.touches[0][n]:v[n]}function N(v){const p=r[this.a],f=r[this.b],g=p.size+f.size;p.size=v/this.size*g,f.size=g-v/this.size*g,L(p.element,p.size,this[re],p.i),L(f.element,f.size,this[ue],f.i)}function X(v){let p;const f=r[this.a],g=r[this.b];this.dragging&&(p=O(v)-this.start+(this[re]-this.dragOffset),j>1&&(p=Math.round(p/j)*j),p<=f.minSize+f.snapOffset+this[re]?p=f.minSize+this[re]:p>=this.size-(g.minSize+g.snapOffset+this[ue])&&(p=this.size-(g.minSize+this[ue])),p>=f.maxSize-f.snapOffset+this[re]?p=f.maxSize+this[re]:p<=this.size-(g.maxSize-g.snapOffset+this[ue])&&(p=this.size-(g.maxSize+this[ue])),N.call(this,p),J(t,"onDrag",ce)(U()))}function Y(){const v=r[this.a].element,p=r[this.b].element,f=v[nt](),g=p[nt]();this.size=f[s]+g[s]+this[re]+this[ue],this.start=f[o],this.end=f[a]}function G(v){if(!getComputedStyle)return null;const p=getComputedStyle(v);if(!p)return null;let f=v[c];return f===0?null:(u===Ne?f-=parseFloat(p.paddingLeft)+parseFloat(p.paddingRight):f-=parseFloat(p.paddingTop)+parseFloat(p.paddingBottom),f)}function B(v){const p=G(h);if(p===null||D.reduce((F,R)=>F+R,0)>p)return v;let f=0;const g=[],q=v.map((F,R)=>{const Q=p*F/100,P=Ue(w,R===0,R===v.length-1,S),W=D[R]+P;return Q<W?(f+=W-Q,g.push(0),W):(g.push(Q-W),Q)});return f===0?v:q.map((F,R)=>{let Q=F;if(f>0&&g[R]-f>0){const P=Math.min(f,g[R]-f);f-=P,Q=F-P}return Q/p*100})}function de(){const v=this,p=r[v.a].element,f=r[v.b].element;v.dragging&&J(t,"onDragEnd",ce)(U()),v.dragging=!1,ie[ae]("mouseup",v.stop),ie[ae]("touchend",v.stop),ie[ae]("touchcancel",v.stop),ie[ae]("mousemove",v.move),ie[ae]("touchmove",v.move),v.stop=null,v.move=null,p[ae]("selectstart",ce),p[ae]("dragstart",ce),f[ae]("selectstart",ce),f[ae]("dragstart",ce),p.style.userSelect="",p.style.webkitUserSelect="",p.style.MozUserSelect="",p.style.pointerEvents="",f.style.userSelect="",f.style.webkitUserSelect="",f.style.MozUserSelect="",f.style.pointerEvents="",v.gutter.style.cursor="",v.parent.style.cursor="",qe.body.style.cursor=""}function ne(v){if("button"in v&&v.button!==0)return;const p=this,f=r[p.a].element,g=r[p.b].element;p.dragging||J(t,"onDragStart",ce)(U()),v.preventDefault(),p.dragging=!0,p.move=X.bind(p),p.stop=de.bind(p),ie[oe]("mouseup",p.stop),ie[oe]("touchend",p.stop),ie[oe]("touchcancel",p.stop),ie[oe]("mousemove",p.move),ie[oe]("touchmove",p.move),f[oe]("selectstart",ce),f[oe]("dragstart",ce),g[oe]("selectstart",ce),g[oe]("dragstart",ce),f.style.userSelect="none",f.style.webkitUserSelect="none",f.style.MozUserSelect="none",f.style.pointerEvents="none",g.style.userSelect="none",g.style.webkitUserSelect="none",g.style.MozUserSelect="none",g.style.pointerEvents="none",p.gutter.style.cursor=l,p.parent.style.cursor=l,qe.body.style.cursor=l,Y.call(p),p.dragOffset=O(v)-p.end}k=B(k);const K=[];r=i.map((v,p)=>{const f={element:_t(v),size:k[p],minSize:D[p],maxSize:_[p],snapOffset:H[p],i:p};let g;if(p>0&&(g={a:p-1,b:p,dragging:!1,direction:u,parent:h},g[re]=Ue(w,p-1===0,!1,S),g[ue]=Ue(w,!1,p===i.length-1,S),y==="row-reverse"||y==="column-reverse")){const q=g.a;g.a=g.b,g.b=q}if(p>0){const q=x(p,u,f.element);A(q,w,p),g[Le]=ne.bind(g),q[oe]("mousedown",g[Le]),q[oe]("touchstart",g[Le]),h.insertBefore(q,f.element),g.gutter=q}return L(f.element,f.size,Ue(w,p===0,p===i.length-1,S),p),p>0&&K.push(g),f});function ve(v){const p=v.i===K.length,f=p?K[v.i-1]:K[v.i];Y.call(f);const g=p?f.size-v.minSize-f[ue]:v.minSize+f[re];N.call(f,g)}r.forEach(v=>{const p=v.element[nt]()[s];p<v.minSize&&(m?ve(v):v.minSize=p)});function be(v){const p=B(v);p.forEach((f,g)=>{if(g>0){const q=K[g-1],F=r[q.a],R=r[q.b];F.size=p[g-1],R.size=f,L(F.element,F.size,q[re],F.i),L(R.element,R.size,q[ue],R.i)}})}function we(v,p){K.forEach(f=>{if(p!==!0?f.parent.removeChild(f.gutter):(f.gutter[ae]("mousedown",f[Le]),f.gutter[ae]("touchstart",f[Le])),v!==!0){const g=$(s,f.a.size,f[re]);Object.keys(g).forEach(q=>{r[f.a].element.style[q]="",r[f.b].element.style[q]=""})}})}return{setSizes:be,getSizes:U,collapse(v){ve(r[v])},destroy:we,parent:h,pairs:K}};class $e{constructor(){return $e.instance||(this.splitInstances={},$e.instance=this),$e.instance}set(t){Object.assign(this.splitInstances,t)}get(){return this.splitInstances}}const mt=new $e;Object.freeze(mt);function pi(e){mt.set(e)}function hi(){return mt.get()}async function mi(e){const t=[];await Promise.all(Array.from(e.querySelectorAll("div.split")).map(async i=>{const s=i.id,n=e.querySelector(`#${s}`),o=(n==null?void 0:n.getAttribute("direction"))==="vertical"?"vertical":"horizontal",a=(n==null?void 0:n.getAttribute("gutterSize"))||"8",c=e.querySelectorAll(`#${s} > div.split-container`),r=Array.from(c).map(y=>{const k=y.getAttribute("data-initSize")?parseInt(y.getAttribute("data-initSize")):100/c.length,z=y.getAttribute("data-minSize")?parseInt(y.getAttribute("data-minSize")):1/0;return{id:`#${y.id}`,initSize:k,minSize:z}}),d=r.map(y=>y.id),h=r.map(y=>y.initSize),b=r.map(y=>y.minSize);console.log("Split component",d,h,b,o,a),t[s]=ui(d,{sizes:h,minSize:b,direction:o,gutterSize:parseInt(a),snapOffset:0,dragInterval:1,elementStyle:(y,k,z)=>({"flex-basis":`calc(${k}% - ${z}px)`}),gutterStyle:(y,k)=>({"flex-basis":`${k}px`,"min-width":`${k}px`,"min-height":`${k}px`})})})),pi(t)}const je={setItem:function(e,t){localStorage.setItem(e,t),this.notifyChange(e,t)},getItem:function(e){return localStorage.getItem(e)},removeItem:function(e){localStorage.removeItem(e),this.notifyChange(e,null)},notifyChange:function(e,t){const i=new CustomEvent("localStorageChange",{detail:{key:e,value:t}});window.dispatchEvent(i)}};function fi(e,t){const i=je.getItem(t);e(t,i);const s=n=>{e(n.detail.key,n.detail.value)};return window.addEventListener("localStorageChange",s),()=>{window.removeEventListener("localStorageChange",s)}}let ot=0;function gi(e,t){const i=e.querySelectorAll("td:last-child"),s=document.createElement("style");let n=1,o="";i.forEach((a,c)=>{const r=parseFloat(a.textContent.trim());if(a.id=`td_${c}`,!isNaN(r)){let d;c===0?(n=r,d=100):d=r/n*100,o+=`#td_${c}::before { min-width: ${d}%; }`}}),s.textContent=o,t.appendChild(s)}function _i(e,t){e.querySelectorAll(`${t}, style`).forEach(s=>{e.removeChild(s)})}function yi(e,t){const i=e.getAttribute("append-index");Array.from(e.children).forEach(n=>{if(n!==t)if(t.className.includes("gradio-accordion"))if(i){const o=parseInt(i,10);let a=t.children[2].children[o];t.children[2].insertBefore(n,a)}else t.children[2].append(n);else t.append(n)})}async function ft(e,t,i=0,s,n,o=!1){var h;const a=e.getAttribute("data-selector"),c=e.getAttribute("data-parent-selector");let r;if(i%2===0?r=document.querySelector(`${c} ${a}`):r=t.querySelector(`${a}`),r&&e){e.classList.contains("dynamic")&&(_i(e,a),a.includes("popup-table")&&gi(r,e)),e.append(r),o&&ot++,console.log("register | Ref",s,c,a),e.getAttribute("droppable")&&yi(e,r);const y=e.getAttribute("show-button");y&&((h=document.querySelector(y))==null||h.classList.remove("hidden"))}else if(i<2){const b=e.getAttribute("data-timeout"),y=b?parseInt(b):500;await new Promise(k=>setTimeout(k,y)),console.log(i+1,"retry | ",y," | Ref",s,c,a),await ft(e,t,i+1,s,n,o)}else e.classList.contains("dynamic")?console.error("error | Ref",s,c,a):console.warn("dynamic | Ref",s,c,a),o&&ot++;ot===n&&o&&je.getItem("UiUxReady")==="false"&&(console.log("Runtime components initialized"),je.setItem("UiUxReady","true"))}async function vi(e){await Promise.all(Array.from(e.querySelectorAll(".portal:not(.dynamic)")).map(async(t,i,s)=>{ft(t,e,0,i,s.length,!0)}))}async function bi(e){const t=Ce();await Promise.all(Array.from(e.querySelectorAll(".xtabs-tab")).map(async s=>{if(s.addEventListener("click",()=>{const o=s.parentElement,a=s.getAttribute("tabGroup");s.getAttribute("data-click");const c=s.getAttribute("toggle"),r=s.classList.contains("active");function d(h){h.classList.remove("active");const b=h.getAttribute("tabItemId");t.querySelectorAll(b).forEach(y=>{y.classList.remove("fade-in"),y.classList.add("fade-out")})}if((!c||c&&r)&&(a?t.querySelectorAll(`[tabGroup="${a}"]`).forEach(h=>{h.classList.contains("active")&&d(h)}):o&&[].slice.call(o.children).forEach(b=>{b.classList.contains("active")&&d(b)})),!c||c&&!r){const h=s.getAttribute("tabItemId");t.querySelectorAll(h).forEach(b=>{b.classList.remove("fade-out"),b.classList.add("fade-in"),b.querySelectorAll(".portal.dynamic").forEach((y,k,z)=>{ft(y,document,0,k,z.length)})}),s.classList.add("active"),i(s)}}),!s.getAttribute("active")){const o=s.getAttribute("tabItemId");t.querySelectorAll(o).forEach(a=>{a.classList.remove("fade-in"),a.classList.add("fade-out")})}})),await Promise.all(Array.from(e.querySelectorAll(".xtabs-tab[active]")).map(async s=>{s.classList.add("active");const n=s.getAttribute("tabItemId");s.getAttribute("data-click"),t.querySelectorAll(n).forEach(o=>{o.classList.remove("fade-out"),o.classList.add("fade-in")}),i(s)}));function i(s,n,o){const a=s.closest(".accordion-bar");if(a){const c=a.parentElement;if(c.className.indexOf("expand")===-1){let r=a;const d=c.getAttribute("iconTrigger");if(d){const h=e.querySelector(d);h&&(r=h)}r.click()}}}}const yt={DEFAULT_PATH:Lt,FOCUS_PROMPT:"txt2img",loadCurrentTemplate:Ee,initUiUxComponents:Ot};async function wi(){document.head.querySelectorAll(`
        [rel="stylesheet"][href*="/assets/"],
        [rel="stylesheet"][href*="theme.css"],
        [rel="stylesheet"][href*="index"]`).forEach(s=>{s.remove(),console.log("Remove stylesheet",s.getAttribute("href"))}),document.body.querySelectorAll(`
        [rel="stylesheet"][href*="file=style.css"]`).forEach(s=>{s.remove(),console.log("Remove stylesheet",s.getAttribute("href"))});const e=document.querySelectorAll('.styler, [class*="svelte"]:not(input)'),t=e.length;let i=0;e.forEach(s=>{s.style.display!=="none"&&s.style.display!=="block"&&(s.removeAttribute("style"),i++),[...s.classList].filter(n=>n.match(/^svelte.*/)).forEach(n=>s.classList.remove(n))}),console.log("Remove inline styles from DOM","Total Selectors:",t,"Removed Selectors:",i)}async function xi(){var e,t,i,s,n,o,a,c;if(!ut){const r=ye();console.log("Remove Extra Networks Instances"),(e=r.querySelector("#img2img_textual_inversion_cards_html"))==null||e.remove(),(t=r.querySelector("#img2img_checkpoints_cards_html"))==null||t.remove(),(i=r.querySelector("#img2img_hypernetworks_cards_html"))==null||i.remove(),(s=r.querySelector("#img2img_lora_cards_html"))==null||s.remove(),(n=r.querySelector("#txt2img_textual_inversion_cards_html"))==null||n.remove(),(o=r.querySelector("#txt2img_checkpoints_cards_html"))==null||o.remove(),(a=r.querySelector("#txt2img_hypernetworks_cards_html"))==null||a.remove(),(c=r.querySelector("#txt2img_lora_cards_html"))==null||c.remove(),console.log("Remove element #img2img_textual_inversion_cards_html"),console.log("Remove element #img2img_checkpoints_cards_html"),console.log("Remove element #img2img_hypernetworks_cards_html"),console.log("Remove element #img2img_lora_cards_html"),console.log("Remove element #txt2img_textual_inversion_cards_html"),console.log("Remove element #txt2img_checkpoints_cards_html"),console.log("Remove element #txt2img_hypernetworks_cards_html"),console.log("Remove element #txt2img_lora_cards_html")}}async function Si(e){await Promise.all(Array.from(e.querySelectorAll(".ae-button")).map(async t=>{const i=t.getAttribute("toggle"),s=t.getAttribute("active"),n=t.querySelector("input");n&&(n.checked===!0&&!s||n.checked===!1&&s)&&n.click(),s?t.classList.add("active"):t.classList.remove("active"),i&&t.addEventListener("click",o=>{const a=t.querySelector("input");a?(a.click(),a.checked===!0?t.classList.add("active"):a.checked===!1&&t.classList.remove("active")):t.classList.toggle("active")})}))}async function Ei(e){const t=hi();await Promise.all(Array.from(e.querySelectorAll(".accordion-bar")).map(async i=>{const s=i.parentElement,n=s.closest(".split-container");let o=i;const a=s.getAttribute("iconTrigger");if(a){const c=e.querySelector(a);c&&(o=c,i.classList.add("pointer-events-none"))}if(s.className.indexOf("accordion-vertical")!==-1&&n.className.indexOf("split")!==-1){s.classList.add("expand");const c=n.parentElement.id,r=t[c];n.setAttribute("data-sizes",JSON.stringify(r.getSizes())),o==null||o.addEventListener("click",()=>{if(s.classList.toggle("expand"),n.className.indexOf("v-expand")!==-1)n.classList.remove("v-expand"),r.setSizes(JSON.parse(n.getAttribute("data-sizes")));else{n.classList.add("v-expand");let d=r.getSizes();n.setAttribute("data-sizes",JSON.stringify(d)),console.log(d),d[d.length-1]=0,d[d.length-2]=100;const h=parseFloat(window.getComputedStyle(i,null).getPropertyValue("padding-left"))*2;n.style.minWidth=i.offsetWidth+h+"px",r.setSizes(d)}})}else o==null||o.addEventListener("click",()=>{s.classList.toggle("expand")})}))}async function Ot(e){var i;await mi(e),await vi(e),await Ei(e),await bi(e),await Si(e),document.querySelector("#container-console-log").append($t()),(i=document.querySelector("#logger_screen"))==null||i.remove()}async function Ci(e=pt,t=1){return await(await fetch(`https://api.github.com/repos/${e}/contributors?per_page=100&page=${t}`,{method:"GET",headers:{"Content-Type":"application/json"}})).json()}async function zt(e=pt,t=1,i=[]){const s=await Ci(e,t);return i=i.concat(s),s.length===100?zt(e,t+1,i):i}function Li(){const e=document.querySelector("#contributors"),t=document.querySelector("#contributors_tabitem"),i=document.createElement("div");i.id="contributors_grid",i.innerHTML=`Kindly allow us a moment to retrieve the contributors. 
    We're grateful for the many individuals who have generously put their time and effort to make this possible.`,t.append(i),e.addEventListener("click",s=>{e.getAttribute("data-visited")||(e.setAttribute("data-visited","true"),zt().then(o=>{i.innerHTML="";for(let a=0;a<o.length;a++){const c=o[a].login,r=o[a].html_url,d=o[a].avatar_url;i.innerHTML+=`
                        <a href="${r}" target="_blank" rel="noopener noreferrer nofollow" class="contributor-button flexbox col">
                            <figure><img src="${d}" lazy="true"></figure>
                            <div class="contributor-name">
                                ${c}
                            </div>
                        </a>`}}))})}async function Mt(e,t){try{const i=await fetch(e);if(!i.ok)throw new Error(`HTTP error! Status: ${i.status}`);const s=await i.json();t(s)}catch(i){console.error("Failed to fetch metadata:",i)}}async function Xe(e,t,i){try{const s=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw new Error(`HTTP error! Status: ${s.status}`);const n=await s.json();i(n)}catch(s){console.error("Failed to fetch data:",s)}}const vt=()=>window.innerWidth<=768,Fe=e=>{var i;const t=Ce();t.querySelectorAll("[mobile]").forEach(s=>{if(e){if(s.childElementCount===0){const n=s.getAttribute("mobile");if(n){const o=t.querySelector(n);o&&(s.setAttribute("mobile-restore",`#${o.parentElement.id}`),s.append(o))}}}else if(s.childElementCount>0){const n=s.getAttribute("mobile-restore");if(n){const o=t.querySelector(n);o&&o.append(s.firstElementChild)}}}),e?((i=t.querySelector(".accordion-vertical.expand #mask-icon-acc-arrow"))==null||i.click(),t.classList.add("default-mobile")):t.classList.remove("default-mobile")},Ti=()=>{const e=Ce(),t=window.opts.uiux_default_layout;e.classList.add(`default-${t.toLowerCase()}`),t==="Auto"?(window.addEventListener("resize",i=>{const s=vt();Fe(s)}),Fe(vt())):Fe(t==="Mobile")};function ki(){const e=Ce(),t=ye();if(!e||!t){console.warn(`Required elements not found: ${e?"":"anapnoeApp"} ${t?"":"gradioApp"}`);return}t.querySelector("#setting_uiux_mobile_scale input[type=range]").classList.add("hidden");const s=t.querySelector("#setting_uiux_mobile_scale input[type=number]");function n(m){document.head.querySelector('meta[name="viewport"]').setAttribute("content",`width=device-width, initial-scale=1, shrink-to-fit=no, maximum-scale=${m}`)}s.addEventListener("change",m=>{s.value=m.target.value,xe(s),n(m.target.value)}),n(window.opts.uiux_mobile_scale);function o(m){t.querySelectorAll('[id$="2img_width"] input,[id$="2img_height"] input').forEach(w=>{w.max=m})}t.querySelector("#setting_uiux_max_resolution_output").addEventListener("input",m=>{let w=parseInt(m.target.value);w=Math.min(Math.max(w,512),16384),o(w)}),o(window.opts.uiux_max_resolution_output);function a(m){m.forEach(w=>{const S=w.step/(w.max-w.min)*100,M=`max(3px, calc(${S}% - 1px))`,H=`max(4px, calc(${S}% + 0px))`;w.style.setProperty("--ae-slider-bg-overlay",`repeating-linear-gradient(90deg, transparent, transparent ${M}, var(--ae-input-border-color) ${M}, var(--ae-input-border-color) ${H})`)})}function c(m,w){const M=t.querySelectorAll("input[type='range']");m?a(M):w&&M.forEach(H=>{H.style.setProperty("--ae-slider-bg-overlay","transparent")})}t.querySelector("#setting_uiux_show_input_range_ticks input").addEventListener("click",m=>{c(m.target.checked,!0)}),c(window.opts.uiux_show_input_range_ticks);function d(){const m=Array.from(t.querySelectorAll("#setting_uiux_ignore_overrides input:checked")).map(S=>S.nextElementSibling.innerHTML);t.querySelectorAll("[id$='2img_override_settings'] .token").forEach(S=>{var j;const[M,H]=S.querySelector("span").textContent.split(":").map(u=>u.trim());m.includes(M)&&(t.querySelector("[id$='2img_override_settings']").classList.add("show"),(j=S.querySelector(".token-remove"))==null||j.click())})}t.querySelector("#setting_uiux_ignore_overrides").addEventListener("click",()=>{setTimeout(d,100)});const h=new MutationObserver(m=>{m.forEach(w=>{w.type==="attributes"&&w.attributeName==="class"&&setTimeout(d,1e3)})}),b=new MutationObserver(m=>{m.forEach(w=>{w.addedNodes.length&&setTimeout(d,1e3)})});document.querySelectorAll("#txt2img_override_settings .wrap-inner, #img2img_override_settings .wrap_inner").forEach(m=>b.observe(m,{childList:!0})),document.querySelectorAll("#txt2img_nav, #img2img_nav").forEach(m=>h.observe(m,{attributes:!0}));function z(m,w){const S=t.querySelector(`${m} input`);if(S){const M=m.split("#setting_")[1],H=window.opts[M];e.classList.toggle(w,H),localStorage.setItem(M,H),S.addEventListener("click",j=>{localStorage.setItem(M,j.target.checked),e.classList.toggle(w,j.target.checked),M==="uiux_enable_console_log"&&ti(j.target.checked)})}}const D=[{key:"#setting_uiux_no_slider_layout",className:"no-slider-layout"},{key:"#setting_uiux_show_labels_aside",className:"aside-labels"},{key:"#setting_uiux_show_labels_main",className:"main-labels"},{key:"#setting_uiux_show_labels_tabs",className:"tab-labels"},{key:"#setting_uiux_hide_extra_info",className:"no-extra-info"},{key:"#setting_uiux_disable_transitions",className:"notransition"},{key:"#setting_uiux_enable_console_log",className:"debug-log"}];for(const{key:m,className:w}of D)z(m,w);function E(m,w){e.style.setProperty(m,w)}const _=["#setting_uiux_exnet_fit_size","#setting_uiux_exnet_aspect_ratio_x","#setting_uiux_exnet_aspect_ratio_y","#setting_uiux_exnet_header_size","#setting_uiux_min_wrap_size","#setting_uiux_exnet_image_tint"];for(const m of _){const w=document.querySelector(`${m} input[type=number]`),S=document.querySelector(`${m} input[type=range]`);if(S&&S.classList.add("hidden"),w){const M=m.split("#setting_")[1],H=`--ae-${M}`,j=window.opts[M];E(H,j),w.addEventListener("change",u=>{xe(w),E(H,u.target.value)})}}}function Ii(){["#txt2img","#img2img","#deforum"].forEach(t=>{var s;const i=document.querySelector(`${t}_generate`);if(i){(s=document.querySelector(`${t}_nav`))==null||s.classList.remove("hidden");const n=document.querySelector(`${t}_interrupt`),o=n.closest(".portal"),a=i.closest(".ae-button"),c=document.querySelector(`${t}_skip`).closest(".portal"),r=document.querySelector(`${t}_loop`);n.addEventListener("click",()=>{r==null||r.classList.add("stop")}),new MutationObserver(h=>{h.forEach(b=>{n.style.display==="none"?(document.querySelector(".progressDiv .progress")&&(o.classList.remove("disable"),setTimeout(()=>n.click(),500)),r?r.className.indexOf("stop")!==-1||r.className.indexOf("active")===-1?(r.classList.remove("stop"),o.classList.add("disable"),c==null||c.classList.add("disable"),a.classList.remove("active")):r.className.indexOf("active")!==-1&&i.click():(o.classList.add("disable"),a.classList.remove("active"))):(o.classList.remove("disable"),c==null||c.classList.remove("disable"),a.classList.add("active"))})}).observe(n,{attributes:!0,attributeFilter:["style"]})}})}function $i(e,t){const i=document.querySelector("#setting_sd_model_checkpoint .wrap .secondary-wrap input")||document.querySelector(".gradio-dropdown.model_selection .wrap .secondary-wrap input"),s=document.querySelector("#setting_sd_model_checkpoint .wrap")||document.querySelector(".gradio-dropdown.model_selection .wrap"),n=document.querySelector("#checkpoints_main_footer_db .model-selected");document.querySelector("#checkpoints_main_footer_db .model-preloader").append(s);let a="";const c=d=>{if(a!==d){const h=d.split(".").slice(0,-1).join();e.selected=t.selected=new Set([h]),e.renderItems(),t.updateSelectedItems(),n.textContent=d,console.log("Checkpoint:",d,h),a=d}};c(i.value);const r=new MutationObserver(function(d){d.forEach(function(h){setTimeout(()=>c(i.value),1e3)})});r.observe(i,{attributes:!0}),r.observe(s,{childList:!0,subtree:!0})}function Ye(e,t,i,s=null){return Object.keys(e).forEach(n=>{const o=document.querySelector(`${n}`);if(o){const a=e[n],c=o.tagName==="SELECT"&&o.multiple||o.tagName==="SELECT"||o.type==="checkbox"||o.type==="radio"||o.type!=="range"&&o.type!=="color"&&o.type!=="text"?"change":"input",r=()=>{let d;o.tagName==="SELECT"&&o.multiple?(d=Array.from(o.selectedOptions).map(b=>b.value),t[a]=d):o.type==="checkbox"||o.type==="radio"?d=o.checked:d=o.value;const h=s?s({[a]:d}):{[a]:d};i.updateParamsAndFetch(h,1e3)};o.addEventListener(c,r)}else console.warn(`Input element with id ${n} not found.`)}),t}function bt(e){let t=e.startsWith("#")?e.slice(1):e,i=1;if(t.length===8?(i=parseInt(t.slice(6,8),16)/255,t=t.slice(0,6)):t.length===3&&(t=t.split("").map(n=>n+n).join("")),t.length!==6)throw new Error("Invalid HEX color.");const s=t.match(/.{2}/g).map(n=>parseInt(n,16));return s.push(i),s}function He(e){const t=e[0]/255,i=e[1]/255,s=e[2]/255,n=Math.max(t,i,s),o=Math.min(t,i,s),a=n-o,c=n+o,r=o===n?0:t===n?(60*(i-s)/a+360)%360:i===n?60*(s-t)/a+120:60*(t-i)/a+240,d=.5*c,h=d===0?0:d===1?1:d<=.5?a/c:a/(2-c),b=e.length===4?e[3]:1;return[Math.round(r),Math.round(h*100),Math.round(d*100),b]}function dt(e,t,i,s=1){i/=100;const n=(s*255|256).toString(16).slice(1),o=a=>{const c=(a+e/30)%12,r=i-t*Math.min(i,1-i)/100*Math.max(Math.min(c-3,9-c,1),-1);return Math.round(255*Math.max(0,Math.min(r,1))).toString(16).padStart(2,"0")};return`#${o(0)}${o(8)}${o(4)}${n}`}function wt(e){e.startsWith("#")&&(e=e.slice(1));let t=1;if(e.length===8&&(t=parseInt(e.slice(6,8),16)/255,e=e.slice(0,6)),e.length===3&&(e=e.split("").map(o=>o+o).join("")),e.length!==6)throw new Error("Invalid HEX color.");const i=(255-parseInt(e.slice(0,2),16)).toString(16),s=(255-parseInt(e.slice(2,4),16)).toString(16),n=(255-parseInt(e.slice(4,6),16)).toString(16);return`#${De(i)}${De(s)}${De(n)}${De(Math.round(t*255).toString(16))}`}function De(e,t=2){return(new Array(t).join("0")+e).slice(-t)}const te={};let Pe,Te=[0,0,0,0];const Ve=e=>e.match(/[\d.]+/g).map(Number);function Ai(e,t,i,s){let n;if(i.includes("#")){let h=i.replace(/\s+/g,"");Pe&&(h=wt(h),te[t]=h),n=He(bt(h))}else if((i.includes("hsl")||i.includes("rgb"))&&(n=i.includes("rgb")?He(Ve(i)):Ve(i),Pe)){const h=dt(n[0],n[1],n[2],n[3]);te[t]=wt(h),n=He(bt(te[t]))}const o=((Number(n[0])||0)+(Number(s[0])||0))%360,a=Math.min(Math.max((Number(n[1])||0)+(Number(s[1])||0),0),100),c=Math.min(Math.max((Number(n[2])||0)+(Number(s[2])||0),0),100),r=Math.min(Math.max((Number(n[3])||1)+(Number(s[3])||0),0),1),d=dt(o,a,c,r).slice(0,-2);return e.value=d,`hsla(${o}, ${a}%, ${c}%, ${r})`}function at(e){let t="";for(const n in te){const o=te[n];if(n!=""&&o&&o.length>0){const a=document.body.querySelector(`#${n} input`)||document.body.querySelector(`#${n} textarea`);if(a)if((a.type||"text")==="color"){const r=Ai(a,n,o,e);t+=`${n}:${r};`}else t+=`${n}:${te[n]};`}}Pe=!1;const i=document.body.querySelector("#preview-styles");i.innerHTML=`:root {${t}}`,i.innerHTML+="@media only screen and (max-width: 860px) { :root { --ae-outside-gap-size: var(--ae-mobile-outside-gap-size); --ae-inside-padding-size: var(--ae-mobile-inside-padding-size); } }";const s=document.body.querySelector("#theme_vars textarea");s.value=t,window.updateInput(s)}function rt(e){let t="";for(let o=0;o<e.length-1;o++){const[a,c]=e[o].split(":").map(h=>h.trim()),r=a.replace(/\s+/g,"");te[r]=c,t+=`${r}:${c};`,document.body.querySelectorAll(`#${r} input, #${r} textarea`).forEach(h=>{const b=h.type||"text";if(b==="color")if(c.includes("hsl")||c.includes("rgb")){let y;c.includes("rgb")?y=He(Ve(c)):y=Ve(c),h.value=dt(y[0],y[1],y[2],y[3]).slice(0,-2)}else h.value=c;else b==="number"||b==="range"?h.value=parseFloat(c)||0:(b==="textarea"||b==="text")&&(h.value=c)})}const i=document.body.querySelector("#preview-styles");if(i)i.innerHTML=`:root {${t}}`,i.innerHTML+="@media only screen and (max-width: 860px) { :root { --ae-outside-gap-size: var(--ae-mobile-outside-gap-size); --ae-inside-padding-size: var(--ae-mobile-inside-padding-size); } }";else{const o=document.createElement("style");o.id="preview-styles",o.innerHTML=`:root {${t}}`,o.innerHTML+="@media only screen and (max-width: 860px) { :root { --ae-outside-gap-size: var(--ae-mobile-outside-gap-size); --ae-inside-padding-size: var(--ae-mobile-inside-padding-size); } }",document.body.appendChild(o)}const s=document.body.querySelector("#theme_vars textarea"),n=document.body.querySelector("#theme_css textarea");s.value=t,window.updateInput(s),window.updateInput(n)}function qi(e){const t=e.split("/*BREAKPOINT_CSS_CONTENT*/");let i=t[0].split("}")[0].split("{")[1].replace(/\n|\r/g,"");i=i.replace(/;+/,";").trim();const s=i.split(";"),n=document.body.querySelector("#theme_vars textarea"),o=document.body.querySelector("#theme_css textarea");n.value=i,window.updateInput(n);const a=t[1]!==void 0?t[1]:"";o.value=`/*BREAKPOINT_CSS_CONTENT*/${a}/*BREAKPOINT_CSS_CONTENT*/`,rt(s);const c=document.body.querySelector("#preview-styles");if(!c){const E=document.createElement("style");E.id="preview-styles",E.innerHTML=e,document.body.appendChild(E)}let r;function d(E){let _=E.value,m=E.parentElement,w=E.type||"text";w==="range"||w==="number"?(m=E.closest(".gradio-slider")||E.closest(".gradio-number"),_+=m.id.indexOf("angle")!==-1?"deg":m.id.indexOf("slider-height")===-1?"px":"",te[m.id]=_):w==="color"?(m=E.closest(".gradio-colorpicker"),te[m.id]=_):w==="textarea"?(m=E.closest(".gradio-textbox"),_.length>0?te[m.id]=_:delete te[m.id]):w==="text"&&(m=E.closest(".gradio-dropdown"),m&&(te[m.id]=_)),r!=null&&clearInterval(r),r=setTimeout(()=>{let S=Object.entries(te).map(([M,H])=>`${M}:${H};`).join("");n.value=S,c.innerHTML=`:root {${S}}@media only screen and (max-width: 860px) { :root { --ae-outside-gap-size: var(--ae-mobile-outside-gap-size); --ae-inside-padding-size: var(--ae-mobile-inside-padding-size); } }`,window.updateInput(n),at(Te)},1e3)}document.body.querySelectorAll("#ui_theme_settings input, #ui_theme_settings textarea").forEach(E=>{E.addEventListener("input",_=>{d(_.currentTarget)})});const h=new MutationObserver(E=>{E.forEach(_=>{_.removedNodes.forEach(m=>{m.nodeType===1&&m.matches("ul")&&d(_.target.querySelector(".secondary-wrap input"))})})});document.body.querySelectorAll("#ui_theme_settings .gradio-dropdown").forEach(E=>{h.observe(E,{childList:!0,subtree:!0})}),document.getElementById("theme_reset_btn").addEventListener("click",E=>{E.preventDefault(),document.body.querySelectorAll("#ui_theme_hsv input").forEach(_=>{_.value=0}),Te=[0,0,0],rt(s)});let y;function k(){if(i!==n.value){clearInterval(y),i=n.value.replace(/\n|\r/g,""),i=i.split(":root{")[0],n.value=i;const E=i.split(";");rt(E)}}document.body.querySelector("#themes_drop_down input").addEventListener("click",E=>{y!==null&&clearInterval(y),n.value=i,y=setInterval(k,500)}),document.body.querySelectorAll("#theme_hue input, #theme_sat input, #theme_brt input").forEach((E,_)=>{E.addEventListener("change",m=>{m.preventDefault(),Te[Math.floor(_/2)]=m.currentTarget.value,at(Te)})}),document.getElementById("theme_invert_btn").addEventListener("click",E=>{E.preventDefault(),Pe=!Pe,at(Te)})}function xt(e){var s;const i=(s=Array.from(e.sheet.cssRules).filter(n=>n instanceof CSSStyleRule&&n.selectorText===":root")[0])==null?void 0:s.cssText;i&&qi(i)}function Pi(){const e=document.querySelector('[rel="stylesheet"][href*="user"]');if(ye().querySelector('[id^="tab_ui_theme"]')&&e){xt(e);return}const i=new MutationObserver(()=>{const s=document.querySelector('[rel="stylesheet"][href*="user"]');if(ye().querySelector('[id^="tab_ui_theme"]'))if(s)i.disconnect(),setTimeout(()=>{xt(s)},500);else{var o=document.createElement("link");o.rel="stylesheet",o.type="text/css",o.href="./file=user.css",document.head.appendChild(o)}});i.observe(ye(),{childList:!0,subtree:!0})}function I(e,t,i=10,s={title:"username",url:"url"},n="",o={},a="POST"){this.container=e,this.originalData=t,this.data=t,this.itemsPerPage=i,this.limit=o.limit,this.apiUrl=n,this.method=a,this.params=o,this.keys=s,this.startIndex=0,this.renderedItems={},this.lastScrollTop=0,this.isFetching=!1,this.useDataFetching=!0,this.isInit=!1,this.resolvedRenderMethod=this.renderItems,this.selected,this.createContainer(),this.createSentinels(),this.createDetail(),this.initialize()}I.prototype.initialize=function(){(!this.apiUrl||this.apiUrl.includes(".json"))&&(this.useDataFetching=!1),this.isInit?this.data.length>0?(this.itemsWrapper.classList.remove("hidden"),this.updateDimensions()):this.itemsWrapper.classList.add("hidden"):this.data.length>0&&(this.isInit=!0,this.setupScrollListener(),this.resolvedRenderMethod(),this.setupResizeObserver(),this.setupKeyboardListener(),this.setupClickListener())};I.prototype.createContainer=function(){this.container.style.position="relative",this.container.style.overflow="auto",this.itemsWrapper=document.createElement("div"),this.itemsWrapper.className="ae-virtual-wrapper",this.container.appendChild(this.itemsWrapper)};I.prototype.createSentinel=function(){const e=document.createElement("div");return e.classList.add("sentinel"),e};I.prototype.createSentinels=function(){this.topSentinel=this.createSentinel(),this.bottomSentinel=this.createSentinel(),this.totalHeightSentinel=this.createSentinel(),this.container.append(this.topSentinel,this.bottomSentinel,this.totalHeightSentinel)};I.prototype.createDetail=function(){this.detail=document.createElement("div"),this.detail.className="ae-virtual-detail";const e=document.createElement("button");e.className="ae-button close";const t=document.createElement("div");t.className="mask-icon icon-cancel",e.appendChild(t),this.detail.appendChild(e);const i=document.createElement("div");i.className="ae-virtual-detail-content",this.detail.appendChild(i),this.container.parentElement.appendChild(this.detail),e.addEventListener("click",this.hideDetail.bind(this)),this.hideDetail()};I.prototype.createItemElement=function(e,t){const i=document.createElement("div");i.className="item card";const s=e[this.keys.url];s&&(i.style.backgroundImage=`url(${s})`);const n=document.createElement("span");return n.textContent=e[this.keys.title],n.className="title",i.appendChild(n),i};I.prototype.getItemsToRender=function(){const e=Math.max(0,this.startIndex),t=Math.min(this.data.length,this.startIndex+this.itemsPerPage);return this.data.slice(e,t)};I.prototype.renderItems=function(){this.itemsWrapper.innerHTML="";const e=this.getItemsToRender(),t=document.createDocumentFragment();e.forEach((i,s)=>{const n=this.startIndex+s,o=this.createItemElement(i,n);o.dataset.index=n,o.dataset.id=i.id,t.appendChild(o)}),this.itemsWrapper.appendChild(t),this.updateSentinels()};I.prototype.forceRenderItems=function(){this.itemsWrapper.innerHTML="",this.renderedItems={};const e=this.getItemsToRender(),t=document.createDocumentFragment();e.forEach((i,s)=>{const n=this.startIndex+s,o=this.createItemElement(i);o.dataset.index=n,o.dataset.id=i.id,t.appendChild(o),this.renderedItems[n]=o}),this.itemsWrapper.appendChild(t),this.updateSentinels()};I.prototype.renderItemsByIndex=function(e="down"){const t=this.getItemsToRender(),i=document.createDocumentFragment();t.forEach((s,n)=>{const o=this.startIndex+n;if(!this.renderedItems[o]){const a=this.createItemElement(s);a.dataset.index=o,a.dataset.id=s.id,i.appendChild(a),this.renderedItems[o]=a}}),e==="down"?this.itemsWrapper.appendChild(i):this.itemsWrapper.insertBefore(i,this.itemsWrapper.firstChild),this.cleanupRenderedItems(),this.updateSentinels()};I.prototype.cleanupRenderedItems=function(){const e=Object.keys(this.renderedItems),t=this.startIndex+this.itemsPerPage;for(let i=0;i<e.length;i++){const s=parseInt(e[i],10);if(s<this.startIndex||s>t){const n=this.renderedItems[s];this.itemsWrapper.removeChild(n),delete this.renderedItems[s]}}};I.prototype.updateSentinels=function(){const e=Math.max(0,this.startIndex),t=Math.min(this.data.length,this.startIndex+this.itemsPerPage),i=e/this.itemsPerRow*this.itemHeight;let s=t/this.itemsPerRow*this.itemHeight;s=Math.min(s,this.totalHeight),this.topSentinel.style.transform=`translateY(${i}px)`,this.bottomSentinel.style.transform=`translateY(${s}px)`,this.itemsWrapper.style.transform=`translateY(${i}px)`};I.prototype.updateDimensions=function(){const e=this.itemsWrapper.querySelector(".item");e&&(this.itemHeight=e.offsetHeight,this.itemWidth=e.offsetWidth,this.containerWidth=this.container.offsetWidth,this.containerHeight=this.container.parentElement.offsetHeight,this.containerHeight&&(this.container.style.height=`${this.containerHeight}px`,this.data.length&&(this.itemsPerRow=Math.floor(this.containerWidth/this.itemWidth),this.totalRows=Math.ceil(this.data.length/this.itemsPerRow),this.rowsInView=Math.ceil(this.containerHeight/this.itemHeight),this.itemsPerPage=Math.max(this.itemsPerPage,this.rowsInView*this.itemsPerRow),this.totalHeight=this.totalRows*this.itemHeight,this.totalHeightSentinel.style.transform=`translateY(${this.totalHeight}px)`,this.maxStartIndex=Math.max(this.data.length-this.itemsPerPage,0),this.scrollHandler())))};I.prototype.scrollHandler=function(){this.scrollTimeout&&cancelAnimationFrame(this.scrollTimeout),this.scrollTimeout=requestAnimationFrame(()=>{const e=this.container.scrollTop,t=Math.floor(e/this.itemHeight);this.startIndex=t*this.itemsPerRow;const i=e>this.lastScrollTop?"down":"up";this.lastScrollTop=e,i==="down"&&this.useDataFetching&&!this.isFetching&&this.params.cursor&&this.startIndex>=this.maxStartIndex&&(this.isFetching=!0,this.fetchUpdateData()),this.resolvedRenderMethod(i)})};I.prototype.clickHandler=function(e){const{target:t,currentTarget:i}=e,s=t.closest(".item.card").dataset.index,n=this.data[s];console.log(n)};I.prototype.setupScrollListener=function(){this.container.addEventListener("scroll",this.throttle(this.scrollHandler.bind(this),100))};I.prototype.setupResizeObserver=function(){let e;new ResizeObserver(()=>{clearTimeout(e),e=setTimeout(()=>{this.updateDimensions()},100)}).observe(this.container)};I.prototype.setupKeyboardListener=function(){document.addEventListener("keydown",this.handleKeyPress.bind(this))};I.prototype.setupClickListener=function(){this.container.addEventListener("click",this.clickHandler.bind(this))};I.prototype.handleKeyPress=function(e){switch(e.key){case"ArrowDown":this.scrollBy(1);break;case"ArrowUp":this.scrollBy(-1);break;case"Home":this.scrollToStart();break;case"End":this.scrollToEnd();break}};I.prototype.scrollBy=function(e){this.container.scrollTop+=e*this.itemHeight};I.prototype.scrollToStart=function(){this.startIndex=0,this.container.scrollTop=0};I.prototype.scrollToEnd=function(){this.startIndex=Math.max(0,this.data.length-this.itemsPerPage),this.container.scrollTop=this.startIndex*this.itemHeight};I.prototype.debounce=function(e,t=1e3){return(function(...i){const s=this,n=typeof i[i.length-1]=="number"?i.pop():t,o=()=>{this.timeout=null,e.apply(s,i)};clearTimeout(this.timeout),this.timeout=setTimeout(o,n)}).bind(this)};I.prototype.throttle=function(e,t){let i,s;return function(){const n=this,o=arguments;s?(clearTimeout(i),i=setTimeout(function(){Date.now()-s>=t&&(e.apply(n,o),s=Date.now())},t-(Date.now()-s))):(e.apply(n,o),s=Date.now())}};I.prototype.setNextCursor=function(e){e&&this.data.length>0?(this.params.cursor=e,this.params.page=Math.floor(this.data.length/this.params.limit)+1||1):this.params.cursor&&delete this.params.cursor,this.params.limit&&this.data.length>0?this.params.page=Math.floor(this.data.length/this.params.limit)+1:delete this.params.page};I.prototype.getValueByPath=function(e,t){return t?t.split(".").reduce((s,n)=>{if(s!=null)return s[n]},e):e};I.prototype.setData=function(e){this.originalData=e,this.data=e,this.container.scrollTop=0,this.lastScrollTop=0,this.initialize()};I.prototype.appendData=function(e){this.originalData.push(...e),this.data=this.originalData,this.isFetching=!1;const t=this.startIndex*this.itemHeight;this.container.scrollTop=t,this.updateDimensions()};I.prototype.updateDataByIndex=function(e,t){const i=this.originalData[t];for(const[s,n]of Object.entries(e))i[s]=n;this.originalData[t]=i,this.data=this.originalData,this.renderItems()};I.prototype.updateDataById=function(e,t){const i=this.originalData.find(s=>s.id===t);if(i){for(const[s,n]of Object.entries(e))i[s]=n;this.data=this.originalData,this.renderItems()}else console.error(`Item with ID ${t} not found.`)};I.prototype.setSelectedItems=function(e){this.selected=e,this.renderItems()};I.prototype.fetchData=async function(e){return new Promise((t,i)=>{const s=new XMLHttpRequest;let n=this.apiUrl;if(this.method.toUpperCase()==="GET"&&this.params){const o=new URLSearchParams;Object.keys(this.params).forEach(a=>{const c=this.params[a];Array.isArray(c)?c.forEach(r=>o.append(a,r)):o.append(a,c)}),n+="?"+o.toString()}s.open(this.method,n,!0),s.setRequestHeader("Accept","application/json"),s.onprogress=function(o){if(o.lengthComputable){const a=parseInt(o.loaded/o.total*100);e(a)}},s.onload=function(){if(s.status===200){const o=JSON.parse(s.responseText);t(o)}else i(s.status)},s.onerror=function(){i(s.status)},this.method.toUpperCase()==="POST"?(s.setRequestHeader("Content-Type","application/json"),s.send(JSON.stringify(this.params))):s.send()})};I.prototype.fetchUpdateData=async function(e=!1){var i;this.showLoadingIndicator();const t=await this.fetchData(s=>this.updateLoadingIndicator(s));if(t){const s=this.getValueByPath(t,this.keys.dataPath)||t;e?this.setData(s):this.appendData(s),this.setNextCursor(((i=t.metadata)==null?void 0:i.nextCursor)||t.nextCursor)}else console.error(`Error fetching data: ${error}`);this.hideLoadingIndicator()};I.prototype.updateParamsAndFetch=async function(e,t=1e3){Object.assign(this.params,e),Object.keys(this.params).forEach(s=>{this.params[s]||delete this.params[s]}),this.startIndex=0,delete this.params.cursor,this.originalData=[],this.data=this.originalData,this.debounce(this.fetchUpdateData.bind(this,!0),t)()};I.prototype.showLoadingIndicator=function(){this.loadingIndicator||(this.loadingIndicator=document.createElement("div"),this.loadingIndicator.className="loading-indicator",this.container.parentElement.appendChild(this.loadingIndicator),this.hideLoadingIndicator(),this.isFetching=!1),this.loadingIndicator.innerHTML="Loading... 0%",this.loadingIndicator.style.display="flex"};I.prototype.updateLoadingIndicator=function(e){this.loadingIndicator&&(this.loadingIndicator.innerHTML=`Loading... ${e}%`)};I.prototype.hideLoadingIndicator=function(){this.loadingIndicator&&(this.loadingIndicator.style.display="none")};I.prototype.showDetail=function(){this.detail.classList.remove("hidden")};I.prototype.hideDetail=function(){this.detail&&this.detail.classList.add("hidden")};I.prototype.filterItems=function(e,t={}){this.startIndex=0,this.data=this.originalData.filter(i=>{let s=!0;e&&(s=s&&i[this.keys.title].toLowerCase().includes(e.toLowerCase()));for(const[n,o]of Object.entries(t))if(i[n]!==void 0&&o!==void 0)if(Array.isArray(i[n])){const a=i[n];s=s&&a.some(c=>typeof c=="string"&&c.toLowerCase().includes(o.toLowerCase()))}else typeof i[n]=="string"&&(s=s&&i[n].toLowerCase().includes(o.toLowerCase()));return s}),this.updateDimensions(),this.forceRenderItems()};I.prototype.sortItems=function(e,t=!1){this.startIndex=0;const i=this,s=[...this.data];function n(o,a){const c=i.getValueByPath(o,e),r=i.getValueByPath(a,e);return!isNaN(c)&&!isNaN(r)?t?r-c:c-r:t?r<c?-1:r>c?1:0:c<r?-1:c>r?1:0}s.sort(n),this.data=s,this.updateDimensions(),this.forceRenderItems()};function le(e,t){e.classList.add(t)}function he(e,t){e.classList.remove(t)}function Ke(e,t,i){i?le(e,t):he(e,t)}function V(e,t,i){i=""+i,e["_s_"+t]!==i&&(e.style.setProperty(t,i),e["_s_"+t]=i)}let St=0;function Je(e,t){t&&(V(e,"transition","none"),t()),St||(St=e.clientTop&&0),t&&V(e,"transition","")}function Et(e,t){e.firstChild.nodeValue=t}function Nt(e,t){return(t||document).getElementsByClassName(e)}function Be(e,t,i,s){se(!0,e,t,i,s)}function se(e,t,i,s,n){t[(e?"add":"remove")+"EventListener"](i,s,n||n===!1?n:!0)}function Ze(e,t){e.stopPropagation(),t&&e.preventDefault()}function Oi(e,t){const i=Oe("a"),s=t.src;i.href=s,i.download=s.substring(s.lastIndexOf("/")+1),e.appendChild(i),i.click(),e.removeChild(i)}function Oe(e){return document.createElement(e)}function Ae(e,t){V(e,"display",t?"":"none")}function ke(e,t){V(e,"visibility",t?"":"hidden")}function me(e,t){V(e,"transition",t?"":"none")}const ct={},zi=Oe("video");function Ct(e,t,i,s){let n,o;if(s!=="node"){const a=Object.keys(i);for(let c=0,r;c<a.length;c++)if(r=a[c],r.length>3&&r.indexOf("src")===0)if(s==="video"){const d=ct[r];if(d){if(d>0){n=i[r];break}}else if(zi.canPlayType("video/"+r.substring(3).replace("-","").toLowerCase())){ct[r]=1,n=i[r];break}else ct[r]=-1}else{const d=parseInt(r.substring(4),10);if(d){const h=Math.abs(t-d);(!o||h<o)&&(o=h,n=i[r])}}}return n||i.src||i.href||e.src||e.href}function C(e,t={}){this.controls=["info","theme","download","play","page","close","autofit","zoom-in","zoom-out","prev","next","fullscreen"],this.controls_default={info:1,page:1,close:1,autofit:1,"zoom-in":1,"zoom-out":1,prev:1,next:1,fullscreen:1},this.keycodes={BACKSPACE:8,ESCAPE:27,SPACEBAR:32,LEFT:37,RIGHT:39,UP:38,NUMBLOCK_PLUS:107,PLUS:187,DOWN:40,NUMBLOCK_MINUS:109,MINUS:189,INFO:73},this.controls_dom={},this.connection=navigator.connection,this.dpr=window.devicePixelRatio||1,this.widget=Oe("div"),this.init(e,t)}C.prototype.init=function(e,t){this.parentEl||(this.doc=document.body,this.parentEl=e||document.body,this.scale=1,this.x=0,this.y=0,t&&(this.options=t),this.widget.innerHTML="<div class=spl-spinner></div><div class=spl-track><div class=spl-scene><div class=spl-pane></div></div></div><div class=spl-header><div class=spl-page> </div></div><div class=spl-progress></div><div class=spl-footer><div class=spl-title> </div><div class=spl-more> </div><div class=spl-description> </div><div class=spl-button> </div></div><div class=spl-prev></div><div class=spl-next></div>",this.widget.classList.add("spotlight"),this.slider=this.getOneByClass("scene"),this.header=this.getOneByClass("header"),this.footer=this.getOneByClass("footer"),this.title=this.getOneByClass("title"),this.description=this.getOneByClass("description"),this.button=this.getOneByClass("button"),this.page_prev=this.getOneByClass("prev"),this.page_next=this.getOneByClass("next"),this.page=this.getOneByClass("page"),this.progress=this.getOneByClass("progress"),this.spinner=this.getOneByClass("spinner"),this.panes=[this.getOneByClass("pane")],this.track=this.getOneByClass("track"),this.addControl("close",this.close.bind(this)),this.doc[this.prefix_request="requestFullscreen"]||this.doc[this.prefix_request="msRequestFullscreen"]||this.doc[this.prefix_request="webkitRequestFullscreen"]||this.doc[this.prefix_request="mozRequestFullscreen"]||(this.prefix_request=""),this.prefix_request?(this.prefix_exit=this.prefix_request.replace("request","exit").replace("mozRequest","mozCancel").replace("Request","Exit"),this.maximize=this.addControl("fullscreen",this.fullscreen.bind(this))):this.controls.pop(),this.addControl("info",this.info.bind(this)),this.addControl("autofit",this.autofit.bind(this)),this.addControl("zoom-in",this.zoom_in.bind(this)),this.addControl("zoom-out",this.zoom_out.bind(this)),this.addControl("theme",this.theme.bind(this)),this.player=this.addControl("play",this.play.bind(this)),this.addControl("download",this.download.bind(this)),Be(this.page_prev,"click",this.prev.bind(this)),Be(this.page_next,"click",this.next.bind(this)),Be(this.button,"click",()=>{this.options_click?this.options_click(this.current_slide,this.options):this.options_href&&(location.href=this.options_href)}))};C.prototype.getOneByClass=function(e){return this.controls_dom[e]=Nt("spl-"+e,this.widget)[0]};C.prototype.addControl=function(e,t){const i=Oe("div");return i.className="spl-"+e,Be(i,"click",t),this.header.appendChild(i),this.controls_dom[e]=i};C.prototype.removeControl=function(e){const t=this.controls_dom[e];t&&(this.header.removeChild(t),this.controls_dom[e]=null)};C.prototype.dispatch=function(e){const t=e.target.closest(".spotlight");if(t){Ze(e,!0);const i=t.closest(".spotlight-group");this.anchors=Nt("spotlight",i);for(let s=0;s<this.anchors.length;s++)if(this.anchors[s]===t){this.options_group=i&&i.dataset,this.init_gallery(s+1);break}}};C.prototype.show=function(e,t,i){this.anchors=e,t&&(this.options_group=t,this.options_onshow=t.onshow,this.options_onchange=t.onchange,this.options_onclose=t.onclose,this.index=i||t.index),this.init_gallery(i)};C.prototype.init_gallery=function(e){if(this.slide_count=this.anchors.length,this.slide_count){this.parentEl||this.init(),this.options_onshow&&this.options_onshow(e);const t=this.panes[0],i=t.parentNode;for(let s=this.panes.length;s<this.slide_count;s++){const n=t.cloneNode(!1);V(n,"left",s*100+"%"),i.appendChild(n),this.panes[s]=n}this.panel||(this.parentEl.appendChild(this.widget),this.update_widget_viewport()),this.current_slide=e||1,me(this.slider),this.setup_page(!0),this.prefix_request&&this.detect_fullscreen(),this.show_gallery()}};C.prototype.parse_option=function(e,t){let i=this.options[e];return typeof i<"u"?(i=""+i,i!=="false"&&(i||t)):t};C.prototype.apply_options=function(e){this.options={},this.options_group&&Object.assign(this.options,this.options_group),Object.assign(this.options,e.dataset||e),this.options_media=this.options.media,this.options_click=this.options.onclick,this.options_theme=this.options.theme,this.options_class=this.options.class,this.options_autohide=this.parse_option("autohide",!0),this.options_infinite=this.parse_option("infinite"),this.options_progress=this.parse_option("progress",!0),this.options_autoslide=this.parse_option("autoslide"),this.options_preload=this.parse_option("preload",!0),this.options_href=this.options.buttonHref,this.delay=this.options_autoslide&&parseFloat(this.options_autoslide)||7,this.toggle_theme||this.options_theme&&this.theme(this.options_theme),this.options_class&&le(this.widget,this.options_class),this.options_class&&Je(this.widget);const t=this.options.control;if(t){const s=typeof t=="string"?t.split(","):t;for(let n=0;n<this.controls.length;n++)this.options[this.controls[n]]=!1;for(let n=0;n<s.length;n++){const o=s[n].trim();o==="zoom"?this.options["zoom-in"]=this.options["zoom-out"]=!0:this.options[o]=!0}}const i=this.options.animation;if(this.animation_scale=this.animation_fade=this.animation_slide=!i,this.animation_custom=!1,i){const s=typeof i=="string"?i.split(","):i;for(let n=0;n<s.length;n++){const o=s[n].trim();o==="scale"?this.animation_scale=!0:o==="fade"?this.animation_fade=!0:o==="slide"?this.animation_slide=!0:o&&(this.animation_custom=o)}}this.options_fit=this.options.fit};C.prototype.prepare_animation=function(e){e?Je(this.media,this.prepare_animation):(V(this.media,"opacity",this.animation_fade?0:1),this.update_scroll(this.animation_scale&&.8),this.animation_custom&&le(this.media,this.animation_custom))};C.prototype.init_slide=function(e){if(this.panel=this.panes[e-1],this.media=this.panel.firstChild,this.current_slide=e,this.media)this.disable_autoresizer(),this.options_fit&&le(this.media,this.options_fit),this.animation_custom&&he(this.media,this.animation_custom),this.animation_fade&&V(this.media,"opacity",1),this.animation_scale&&V(this.media,"transform",""),V(this.media,"visibility","visible"),this.options_autoslide&&this.animate_bar(this.playing);else{const t=this.gallery.media,i=this.parse_option("spinner",!0);if(t==="node"){this.media=this.gallery.src,typeof this.media=="string"&&(this.media=document.querySelector(this.media)),this.media&&(this.media._root||(this.media._root=this.media.parentNode),this.update_media_viewport(),this.panel.appendChild(this.media),this.init_slide(e));return}else this.toggle_spinner(i,!0),this.media=Oe("img"),this.media.onload=()=>{this.media.onerror=null,this.toggle_spinner(i),this.init_slide(e),this.update_media_viewport()},this.media.src=this.gallery.src,this.panel.appendChild(this.media);this.media&&(i||V(this.media,"visibility","visible"),this.media.onerror=()=>{this.checkout(this.media),le(this.spinner,"error"),this.toggle_spinner(i)})}};C.prototype.toggle_spinner=function(e,t){e&&Ke(this.spinner,"spin",t)};C.prototype.has_fullscreen=function(){return document.fullscreen||document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement};C.prototype.resize_listener=function(){if(this.update_widget_viewport(),this.media&&this.update_media_viewport(),this.prefix_request){const e=this.has_fullscreen();Ke(this.maximize,"on",e),e||this.detect_fullscreen()}};C.prototype.detect_fullscreen=function(){Ae(this.maximize,screen.availHeight-window.innerHeight>0)};C.prototype.update_widget_viewport=function(){this.viewport_w=this.widget.clientWidth,this.viewport_h=this.widget.clientHeight};C.prototype.update_media_viewport=function(){this.media_w=this.media.clientWidth,this.media_h=this.media.clientHeight};C.prototype.update_scroll=function(e){V(this.media,"transform","translate(-50%, -50%) scale("+(e||this.scale)+")")};C.prototype.update_panel=function(e,t){V(this.panel,"transform",e||t?"translate("+e+"px, "+t+"px)":"")};C.prototype.update_slider=function(e,t,i){t?Je(this.slider,()=>{this.update_slider(e,!1,i)}):V(this.slider,"transform","translateX("+(-e*100+(i||0))+"%)")};C.prototype.toggle_listener_track=function(e){const t=this.track;window.activeElement=t,se(e,t,"wheel",this.wheel_listener.bind(this),{passive:!1}),se(e,t,"mousedown",this.start.bind(this)),se(e,t,"mousemove",this.move.bind(this)),se(e,t,"mouseleave",this.end.bind(this)),se(e,t,"mouseup",this.end.bind(this)),se(e,t,"touchstart",this.start.bind(this),{passive:!1}),se(e,t,"touchmove",this.move.bind(this),{passive:!0}),se(e,t,"touchend",this.end.bind(this)),se(e,t,"resize",this.resize_listener.bind(this))};C.prototype.toggle_listener_widget=function(e){const t=this.parentEl;se(e,t,"resize",this.resize_listener.bind(this)),this.toggle_listener_track(e)};C.prototype.toggle_listener=function(e){se(e,window,"keydown",this.key_listener.bind(this)),this.toggle_listener_widget(e)};C.prototype.history_listener=function(e){this.panel&&e.state.spl&&this.close(!0)};C.prototype.key_listener=function(e){if(this.panel&&window.activeElement&&window.activeElement===this.track){const t=this.options["zoom-in"]!==!1;switch(e.keyCode){case this.keycodes.BACKSPACE:t&&this.autofit();break;case this.keycodes.ESCAPE:this.close();break;case this.keycodes.SPACEBAR:this.options_autoslide&&this.play();break;case this.keycodes.LEFT:this.prev();break;case this.keycodes.RIGHT:this.next();break;case this.keycodes.UP:case this.keycodes.NUMBLOCK_PLUS:case this.keycodes.PLUS:t&&this.zoom_in();break;case this.keycodes.DOWN:case this.keycodes.NUMBLOCK_MINUS:case this.keycodes.MINUS:t&&this.zoom_out();break;case this.keycodes.INFO:this.info();break}}};C.prototype.wheel_listener=function(e){if(this.panel&&this.options["zoom-in"]!==!1){let t=e.deltaY;t=(t<0?1:t?-1:0)*.5;const i=this.widget.getBoundingClientRect(),s=e.clientX-i.left,n=e.clientY-i.top;t<0?this.zoom_out(e,s,n):this.zoom_in(e,s,n)}};C.prototype.play=function(e,t){(typeof e=="boolean"?e:!this.playing)===!this.playing&&(this.playing=this.playing?clearTimeout(this.playing):1,Ke(this.player,"on",this.playing),t||this.animate_bar(this.playing))};C.prototype.animate_bar=function(e){this.options_progress&&(Je(this.progress,function(){V(this.progress,"transition-duration",""),V(this.progress,"transform","")}),e&&(V(this.progress,"transition-duration",this.delay+"s"),V(this.progress,"transform","translateX(0)"))),e&&(this.playing=setTimeout(this.next,this.delay*1e3))};C.prototype.autohide=function(){this.options_autohide&&(this.hide_cooldown=Date.now()+2950,this.hide||(le(this.widget,"menu"),this.schedule(3e3)))};C.prototype.schedule=function(e){this.hide=setTimeout(()=>{const t=Date.now();t>=this.hide_cooldown?(he(this.widget,"menu"),this.hide=0):this.schedule(this.hide_cooldown-t)},e)};C.prototype.menu=function(e){typeof e=="boolean"&&(this.hide=e?this.hide:0),this.hide?(this.hide=clearTimeout(this.hide),he(this.widget,"menu")):this.autohide()};C.prototype.start=function(e){Ze(e,!0),this.is_down=!0,this.dragged=!1,this.is_sliding_up=!1;let t=e,i=e.touches;this.prev_touches=i,i&&(i=i[0])&&(t=i),this.slidable=this.media_w*this.scale<=this.viewport_w&&this.media_h*this.scale<=this.viewport_h,this.startX=t.pageX,this.startY=t.pageY,window.activeElement=this.track,me(this.panel)};C.prototype.end=function(e){if(Ze(e),this.is_down){if(!this.dragged)this.menu();else{if(this.slidable&&this.dragged){const t=this.x<-(this.viewport_w/7)&&(this.current_slide<this.slide_count||this.options_infinite),i=t||this.x>this.viewport_w/7&&(this.current_slide>1||this.options_infinite);(t||i)&&(this.update_slider(this.current_slide-1,!0,this.x/this.viewport_w*100),t&&this.next()||i&&this.prev()),this.is_sliding_up&&this.y<-(this.viewport_h/4)?this.close():(this.x=0,this.y=0),this.update_panel()}me(this.panel,!0)}this.is_down=!1}};C.prototype.distance=function(e){const t=this.widget.getBoundingClientRect(),i=e[0].clientX-t.left,s=e[0].clientY-t.top,n=e[1].clientX-t.left,o=e[1].clientY-t.top;return Math.sqrt(Math.pow(i-n,2)+Math.pow(s-o,2))};C.prototype.center_of=function(e){const t=this.widget.getBoundingClientRect(),i=e[0].clientX-t.left,s=e[0].clientY-t.top,n=e[1].clientX-t.left,o=e[1].clientY-t.top;return[(i+n)*.5,(s+o)*.5]};C.prototype.scale_touches=function(e){if(this.options["zoom-in"]!==!1&&e&&e.length===2&&this.prev_touches&&this.prev_touches.length===2){const t=this.distance(e)/this.distance(this.prev_touches),i=this.center_of(e);this.centered_zoom(t,i[0],i[1],!1)}return this.prev_touches=e,e&&e[0]};C.prototype.move=function(e){if(Ze(e),this.is_down){let t=this.scale_touches(e.touches);if(t&&(e=t),!this.dragged){const i=this.startX-e.pageX,s=this.startY-e.pageY;this.is_sliding_up=this.slidable&&s>Math.abs(i)*1.15}if(this.is_sliding_up)this.y-=this.startY-(this.startY=e.pageY);else if(this.slidable)this.x-=this.startX-(this.startX=e.pageX);else{let i=(this.media_w*this.scale-this.viewport_w)/2,s=Math.abs(i);i>0&&(this.x-=this.startX-(this.startX=e.pageX)),this.x>s?this.x=s:this.x<-s&&(this.x=-s),i=(this.media_h*this.scale-this.viewport_h)/2,s=Math.abs(i),i>0&&(this.y-=this.startY-(this.startY=e.pageY)),this.y>s?this.y=s:this.y<-s&&(this.y=-s)}this.dragged=!0,this.update_panel(this.x,this.y)}else this.autohide()};C.prototype.fullscreen=function(e){console.log("fullscreen",e);const t=this.has_fullscreen();(typeof e!="boolean"||e!==!!t)&&(t?document[this.prefix_exit]():this.widget[this.prefix_request]())};C.prototype.theme=function(e){typeof e!="string"&&(e=this.toggle_theme?"":this.options_theme||"white"),this.toggle_theme!==e&&(this.toggle_theme&&he(this.widget,this.toggle_theme),e&&le(this.widget,e),this.toggle_theme=e)};C.prototype.autofit=function(e){typeof e=="boolean"&&(this.toggle_autofit=!e),this.toggle_autofit=this.scale===1&&!this.toggle_autofit,Ke(this.media,"autofit",this.toggle_autofit),V(this.media,"transform",""),this.scale=1,this.x=0,this.y=0,this.update_media_viewport(),me(this.panel),this.update_panel()};C.prototype.centered_zoom=function(e,t,i,s){let n=this.scale*e;if(me(this.panel,s),me(this.media,s),this.disable_autoresizer(),n<=1){this.x=this.y=0,this.update_panel(this.x,this.y),this.zoom(1);return}if(!(n>50)){if(i){const o=this.viewport_w/2,a=this.viewport_h/2;this.x=t-(t-this.x-o)*e-o,this.y=i-(i-this.y-a)*e-a}else this.x*=e,this.y*=e;this.update_panel(this.x,this.y),this.zoom(n)}};C.prototype.zoom_in=function(e,t,i){this.centered_zoom(1/.65,t,i,!0)};C.prototype.zoom_out=function(e,t,i){this.centered_zoom(.65,t,i,!0)};C.prototype.zoom=function(e){this.scale=e||1,this.update_scroll()};C.prototype.info=function(){this.footer_visible=!this.footer_visible,ke(this.footer,this.footer_visible)};C.prototype.disable_autoresizer=function(){this.toggle_autofit&&this.autofit()};C.prototype.show_gallery=function(){window.history.pushState({spl:1},""),window.history.pushState({spl:2},""),me(this.widget,!0),le(this.parentEl,"hide-scrollbars"),le(this.widget,"spotlight"),le(this.widget,"show"),this.toggle_listener(!0),this.update_widget_viewport(),this.update_media_viewport(),me(this.panel),this.update_panel(),this.autohide(),this.options_autoslide&&this.play(!0,!0)};C.prototype.download=function(){Oi(this.parentEl,this.media)};C.prototype.close=function(e){setTimeout(()=>{var t;console.log(this.parentEl,this.widget),(t=this.parentEl)==null||t.removeChild(this.widget),this.panel=this.media=this.gallery=this.options=this.options_group=this.anchors=this.options_onshow=this.options_onchange=this.options_onclose=this.options_click=null},200),he(this.parentEl,"hide-scrollbars"),he(this.widget,"show"),this.fullscreen(!1),this.toggle_listener(),window.history.go(e===!0?-1:-2),this.playing&&this.play(),this.media&&this.checkout(this.media),this.hide&&(this.hide=clearTimeout(this.hide)),this.toggle_theme&&this.theme(),this.options_class&&he(this.widget,this.options_class),this.options_onclose&&this.options_onclose()};C.prototype.checkout=function(e){if(e._root)e._root.appendChild(e),e._root=null;else{const t=e.parentNode;t&&t.removeChild(e),e=e.src=e.onerror=""}};C.prototype.prev=function(e){if(e&&this.autohide(),this.slide_count>1){if(this.current_slide>1)return this.goto(this.current_slide-1);if(this.options_infinite)return this.update_slider(this.slide_count,!0),this.goto(this.slide_count)}};C.prototype.next=function(e){if(e&&this.autohide(),this.slide_count>1){if(this.current_slide<this.slide_count)return this.goto(this.current_slide+1);if(this.options_infinite)return this.update_slider(-1,!0),this.goto(1);this.playing&&this.play()}};C.prototype.goto=function(e){if(e!==this.current_slide){this.playing?(clearTimeout(this.playing),this.animate_bar()):this.autohide();const t=e>this.current_slide;return this.current_slide=e,this.setup_page(t),!0}};C.prototype.prepare=function(e){let t=this.anchors[this.current_slide-1];this.apply_options(t);const i=this.connection&&this.connection.downlink;let s=Math.max(this.viewport_h,this.viewport_w)*this.dpr;i&&i*1200<s&&(s=i*1200);let n;if(this.gallery={media:this.options_media,src:Ct(t,s,this.options,this.options_media),title:this.parse_option("title",t.alt||t.title||(n=t.firstElementChild)&&(n.alt||n.title))},this.options_preload&&e&&(t=this.anchors[this.current_slide])){const o=t.dataset||t,a=o.media;(!a||a==="image")&&(this.gallery_next=Ct(t,s,o,a))}for(let o=0;o<this.controls.length;o++){const a=this.controls[o];Ae(this.controls_dom[a],this.parse_option(a,this.controls_default[a]))}};C.prototype.setup_page=function(e){if(this.x=0,this.y=0,this.scale=1,this.media)if(this.media.onerror)this.checkout(this.media);else{let o=this.media;setTimeout(()=>{o&&this.media!==o&&(this.checkout(o),o=null)},650),this.prepare_animation(),this.update_panel()}this.footer&&ke(this.footer,0),this.prepare(e),this.update_slider(this.current_slide-1),he(this.spinner,"error"),this.init_slide(this.current_slide),me(this.panel),this.update_panel();const t=this.gallery.title,i=this.parse_option("description"),s=this.parse_option("button"),n=t||i||s;n&&(this.title.innerHTML=t,this.description.innerHTML=i,s&&Et(this.button,s),Ae(this.title,t),Ae(this.description,i),Ae(this.button,s),V(this.footer,"transform",this.options_autohide==="all"?"":"none")),this.options_autohide||le(this.widget,"menu"),ke(this.footer,this.footer_visible&&n),ke(this.page_prev,this.options_infinite||this.current_slide>1),ke(this.page_next,this.options_infinite||this.current_slide<this.slide_count),Et(this.page,this.slide_count>1?this.current_slide+" / "+this.slide_count:""),this.options_onchange&&this.options_onchange(this.current_slide,this.options)};function We(e,t){const i=document.querySelector(`#pnginfo_send_buttons ${t}`),s=document.querySelector('#pnginfo_image input[type="file"]'),n=new DataTransfer;s.files=n.files,fetch(e.src).then(o=>o.blob()).then(o=>{const a=new File([o],"image.jpg",{type:o.type}),c=new DataTransfer;c.items.add(a),s.files=c.files,oi(s),setTimeout(()=>{i.click()},1e3)}).catch(o=>console.error("Error fetching image:",o))}async function Mi(){const e=document.querySelector("#civitai_cardholder_images"),t=document.querySelector("#civit_search_images"),i=document.querySelector("#civit_search_images_clear"),s=100,n="/sd_webui_ux/civitai_proxy/images",o={"#civit_nsfw_images":"nsfw","#civit_sort_images":"sort","#civit_period_images":"period","#civit_search_images":"username"},a={limit:s,page:1},c={title:"username",url:"url",dataPath:"items"},r=new I(e,[],18,c,n,a),d=Ye(o,a,r),h=["prompt","negativePrompt","clipSkip","cfgScale","sampler","steps","seed","Size"];function b(k){const z=e.parentElement.querySelector(".ae-virtual-detail-content");z.innerHTML="";var D=[];k.forEach(w=>{var j,u;const S=w.url,M=[];M.push(`<p><strong>baseModel:</strong> ${w.baseModel}</p>`),h.forEach(l=>{w.meta&&w.meta[l]!==void 0&&M.push(`<p><strong>${l}:</strong> ${w.meta[l]}</p>`)}),w.meta&&w.meta.civitaiResources&&((u=(j=w.meta)==null?void 0:j.civitaiResources)==null||u.forEach(l=>{const x=l.type?l.type:"Unknown Type",$=l.weight?l.weight:"",T=l.modelVersionId?l.modelVersionId:null,L=l.modelVersionName?l.modelVersionName:"Unnamed Model";T&&M.push(`
                        <p>${x} ${$}
                            <a href="https://civitai.com/api/v1/models/${T}" target="_blank">
                                ${L}
                            </a>
                        </p>
                    `)}));const H=M.join("");if(S){const l={title:`<button class="ae-button"><h2>${w.username}</h2></button>`,description:H,src:S};D.push(l)}});const E=new C(z);E.addControl("txt2img-send mask-icon icon-2txt2img",function(w){const S=z.querySelector("img");We(S,"#pnginfo_send_txt2img button")}),E.addControl("img2img-send mask-icon icon-2img2img",function(w){const S=z.querySelector("img");We(S,"#pnginfo_send_img2img button")}),E.show(D,{index:1,theme:"dark",autohide:!1,info:!0,control:["next","prev","page","spinner","info","autofit","zoom","fullscreen","close"]});const _=z.querySelector(".spl-title");function m(w){t.value=w.target.textContent,E.close(),xe(t)}_.removeEventListener("click",m),_.addEventListener("click",m)}r.clickHandler=function(k){const{target:z,currentTarget:D}=k,E=z.closest(".item.card").dataset.index,_=this.data[E];_&&(r.showDetail(),b([_]),console.log(_))};function y(k){t.value="",xe(t)}i.addEventListener("click",y),r.updateParamsAndFetch(d,0)}async function Ni(){const e=document.querySelector("#civitai_cardholder_models"),t=document.querySelector("#civit_search_models"),i=document.querySelector("#civit_search_models_clear"),s=100,n="/sd_webui_ux/civitai_proxy/models",o={"#civit_nsfw_models":"nsfw","#civit_type_models":"types","#civit_sort_models":"sort","#civit_period_models":"period","#civit_search_models":"query"},a={limit:s,page:1},c={title:"username",url:"url",dataPath:"items"},r=new I(e,[],18,c,n,a),d=Ye(o,a,r);r.createItemElement=function(y){var _,m;const k=document.createElement("div");k.className="item card";const z=(m=(_=y.modelVersions[0])==null?void 0:_.images[0])==null?void 0:m.url;z&&(k.style.backgroundImage=`url(${encodeURI(z)})`);const D=document.createElement("span");D.textContent=y.name,D.className="title";const E=document.createElement("span");return E.textContent=y.type,E.className=`extra-type ${y.type}`,k.appendChild(E),k.appendChild(D),k};function h(y,k,z){const D=e.parentElement.querySelector(".ae-virtual-detail-content");D.innerHTML="";var E=[];const _=[];_.push('<select class="baseModel">'),k.forEach((O,N)=>{const X=N===z?"selected":"";_.push(`<option value="${N}" ${X}>${O.baseModel} | ${O.name} | ${O.baseModelType}</option>`)}),_.push("</select>");const m=_.join(""),w=k[z].description?k[z].description:"",S=y.description+w,M=k[z].images;M&&M.forEach(O=>{const N=O.url;if(N){const X={title:`${y.name}`,description:`${S} <br> ${y.tags}`,src:N};E.push(X)}});const H=new C(D);H.show(E,{index:1,theme:"dark",autohide:!1,control:["next","prev","page","spinner","info","autofit","zoom","download","fullscreen","close"]}),H.addControl("txt2img-send mask-icon icon-2txt2img",function(O){const N=D.querySelector("img");We(N,"#pnginfo_send_txt2img button")}),H.addControl("img2img-send mask-icon icon-2img2img",function(O){const N=D.querySelector("img");We(N,"#pnginfo_send_img2img button")});const j=D.querySelector(".spl-more"),u=document.createElement("div");u.innerHTML=m;const l=u.firstChild;l.addEventListener("change",function(N){H.close(),setTimeout(()=>{h(y,k,parseInt(N.target.value))},300)});const x=document.createElement("span");x.innerHTML=y.type,x.className="model-type";function $(O){const N=O/1024;return N>=1024?`${(N/1024).toFixed(2)} GB`:`${N.toFixed(2)} MB`}const T=k[z].files[0].downloadUrl,L=k[z].files[0].name,A=k[z].files[0].sizeKB,U=document.createElement("a");U.target="_blank",U.href=T,U.textContent=`${L} - ${$(A)}`,j.appendChild(x),j.appendChild(l),j.appendChild(U)}r.clickHandler=function(y){const{target:k,currentTarget:z}=y,D=k.closest(".item.card").dataset.index,E=this.data[D];E.modelVersions&&(r.showDetail(),h(E,E.modelVersions,0),console.log(E))};function b(y){t.value="",xe(t)}i.addEventListener("click",b),r.updateParamsAndFetch(d,0)}function ee(e,t,i,s=""){this.container=document.querySelector(e),this.fetchUrl=t,this.tableName=i,this.rootPath=s.replace(/\\/g,"/").toLowerCase(),this.selected}ee.prototype.initialize=async function(){this.container.innerHTML="";const e=await this.fetchData(this.rootPath),t=this.buildTree(e),i=this.createTreeView(t);this.container.appendChild(i),this.attachEventListeners(),this.itemMap=e.reduce((s,n)=>(s[n.id]=n,s),{})};ee.prototype.updateSelectedItems=function(){var e;this.container.querySelectorAll(".li-file.active").forEach(t=>{t.classList.remove("active")}),(e=this.selected)==null||e.forEach(t=>{const i=this.container.querySelector(`.li-file[data-name="${t}"]`);i&&i.classList.add("active")})};ee.prototype.fetchData=async function(e){const i=await(await fetch(`${this.fetchUrl}?table_name=${this.tableName}&path=${encodeURIComponent(e)}`)).json();return this.data=i.data,this.subpaths=i.unique_subpaths,this.subpaths=this.subpaths.map(s=>{const n=s.split(e);return{path:s,relativePath:n[1],basePath:`${n[0]}${e}`}}),console.log(this.subpaths),console.log("tree data length:",this.data.length),i.data};ee.prototype.buildTree=function(e){const t={},i=this.rootPath;t[i]={};const s=t[i];return e.forEach(n=>{const o=n.filename.replace(/\\/g,"/").toLowerCase(),a=o.indexOf(i);if(a===-1)return;const r=o.slice(a+i.length).replace(/^\//,"").split("/").filter(Boolean);let d=s;for(let h=0;h<r.length;h++){const b=r[h];d[b]||(h===r.length-1?d[b]=n:d[b]={}),d=d[b]}}),t};ee.prototype.createFileItem=function(e,t){const i=document.createElement("li");return i.dataset.name=e[t].name,i.dataset.id=e[t].id,i.innerHTML=`<summary class="tree-file">${e[t].name}</summary>`,i.classList.add("li-file"),i};ee.prototype.createFolderItem=function(e,t,i){const s=document.createElement("li");s.innerHTML=`<summary class="tree-folder caret" data-path="${i}${t}">${t}</summary>`;const n=this.createTreeView(e[t],`${i}/${t}`);return n.classList.add("nested"),s.appendChild(n),s};ee.prototype.createTreeView=function(e,t=""){const i=document.createElement("ul");i.classList.add("tree-view");for(const s in e){let n;typeof e[s]=="object"&&!Array.isArray(e[s])?s.includes(".safetensors")||s.includes(".pt")||s.includes(".png")||s.includes(".jpg")||s.includes(".webp")?n=this.createFileItem(e,s):n=this.createFolderItem(e,s,t):n=this.createFileItem(e,s),i.appendChild(n)}return i};ee.prototype.attachEventListeners=function(){this.eventListenerAdded||(this.container.addEventListener("click",async e=>{const t=e.target,i=t.closest("li[data-id]");if(t.tagName==="BUTTON"){const n=i.dataset.id,o=this.getItemProperties(n);this.onFileClicked(t,o)}else if(i){const n=i.dataset.id,o=this.getItemProperties(n);this.onFileClicked(i,o)}else if(t.classList.contains("caret")){t.classList.toggle("caret-down");const n=t.nextElementSibling;n.classList.contains("nested")&&n.classList.toggle("active"),this.onFolderClicked(t,t.getAttribute("data-path"),n.classList.contains("active"))}e.stopPropagation()}),this.eventListenerAdded=!0)};ee.prototype.getItemProperties=function(e){return this.itemMap[e]};ee.prototype.updateDataById=function(e,t){const i=this.itemMap[t];if(i)for(const[s,n]of Object.entries(e))i[s]=n;else console.error(`Item with ID ${t} not found.`)};ee.prototype.onFolderClicked=function(e,t,i){};ee.prototype.onFileClicked=function(e,t){};function Z(e,t,i,s,n="Submit"){this.url=e,this.table_name=t,this.itemData=i,this.container=s,this.submit_label=n,this.form=document.createElement("form"),this.form.setAttribute("id","userMetadataForm"),this.form.classList.add("flexbox","padding","col","shrink")}Z.prototype.formatFileSize=function(e){return typeof e!="number"?"0 bytes":e>=1073741824?(e/1073741824).toFixed(2)+" GB":e>=1048576?(e/1048576).toFixed(2)+" MB":e>=1024?(e/1024).toFixed(2)+" KB":e+" bytes"};Z.prototype.formatDate=function(e){return typeof e!="number"?"":new Date(e*1e3).toLocaleDateString()};Z.prototype.formatFilename=function(e){return typeof e!="string"?"":e.replace(/\\/g,"/").split("/").pop()};Z.prototype.createElement=function(e,t,i,s={}){const n={textarea:{tag:"textarea",attributes:{...s,rows:s.rows||1,textContent:i||""}},select:{tag:"select",attributes:{id:s.id,class:s.class,name:s.name},children:Array.isArray(s.options)?s.options.map(r=>({option:{type:"option",value:r.value,textContent:r.textContent,selected:r.value===s.value}})):[]},option:{tag:"option",attributes:{...s}},input:{tag:"input",attributes:{...s,type:"text",value:i||""}},file:{tag:"input",attributes:{type:"file"}},number:{tag:"input",attributes:{type:"number",value:i}},checkbox:{tag:"input",attributes:{type:"checkbox",checked:i}},radio:{tag:"input",attributes:{type:"radio",checked:i}},slider:{tag:"input",attributes:{type:"range",value:i}},img:{tag:"img",attributes:{src:s.req+i,alt:t,class:"thumbnail-image"}},button:{tag:"button",textContent:i,attributes:{type:"button",id:s.id,class:"ae-button",name:t}},placeholder:{tag:"div",attributes:s},row:{tag:"div",attributes:{id:s.id,class:`flexbox row ${s.class||""}`},children:s.children},col:{tag:"div",attributes:{id:s.id,class:`flexbox col ${s.class||""}`},children:s.children},panel:{tag:"div",attributes:{id:s.id,class:`panel padding ${s.class||""}`},children:s.children},default:{tag:"input",attributes:{type:"text",value:i||""}}},o=n[e]||n.default,a=document.createElement(o.tag);return((r,d)=>{Object.entries(d).forEach(([h,b])=>{typeof h=="string"&&h.trim()!==""?h==="textContent"?r.textContent=b:h==="checked"?r.checked=!!b:h==="selected"?r.selected=!!b:(typeof b=="string"||typeof b=="number")&&r.setAttribute(h,b):console.warn(`Invalid attribute name: ${h}`)})})(a,o.attributes),o.children&&o.children.forEach(r=>{const d=Object.keys(r)[0],h=r[d],b=h.value!==void 0?h.value:this.itemData[d]||"",y=this.createElement(h.type,d,b,h);a.appendChild(y)}),a};Z.prototype.addElementToForm=function(e,t){const i=document.createElement("div");i.classList.add("panel","col","padding"),t.id&&(i.id=t.id);const s=document.createElement("label");s.setAttribute("for",e),s.classList.add("flexbox"),s.textContent=t.label||e.replace("_"," ").toUpperCase();const n=this.createElement(t.type,e,this.itemData[e],t);i.appendChild(s),i.appendChild(n),this.form.appendChild(i)};Z.prototype.createForm=function(e){Object.entries(e).forEach(([n,o])=>{(this.itemData.hasOwnProperty(n)||o.draw==="true")&&this.addElementToForm(n,o)});const t=document.createElement("div");t.classList.add("panel","row","flex-end");const i=document.createElement("button");i.setAttribute("type","submit"),i.textContent=this.submit_label,i.classList.add("ae-submit-button");const s=document.createElement("button");return s.setAttribute("type","button"),s.textContent="Cancel",s.classList.add("ae-submit-button"),t.appendChild(i),t.appendChild(s),this.form.appendChild(t),this.form.addEventListener("submit",n=>this.handleSubmit(n)),this.form};Z.prototype.createValueElement=function(e,t,i,s,n){const o={filename:{textContent:this.formatFilename(i)},filesize:{textContent:this.formatFileSize(i)},"date-format":{textContent:this.formatDate(i)},img:{tag:"img",attributes:{src:n+i,alt:t,class:"thumbnail-image"}},button:{tag:"button",textContent:s||"button",attributes:{class:`ae-button ${t}`,name:t}},default:{textContent:i||""}},a=o[e]||o.default;let c;return a.tag?(c=document.createElement(a.tag),Object.entries(a.attributes).forEach(([r,d])=>{c.setAttribute(r,d)}),a.textContent&&(c.textContent=a.textContent)):(c=document.createElement("span"),c.textContent=a.textContent),c};Z.prototype.createTable=function(e){const t=document.createElement("table");return t.classList.add("non-editable-table","panel"),Object.entries(e).forEach(([i,s])=>{const n=document.createElement("tr"),o=document.createElement("td");o.textContent=i.replace("_"," ").toUpperCase(),n.appendChild(o);const a=document.createElement("td"),c=this.createValueElement(s.type,i,this.itemData[i]);a.appendChild(c),n.appendChild(a),t.appendChild(n)}),t};Z.prototype.createHtmlElement=function(e){const t=document.createElement("div");return t.classList.add("non-editable-div","flexbox","col","shrink"),Object.entries(e).forEach(([i,s])=>{const n=document.createElement("div");if(n.classList.add("panel",i),s.showLabel!==!1){const a=document.createElement("label");a.textContent=i.replace("_"," ").toUpperCase(),n.appendChild(a)}const o=this.createValueElement(s.type,i,this.itemData[i],s.label||"",s.req);n.appendChild(o),t.appendChild(n)}),t};Z.prototype.buildTags=function(e){const t=/[-_\w']+/g;function i(o){return Object.keys(o).reduce((c,r)=>c+r.length,0)/Object.keys(o).length>=16}const s={},n=e.ss_tag_frequency||{};for(const o of Object.values(n))for(const[a,c]of Object.entries(o)){const r=a.trim();s[r]=(s[r]||0)+parseInt(c,10)}if(Object.keys(s).length>0&&i(s)){const o={};for(const[a,c]of Object.entries(s)){const r=a.match(t)||[];for(const d of r)d.length>=3&&(o[d]=(o[d]||0)+c)}return Object.entries(o).sort(([,a],[,c])=>c-a).map(([a,c])=>[a,c])}return Object.entries(s).sort(([,o],[,a])=>a-o).map(([o,a])=>[o,a])};Z.prototype.createTagsElement=function(e,t){const i=this.buildTags(e);if(i.length>0){const s=document.createElement("div");s.classList.add("non-editable-tags","flexbox","shrink");const n=document.createElement("div");if(n.classList.add("panel","flexbox","row","padding"),t){const o=document.createElement("label");o.textContent=t.toUpperCase(),n.appendChild(o)}return Object.entries(i).forEach(o=>{const a=document.createElement("button");a.type="button",a.textContent=o[1][0];const c=document.createElement("span");c.classList.add("tag-num"),c.textContent=o[1][1],a.appendChild(c),n.appendChild(a)}),s.appendChild(n),s}return!1};Z.prototype.handleSubmit=async function(e){e.preventDefault();const t=new FormData(this.form),i={};for(const[n,o]of t.entries())i[n]=o;let s=i;s.table_name=this.table_name,s.name=this.itemData.name,s=this.beforeFormSubmit(i);try{const n=await fetch(this.url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!n.ok)throw new Error(`HTTP error! Status: ${n.status}`);const o=await n.json();this.afterFormSubmit(i,o)}catch(n){console.error("Failed to fetch data:",n)}};Z.prototype.afterFormSubmit=function(e,t){};Z.prototype.beforeFormSubmit=function(e){return e};async function Ui(){Qe("checkpoints","checkpoint","stable-diffusion/")}async function Fi(){Qe("textual_inversion","textualinversion","embeddings/")}async function Di(){Qe("lora","lora","lora/")}async function Ri(){Qe("hypernetworks","hypernetwork","hypernetworks/")}function Hi(e,t){const i=e.parentElement.querySelector(".ae-virtual-detail-content");i.innerHTML="",i.appendChild(t)}async function Bi(e,t,i,s){const n=`/sd_webui_ux/get_internal_metadata?type=${encodeURIComponent(e)}&name=${encodeURIComponent(t)}`;Mt(n,function(o){console.log(o),i.showDetail();const a=window.extraNetworksFlattenMetadata(o),c=window.createVisualizationTable(a,0);Hi(s,c)})}const _e={};async function Qe(e,t,i){const s=document.querySelector(`#${e}_cardholder`),n=document.querySelector(`#${e}_search`);document.querySelector(`#${e}_sort`);const o=document.querySelector(`#${e}_order`);document.querySelector(`#${e}_sd_version`);const a=document.querySelector(`#${e}_refresh`),c=document.querySelector(`#${e}_rebuild`),r=document.querySelector(`#${e}_clear`),d=document.querySelector("#refresh_database");_e[`txt2img_${t}`]=[],_e[`img2img_${t}`]=[];const h=100,b="/sd_webui_ux/get_items_from_db",y="GET",k={table_name:t,skip:0,limit:h,sort_by:"name",order:"asc",search_term:""},z={title:"name",url:"preview",dataPath:"items"},D={[`#${e}_search`]:"search_term",[`#${e}_sort`]:"sort_by",[`#${e}_search_in`]:"search_columns",[`#${e}_sd_version`]:"sd_version"},E=u=>(u.skip=0,u),_=new I(s,[],18,z,b,k,y),m=Ye(D,k,_,E);_.setNextCursor=function(u){u&&this.data.length>0?this.params.skip=this.params.cursor=u:delete this.params.cursor},_.createItemElement=function(u,l){var O;const x=document.createElement("div");x.className="item card",(O=this.selected)!=null&&O.has(u.name)?x.classList.add("active"):x.classList.remove("active");const $=u.thumbnail;u.timestamp,$&&(x.style.backgroundImage=`url('./sd_extra_networks/thumb?filename=${encodeURIComponent($)}')`);const T=document.createElement("span");T.textContent=u.name,T.className="title";const L=document.createElement("button");L.className="edit-meta edit-button card-button";const A=document.createElement("button");A.className="copy-path copy-path-button card-button";const U=document.createElement("div");if(U.className="item-actions",U.appendChild(A),u.metadata_exists){const N=document.createElement("button");N.className="show-meta metadata-button card-button",U.appendChild(N)}return U.appendChild(L),x.appendChild(U),x.appendChild(T),x};function w(u,l,x){var A;const $=window.UIUX.FOCUS_PROMPT;let T=((A=l.prompt)==null?void 0:A.replace("opts.extra_networks_default_multiplier",l.preferred_weight>0?l.preferred_weight:opts.extra_networks_default_multiplier))||"";T+=l.activation_text||"";const L=l.negative_prompt||"";u.classList.contains("copy-path")?navigator.clipboard.writeText(l.filename):u.classList.contains("show-meta")?Bi(l.type,l.name,_,s):u.classList.contains("edit-meta")?j(l,l.id):l.type==="Checkpoint"?window.selectCheckpoint(l.name):l.type==="TextualInversion"?(window.cardClicked($,T,L,!0),_e[`${$}_textualinversion`].push({id:l.id,name:l.name,value:T})):l.type==="LORA"?(window.cardClicked($,T,L,!1),_e[`${$}_lora`].push({id:l.id,name:l.name,value:`<lora:${T.split(":")[1]}`})):l.type==="Hypernetwork"&&(window.cardClicked($,T,L,!1),_e[`${$}_hypernetwork`].push({id:l.id,name:l.name,value:T}))}_.clickHandler=function(u){const{target:l,currentTarget:x}=u,$=l.closest(".item.card").dataset.id,T=this.data.find(L=>L.id.toString()===$);T&&w(l,T),u.stopPropagation()},c.addEventListener("click",u=>{Xe("/sd_webui_ux/generate-thumbnails",{table_name:t},function(l){console.log(l),setTimeout(()=>{m.skip=0,_.updateParamsAndFetch(m,0)},1e3)})}),o.addEventListener("click",u=>{const l=o.classList.contains("active");m.skip=0,m.order=l?"desc":"asc",_.updateParamsAndFetch(m,0)}),r.addEventListener("click",u=>{n.value="",xe(n)}),_.updateParamsAndFetch(m,0);const S=new ee(`#${e}_tree_view`,"/sd_webui_ux/get_items_by_path",t,i);S.initialize(),S.createFileItem=function(u,l){var A;const x=document.createElement("li");x.dataset.name=u[l].name,x.dataset.id=u[l].id,(A=this.selected)!=null&&A.has(u[l].name)&&x.classList.add("active"),x.innerHTML=`<summary class="tree-file">${u[l].name}</summary>`,x.classList.add("li-file");const $=document.createElement("button");$.className="edit-meta edit-button card-button";const T=document.createElement("button");T.className="copy-path copy-path-button card-button";const L=document.createElement("div");if(L.className="item-actions",L.appendChild(T),u[l].metadata_exists){const U=document.createElement("button");U.className="show-meta metadata-button card-button",L.appendChild(U)}return L.appendChild($),x.appendChild(L),x},S.onFolderClicked=function(u,l,x){},S.onFileClicked=function(u,l){w(u,l,l.id)},a.addEventListener("click",u=>{d.click(),setTimeout(()=>{m.skip=0,_.updateParamsAndFetch(m,0),S.initialize()},1e3)});function M(u){const l=window.UIUX.FOCUS_PROMPT,x=_e[`${l}_${t}`];setTimeout(()=>{let $="";document.querySelectorAll(`#${l}_prompt textarea, #${l}_neg_prompt textarea`).forEach(A=>{$+=A.value});const T=x.filter(A=>A&&A.value&&$.includes(A.value));_e[`${l}_${t}`]=T;const L=new Set(T.map(A=>A.name));_.selected=S.selected=L,_.renderItems(),S.updateSelectedItems()},100)}function H(u){const l=window.UIUX.FOCUS_PROMPT;let x="";if(document.querySelectorAll(`#${l}_prompt textarea, #${l}_neg_prompt textarea`).forEach(L=>{x+=` ${L.value}`}),x.length>2){let L=function(O){return O.replace(/[()]+|:[0-9]+(.[0-9]+)?/g,"").trim()};var $=L;let U=x.trim().split(/[\s,.]+/).map(L).filter(Boolean);if(t==="lora"||t==="hypernetwork"){let N=function(Y){if(Y.includes(`${O}:`)){const G=Y.split(`${O}:`)[1].split(":")[0];return`<${O}:${G}:opts.extra_networks_default_multiplier>`}return""};var T=N;const O=t==="lora"?"lora":"hypernet";U=x.trim().split("<").map(N).filter(Boolean)}U.length>0&&Xe("/sd_webui_ux/search_words_in_tables_columns",{tables:t,columns:"prompt",words:U},function(X){const G=X[t].map(B=>{let de=B.prompt;return(t==="lora"||t==="hypernetwork")&&(de=`<${t==="lora"?"lora":"hypernet"}:${B.prompt.split(":")[1]}`),{id:B.id,name:B.name,value:de}});_e[`${l}_${t}`]=G,_.selected=S.selected=new Set(G.map(B=>B.name)),_.renderItems(),S.updateSelectedItems()})}else _.selected=S.selected=new Set,_.renderItems(),S.updateSelectedItems()}t!=="checkpoint"?document.querySelectorAll("#txt2img_prompt textarea, #img2img_prompt textarea, #txt2img_neg_prompt textarea, #img2img_neg_prompt textarea").forEach(u=>{u.addEventListener("input",M),u.addEventListener("focus",H)}):$i(_,S);function j(u,l){const x={local_preview:{type:"input",name:"local_preview"},sd_version:{type:"select",name:"sd_version",label:"SD Version",value:u.sd_version,options:Qt},preferred_weight:{type:"number",name:"preferred_weight",label:"Preferred Weight"},activation_text:{type:"textarea",name:"activation_text",label:"Activation Text",rows:4},negative_prompt:{type:"textarea",name:"negative_prompt",label:"Negative Prompt",rows:2},description:{type:"textarea",name:"description",label:"Description",rows:2},tags:{type:"textarea",name:"tags",label:"Tags"},notes:{type:"textarea",name:"notes",label:"Notes",rows:2}},$={filename:{type:"filename"},filesize:{type:"filesize"},type:{type:"text"},hash:{type:"text"},date_created:{type:"date-format"},date_modified:{type:"date-format"}},T={thumbnail:{type:"img",req:"./sd_extra_networks/thumb?filename=",showLabel:!1},replace_preview:{type:"button",label:"Replace Preview",showLabel:!1}},L=`/sd_webui_ux/get_internal_metadata?type=${encodeURIComponent(u.type)}&name=${encodeURIComponent(u.name)}`;Mt(L,function(A){var f;const U=A,O="/sd_webui_ux/update_user_metadata",N=document.getElementById("formContainer"),X=new Z(O,t,u,N),Y=X.createForm(x),G=X.createTable($),B=X.createHtmlElement(T),de=X.createTagsElement(U,"Train Tags");if(de){(f=Y.children[2])==null||f.insertAdjacentElement("afterend",de);let g=Y.querySelector("#activation_text");Y.addEventListener("click",q=>{const F=q.target.closest("textarea");F&&(g=F);const R=q.target.closest("button[type=button]");if(R){const Q=R.childNodes[0].textContent.trim(),P=g.value;P.includes(Q)?g.value=P.split(",").map(W=>W.trim()).filter(W=>W!==Q).join(", "):g.value+=(P?", ":"")+Q}})}const ne=document.createElement("div");ne.classList.add("non-editable-info","flexbox","padding","shrink"),ne.appendChild(B),ne.appendChild(G),_.showDetail();const K=s.parentElement.querySelector(".ae-virtual-detail-content");K.innerHTML="",K.appendChild(ne),K.appendChild(Y);function ve(g){const q=g.lastIndexOf(".");return q===-1?g:g.substring(0,q)}function be(g){const q=g.lastIndexOf("/"),F=g.substring(0,q),R=g.substring(q+1),Q=R.lastIndexOf("."),P=R.substring(0,Q);return{path:F,filename:R,filename_no_ext:P}}let we;X.beforeFormSubmit=function(g){return g.id=u.id,g.type=u.type,g.name=u.name,g.filename=u.filename,we&&(g.local_preview=we),g};let v=u.local_preview;X.afterFormSubmit=function(g){_.hideDetail();const q=be(v),F=new Date().getTime();g.thumbnail=`${q.path}/thumbnails/${q.filename_no_ext}.thumb.webp`,g.timestamp=`?t=${F}`,_.updateDataById(g,l),S.updateDataById(g,l)},B.querySelector("button.replace_preview").addEventListener("click",g=>{const q=window.UIUX.FOCUS_PROMPT,F=document.querySelector(`#${q}_gallery [data-testid="detailed-image"]`);if(F){const R=B.querySelector(".thumbnail-image");we=F.src.split("file=")[1].split("?")[0],R.style.filter="grayscale(1)"}})})}}async function ji(){Xi("styles","styles","styles_data/")}const Se={};async function Xi(e,t,i){const s=document.querySelector(`#${e}_cardholder`),n=document.querySelector(`#${e}_search`);document.querySelector(`#${e}_sort`);const o=document.querySelector(`#${e}_order`);document.querySelector(`#${e}_sd_version`);const a=document.querySelector(`#${e}_refresh`),c=document.querySelector(`#${e}_rebuild`),r=document.querySelector(`#${e}_clear`),d=document.querySelector("#refresh_styles_database");Se[`txt2img_${t}`]=[],Se[`img2img_${t}`]=[];const h=100,b="/sd_webui_ux/get_items_from_db",y="GET",k={table_name:t,skip:0,limit:h,sort_by:"name",order:"asc",search_term:""},z={title:"name",url:"preview",dataPath:"items"},D={[`#${e}_search`]:"search_term",[`#${e}_sort`]:"sort_by",[`#${e}_search_in`]:"search_columns",[`#${e}_sd_version`]:"sd_version"},E=u=>(u.skip=0,u),_=new I(s,[],18,z,b,k,y),m=Ye(D,k,_,E);_.setNextCursor=function(u){u&&this.data.length>0?this.params.skip=this.params.cursor=u:delete this.params.cursor},_.createItemElement=function(u,l){var N;const x=document.createElement("div");x.className="item card",(N=this.selected)!=null&&N.has(u.name)?x.classList.add("active"):x.classList.remove("active");const $=u.thumbnail,T=u.timestamp||"";$&&(x.style.backgroundImage=`url('/sd_styles/thumb/${encodeURIComponent($)}${T}')`);const L=document.createElement("span");L.textContent=u.name,L.className="title";const A=document.createElement("button");A.className="edit-meta edit-button card-button";const U=document.createElement("button");U.className="copy-path copy-path-button card-button";const O=document.createElement("div");return O.className="item-actions",O.appendChild(U),O.appendChild(A),x.appendChild(O),x.appendChild(L),x};function w(u,l,x){const $=window.UIUX.FOCUS_PROMPT,T=l.prompt||"",L=l.negative||"";u.classList.contains("copy-path")?navigator.clipboard.writeText(l.filename):u.classList.contains("edit-meta")?j(l,l.id):l.type==="Style"&&(window.cardClicked($,T,L,!0),Se[`${$}_styles`].push({id:l.id,name:l.name,value:T}))}_.clickHandler=function(u){const{target:l,currentTarget:x}=u,$=l.closest(".item.card").dataset.id,T=this.data.find(L=>L.id.toString()===$);T&&w(l,T),u.stopPropagation()},c.addEventListener("click",u=>{Xe("/sd_webui_ux/generate-thumbnails",{table_name:t},function(l){console.log(l),setTimeout(()=>{m.skip=0,_.updateParamsAndFetch(m,0)},1e3)})}),o.addEventListener("click",u=>{const l=o.classList.contains("active");m.skip=0,m.order=l?"desc":"asc",_.updateParamsAndFetch(m,0)}),r.addEventListener("click",u=>{n.value="",xe(n)}),_.updateParamsAndFetch(m,0);const S=new ee(`#${e}_tree_view`,"/sd_webui_ux/get_items_by_path",t,i);S.initialize(),S.createFileItem=function(u,l){var A;const x=document.createElement("li");x.dataset.name=u[l].name,x.dataset.id=u[l].id,(A=this.selected)!=null&&A.has(u[l].name)&&x.classList.add("active"),x.innerHTML=`<summary class="tree-file">${u[l].name}</summary>`,x.classList.add("li-file");const $=document.createElement("button");$.className="edit-meta edit-button card-button";const T=document.createElement("button");T.className="copy-path copy-path-button card-button";const L=document.createElement("div");return L.className="item-actions",L.appendChild(T),L.appendChild($),x.appendChild(L),x},S.onFolderClicked=function(u,l,x){},S.onFileClicked=function(u,l){w(u,l,l.id)},a.addEventListener("click",u=>{d.click(),setTimeout(()=>{m.skip=0,_.updateParamsAndFetch(m,0),S.initialize()},1e3)});function M(u){const l=window.UIUX.FOCUS_PROMPT,x=Se[`${l}_${t}`];setTimeout(()=>{let $="";document.querySelectorAll(`#${l}_prompt textarea, #${l}_neg_prompt textarea`).forEach(A=>{$+=A.value});const T=x.filter(A=>A&&A.value&&$.includes(A.value));Se[`${l}_${t}`]=T;const L=new Set(T.map(A=>A.name));_.selected=S.selected=L,_.renderItems(),S.updateSelectedItems()},100)}function H(u){const l=window.UIUX.FOCUS_PROMPT;let x="";if(document.querySelectorAll(`#${l}_prompt textarea`).forEach(T=>{x+=`${T.value}`}),x.length>2){let T=function(O){return O.replace(/[()]+|:[0-9]+(.[0-9]+)?/g,"").trim()};var $=T;const U=x.trim().split(". ").map(T).filter(Boolean).map(O=>". "+O);U.length>0&&Xe("/sd_webui_ux/search_words_in_tables_columns",{words:U,tables:t,columns:"prompt",threshold:1},function(X){const Y=X[t];console.log(Y);const G=Y.map(B=>({id:B.id,name:B.name,value:B.prompt}));Se[`${l}_${t}`]=G,_.selected=S.selected=new Set(G.map(B=>B.name))})}else _.selected=S.selected=new Set;_.renderItems(),S.updateSelectedItems()}document.querySelectorAll("#txt2img_prompt textarea, #img2img_prompt textarea, #txt2img_neg_prompt textarea, #img2img_neg_prompt textarea").forEach(u=>{u.addEventListener("input",M),u.addEventListener("focus",H)});function j(u,l){const x=S.subpaths,$=new Set(x.map(P=>P.relativePath)),T=Array.from($);let L=[{value:"None",textContent:"None"}],A;T.forEach(P=>{u.filename.includes(P)&&(A=P),L.push({value:P,textContent:P})});const U={local_preview:{type:"input",id:"local_preview_path",name:"local_preview",label:"Local Preview"},row:{type:"row",draw:"true",id:"parent_folder_select_row",label:"Parent Category / Filename",children:[{parent_folder:{type:"select",id:"parent_folder_select",value:A,options:L}},{save_path:{type:"input",id:"parent_folder_save",value:u.name,label:"Style Name"}}]},prompt:{type:"textarea",name:"prompt",label:"Prompt",rows:4},negative:{type:"textarea",name:"negative",label:"Negative Prompt",rows:2},description:{type:"textarea",name:"description",label:"Description",rows:2},tags:{type:"textarea",name:"tags",label:"Tags"}},O={filename:{type:"filename"},filesize:{type:"filesize"},type:{type:"text"},hash:{type:"text"},date_created:{type:"date-format"},date_modified:{type:"date-format"}},N={thumbnail:{type:"img",req:"/sd_styles/thumb/",showLabel:!1},replace_preview:{type:"button",label:"Replace Preview",showLabel:!1}},X="/sd_webui_ux/update_user_metadata",Y=document.getElementById("formContainer"),G=new Z(X,t,u,Y),B=G.createForm(U),de=G.createTable(O),ne=G.createHtmlElement(N),K=document.createElement("div");K.classList.add("non-editable-info","flexbox","padding","shrink"),K.appendChild(ne),K.appendChild(de),_.showDetail();const ve=s.parentElement.querySelector(".ae-virtual-detail-content");ve.innerHTML="",ve.appendChild(K),ve.appendChild(B);const be=B.querySelector("#parent_folder_select"),we=B.querySelector("#parent_folder_select_row label"),v=B.querySelector("#parent_folder_save"),p=B.querySelector("#local_preview_path input");let f;const g=P=>P.replace(/\/{2,}/g,"/"),q=P=>{const W=be.value!=="None"?be.value:"",fe=v.value,ge=`${W}/${fe}`;we.textContent=`Style will be saved: ${g(ge)}.png`,f=g(`${x[0].basePath}/${ge}.png`),p.value=f};be.addEventListener("change",q),v.addEventListener("input",q),q();function F(P){const W=P.lastIndexOf("/"),fe=P.substring(0,W),ge=P.substring(W+1),Ut=ge.lastIndexOf("."),Ft=ge.substring(0,Ut);return{path:fe,filename:ge,filename_no_ext:Ft}}let R;G.beforeFormSubmit=function(P){return P.name=F(f).filename_no_ext,P.filename=f,P.type="Style",P.sd_version="Unknown",P.id=u.id,R&&(P.source_file=R),P},G.afterFormSubmit=function(P){_.hideDetail();const W=F(f),fe=new Date().getTime();P.thumbnail=`${W.path}/thumbnails/${W.filename_no_ext}.thumb.webp`,P.timestamp=`?t=${fe}`,_.updateDataById(P,l),S.updateDataById(P,l)},ne.querySelector("button.replace_preview").addEventListener("click",P=>{const W=window.UIUX.FOCUS_PROMPT,fe=document.querySelector(`#${W}_gallery [data-testid="detailed-image"]`);if(fe){const ge=ne.querySelector(".thumbnail-image");R=fe.src.split("file=")[1].split("?")[0],ge.style.filter="grayscale(1)"}})}}function Vi(e){const t=document.querySelector("#logger_screen");t&&(document.querySelector("#container-console-log").append(getLoggerUiUx()),t.remove()),console.log("Finishing optimizations for Extra Networks"),Ii(),ki(),Li(),Ti(),document.querySelectorAll("#txt2img_styles_edit_button, #img2img_styles_edit_button").forEach(a=>{a.addEventListener("click",function(c){window.popup_trigger.click()})});function i(a){yt.FOCUS_PROMPT=a.includes("txt2img")?"txt2img":"img2img"}if(document.querySelectorAll("#txt2img_prompt textarea, #img2img_prompt textarea, #txt2img_neg_prompt textarea, #img2img_neg_prompt textarea").forEach(a=>{a.addEventListener("focus",c=>{const r=c.target.closest(".gradio-textbox").id;i(r)})}),document.querySelectorAll("#about_tabitem img").forEach(a=>{const c=a.getAttribute("data-src");c&&(a.src=c.replace("file=extensions/sd-webui-ux/assets/",`${Ge}`))}),window.UIUX=yt,je.setItem("UiUxComplete","true"),window.opts.uiux_enable_theme_editor&&Pi(),window.opts.uiux_enable_civitai_explorer){document.querySelector("#civitai_explorer_nav").classList.remove("hidden");const c=document.querySelector("#civitai_nav_images"),r=document.querySelector("#civitai_nav_models");c.addEventListener("click",()=>{Mi()},{once:!0}),r.addEventListener("click",()=>{Ni()},{once:!0})}const s=document.querySelector("#textual_inversion_nav"),n=document.querySelector("#lora_nav"),o=document.querySelector("#hypernetwork_nav");if(setTimeout(()=>{Ui()},500),s.addEventListener("click",()=>{Fi()},{once:!0}),n.addEventListener("click",()=>{Di()},{once:!0}),o.addEventListener("click",()=>{Ri()},{once:!0}),window.opts.uiux_enable_sd_styles){const a=document.querySelector("#sd_styles_nav");sd_styles_nav.classList.remove("hidden"),a.addEventListener("click",()=>{ji()},{once:!0})}}async function Wi(){const e=Ce(),t=ye();await Ht(),t.insertAdjacentElement("afterbegin",e);const i=fi((s,n)=>{s==="UiUxReady"&&n==="true"&&(Vi(),i())},"UiUxReady");(async()=>await Ot(e))(),ai(),setTimeout(()=>{Bt("#infinite_image_browsing_container_wrapper iframe",["user.css","uiux-iibrowser.css"])},3e3)}async function Gi(){try{ei(),console.log("Starting DOM Optimizations"),xi(),wi(),console.log("Finishing DOM Optimizations"),jt(Jt),pe.gradio_major>3&&Xt("style.css","style-gradio-4.css",document.body),(async()=>(await ni(),await Wi()))()}catch(e){console.error("Error in run sequence:",e)}}function Yi(){if(localStorage.setItem("UiUxReady","false"),localStorage.setItem("UiUxComplete","false"),!document.getElementById("logger_screen")){const i=document.createElement("div");i.id="logger_screen",i.style="position: fixed; inset: 0; background-color: black; z-index: 99999; display: flex; flex-direction: column; overflow:auto;";const s=document.createElement("div");s.id="loggerUiUx",i.append(s),document.body.append(i)}const e=new MutationObserver(async()=>{if(It()&&window.opts&&Object.keys(window.opts).length){e.disconnect();try{await Gi()}catch(s){console.error("Error running the function:",s)}}}),t=ye();t?e.observe(t,{childList:!0,subtree:!0}):console.error("getGradioApp() did not return a valid target for observation")}Yi();
