async function bi(e,t,n){const i=document.querySelector(n),s=`
        <button tabItemId="#split-app, #${e}_tabitem" 
                tabGroup="main_group" 
                data-click="#tabs" 
                onclick="mainTabs(this, '#${e}')" 
                class="xtabs-tab">
            <div class="icon-letters">${t.slice(0,2)}</div>
            <span>${t}</span>
        </button>`,o=document.createElement("div");o.innerHTML=s;const a=o.firstElementChild;i.append(a)}async function vi(e){const t=document.querySelector("#split-left"),n=`
        <div id="${e}_tabitem" class="xtabs-item other">
            <div data-parent-selector="gradio-app" data-selector="#${e} > div" class="portal"></div>
        </div>`,i=document.createElement("div");i.innerHTML=n;const s=i.firstElementChild;t.append(s)}async function Si(){let e=["tab_txt2img","tab_img2img","tab_extras","tab_pnginfo","tab_train","tab_modelmerger","tab_settings","tab_extensions","tab_deforum_interface","tab_infinite-image-browsing","tab_anapnoe_dock","tab_anapnoe_sd_uiux_core","tab_space","tab_anapnoe_sd_uiux_civitai","tab_anapnoe_sd_uiux_db_extra_networks","tab_anapnoe_sd_uiux_db_styles","tab_anapnoe_sd_uiux_db_output_images"];const t=document.querySelectorAll("#tabs > .tabitem");for(const n of t){const i=n.id,s=i.split("tab_")[1];!e.includes(i)&&!i.startsWith("tab_ui_theme")&&await Promise.all([bi(i,s,"#other_extensions"),vi(i)])}}function wi(e,t){const n=document.querySelector(e);if(n){const i=s=>{t.forEach(o=>{const a=document.querySelector(`link[rel="stylesheet"][href*="${o}"]`);if(a){const c=a.cloneNode();s.appendChild(c)}})};n.contentDocument.readyState==="complete"?i(n.contentDocument.head):n.addEventListener("load",s=>{i(s.target.contentDocument.head)},{once:!0})}}function an(e,t,n){for(const i of e)if(!t.querySelector(`link[rel="stylesheet"][href*="${On}${i}"]`)){const o=document.createElement("link");o.rel="stylesheet",o.href=`${On}${i}`,o.onload=()=>{console.log(`Stylesheet ${i} loaded successfully.`)},o.onerror=()=>{console.error(`Error loading stylesheet ${i}.`)},n?t.insertBefore(o,n.nextSibling):t.appendChild(o)}}function Ei(e){const t=document.body,n=t.querySelector('link[rel="stylesheet"][href*="sd-webui-ux"]');n?an(e,t,n):(an(e,t),console.warn("The sd-webui-ux/style.css is not found in the body."))}function xi(e,t,n){const s=Array.from(n.querySelectorAll(`link[rel="stylesheet"][href*="${e}"]`)).find(o=>o.href.includes("sd-webui-ux")&&o.href.includes(e));s?(an([t],n,s),s.parentNode.removeChild(s),console.log(`Removed existing stylesheet: ${e}`)):console.warn(`No existing stylesheet found: ${e}`)}const dn=window.basePath.includes("builtin"),un="anapnoe/stable-diffusion-webui-ux",Ti="AUTOMATIC1111/stable-diffusion-webui",Li="#anapnoe_app",Ci="0.1.0",Vn=window.basePath,Rt=`${Vn}assets/`,On=`${Rt}css/`,Yn=`${Rt}templates/`,Ai=`${Yn}uiux-gradio-3/`,Ii=`${Yn}forge-gradio-4/`,Zn={"template-deforum-params.html":"deforum","template-deforum-results.html":"deforum","template-stylez.html":"Stylez"},Pi=["uiux-icons.css","uiux-theme-editor.css","uiux-deforum.css","uiux-iibrowser.css","uiux-physton.css","uiux-virtual.css","uiux-tree.css","spotlight.css"];let jt=null;const st=()=>(jt||(jt=document.querySelector(Li)),jt);let Wt=null;const Kn=()=>(Wt||(Wt=document.getElementById("tab_anapnoe_sd_uiux_core")),Wt);let Gt=null;const Ye=()=>(Gt||(Gt=document.querySelector("gradio-app")),Gt);let Xt=null;const Jn=()=>(Xt||(Xt=document.getElementById("loggerUiUx")),Xt),We={};let xt=null;const Ni=()=>{if(!xt){const e=Ye().querySelector(".versions");if(!e){console.error("Versions element not found");return}xt=e.innerHTML.replace(Ti,un).replace(/\n/g,"").split("• "),xt.forEach(s=>{const[o,a]=s.split(":").map(c=>c.trim());o&&a&&(We[o]=a)});const n=We.version.split(".")[0].includes("f")?"forge":"AUTOMATIC1111",i=parseInt(We.gradio,10);We.variant=n,We.gradio_major=i}return xt};let Tt=null;const Qn=()=>(Tt||(Tt=Ai,We.gradio_major>3&&We.variant==="forge"&&(Tt=Ii)),Tt),mn=[{value:"SD1",textContent:"SD1"},{value:"SD2",textContent:"SD2"},{value:"SD3",textContent:"SD3"},{value:"SDXL",textContent:"SDXL"},{value:"PONY",textContent:"PONY"},{value:"FLUX",textContent:"FLUX"},{value:"Unknown",textContent:"Unknown"}];let ft;async function Oi(){(function(n){console.oldLog=console.log,console.oldWarn=console.warn,ft=function(i,s){return function(...o){const c=o.slice(0,10);let r="",p,m;for(r+=`
                <div class="log-row"><span class="log-date">${new Date().toLocaleString().replace(",","")}</span>`,m=0;m<c.length;m++){p=c[m];const g=p.toString().toLowerCase();let h="";g.indexOf("remove")!==-1||g.indexOf("error")!==-1?h+=" log-remove":g.indexOf("loading")!==-1||g.indexOf("| ref")!==-1||g.indexOf("initial")!==-1||g.indexOf("optimiz")!==-1||g.indexOf("python")!==-1||g.indexOf("success")!==-1?h+=" log-load":g.indexOf("[")!==-1&&(h+=" log-object"),p.toString().indexOf(".css")!==-1||p.toString().indexOf(".html")!==-1?h+=" log-url":p.toString().indexOf(`
`)!==-1&&(r+="<br />"),r+=`
                    <span class="log-${typeof p} ${h}">`,typeof p=="object"&&typeof JSON=="object"&&typeof JSON.stringify=="function"?r+=JSON.stringify(p):r+=p,r+=" </span>"}n.innerHTML+=r+"</div>",s.apply(void 0,c)}},console.log=ft("log",console.oldLog),console.warn=ft("warn",console.oldWarn)})(Jn()),console.log(`
`,"╔═╗╔═╦╦═╗╔═╦═╦╦═╦═╗",`
`,"║╬╚╣║║║╬╚╣╬║║║║╬║╩╣",`
`,"╚══╩╩═╩══╣╔╩╩═╩═╩═╝",`
`,"─────────╚╝"),console.log(`Initialize Anapnoe UI/UX runtime engine version ${Ci}`),console.log("UI/UX Backend Optimizations:",dn),console.log(navigator.userAgent),console.log(Ni()),console.log("Console log enabled: ",window.opts.uiux_enable_console_log),console.log("Dev Mode enabled: ",window.opts.uiux_enable_dev_mode),console.log("Theme editor enabled: ",window.opts.uiux_enable_theme_editor),console.log("Maximum resolution output: ",window.opts.uiux_max_resolution_output),console.log("Ignore overrides: ",window.opts.uiux_ignore_overrides),console.log("Show ticks for input range slider: ",window.opts.uiux_show_input_range_ticks),console.log("Default layout: ",window.opts.uiux_default_layout),console.log("Disable transitions: ",window.opts.uiux_disable_transitions),console.log("Aside labels: ",window.opts.uiux_show_labels_aside),console.log("Main labels: ",window.opts.uiux_show_labels_main),console.log("Tabs labels: ",window.opts.uiux_show_labels_tabs),console.log("Hide extra info for labels, checkboxes: ",window.opts.uiux_hide_extra_info),navigator.userAgent.toLowerCase().includes("firefox")&&console.log("Go to the Firefox about:config page, then search and toggle layout. css.has-selector. enabled"),window.opts.uiux_enable_console_log||(console.log=function(){});let t=document.querySelector("link[rel~='icon']");t||(t=document.createElement("link"),t.rel="icon",document.head.appendChild(t)),t.href=`${Rt}favicon.svg/`}function Mi(e){e?(console.log=ft("log",console.oldLog),console.warn=ft("warn",console.oldWarn)):console.log=function(){}}async function ki(e){const t=[];return e.querySelectorAll(".template:not([status])").forEach(n=>{const i={},s=n.getAttribute("url");i.url=s||Qn();const o=n.getAttribute("key");i.key=o||void 0;const a=n.getAttribute("template")||n.id;if(a)!dn&&a.includes("about")?i.template=`${a}-extension.html`:i.template=`${a}.html`;else{console.warn("Template not found on element:",n);return}i.id=n.id,i.extensionEnabled=$i(i.template),t.push(i)}),t}function $i(e){const t=Zn[e];return t?!!document.head.querySelector(`script[type="text/javascript"][src*="${t}"]`):!1}async function nt(e,t){const n=e[t],i=t<e.length;if(!n)return;let s;if(n.template in Zn&&!n.extensionEnabled){console.log(`Skipping loading for extension template ${n.template} (extension disabled)`),await nt(e,t+1);return}if(i){if(n!=null&&n.parent?s=n.parent:n!=null&&n.id&&(s=document.querySelector(`#${n.id}`)),s){const a=`${n.url}${n.template}`;try{const c=await fetch(a);if(c.ok){const r=await c.text(),p=document.createElement("div");if(n.key){const g=r.replace(/\s*\{\{.*?\}\}\s*/g,n.key);p.innerHTML=g}else p.innerHTML=r;const m=await ki(p);m.length>0&&(e=e.concat(m)),console.log("Template loaded",a),s.setAttribute("status","true"),s.append(p.firstElementChild),await nt(e,t+1)}else c.status===404&&(console.error("404 template:",a),s.setAttribute("status","error"),await nt(e,t+1))}catch(c){console.error("Error loading template:",c),s.setAttribute("status","error"),await nt(e,t+1)}}}else console.log("Template files merged successfully")}async function Di(){console.log("Loading Templates",We.gradio);const e=[{url:Qn(),template:"template-app-root.html",parent:Kn()}];await nt(e,0)}function Ge(e){if(e){const t=new Event("input",{bubbles:!0,cancelable:!0});e.dispatchEvent(t)}}function Ri(e){if(e){const t=new Event("change",{bubbles:!0,cancelable:!0});e.dispatchEvent(t)}}function zi(){const e=st();e.addEventListener("animationend",t=>{t.animationName==="fade-out"&&t.target.classList.add("hidden")}),e.addEventListener("animationstart",t=>{const n=e.classList.contains("notransition");t.animationName==="fade-out"?n&&t.target.classList.add("hidden"):t.animationName==="fade-in"&&t.target.classList.remove("hidden")})}const Ot=new WeakMap;function ei(e){if(!(e instanceof Element))return 0;let t=0;const n=Ot.get(e);if(n)for(const i in n)t+=n[i].size;for(const i of e.children)t+=ei(i);return t}(function(){const e=EventTarget.prototype.addEventListener,t=EventTarget.prototype.removeEventListener;EventTarget.prototype.addEventListener=function(n,i,s){typeof s>"u"&&(s=!1);const o=Ot.get(this)||{};o[n]||(o[n]=new Set),o[n].add(i),Ot.set(this,o),e.call(this,n,i,s)},EventTarget.prototype.removeEventListener=function(n,i,s){const o=Ot.get(this);o&&o[n]&&(o[n].delete(i),o[n].size===0&&delete o[n]),t.call(this,n,i,s)},window.countEventListeners=ei})();function it(e,t){const n=document.querySelector(`#pnginfo_send_buttons ${t}`),i=document.querySelector('#pnginfo_image input[type="file"]'),s=new DataTransfer;i.files=s.files,fetch(e).then(o=>o.blob()).then(o=>{const a=new File([o],"image.jpg",{type:o.type}),c=new DataTransfer;c.items.add(a),i.files=c.files,Ri(i),setTimeout(()=>{n.click()},1e3)}).catch(o=>console.error("Error fetching image:",o))}const Ie=typeof window<"u"?window:null,pn=Ie===null,gt=pn?void 0:Ie.document,Ne="addEventListener",Oe="removeEventListener",Vt="getBoundingClientRect",rt="_a",Me="_b",je="_c",Lt="horizontal",ke=()=>!1,Fi=pn?"calc":`${["","-webkit-","-moz-","-o-"].filter(e=>{const t=gt.createElement("div");return t.style.cssText=`width:${e}calc(9px)`,!!t.style.length}).shift()}calc`,ti=e=>typeof e=="string"||e instanceof String,Mn=e=>{if(ti(e)){const t=gt.querySelector(e);if(!t)throw new Error(`Selector ${e} did not match a DOM element`);return t}return e},_e=(e,t,n)=>{const i=e[t];return i!==void 0?i:n},Ct=(e,t,n,i)=>{if(t){if(i==="end")return 0;if(i==="center")return e/2}else if(n){if(i==="start")return 0;if(i==="center")return e/2}return e},Ui=(e,t)=>{const n=gt.createElement("div");return n.className=`gutter gutter-${t}`,n},qi=(e,t,n)=>{const i={};return ti(t)?i[e]=t:i[e]=`${Fi}(${t}% - ${n}px)`,i},Hi=(e,t)=>({[e]:`${t}px`}),Bi=(e,t={})=>{if(pn)return{};let n=e,i,s,o,a,c,r;Array.from&&(n=Array.from(n));const m=Mn(n[0]).parentNode,g=getComputedStyle?getComputedStyle(m):null,h=g?g.flexDirection:null;let T=_e(t,"sizes")||n.map(()=>100/n.length);const O=_e(t,"minSize",100),H=Array.isArray(O)?O:n.map(()=>O),P=_e(t,"maxSize",1/0),w=Array.isArray(P)?P:n.map(()=>P),f=_e(t,"expandToMin",!1),y=_e(t,"gutterSize",10),v=_e(t,"gutterAlign","center"),C=_e(t,"snapOffset",30),$=Array.isArray(C)?C:n.map(()=>C),j=_e(t,"dragInterval",1),x=_e(t,"direction",Lt),d=_e(t,"cursor",x===Lt?"col-resize":"row-resize"),u=_e(t,"gutter",Ui),b=_e(t,"elementStyle",qi),I=_e(t,"gutterStyle",Hi);x===Lt?(i="width",s="clientX",o="left",a="right",c="clientWidth"):x==="vertical"&&(i="height",s="clientY",o="top",a="bottom",c="clientHeight");function N(L,_,E,M){const B=b(i,_,E,M);Object.keys(B).forEach(ee=>{L.style[ee]=B[ee]})}function D(L,_,E){const M=I(i,_,E);Object.keys(M).forEach(B=>{L.style[B]=M[B]})}function F(){return r.map(L=>L.size)}function ne(L){return"touches"in L?L.touches[0][s]:L[s]}function se(L){const _=r[this.a],E=r[this.b],M=_.size+E.size;_.size=L/this.size*M,E.size=M-L/this.size*M,N(_.element,_.size,this[Me],_.i),N(E.element,E.size,this[je],E.i)}function me(L){let _;const E=r[this.a],M=r[this.b];this.dragging&&(_=ne(L)-this.start+(this[Me]-this.dragOffset),j>1&&(_=Math.round(_/j)*j),_<=E.minSize+E.snapOffset+this[Me]?_=E.minSize+this[Me]:_>=this.size-(M.minSize+M.snapOffset+this[je])&&(_=this.size-(M.minSize+this[je])),_>=E.maxSize-E.snapOffset+this[Me]?_=E.maxSize+this[Me]:_<=this.size-(M.maxSize-M.snapOffset+this[je])&&(_=this.size-(M.maxSize+this[je])),se.call(this,_),_e(t,"onDrag",ke)(F()))}function oe(){const L=r[this.a].element,_=r[this.b].element,E=L[Vt](),M=_[Vt]();this.size=E[i]+M[i]+this[Me]+this[je],this.start=E[o],this.end=E[a]}function ae(L){if(!getComputedStyle)return null;const _=getComputedStyle(L);if(!_)return null;let E=L[c];return E===0?null:(x===Lt?E-=parseFloat(_.paddingLeft)+parseFloat(_.paddingRight):E-=parseFloat(_.paddingTop)+parseFloat(_.paddingBottom),E)}function U(L){const _=ae(m);if(_===null||H.reduce((ee,te)=>ee+te,0)>_)return L;let E=0;const M=[],B=L.map((ee,te)=>{const ce=_*ee/100,q=Ct(y,te===0,te===L.length-1,v),Z=H[te]+q;return ce<Z?(E+=Z-ce,M.push(0),Z):(M.push(ce-Z),ce)});return E===0?L:B.map((ee,te)=>{let ce=ee;if(E>0&&M[te]-E>0){const q=Math.min(E,M[te]-E);E-=q,ce=ee-q}return ce/_*100})}function Y(){const L=this,_=r[L.a].element,E=r[L.b].element;L.dragging&&_e(t,"onDragEnd",ke)(F()),L.dragging=!1,Ie[Oe]("mouseup",L.stop),Ie[Oe]("touchend",L.stop),Ie[Oe]("touchcancel",L.stop),Ie[Oe]("mousemove",L.move),Ie[Oe]("touchmove",L.move),L.stop=null,L.move=null,_[Oe]("selectstart",ke),_[Oe]("dragstart",ke),E[Oe]("selectstart",ke),E[Oe]("dragstart",ke),_.style.userSelect="",_.style.webkitUserSelect="",_.style.MozUserSelect="",_.style.pointerEvents="",E.style.userSelect="",E.style.webkitUserSelect="",E.style.MozUserSelect="",E.style.pointerEvents="",L.gutter.style.cursor="",L.parent.style.cursor="",gt.body.style.cursor=""}function J(L){if("button"in L&&L.button!==0)return;const _=this,E=r[_.a].element,M=r[_.b].element;_.dragging||_e(t,"onDragStart",ke)(F()),L.preventDefault(),_.dragging=!0,_.move=me.bind(_),_.stop=Y.bind(_),Ie[Ne]("mouseup",_.stop),Ie[Ne]("touchend",_.stop),Ie[Ne]("touchcancel",_.stop),Ie[Ne]("mousemove",_.move),Ie[Ne]("touchmove",_.move),E[Ne]("selectstart",ke),E[Ne]("dragstart",ke),M[Ne]("selectstart",ke),M[Ne]("dragstart",ke),E.style.userSelect="none",E.style.webkitUserSelect="none",E.style.MozUserSelect="none",E.style.pointerEvents="none",M.style.userSelect="none",M.style.webkitUserSelect="none",M.style.MozUserSelect="none",M.style.pointerEvents="none",_.gutter.style.cursor=d,_.parent.style.cursor=d,gt.body.style.cursor=d,oe.call(_),_.dragOffset=ne(L)-_.end}T=U(T);const re=[];r=n.map((L,_)=>{const E={element:Mn(L),size:T[_],minSize:H[_],maxSize:w[_],snapOffset:$[_],i:_};let M;if(_>0&&(M={a:_-1,b:_,dragging:!1,direction:x,parent:m},M[Me]=Ct(y,_-1===0,!1,v),M[je]=Ct(y,!1,_===n.length-1,v),h==="row-reverse"||h==="column-reverse")){const B=M.a;M.a=M.b,M.b=B}if(_>0){const B=u(_,x,E.element);D(B,y,_),M[rt]=J.bind(M),B[Ne]("mousedown",M[rt]),B[Ne]("touchstart",M[rt]),m.insertBefore(B,E.element),M.gutter=B}return N(E.element,E.size,Ct(y,_===0,_===n.length-1,v),_),_>0&&re.push(M),E});function G(L){const _=L.i===re.length,E=_?re[L.i-1]:re[L.i];oe.call(E);const M=_?E.size-L.minSize-E[je]:L.minSize+E[Me];se.call(E,M)}r.forEach(L=>{const _=L.element[Vt]()[i];_<L.minSize&&(f?G(L):L.minSize=_)});function pe(L){const _=U(L);_.forEach((E,M)=>{if(M>0){const B=re[M-1],ee=r[B.a],te=r[B.b];ee.size=_[M-1],te.size=E,N(ee.element,ee.size,B[Me],ee.i),N(te.element,te.size,B[je],te.i)}})}function be(L,_){re.forEach(E=>{if(_!==!0?E.parent.removeChild(E.gutter):(E.gutter[Oe]("mousedown",E[rt]),E.gutter[Oe]("touchstart",E[rt])),L!==!0){const M=b(i,E.a.size,E[Me]);Object.keys(M).forEach(B=>{r[E.a].element.style[B]="",r[E.b].element.style[B]=""})}})}return{setSizes:pe,getSizes:F,collapse(L){G(r[L])},destroy:be,parent:m,pairs:re}};class ht{constructor(){return ht.instance||(this.splitInstances={},ht.instance=this),ht.instance}set(t){Object.assign(this.splitInstances,t)}get(){return this.splitInstances}}const fn=new ht;Object.freeze(fn);function ji(e){fn.set(e)}function Wi(){return fn.get()}async function Gi(e){const t=[];await Promise.all(Array.from(e.querySelectorAll("div.split")).map(async n=>{const i=n.id,s=e.querySelector(`#${i}`),o=(s==null?void 0:s.getAttribute("direction"))==="vertical"?"vertical":"horizontal",a=(s==null?void 0:s.getAttribute("gutterSize"))||"8",c=e.querySelectorAll(`#${i} > div.split-container`),r=Array.from(c).map(h=>{const T=h.getAttribute("data-initSize")?parseInt(h.getAttribute("data-initSize")):100/c.length,O=h.getAttribute("data-minSize")?parseInt(h.getAttribute("data-minSize")):1/0;return{id:`#${h.id}`,initSize:T,minSize:O}}),p=r.map(h=>h.id),m=r.map(h=>h.initSize),g=r.map(h=>h.minSize);console.log("Split component",p,m,g,o,a),t[i]=Bi(p,{sizes:m,minSize:g,direction:o,gutterSize:parseInt(a),snapOffset:0,dragInterval:1,elementStyle:(h,T,O)=>({"flex-basis":`calc(${T}% - ${O}px)`}),gutterStyle:(h,T)=>({"flex-basis":`${T}px`,"min-width":`${T}px`,"min-height":`${T}px`})})})),ji(t)}const $t={setItem:function(e,t){localStorage.setItem(e,t),this.notifyChange(e,t)},getItem:function(e){return localStorage.getItem(e)},removeItem:function(e){localStorage.removeItem(e),this.notifyChange(e,null)},notifyChange:function(e,t){const n=new CustomEvent("localStorageChange",{detail:{key:e,value:t}});window.dispatchEvent(n)}};function Xi(e,t){const n=$t.getItem(t);e(t,n);const i=s=>{e(s.detail.key,s.detail.value)};return window.addEventListener("localStorageChange",i),()=>{window.removeEventListener("localStorageChange",i)}}let Yt=0;function Vi(e,t){const n=e.querySelectorAll("td:last-child"),i=document.createElement("style");let s=1,o="";n.forEach((a,c)=>{const r=parseFloat(a.textContent.trim());if(a.id=`td_${c}`,!isNaN(r)){let p;c===0?(s=r,p=100):p=r/s*100,o+=`#td_${c}::before { min-width: ${p}%; }`}}),i.textContent=o,t.appendChild(i)}function Yi(e,t){e.querySelectorAll(`${t}, style`).forEach(i=>{e.removeChild(i)})}function Zi(e,t){const n=e.getAttribute("append-index");Array.from(e.children).forEach(s=>{if(s!==t)if(t.className.includes("gradio-accordion"))if(n){const o=parseInt(n,10);let a=t.children[2].children[o];t.children[2].insertBefore(s,a)}else t.children[2].append(s);else t.append(s)})}async function hn(e,t,n=0,i,s,o=!1){var m;const a=e.getAttribute("data-selector"),c=e.getAttribute("data-parent-selector");let r;if(n%2===0?r=document.querySelector(`${c} ${a}`):r=t.querySelector(`${a}`),r&&e){e.classList.contains("dynamic")&&(Yi(e,a),a.includes("popup-table")&&Vi(r,e)),e.append(r),o&&Yt++,console.log("register | Ref",i,c,a),e.getAttribute("droppable")&&Zi(e,r);const h=e.getAttribute("show-button");h&&((m=document.querySelector(h))==null||m.classList.remove("hidden"))}else if(n<2){const g=e.getAttribute("data-timeout"),h=g?parseInt(g):500;await new Promise(T=>setTimeout(T,h)),console.log(n+1,"retry | ",h," | Ref",i,c,a),await hn(e,t,n+1,i,s,o)}else e.classList.contains("dynamic")?console.error("error | Ref",i,c,a):console.warn("dynamic | Ref",i,c,a),o&&Yt++;Yt===s&&o&&$t.getItem("UiUxReady")==="false"&&(console.log("Runtime components initialized"),$t.setItem("UiUxReady","true"))}async function Ki(e){await Promise.all(Array.from(e.querySelectorAll(".portal:not(.dynamic)")).map(async(t,n,i)=>{hn(t,e,0,n,i.length,!0)}))}async function Ji(e){const t=st();await Promise.all(Array.from(e.querySelectorAll(".xtabs-tab")).map(async i=>{if(i.addEventListener("click",()=>{const o=i.parentElement,a=i.getAttribute("tabGroup");i.getAttribute("data-click");const c=i.getAttribute("toggle"),r=i.classList.contains("active");function p(m){m.classList.remove("active");const g=m.getAttribute("tabItemId");t.querySelectorAll(g).forEach(h=>{h.classList.remove("fade-in"),h.classList.add("fade-out")})}if((!c||c&&r)&&(a?t.querySelectorAll(`[tabGroup="${a}"]`).forEach(m=>{m.classList.contains("active")&&p(m)}):o&&[].slice.call(o.children).forEach(g=>{g.classList.contains("active")&&p(g)})),!c||c&&!r){const m=i.getAttribute("tabItemId");t.querySelectorAll(m).forEach(g=>{g.classList.remove("fade-out"),g.classList.add("fade-in"),g.querySelectorAll(".portal.dynamic").forEach((h,T,O)=>{hn(h,document,0,T,O.length)})}),i.classList.add("active"),n(i)}}),!i.getAttribute("active")){const o=i.getAttribute("tabItemId");t.querySelectorAll(o).forEach(a=>{a.classList.remove("fade-in"),a.classList.add("fade-out")})}})),await Promise.all(Array.from(e.querySelectorAll(".xtabs-tab[active]")).map(async i=>{i.classList.add("active");const s=i.getAttribute("tabItemId");i.getAttribute("data-click"),t.querySelectorAll(s).forEach(o=>{o.classList.remove("fade-out"),o.classList.add("fade-in")}),n(i)}));function n(i,s,o){const a=i.closest(".accordion-bar");if(a){const c=a.parentElement;if(c.className.indexOf("expand")===-1){let r=a;const p=c.getAttribute("iconTrigger");if(p){const m=e.querySelector(p);m&&(r=m)}r.click()}}}}const kn={DEFAULT_PATH:Vn,FOCUS_PROMPT:"txt2img",loadCurrentTemplate:nt,initUiUxComponents:ni};async function Qi(){document.head.querySelectorAll(`
        [rel="stylesheet"][href*="/assets/"],
        [rel="stylesheet"][href*="theme.css"],
        [rel="stylesheet"][href*="index"]`).forEach(i=>{i.remove(),console.log("Remove stylesheet",i.getAttribute("href"))}),document.body.querySelectorAll(`
        [rel="stylesheet"][href*="file=style.css"]`).forEach(i=>{i.remove(),console.log("Remove stylesheet",i.getAttribute("href"))});const e=document.querySelectorAll('.styler, [class*="svelte"]:not(input)'),t=e.length;let n=0;e.forEach(i=>{i.style.display!=="none"&&i.style.display!=="block"&&(i.removeAttribute("style"),n++),[...i.classList].filter(s=>s.match(/^svelte.*/)).forEach(s=>i.classList.remove(s))}),console.log("Remove inline styles from DOM","Total Selectors:",t,"Removed Selectors:",n)}async function es(){var e,t,n,i,s,o,a,c;if(!dn){const r=Ye();console.log("Remove Extra Networks Instances"),(e=r.querySelector("#img2img_textual_inversion_cards_html"))==null||e.remove(),(t=r.querySelector("#img2img_checkpoints_cards_html"))==null||t.remove(),(n=r.querySelector("#img2img_hypernetworks_cards_html"))==null||n.remove(),(i=r.querySelector("#img2img_lora_cards_html"))==null||i.remove(),(s=r.querySelector("#txt2img_textual_inversion_cards_html"))==null||s.remove(),(o=r.querySelector("#txt2img_checkpoints_cards_html"))==null||o.remove(),(a=r.querySelector("#txt2img_hypernetworks_cards_html"))==null||a.remove(),(c=r.querySelector("#txt2img_lora_cards_html"))==null||c.remove(),console.log("Remove element #img2img_textual_inversion_cards_html"),console.log("Remove element #img2img_checkpoints_cards_html"),console.log("Remove element #img2img_hypernetworks_cards_html"),console.log("Remove element #img2img_lora_cards_html"),console.log("Remove element #txt2img_textual_inversion_cards_html"),console.log("Remove element #txt2img_checkpoints_cards_html"),console.log("Remove element #txt2img_hypernetworks_cards_html"),console.log("Remove element #txt2img_lora_cards_html")}}async function ts(e){await Promise.all(Array.from(e.querySelectorAll(".ae-button")).map(async t=>{const n=t.getAttribute("toggle"),i=t.getAttribute("active"),s=t.querySelector("input");s&&(s.checked===!0&&!i||s.checked===!1&&i)&&s.click(),i?t.classList.add("active"):t.classList.remove("active"),n&&t.addEventListener("click",o=>{const a=t.querySelector("input");a?(a.click(),a.checked===!0?t.classList.add("active"):a.checked===!1&&t.classList.remove("active")):t.classList.toggle("active")})}))}async function ns(e){const t=Wi();await Promise.all(Array.from(e.querySelectorAll(".accordion-bar")).map(async n=>{const i=n.parentElement,s=i.closest(".split-container");let o=n;const a=i.getAttribute("iconTrigger");if(a){const c=e.querySelector(a);c&&(o=c,n.classList.add("pointer-events-none"))}if(i.className.indexOf("accordion-vertical")!==-1&&s.className.indexOf("split")!==-1){i.classList.add("expand");const c=s.parentElement.id,r=t[c];s.setAttribute("data-sizes",JSON.stringify(r.getSizes())),o==null||o.addEventListener("click",()=>{if(i.classList.toggle("expand"),s.className.indexOf("v-expand")!==-1)s.classList.remove("v-expand"),r.setSizes(JSON.parse(s.getAttribute("data-sizes")));else{s.classList.add("v-expand");let p=r.getSizes();s.setAttribute("data-sizes",JSON.stringify(p)),console.log(p),p[p.length-1]=0,p[p.length-2]=100;const m=parseFloat(window.getComputedStyle(n,null).getPropertyValue("padding-left"))*2;s.style.minWidth=n.offsetWidth+m+"px",r.setSizes(p)}})}else o==null||o.addEventListener("click",()=>{i.classList.toggle("expand")})}))}async function ni(e){var n;await Gi(e),await Ki(e),await ns(e),await Ji(e),await ts(e),document.querySelector("#container-console-log").append(Jn()),(n=document.querySelector("#logger_screen"))==null||n.remove()}async function is(e=un,t=1){return await(await fetch(`https://api.github.com/repos/${e}/contributors?per_page=100&page=${t}`,{method:"GET",headers:{"Content-Type":"application/json"}})).json()}async function ii(e=un,t=1,n=[]){const i=await is(e,t);return n=n.concat(i),i.length===100?ii(e,t+1,n):n}function ss(){const e=document.querySelector("#contributors"),t=document.querySelector("#contributors_tabitem"),n=document.createElement("div");n.id="contributors_grid",n.innerHTML=`Kindly allow us a moment to retrieve the contributors. 
    We're grateful for the many individuals who have generously put their time and effort to make this possible.`,t.append(n),e.addEventListener("click",i=>{e.getAttribute("data-visited")||(e.setAttribute("data-visited","true"),ii().then(o=>{n.innerHTML="";for(let a=0;a<o.length;a++){const c=o[a].login,r=o[a].html_url,p=o[a].avatar_url;n.innerHTML+=`
                        <a href="${r}" target="_blank" rel="noopener noreferrer nofollow" class="contributor-button flexbox col">
                            <figure><img src="${p}" lazy="true"></figure>
                            <div class="contributor-name">
                                ${c}
                            </div>
                        </a>`}}))})}async function si(e,t){try{const n=await fetch(e);if(!n.ok)throw new Error(`HTTP error! Status: ${n.status}`);const i=await n.json();t(i)}catch(n){console.error("Failed to fetch metadata:",n)}}async function Ue(e,t,n){try{const i=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!i.ok)throw new Error(`HTTP error! Status: ${i.status}`);const s=await i.json();n(s)}catch(i){console.error("Failed to fetch data:",i)}}const $n=()=>window.innerWidth<=768,At=e=>{var n;const t=st();t.querySelectorAll("[mobile]").forEach(i=>{if(e){if(i.childElementCount===0){const s=i.getAttribute("mobile");if(s){const o=t.querySelector(s);o&&(i.setAttribute("mobile-restore",`#${o.parentElement.id}`),i.append(o))}}}else if(i.childElementCount>0){const s=i.getAttribute("mobile-restore");if(s){const o=t.querySelector(s);o&&o.append(i.firstElementChild)}}}),e?((n=t.querySelector(".accordion-vertical.expand #mask-icon-acc-arrow"))==null||n.click(),t.classList.add("default-mobile")):t.classList.remove("default-mobile")},os=()=>{const e=st(),t=window.opts.uiux_default_layout;e.classList.add(`default-${t.toLowerCase()}`),t==="Auto"?(window.addEventListener("resize",n=>{At($n())}),At($n())):At(t==="Mobile")};function as(){const e=st(),t=Ye();if(!e||!t){console.warn(`Required elements not found: ${e?"":"anapnoeApp"} ${t?"":"gradioApp"}`);return}t.querySelector("#setting_uiux_mobile_scale input[type=range]").classList.add("hidden");const i=t.querySelector("#setting_uiux_mobile_scale input[type=number]");function s(f){document.head.querySelector('meta[name="viewport"]').setAttribute("content",`width=device-width, initial-scale=1, shrink-to-fit=no, maximum-scale=${f}`)}i.addEventListener("change",f=>{i.value=f.target.value,Ge(i),s(f.target.value)}),s(window.opts.uiux_mobile_scale);function o(f){t.querySelectorAll('[id$="2img_width"] input,[id$="2img_height"] input').forEach(y=>{y.max=f})}t.querySelector("#setting_uiux_max_resolution_output").addEventListener("input",f=>{let y=parseInt(f.target.value);y=Math.min(Math.max(y,512),16384),o(y)}),o(window.opts.uiux_max_resolution_output);function a(f){f.forEach(y=>{const v=y.step/(y.max-y.min)*100,C=`max(3px, calc(${v}% - 1px))`,$=`max(4px, calc(${v}% + 0px))`;y.style.setProperty("--ae-slider-bg-overlay",`repeating-linear-gradient(90deg, transparent, transparent ${C}, var(--ae-input-border-color) ${C}, var(--ae-input-border-color) ${$})`)})}function c(f,y){const C=t.querySelectorAll("input[type='range']");f?a(C):y&&C.forEach($=>{$.style.setProperty("--ae-slider-bg-overlay","transparent")})}t.querySelector("#setting_uiux_show_input_range_ticks input").addEventListener("click",f=>{c(f.target.checked,!0)}),c(window.opts.uiux_show_input_range_ticks);function p(){const f=Array.from(t.querySelectorAll("#setting_uiux_ignore_overrides input:checked")).map(v=>v.nextElementSibling.innerHTML);t.querySelectorAll("[id$='2img_override_settings'] .token").forEach(v=>{var j;const[C,$]=v.querySelector("span").textContent.split(":").map(x=>x.trim());f.includes(C)&&(t.querySelector("[id$='2img_override_settings']").classList.add("show"),(j=v.querySelector(".token-remove"))==null||j.click())})}t.querySelector("#setting_uiux_ignore_overrides").addEventListener("click",()=>{setTimeout(p,100)});const m=new MutationObserver(f=>{f.forEach(y=>{y.type==="attributes"&&y.attributeName==="class"&&setTimeout(p,1e3)})}),g=new MutationObserver(f=>{f.forEach(y=>{y.addedNodes.length&&setTimeout(p,1e3)})});document.querySelectorAll("#txt2img_override_settings .wrap-inner, #img2img_override_settings .wrap_inner").forEach(f=>g.observe(f,{childList:!0})),document.querySelectorAll("#txt2img_nav, #img2img_nav").forEach(f=>m.observe(f,{attributes:!0}));function O(f,y){const v=t.querySelector(`${f} input`);if(v){const C=f.split("#setting_")[1],$=window.opts[C];e.classList.toggle(y,$),localStorage.setItem(C,$),v.addEventListener("click",j=>{localStorage.setItem(C,j.target.checked),e.classList.toggle(y,j.target.checked),C==="uiux_enable_console_log"&&Mi(j.target.checked)})}}const H=[{key:"#setting_uiux_no_slider_layout",className:"no-slider-layout"},{key:"#setting_uiux_show_labels_aside",className:"aside-labels"},{key:"#setting_uiux_show_labels_main",className:"main-labels"},{key:"#setting_uiux_show_labels_tabs",className:"tab-labels"},{key:"#setting_uiux_hide_extra_info",className:"no-extra-info"},{key:"#setting_uiux_disable_transitions",className:"notransition"},{key:"#setting_uiux_enable_console_log",className:"debug-log"}];for(const{key:f,className:y}of H)O(f,y);function P(f,y){e.style.setProperty(f,y)}const w=["#setting_uiux_exnet_fit_size","#setting_uiux_exnet_aspect_ratio_x","#setting_uiux_exnet_aspect_ratio_y","#setting_uiux_exnet_header_size","#setting_uiux_min_wrap_size","#setting_uiux_exnet_image_tint"];for(const f of w){const y=document.querySelector(`${f} input[type=number]`),v=document.querySelector(`${f} input[type=range]`);if(v&&v.classList.add("hidden"),y){const C=f.split("#setting_")[1],$=`--ae-${C}`,j=window.opts[C];P($,j),y.addEventListener("change",x=>{Ge(y),P($,x.target.value)})}}}function rs(){["#txt2img","#img2img","#deforum"].forEach(t=>{var i;const n=document.querySelector(`${t}_generate`);if(n){(i=document.querySelector(`${t}_nav`))==null||i.classList.remove("hidden");const s=document.querySelector(`${t}_interrupt`),o=s.closest(".portal"),a=n.closest(".ae-button"),c=document.querySelector(`${t}_skip`).closest(".portal"),r=document.querySelector(`${t}_loop`);s.addEventListener("click",()=>{r==null||r.classList.add("stop")}),new MutationObserver(m=>{m.forEach(g=>{s.style.display==="none"?(document.querySelector(".progressDiv .progress")&&(o.classList.remove("disable"),setTimeout(()=>s.click(),500)),r?r.className.indexOf("stop")!==-1||r.className.indexOf("active")===-1?(r.classList.remove("stop"),o.classList.add("disable"),c==null||c.classList.add("disable"),a.classList.remove("active")):r.className.indexOf("active")!==-1&&n.click():(o.classList.add("disable"),a.classList.remove("active"))):(o.classList.remove("disable"),c==null||c.classList.remove("disable"),a.classList.add("active"))})}).observe(s,{attributes:!0,attributeFilter:["style"]})}})}function ls(e,t){const n=document.querySelector("#setting_sd_model_checkpoint .wrap .secondary-wrap input")||document.querySelector(".gradio-dropdown.model_selection .wrap .secondary-wrap input"),i=document.querySelector("#setting_sd_model_checkpoint .wrap")||document.querySelector(".gradio-dropdown.model_selection .wrap"),s=document.querySelector("#checkpoints_main_footer_db .model-selected");document.querySelector("#checkpoints_main_footer_db .model-preloader").append(i);let a="";const c=p=>{if(a!==p){const m=p.split(".").slice(0,-1).join();e.selected=t.selected=new Set([m]),e.renderItems(),t.updateSelectedItems(),s.textContent=p,console.log("Checkpoint:",p,m),a=p}};c(n.value);const r=new MutationObserver(function(p){p.forEach(function(m){setTimeout(()=>c(n.value),1e3)})});r.observe(n,{attributes:!0}),r.observe(i,{childList:!0,subtree:!0})}function yt(e,t,n,i=null){return Object.keys(e).forEach(s=>{const o=document.querySelector(`${s}`);if(o){const a=e[s],c=o.tagName==="SELECT"&&o.multiple||o.tagName==="SELECT"||o.type==="checkbox"||o.type==="radio"||o.type!=="range"&&o.type!=="color"&&o.type!=="text"?"change":"input",r=()=>{let p;o.tagName==="SELECT"&&o.multiple?(p=Array.from(o.selectedOptions).map(g=>g.value),t[a]=p):o.type==="checkbox"||o.type==="radio"?p=o.checked:p=o.value;const m=i?i({[a]:p}):{[a]:p};n.updateParamsAndFetch(m,1e3)};o.addEventListener(c,r)}else console.warn(`Input element with id ${s} not found.`)}),t}function Dn(e){let t=e.startsWith("#")?e.slice(1):e,n=1;if(t.length===8?(n=parseInt(t.slice(6,8),16)/255,t=t.slice(0,6)):t.length===3&&(t=t.split("").map(s=>s+s).join("")),t.length!==6)throw new Error("Invalid HEX color.");const i=t.match(/.{2}/g).map(s=>parseInt(s,16));return i.push(n),i}function Mt(e){const t=e[0]/255,n=e[1]/255,i=e[2]/255,s=Math.max(t,n,i),o=Math.min(t,n,i),a=s-o,c=s+o,r=o===s?0:t===s?(60*(n-i)/a+360)%360:n===s?60*(i-t)/a+120:60*(t-n)/a+240,p=.5*c,m=p===0?0:p===1?1:p<=.5?a/c:a/(2-c),g=e.length===4?e[3]:1;return[Math.round(r),Math.round(m*100),Math.round(p*100),g]}function rn(e,t,n,i=1){n/=100;const s=(i*255|256).toString(16).slice(1),o=a=>{const c=(a+e/30)%12,r=n-t*Math.min(n,1-n)/100*Math.max(Math.min(c-3,9-c,1),-1);return Math.round(255*Math.max(0,Math.min(r,1))).toString(16).padStart(2,"0")};return`#${o(0)}${o(8)}${o(4)}${s}`}function Rn(e){e.startsWith("#")&&(e=e.slice(1));let t=1;if(e.length===8&&(t=parseInt(e.slice(6,8),16)/255,e=e.slice(0,6)),e.length===3&&(e=e.split("").map(o=>o+o).join("")),e.length!==6)throw new Error("Invalid HEX color.");const n=(255-parseInt(e.slice(0,2),16)).toString(16),i=(255-parseInt(e.slice(2,4),16)).toString(16),s=(255-parseInt(e.slice(4,6),16)).toString(16);return`#${It(n)}${It(i)}${It(s)}${It(Math.round(t*255).toString(16))}`}function It(e,t=2){return(new Array(t).join("0")+e).slice(-t)}const Ce={};let _t,lt=[0,0,0,0];const Dt=e=>e.match(/[\d.]+/g).map(Number);function cs(e,t,n,i){let s;if(n.includes("#")){let m=n.replace(/\s+/g,"");_t&&(m=Rn(m),Ce[t]=m),s=Mt(Dn(m))}else if((n.includes("hsl")||n.includes("rgb"))&&(s=n.includes("rgb")?Mt(Dt(n)):Dt(n),_t)){const m=rn(s[0],s[1],s[2],s[3]);Ce[t]=Rn(m),s=Mt(Dn(Ce[t]))}const o=((Number(s[0])||0)+(Number(i[0])||0))%360,a=Math.min(Math.max((Number(s[1])||0)+(Number(i[1])||0),0),100),c=Math.min(Math.max((Number(s[2])||0)+(Number(i[2])||0),0),100),r=Math.min(Math.max((Number(s[3])||1)+(Number(i[3])||0),0),1),p=rn(o,a,c,r).slice(0,-2);return e.value=p,`hsla(${o}, ${a}%, ${c}%, ${r})`}function Zt(e){let t="";for(const s in Ce){const o=Ce[s];if(s!=""&&o&&o.length>0){const a=document.body.querySelector(`#${s} input`)||document.body.querySelector(`#${s} textarea`);if(a)if((a.type||"text")==="color"){const r=cs(a,s,o,e);t+=`${s}:${r};`}else t+=`${s}:${Ce[s]};`}}_t=!1;const n=document.body.querySelector("#preview-styles");n.innerHTML=`:root {${t}}`,n.innerHTML+="@media only screen and (max-width: 860px) { :root { --ae-outside-gap-size: var(--ae-mobile-outside-gap-size); --ae-inside-padding-size: var(--ae-mobile-inside-padding-size); } }";const i=document.body.querySelector("#theme_vars textarea");i.value=t,window.updateInput(i)}function Kt(e){let t="";for(let o=0;o<e.length-1;o++){const[a,c]=e[o].split(":").map(m=>m.trim()),r=a.replace(/\s+/g,"");Ce[r]=c,t+=`${r}:${c};`,document.body.querySelectorAll(`#${r} input, #${r} textarea`).forEach(m=>{const g=m.type||"text";if(g==="color")if(c.includes("hsl")||c.includes("rgb")){let h;c.includes("rgb")?h=Mt(Dt(c)):h=Dt(c),m.value=rn(h[0],h[1],h[2],h[3]).slice(0,-2)}else m.value=c;else g==="number"||g==="range"?m.value=parseFloat(c)||0:(g==="textarea"||g==="text")&&(m.value=c)})}const n=document.body.querySelector("#preview-styles");if(n)n.innerHTML=`:root {${t}}`,n.innerHTML+="@media only screen and (max-width: 860px) { :root { --ae-outside-gap-size: var(--ae-mobile-outside-gap-size); --ae-inside-padding-size: var(--ae-mobile-inside-padding-size); } }";else{const o=document.createElement("style");o.id="preview-styles",o.innerHTML=`:root {${t}}`,o.innerHTML+="@media only screen and (max-width: 860px) { :root { --ae-outside-gap-size: var(--ae-mobile-outside-gap-size); --ae-inside-padding-size: var(--ae-mobile-inside-padding-size); } }",document.body.appendChild(o)}const i=document.body.querySelector("#theme_vars textarea"),s=document.body.querySelector("#theme_css textarea");i.value=t,window.updateInput(i),window.updateInput(s)}function ds(e){const t=e.split("/*BREAKPOINT_CSS_CONTENT*/");let n=t[0].split("}")[0].split("{")[1].replace(/\n|\r/g,"");n=n.replace(/;+/,";").trim();const i=n.split(";"),s=document.body.querySelector("#theme_vars textarea"),o=document.body.querySelector("#theme_css textarea");s.value=n,window.updateInput(s);const a=t[1]!==void 0?t[1]:"";o.value=`/*BREAKPOINT_CSS_CONTENT*/${a}/*BREAKPOINT_CSS_CONTENT*/`,Kt(i);const c=document.body.querySelector("#preview-styles");if(!c){const P=document.createElement("style");P.id="preview-styles",P.innerHTML=e,document.body.appendChild(P)}let r;function p(P){let w=P.value,f=P.parentElement,y=P.type||"text";y==="range"||y==="number"?(f=P.closest(".gradio-slider")||P.closest(".gradio-number"),w+=f.id.indexOf("angle")!==-1?"deg":f.id.indexOf("slider-height")===-1?"px":"",Ce[f.id]=w):y==="color"?(f=P.closest(".gradio-colorpicker"),Ce[f.id]=w):y==="textarea"?(f=P.closest(".gradio-textbox"),w.length>0?Ce[f.id]=w:delete Ce[f.id]):y==="text"&&(f=P.closest(".gradio-dropdown"),f&&(Ce[f.id]=w)),r!=null&&clearInterval(r),r=setTimeout(()=>{let v=Object.entries(Ce).map(([C,$])=>`${C}:${$};`).join("");s.value=v,c.innerHTML=`:root {${v}}@media only screen and (max-width: 860px) { :root { --ae-outside-gap-size: var(--ae-mobile-outside-gap-size); --ae-inside-padding-size: var(--ae-mobile-inside-padding-size); } }`,window.updateInput(s),Zt(lt)},1e3)}document.body.querySelectorAll("#ui_theme_settings input, #ui_theme_settings textarea").forEach(P=>{P.addEventListener("input",w=>{p(w.currentTarget)})});const m=new MutationObserver(P=>{P.forEach(w=>{w.removedNodes.forEach(f=>{f.nodeType===1&&f.matches("ul")&&p(w.target.querySelector(".secondary-wrap input"))})})});document.body.querySelectorAll("#ui_theme_settings .gradio-dropdown").forEach(P=>{m.observe(P,{childList:!0,subtree:!0})}),document.getElementById("theme_reset_btn").addEventListener("click",P=>{P.preventDefault(),document.body.querySelectorAll("#ui_theme_hsv input").forEach(w=>{w.value=0}),lt=[0,0,0],Kt(i)});let h;function T(){if(n!==s.value){clearInterval(h),n=s.value.replace(/\n|\r/g,""),n=n.split(":root{")[0],s.value=n;const P=n.split(";");Kt(P)}}document.body.querySelector("#themes_drop_down input").addEventListener("click",P=>{h!==null&&clearInterval(h),s.value=n,h=setInterval(T,500)}),document.body.querySelectorAll("#theme_hue input, #theme_sat input, #theme_brt input").forEach((P,w)=>{P.addEventListener("change",f=>{f.preventDefault(),lt[Math.floor(w/2)]=f.currentTarget.value,Zt(lt)})}),document.getElementById("theme_invert_btn").addEventListener("click",P=>{P.preventDefault(),_t=!_t,Zt(lt)})}function zn(e){var i;const n=(i=Array.from(e.sheet.cssRules).filter(s=>s instanceof CSSStyleRule&&s.selectorText===":root")[0])==null?void 0:i.cssText;n&&ds(n)}function us(){const e=document.querySelector('[rel="stylesheet"][href*="user"]');if(Ye().querySelector('[id^="tab_ui_theme"]')&&e){zn(e);return}const n=new MutationObserver(()=>{const i=document.querySelector('[rel="stylesheet"][href*="user"]');if(Ye().querySelector('[id^="tab_ui_theme"]'))if(i)n.disconnect(),setTimeout(()=>{zn(i)},500);else{var o=document.createElement("link");o.rel="stylesheet",o.type="text/css",o.href="./file=user.css",document.head.appendChild(o)}});n.observe(Ye(),{childList:!0,subtree:!0})}function A(e,t,n=10,i={title:"username",url:"url"},s="",o={},a="POST"){this.container=e,this.originalData=t,this.data=t,this.itemsPerPage=n,this.optItemsPerPage=n,this.limit=o.limit,this.apiUrl=s,this.method=a,this.params=o,this.keys=i,this.startIndex=0,this.renderedItems={},this.lastScrollPos=0,this.isFetching=!1,this.useDataFetching=!0,this.isInit=!1,this.resolvedRenderMethod=this.renderItems,this.selected,this.smoothScrolling=!0,this.activePointers={},this.zoom_scale=1,this.scrollDelta=0,this.x=this.y=0,this.isTouchDevice="ontouchstart"in window||navigator.maxTouchPoints>0||/Mobi|Android/i.test(navigator.userAgent),console.log(" this.isTouchDevice",this.isTouchDevice),this.createContainer(),this.createSentinels(),this.createDetail(),this.setLayout("vertical"),this.initialize()}A.prototype.initialize=function(){(!this.apiUrl||this.apiUrl.includes(".json"))&&(this.useDataFetching=!1),this.isInit?this.data.length>0?(this.itemsWrapper.classList.remove("hidden"),this.renderItems(),this.updateDimensions(!0)):this.itemsWrapper.classList.add("hidden"):this.data.length>0&&(this.isInit=!0,this.resolvedRenderMethod(),this.setupEventListeners(),this.setupResizeObserver(),this.updateDimensions())};A.prototype.setFullSize=function(e){this.isFullSize=e,e?this.container.classList.add("full"):this.container.classList.remove("full")};A.prototype.setTileable=function(e){this.isTileable=e,e?this.container.classList.add("tileable"):this.container.classList.remove("tileable")};A.prototype.setInfo=function(e){this.isInfo=e,e?this.container.classList.add("info"):this.container.classList.remove("info")};A.prototype.setFullScreen=function(e){this.isFullScreen=e,e?this.container.requestFullscreen&&(this.container.parentElement.requestFullscreen(),this.container.classList.add("fullscreen")):document.exitFullscreen&&(document.exitFullscreen(),this.container.classList.remove("fullscreen"))};A.prototype.setLayout=function(e){e==="horizontal"?(this.direction="horizontal",this.translateProp="translateX",this.scrollProp="scrollLeft",this.client="clientX",this.scrollSize="scrollWidth",this.container.classList.remove("vertical"),this.container.classList.add("horizontal")):(this.direction="vertical",this.translateProp="translateY",this.scrollProp="scrollTop",this.client="clientY",this.scrollSize="scrollHeight",this.container.classList.remove("horizontal"),this.container.classList.add("vertical"))};A.prototype.createContainer=function(){this.container.classList.add("ae-virtual","visible",this.direction||"vertical"),this.itemsWrapper=document.createElement("div"),this.itemsWrapper.classList.add("ae-virtual-wrapper"),this.container.appendChild(this.itemsWrapper)};A.prototype.createSentinel=function(){const e=document.createElement("div");return e.classList.add("sentinel"),e};A.prototype.createSentinels=function(){this.minSentinel=this.createSentinel(),this.maxSentinel=this.createSentinel(),this.totalSizeSentinel=this.createSentinel(),this.container.append(this.minSentinel,this.maxSentinel,this.totalSizeSentinel)};A.prototype.createDetail=function(){this.detail=document.createElement("div"),this.detail.className="ae-virtual-detail";const e=document.createElement("button");e.className="ae-button close";const t=document.createElement("div");t.className="mask-icon icon-cancel",e.appendChild(t),this.detail.appendChild(e);const n=document.createElement("div");n.className="ae-virtual-detail-content",this.detail.appendChild(n),this.container.parentElement.appendChild(this.detail),e.addEventListener("click",this.hideDetail.bind(this)),this.hideDetail()};A.prototype.createItemElement=function(e,t){const n=document.createElement("div");n.className="item card";const i=e[this.keys.url];i&&(n.style.backgroundImage=`url(${i})`);const s=document.createElement("span");return s.textContent=e[this.keys.title],s.className="title",n.appendChild(s),n};A.prototype.getItemsToRender=function(){const e=Math.max(0,this.startIndex),t=Math.min(this.data.length,this.startIndex+this.itemsPerPage);return this.data.slice(e,t)};A.prototype.renderItems=function(){this.itemsWrapper.innerHTML="";const e=this.getItemsToRender(),t=document.createDocumentFragment();e.forEach((n,i)=>{const s=this.startIndex+i,o=this.createItemElement(n,s);o.dataset.index=s,o.dataset.id=n.id,t.appendChild(o)}),this.itemsWrapper.appendChild(t),this.updateSentinels()};A.prototype.forceRenderItems=function(){this.itemsWrapper.innerHTML="",this.renderedItems={};const e=this.getItemsToRender(),t=document.createDocumentFragment();e.forEach((n,i)=>{const s=this.startIndex+i,o=this.createItemElement(n);o.dataset.index=s,o.dataset.id=n.id,t.appendChild(o),this.renderedItems[s]=o}),this.itemsWrapper.appendChild(t),this.updateSentinels()};A.prototype.renderItemsByIndex=function(e="increase"){const t=this.getItemsToRender(),n=document.createDocumentFragment();t.forEach((i,s)=>{const o=this.startIndex+s;if(!this.renderedItems[o]){const a=this.createItemElement(i);a.dataset.index=o,a.dataset.id=i.id,n.appendChild(a),this.renderedItems[o]=a}}),e==="increase"?this.itemsWrapper.appendChild(n):this.itemsWrapper.insertBefore(n,this.itemsWrapper.firstChild),this.cleanupRenderedItems(),this.updateSentinels()};A.prototype.cleanupRenderedItems=function(){const e=Object.keys(this.renderedItems),t=this.startIndex+this.itemsPerPage;for(let n=0;n<e.length;n++){const i=parseInt(e[n],10);if(i<this.startIndex||i>t){const s=this.renderedItems[i];this.itemsWrapper.removeChild(s),delete this.renderedItems[i]}}};A.prototype.updateSentinels=function(){const e=Math.max(0,this.startIndex),t=Math.min(this.data.length,this.startIndex+this.itemsPerPage),n=e/this.itemsPerRow*this.itemSize;let i=t/this.itemsPerRow*this.itemSize;i=Math.min(i,this.totalSize),i=Math.round(i/this.itemSize)*this.itemSize,this.minSentinel.style.transform=`${this.translateProp}(${n}px)`,this.maxSentinel.style.transform=`${this.translateProp}(${i}px)`,this.itemsWrapper.style.transform=`${this.translateProp}(${n}px)`};A.prototype.updateDimensions=function(e=!1){const t=this.itemsWrapper.querySelector(".item");if(!t||(this.itemHeight=t.offsetHeight,this.itemWidth=t.offsetWidth,this.containerWidth=this.container.parentElement.offsetWidth,this.containerHeight=this.container.parentElement.offsetHeight,console.log("this.updateDimensions",this.containerWidth,this.containerHeight),!this.containerWidth)||!this.containerHeight||!this.data.length)return;const n=this.total||this.data.length;this.direction==="horizontal"?(this.itemSize=this.itemWidth,this.containerSize=this.containerWidth,this.itemsPerRow=Math.floor(this.containerHeight/this.itemHeight),this.rowsInView=Math.ceil(this.containerWidth/this.itemWidth)):(this.itemSize=this.itemHeight,this.containerSize=this.containerHeight,this.itemsPerRow=Math.floor(this.containerWidth/this.itemWidth),this.rowsInView=Math.ceil(this.containerHeight/this.itemHeight)),this.totalRows=Math.ceil(n/this.itemsPerRow),this.itemsPerPage=Math.max(this.optItemsPerPage,(this.rowsInView+2)*this.itemsPerRow),this.totalSize=this.totalRows*this.itemSize,this.totalSizeSentinel.style.transform=`${this.translateProp}(${this.totalSize}px)`,this.maxStartIndex=Math.max(this.data.length-this.itemsPerPage,0),this.half_w=this.containerWidth/2,this.half_h=this.containerHeight/2,this.boundingClientRect=this.container.getBoundingClientRect(),this.invalidateScrollIndex?(console.log("this.invalidateScrollIndex ",this.invalidateScrollIndex,this.itemsPerRow,this.containerSize),this.isFullSize||(this.invalidateScrollIndex=Math.floor(this.invalidateScrollIndex/this.itemsPerRow)),this.container[this.scrollProp]=this.invalidateScrollIndex*this.itemSize,this.invalidateScrollIndex=0,this.updateDimensions()):e?this.resolvedRenderMethod():this.scrollHandler()};A.prototype.updateScroll=function(){const e=this.container[this.scrollProp],{lastScrollPos:t,itemSize:n}=this,i=Math.floor(e/n)*this.itemsPerRow;this.startIndex=i;const s=Math.abs(n)*.9;if(Math.abs(e-t)>s){const a=e>t?"increase":"decrease";this.lastScrollPos=e,a==="increase"&&this.useDataFetching&&!this.isFetching&&this.params.cursor&&i>=this.maxStartIndex&&(this.isFetching=!0,this.fetchUpdateData()),this.resolvedRenderMethod(a)}};A.prototype.scrollHandler=function(){this.scrollTimeout&&clearTimeout(this.scrollTimeout),this.scrollAnimationFrame&&cancelAnimationFrame(this.scrollAnimationFrame),this.scrollAnimationFrame=requestAnimationFrame(()=>{this.updateScroll()}),this.scrollTimeout=setTimeout(()=>{this.updateScroll()},100)};A.prototype.clickHandler=function(e){const{target:t,currentTarget:n}=e,i=t.closest(".item.card").dataset.index,s=this.data[i];console.log(s)};A.prototype.changeHandler=function(e){};A.prototype.wheelHandler=function(e){if(!e.target.closest(".full .item-info"))if(!this.isFullSize||!this.isZoomMode){e.preventDefault();const t=Math.sign(e.deltaY);this.scrollDelta+=t,this.useSmoothScrolling(200)}else{const t=-Math.sign(e.deltaY)*.5,n=e.clientX-this.boundingClientRect.left,i=e.clientY-this.boundingClientRect.top;t<0?this.zoomOut(e,n,i):this.zoomIn(e,n,i)}};A.prototype.setupEventListeners=function(){this.container.addEventListener("scroll",this.throttle(this.scrollHandler.bind(this),100)),this.container.addEventListener("click",this.clickHandler.bind(this)),this.container.addEventListener("change",this.changeHandler.bind(this)),this.container.addEventListener("wheel",this.wheelHandler.bind(this),{passive:!1}),document.addEventListener("keydown",this.keyPressHandler.bind(this)),this.panel=this.itemsWrapper,this.panel.addEventListener("pointerdown",this.pointerDown.bind(this),{passive:!1}),this.panel.addEventListener("pointermove",this.throttle(this.pointerMove.bind(this),16),{passive:!1}),this.panel.addEventListener("pointerup",this.pointerUp.bind(this),{passive:!1}),this.panel.addEventListener("pointercancel",this.pointerUp.bind(this),{passive:!1}),this.panel.addEventListener("pointerleave",this.pointerUp.bind(this),{passive:!1}),this.isMouseDevice=!1,window.addEventListener("mousemove",()=>{this.isMouseDevice=!0},{once:!0})};A.prototype.useSmoothScrolling=function(e=200){if(this.smoothScrolling){const t=this.container[this.scrollProp]+this.scrollDelta*this.itemSize,n=Math.round(t/this.itemSize)*this.itemSize;this.smoothScroll(n,e)}else this.container[this.scrollProp]+=this.scrollDelta*this.itemSize,this.scrollDelta=0};A.prototype.smoothScroll=function(e,t){const n=this.container[this.scrollProp],i=e-n;let s=null,o;const a=c=>{s===null&&(s=c);const r=c-s,p=Math.min(r/t,1),m=1-Math.pow(1-p,3);this.container[this.scrollProp]=n+i*m,p<1?o=requestAnimationFrame(a):(this.scrollDelta=0,this.container[this.scrollProp]=e,o=null)};o&&cancelAnimationFrame(o),o=requestAnimationFrame(a)};A.prototype.setupResizeObserver=function(){let e;new ResizeObserver(()=>{clearTimeout(e),this.invalidateScrollIndex||(this.invalidateScrollIndex=this.startIndex),e=setTimeout(()=>{this.updateDimensions(!0)},100)}).observe(this.container)};A.prototype.keyPressHandler=function(e){switch(e.key){case"ArrowDown":this.scrollBy(1);break;case"ArrowUp":this.scrollBy(-1);break;case"Home":this.scrollToStart();break;case"End":this.scrollToEnd();break}};A.prototype.scrollBy=function(e){this.scrollDelta+=e,this.useSmoothScrolling(100)};A.prototype.scrollToStart=function(){this.startIndex=0,this.container[this.scrollProp]=0};A.prototype.scrollToEnd=function(){this.startIndex=Math.max(0,this.data.length-this.itemsPerPage),this.container[this.scrollProp]=this.startIndex*this.itemSize};A.prototype.scrollToId=function(e){const t=this.originalData.findIndex(n=>n.id===e);console.warn(`Item with Index ${t} clicked.`),t!==-1?(this.container.classList.remove("visible"),this.container[this.scrollProp]=0,this.invalidateScrollIndex=t,setTimeout(()=>{this.updateDimensions(),this.container.classList.add("visible")},200)):console.warn(`Item with ID ${e} not found in loaded data object.`)};A.prototype.scrollToIndex=function(e){this.container.classList.remove("visible"),this.container[this.scrollProp]=0,this.invalidateScrollIndex=e||0,setTimeout(()=>{this.updateDimensions(),this.container.classList.add("visible")},200)};A.prototype.debounce=function(e,t=1e3){return(function(...n){const i=this,s=typeof n[n.length-1]=="number"?n.pop():t,o=()=>{this.timeout=null,e.apply(i,n)};clearTimeout(this.timeout),this.timeout=setTimeout(o,s)}).bind(this)};A.prototype.throttle=function(e,t){let n,i,s;return function(){const o=this;s=arguments;const a=Date.now();i?(clearTimeout(n),n=setTimeout(function(){a-i>=t&&(e.apply(o,s),i=a)},t-(a-i))):(e.apply(o,s),i=a)}};A.prototype.setNextCursor=function(e){e&&this.data.length>0?(this.params.cursor=e,this.params.page=Math.floor(this.data.length/this.params.limit)+1||1):this.params.cursor&&delete this.params.cursor,this.params.limit&&this.data.length>0?this.params.page=Math.floor(this.data.length/this.params.limit)+1:delete this.params.page};A.prototype.getValueByPath=function(e,t){return t?t.split(".").reduce((i,s)=>{if(i!=null)return i[s]},e):e};A.prototype.setData=function(e){this.startIndex=0,this.container[this.scrollProp]=0,this.originalData=e,this.data=this.originalData,this.initialize()};A.prototype.appendData=function(e){this.originalData.push(...e),this.data=this.originalData,this.isFetching=!1,this.updateDimensions()};A.prototype.updateDataByIndex=function(e,t){const n=this.originalData[t];for(const[i,s]of Object.entries(e))n[i]=s;this.originalData[t]=n,this.data=this.originalData,this.renderItems()};A.prototype.updateDataById=function(e,t){const n=this.originalData.find(i=>i.id===t);if(n){for(const[i,s]of Object.entries(e))n[i]=s;this.data=this.originalData,this.renderItems()}else console.warn(`Item with ID ${t} not found in loaded data object.`)};A.prototype.removeDataById=function(e){const t=this.originalData.findIndex(n=>n.id===e);t!==-1?(this.originalData.splice(t,1),this.data=this.originalData,this.total-=1,this.updateDimensions(!0)):console.warn(`Item with ID ${e} not found in loaded data object.`)};A.prototype.setSelectedItems=function(e){this.selected=e,this.renderItems()};A.prototype.fetchData=async function(e){return new Promise((t,n)=>{const i=new XMLHttpRequest;let s=this.apiUrl;if(this.method.toUpperCase()==="GET"&&this.params){const o=new URLSearchParams;Object.keys(this.params).forEach(a=>{const c=this.params[a];Array.isArray(c)?c.forEach(r=>o.append(a,r)):o.append(a,c)}),s+="?"+o.toString()}i.open(this.method,s,!0),i.setRequestHeader("Accept","application/json"),i.onprogress=function(o){if(o.lengthComputable){const a=parseInt(o.loaded/o.total*100);e(a)}},i.onload=function(){if(i.status===200){const o=JSON.parse(i.responseText);t(o)}else n(i.status)},i.onerror=function(){n(i.status)},this.method.toUpperCase()==="POST"?(i.setRequestHeader("Content-Type","application/json"),i.send(JSON.stringify(this.params))):i.send()})};A.prototype.fetchUpdateData=async function(e=!1){var n;this.showLoadingIndicator();const t=await this.fetchData(i=>this.updateLoadingIndicator(i));if(t){this.total=t.total;const i=this.getValueByPath(t,this.keys.dataPath)||t;e?this.setData(i):this.appendData(i),this.setNextCursor(((n=t.metadata)==null?void 0:n.nextCursor)||t.nextCursor)}else console.error(`Error fetching data: ${error}`);this.hideLoadingIndicator()};A.prototype.updateParamsAndFetch=async function(e,t=1e3){Object.assign(this.params,e),Object.keys(this.params).forEach(i=>{this.params[i]||delete this.params[i]}),this.startIndex=0,delete this.params.cursor,this.originalData=[],this.data=this.originalData,this.debounce(this.fetchUpdateData.bind(this,!0),t)()};A.prototype.showLoadingIndicator=function(){this.loadingIndicator||(this.loadingIndicator=document.createElement("div"),this.loadingIndicator.className="loading-indicator",this.container.parentElement.appendChild(this.loadingIndicator),this.hideLoadingIndicator(),this.isFetching=!1),this.loadingIndicator.innerHTML="Loading... 0%",this.loadingIndicator.style.display="flex"};A.prototype.updateLoadingIndicator=function(e){this.loadingIndicator&&(this.loadingIndicator.innerHTML=`Loading... ${e}%`)};A.prototype.hideLoadingIndicator=function(){this.loadingIndicator&&(this.loadingIndicator.style.display="none")};A.prototype.showDetail=function(){this.detail.classList.remove("hidden")};A.prototype.hideDetail=function(){this.detail&&this.detail.classList.add("hidden")};A.prototype.filterItems=function(e,t={}){this.startIndex=0,this.data=this.originalData.filter(n=>{let i=!0;e&&(i=i&&n[this.keys.title].toLowerCase().includes(e.toLowerCase()));for(const[s,o]of Object.entries(t))if(n[s]!==void 0&&o!==void 0)if(Array.isArray(n[s])){const a=n[s];i=i&&a.some(c=>typeof c=="string"&&c.toLowerCase().includes(o.toLowerCase()))}else typeof n[s]=="string"&&(i=i&&n[s].toLowerCase().includes(o.toLowerCase()));return i}),this.updateDimensions(),this.forceRenderItems()};A.prototype.sortItems=function(e,t=!1){this.startIndex=0;const n=this,i=[...this.data];function s(o,a){const c=n.getValueByPath(o,e),r=n.getValueByPath(a,e);return!isNaN(c)&&!isNaN(r)?t?r-c:c-r:t?r<c?-1:r>c?1:0:c<r?-1:c>r?1:0}i.sort(s),this.data=i,this.updateDimensions(),this.forceRenderItems()};A.prototype.resetZoom=function(){this.zoom_scale=1,this.x=this.y=0,this.updateZoom()};A.prototype.zoomIn=function(e,t,n){this.centeredZoom(1/.65,t,n)};A.prototype.zoomOut=function(e,t,n){this.centeredZoom(.65,t,n)};A.prototype.getRelativePointers=function(e){const{boundingClientRect:t}=this,[n,i]=e;return{x1:n.x-t.left,y1:n.y-t.top,x2:i.x-t.left,y2:i.y-t.top}};A.prototype.centerOfPointers=function(e){const{x1:t,y1:n,x2:i,y2:s}=this.getRelativePointers(e),o=(t+i)/2,a=(n+s)/2;return[o,a]};A.prototype.distance=function(e){if(e.length<2)return 0;const t=e[0].x-e[1].x,n=e[0].y-e[1].y;return Math.sqrt(t*t+n*n)};A.prototype.scalePointers=function(e){if(e.length<2)return 0;const t=this.distance(e),n=this.previousDistance||0;if(n>0){const i=t/n,s=this.centerOfPointers(e);this.centeredZoom(i,s[0],s[1])}this.previousDistance=t};A.prototype.centeredZoom=function(e,t,n){const{zoom_scale:i,x:s,y:o,half_w:a,half_h:c}=this;let r=i*e;if(r<=1){this.resetZoom();return}else if(r>50)return;n?(this.x=t-(t-s-a)*e-a,this.y=n-(n-o-c)*e-c):(this.x*=e,this.y*=e),this.zoom_scale=r,this.updateZoom()};A.prototype.updateZoom=function(){this.zoomTarget&&(this.zoomTarget.style.transform=`translate(${this.x}px, ${this.y}px) scale(${this.zoom_scale})`)};A.prototype.debounceDoubleTap=function(e){const t=Date.now();this.lastTapTime&&t-this.lastTapTime<300&&(this.isZoomMode=!this.isZoomMode,this.isZoomMode?(this.zoomTarget=e.target.closest(".item-img"),this.zoom_scale=1.2,this.updateZoom()):(this.activePointers={},this.resetZoom())),this.lastTapTime=t};A.prototype.pointerDown=function(e){e.target.tagName.toLowerCase()!=="select"&&e.preventDefault(),this.dragged=!1,this.startX=e.pageX,this.startY=e.pageY;const{isFullSize:t,isMouseDevice:n,activePointers:i}=this;i[e.pointerId]={x:e.pageX,y:e.pageY};const s=Object.keys(i).length;if(s>2)return;t||(this.isZoomMode=!1),t&&s===1&&this.debounceDoubleTap(e);const o=this.isZoomMode;console.log(`isZoomMode: ${o}`),(!o&&t||!o&&n)&&s===1&&(this.isDragging=!0,this.start=e[this.client],this.scrollStart=this.container[this.scrollProp],this.container.style.cursor="grabbing")};A.prototype.pointerMove=function(e){e.preventDefault(),this.dragged=!0;const{isZoomMode:t,isFullSize:n,isMouseDevice:i,activePointers:s,startX:o,startY:a,start:c,scrollProp:r,scrollStart:p}=this;if(s[e.pointerId]){s[e.pointerId]={x:e.pageX,y:e.pageY};const m=Object.keys(s).length;if(t){if(m>2)return;if(m===2)this.scalePointers(Object.values(s));else if(m===1){const g=e.pageX-o,h=e.pageY-a;this.startX=e.pageX,this.startY=e.pageY,this.x+=g,this.y+=h,requestAnimationFrame(()=>{this.updateZoom()})}}else if(!t&&n||!t&&i){if(!this.isDragging||m>1)return;const g=c-e[this.client],h=Math.sign(g);h!==0&&(this.scrollDelta=h),requestAnimationFrame(()=>{this.container[r]=p+g})}}};A.prototype.pointerUp=function(e){e.preventDefault(),this.dragged=!1;const{isZoomMode:t,isFullSize:n,isMouseDevice:i,activePointers:s}=this;if(delete s[e.pointerId],Object.keys(s).length<2&&(this.previousDistance=0),!t&&n||!t&&i){if(this.isDragging=!1,!this.scrollDelta)return;this.container.style.cursor="grab",this.useSmoothScrolling(200)}};A.prototype.touchStart=function(e){e.preventDefault(),this.dragged=!1,this.startX=e.touches[0].pageX,this.startY=e.touches[0].pageY;const{isFullSize:t,isMouseDevice:n,activePointers:i}=this;for(let a=0;a<e.touches.length;a++){const c=e.touches[a];i[c.identifier]={x:c.pageX,y:c.pageY}}const s=Object.keys(i).length;t||(this.isZoomMode=!1),t&&s===1&&this.debounceDoubleTap(e);const o=this.isZoomMode;console.log(`isZoomMode: ${o}`),(!o&&t||!o&&n)&&s===1&&(this.isDragging=!0,this.start=e.touches[0][this.client],this.scrollStart=this.container[this.scrollProp],this.container.style.cursor="grabbing")};A.prototype.touchMove=function(e){e.preventDefault(),this.dragged=!0;const{isZoomMode:t,isFullSize:n,isMouseDevice:i,activePointers:s,startX:o,startY:a,start:c,scrollProp:r,scrollStart:p}=this;if(t){for(let g=0;g<e.touches.length;g++){const h=e.touches[g];s[h.identifier]={x:h.pageX,y:h.pageY}}const m=Object.keys(s).length;if(m===2)this.scalePointers(Object.values(s));else if(m===1){const g=e.touches[0].pageX-o,h=e.touches[0].pageY-a;this.startX=e.touches[0].pageX,this.startY=e.touches[0].pageY,this.x+=g,this.y+=h,requestAnimationFrame(()=>{this.updateZoom()})}}else if(!t&&n||!t&&i){if(!this.isDragging)return;const m=c-e.touches[0][this.client],g=Math.sign(m);g!==0&&(this.scrollDelta=g),requestAnimationFrame(()=>{this.container[r]=p+m})}};A.prototype.touchEnd=function(e){e.preventDefault(),this.dragged=!1;const{isZoomMode:t,isFullSize:n,isMouseDevice:i,activePointers:s}=this;for(let o=0;o<e.changedTouches.length;o++){const a=e.changedTouches[o];delete s[a.identifier]}if(Object.keys(s).length<2&&(this.previousDistance=0),!t&&n||!t&&i){if(this.isDragging=!1,!this.scrollDelta)return;this.container.style.cursor="grab",this.useSmoothScrolling(200)}};function ms(e){return document.createElement(e)}ms("video");/*! @license DOMPurify 3.2.3 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.3/LICENSE */const{entries:oi,setPrototypeOf:Fn,isFrozen:ps,getPrototypeOf:fs,getOwnPropertyDescriptor:hs}=Object;let{freeze:xe,seal:Pe,create:ai}=Object,{apply:ln,construct:cn}=typeof Reflect<"u"&&Reflect;xe||(xe=function(t){return t});Pe||(Pe=function(t){return t});ln||(ln=function(t,n,i){return t.apply(n,i)});cn||(cn=function(t,n){return new t(...n)});const Pt=Ae(Array.prototype.forEach),Un=Ae(Array.prototype.pop),ct=Ae(Array.prototype.push),kt=Ae(String.prototype.toLowerCase),Jt=Ae(String.prototype.toString),qn=Ae(String.prototype.match),dt=Ae(String.prototype.replace),gs=Ae(String.prototype.indexOf),_s=Ae(String.prototype.trim),De=Ae(Object.prototype.hasOwnProperty),Se=Ae(RegExp.prototype.test),ut=ys(TypeError);function Ae(e){return function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];return ln(e,t,i)}}function ys(e){return function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return cn(e,n)}}function X(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:kt;Fn&&Fn(e,null);let i=t.length;for(;i--;){let s=t[i];if(typeof s=="string"){const o=n(s);o!==s&&(ps(t)||(t[i]=o),s=o)}e[s]=!0}return e}function bs(e){for(let t=0;t<e.length;t++)De(e,t)||(e[t]=null);return e}function Ze(e){const t=ai(null);for(const[n,i]of oi(e))De(e,n)&&(Array.isArray(i)?t[n]=bs(i):i&&typeof i=="object"&&i.constructor===Object?t[n]=Ze(i):t[n]=i);return t}function mt(e,t){for(;e!==null;){const i=hs(e,t);if(i){if(i.get)return Ae(i.get);if(typeof i.value=="function")return Ae(i.value)}e=fs(e)}function n(){return null}return n}const Hn=xe(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Qt=xe(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),en=xe(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),vs=xe(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),tn=xe(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Ss=xe(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Bn=xe(["#text"]),jn=xe(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),nn=xe(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Wn=xe(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Nt=xe(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),ws=Pe(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Es=Pe(/<%[\w\W]*|[\w\W]*%>/gm),xs=Pe(/\$\{[\w\W]*}/gm),Ts=Pe(/^data-[\-\w.\u00B7-\uFFFF]+$/),Ls=Pe(/^aria-[\-\w]+$/),ri=Pe(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Cs=Pe(/^(?:\w+script|data):/i),As=Pe(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),li=Pe(/^html$/i),Is=Pe(/^[a-z][.\w]*(-[.\w]+)+$/i);var Gn=Object.freeze({__proto__:null,ARIA_ATTR:Ls,ATTR_WHITESPACE:As,CUSTOM_ELEMENT:Is,DATA_ATTR:Ts,DOCTYPE_NAME:li,ERB_EXPR:Es,IS_ALLOWED_URI:ri,IS_SCRIPT_OR_DATA:Cs,MUSTACHE_EXPR:ws,TMPLIT_EXPR:xs});const pt={element:1,attribute:2,text:3,cdataSection:4,entityReference:5,entityNode:6,progressingInstruction:7,comment:8,document:9,documentType:10,documentFragment:11,notation:12},Ps=function(){return typeof window>"u"?null:window},Ns=function(t,n){if(typeof t!="object"||typeof t.createPolicy!="function")return null;let i=null;const s="data-tt-policy-suffix";n&&n.hasAttribute(s)&&(i=n.getAttribute(s));const o="dompurify"+(i?"#"+i:"");try{return t.createPolicy(o,{createHTML(a){return a},createScriptURL(a){return a}})}catch{return console.warn("TrustedTypes policy "+o+" could not be created."),null}},Xn=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function ci(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ps();const t=R=>ci(R);if(t.version="3.2.3",t.removed=[],!e||!e.document||e.document.nodeType!==pt.document)return t.isSupported=!1,t;let{document:n}=e;const i=n,s=i.currentScript,{DocumentFragment:o,HTMLTemplateElement:a,Node:c,Element:r,NodeFilter:p,NamedNodeMap:m=e.NamedNodeMap||e.MozNamedAttrMap,HTMLFormElement:g,DOMParser:h,trustedTypes:T}=e,O=r.prototype,H=mt(O,"cloneNode"),P=mt(O,"remove"),w=mt(O,"nextSibling"),f=mt(O,"childNodes"),y=mt(O,"parentNode");if(typeof a=="function"){const R=n.createElement("template");R.content&&R.content.ownerDocument&&(n=R.content.ownerDocument)}let v,C="";const{implementation:$,createNodeIterator:j,createDocumentFragment:x,getElementsByTagName:d}=n,{importNode:u}=i;let b=Xn();t.isSupported=typeof oi=="function"&&typeof y=="function"&&$&&$.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:I,ERB_EXPR:N,TMPLIT_EXPR:D,DATA_ATTR:F,ARIA_ATTR:ne,IS_SCRIPT_OR_DATA:se,ATTR_WHITESPACE:me,CUSTOM_ELEMENT:oe}=Gn;let{IS_ALLOWED_URI:ae}=Gn,U=null;const Y=X({},[...Hn,...Qt,...en,...tn,...Bn]);let J=null;const re=X({},[...jn,...nn,...Wn,...Nt]);let G=Object.seal(ai(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),pe=null,be=null,L=!0,_=!0,E=!1,M=!0,B=!1,ee=!0,te=!1,ce=!1,q=!1,Z=!1,de=!1,W=!1,z=!0,Q=!1;const le="user-content-";let Te=!0,qe=!1,Xe={},Ke=null;const gn=X({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let _n=null;const yn=X({},["audio","video","img","source","image","track"]);let Ft=null;const bn=X({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),bt="http://www.w3.org/1998/Math/MathML",vt="http://www.w3.org/2000/svg",He="http://www.w3.org/1999/xhtml";let Je=He,Ut=!1,qt=null;const mi=X({},[bt,vt,He],Jt);let St=X({},["mi","mo","mn","ms","mtext"]),wt=X({},["annotation-xml"]);const pi=X({},["title","style","font","a","script"]);let ot=null;const fi=["application/xhtml+xml","text/html"],hi="text/html";let ue=null,Qe=null;const gi=n.createElement("form"),vn=function(l){return l instanceof RegExp||l instanceof Function},Ht=function(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Qe&&Qe===l)){if((!l||typeof l!="object")&&(l={}),l=Ze(l),ot=fi.indexOf(l.PARSER_MEDIA_TYPE)===-1?hi:l.PARSER_MEDIA_TYPE,ue=ot==="application/xhtml+xml"?Jt:kt,U=De(l,"ALLOWED_TAGS")?X({},l.ALLOWED_TAGS,ue):Y,J=De(l,"ALLOWED_ATTR")?X({},l.ALLOWED_ATTR,ue):re,qt=De(l,"ALLOWED_NAMESPACES")?X({},l.ALLOWED_NAMESPACES,Jt):mi,Ft=De(l,"ADD_URI_SAFE_ATTR")?X(Ze(bn),l.ADD_URI_SAFE_ATTR,ue):bn,_n=De(l,"ADD_DATA_URI_TAGS")?X(Ze(yn),l.ADD_DATA_URI_TAGS,ue):yn,Ke=De(l,"FORBID_CONTENTS")?X({},l.FORBID_CONTENTS,ue):gn,pe=De(l,"FORBID_TAGS")?X({},l.FORBID_TAGS,ue):{},be=De(l,"FORBID_ATTR")?X({},l.FORBID_ATTR,ue):{},Xe=De(l,"USE_PROFILES")?l.USE_PROFILES:!1,L=l.ALLOW_ARIA_ATTR!==!1,_=l.ALLOW_DATA_ATTR!==!1,E=l.ALLOW_UNKNOWN_PROTOCOLS||!1,M=l.ALLOW_SELF_CLOSE_IN_ATTR!==!1,B=l.SAFE_FOR_TEMPLATES||!1,ee=l.SAFE_FOR_XML!==!1,te=l.WHOLE_DOCUMENT||!1,Z=l.RETURN_DOM||!1,de=l.RETURN_DOM_FRAGMENT||!1,W=l.RETURN_TRUSTED_TYPE||!1,q=l.FORCE_BODY||!1,z=l.SANITIZE_DOM!==!1,Q=l.SANITIZE_NAMED_PROPS||!1,Te=l.KEEP_CONTENT!==!1,qe=l.IN_PLACE||!1,ae=l.ALLOWED_URI_REGEXP||ri,Je=l.NAMESPACE||He,St=l.MATHML_TEXT_INTEGRATION_POINTS||St,wt=l.HTML_INTEGRATION_POINTS||wt,G=l.CUSTOM_ELEMENT_HANDLING||{},l.CUSTOM_ELEMENT_HANDLING&&vn(l.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(G.tagNameCheck=l.CUSTOM_ELEMENT_HANDLING.tagNameCheck),l.CUSTOM_ELEMENT_HANDLING&&vn(l.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(G.attributeNameCheck=l.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),l.CUSTOM_ELEMENT_HANDLING&&typeof l.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(G.allowCustomizedBuiltInElements=l.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),B&&(_=!1),de&&(Z=!0),Xe&&(U=X({},Bn),J=[],Xe.html===!0&&(X(U,Hn),X(J,jn)),Xe.svg===!0&&(X(U,Qt),X(J,nn),X(J,Nt)),Xe.svgFilters===!0&&(X(U,en),X(J,nn),X(J,Nt)),Xe.mathMl===!0&&(X(U,tn),X(J,Wn),X(J,Nt))),l.ADD_TAGS&&(U===Y&&(U=Ze(U)),X(U,l.ADD_TAGS,ue)),l.ADD_ATTR&&(J===re&&(J=Ze(J)),X(J,l.ADD_ATTR,ue)),l.ADD_URI_SAFE_ATTR&&X(Ft,l.ADD_URI_SAFE_ATTR,ue),l.FORBID_CONTENTS&&(Ke===gn&&(Ke=Ze(Ke)),X(Ke,l.FORBID_CONTENTS,ue)),Te&&(U["#text"]=!0),te&&X(U,["html","head","body"]),U.table&&(X(U,["tbody"]),delete pe.tbody),l.TRUSTED_TYPES_POLICY){if(typeof l.TRUSTED_TYPES_POLICY.createHTML!="function")throw ut('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof l.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw ut('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');v=l.TRUSTED_TYPES_POLICY,C=v.createHTML("")}else v===void 0&&(v=Ns(T,s)),v!==null&&typeof C=="string"&&(C=v.createHTML(""));xe&&xe(l),Qe=l}},Sn=X({},[...Qt,...en,...vs]),wn=X({},[...tn,...Ss]),_i=function(l){let S=y(l);(!S||!S.tagName)&&(S={namespaceURI:Je,tagName:"template"});const k=kt(l.tagName),ie=kt(S.tagName);return qt[l.namespaceURI]?l.namespaceURI===vt?S.namespaceURI===He?k==="svg":S.namespaceURI===bt?k==="svg"&&(ie==="annotation-xml"||St[ie]):!!Sn[k]:l.namespaceURI===bt?S.namespaceURI===He?k==="math":S.namespaceURI===vt?k==="math"&&wt[ie]:!!wn[k]:l.namespaceURI===He?S.namespaceURI===vt&&!wt[ie]||S.namespaceURI===bt&&!St[ie]?!1:!wn[k]&&(pi[k]||!Sn[k]):!!(ot==="application/xhtml+xml"&&qt[l.namespaceURI]):!1},Re=function(l){ct(t.removed,{element:l});try{y(l).removeChild(l)}catch{P(l)}},Et=function(l,S){try{ct(t.removed,{attribute:S.getAttributeNode(l),from:S})}catch{ct(t.removed,{attribute:null,from:S})}if(S.removeAttribute(l),l==="is")if(Z||de)try{Re(S)}catch{}else try{S.setAttribute(l,"")}catch{}},En=function(l){let S=null,k=null;if(q)l="<remove></remove>"+l;else{const fe=qn(l,/^[\r\n\t ]+/);k=fe&&fe[0]}ot==="application/xhtml+xml"&&Je===He&&(l='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+l+"</body></html>");const ie=v?v.createHTML(l):l;if(Je===He)try{S=new h().parseFromString(ie,ot)}catch{}if(!S||!S.documentElement){S=$.createDocument(Je,"template",null);try{S.documentElement.innerHTML=Ut?C:ie}catch{}}const ge=S.body||S.documentElement;return l&&k&&ge.insertBefore(n.createTextNode(k),ge.childNodes[0]||null),Je===He?d.call(S,te?"html":"body")[0]:te?S.documentElement:ge},xn=function(l){return j.call(l.ownerDocument||l,l,p.SHOW_ELEMENT|p.SHOW_COMMENT|p.SHOW_TEXT|p.SHOW_PROCESSING_INSTRUCTION|p.SHOW_CDATA_SECTION,null)},Bt=function(l){return l instanceof g&&(typeof l.nodeName!="string"||typeof l.textContent!="string"||typeof l.removeChild!="function"||!(l.attributes instanceof m)||typeof l.removeAttribute!="function"||typeof l.setAttribute!="function"||typeof l.namespaceURI!="string"||typeof l.insertBefore!="function"||typeof l.hasChildNodes!="function")},Tn=function(l){return typeof c=="function"&&l instanceof c};function Be(R,l,S){Pt(R,k=>{k.call(t,l,S,Qe)})}const Ln=function(l){let S=null;if(Be(b.beforeSanitizeElements,l,null),Bt(l))return Re(l),!0;const k=ue(l.nodeName);if(Be(b.uponSanitizeElement,l,{tagName:k,allowedTags:U}),l.hasChildNodes()&&!Tn(l.firstElementChild)&&Se(/<[/\w]/g,l.innerHTML)&&Se(/<[/\w]/g,l.textContent)||l.nodeType===pt.progressingInstruction||ee&&l.nodeType===pt.comment&&Se(/<[/\w]/g,l.data))return Re(l),!0;if(!U[k]||pe[k]){if(!pe[k]&&An(k)&&(G.tagNameCheck instanceof RegExp&&Se(G.tagNameCheck,k)||G.tagNameCheck instanceof Function&&G.tagNameCheck(k)))return!1;if(Te&&!Ke[k]){const ie=y(l)||l.parentNode,ge=f(l)||l.childNodes;if(ge&&ie){const fe=ge.length;for(let Le=fe-1;Le>=0;--Le){const ze=H(ge[Le],!0);ze.__removalCount=(l.__removalCount||0)+1,ie.insertBefore(ze,w(l))}}}return Re(l),!0}return l instanceof r&&!_i(l)||(k==="noscript"||k==="noembed"||k==="noframes")&&Se(/<\/no(script|embed|frames)/i,l.innerHTML)?(Re(l),!0):(B&&l.nodeType===pt.text&&(S=l.textContent,Pt([I,N,D],ie=>{S=dt(S,ie," ")}),l.textContent!==S&&(ct(t.removed,{element:l.cloneNode()}),l.textContent=S)),Be(b.afterSanitizeElements,l,null),!1)},Cn=function(l,S,k){if(z&&(S==="id"||S==="name")&&(k in n||k in gi))return!1;if(!(_&&!be[S]&&Se(F,S))){if(!(L&&Se(ne,S))){if(!J[S]||be[S]){if(!(An(l)&&(G.tagNameCheck instanceof RegExp&&Se(G.tagNameCheck,l)||G.tagNameCheck instanceof Function&&G.tagNameCheck(l))&&(G.attributeNameCheck instanceof RegExp&&Se(G.attributeNameCheck,S)||G.attributeNameCheck instanceof Function&&G.attributeNameCheck(S))||S==="is"&&G.allowCustomizedBuiltInElements&&(G.tagNameCheck instanceof RegExp&&Se(G.tagNameCheck,k)||G.tagNameCheck instanceof Function&&G.tagNameCheck(k))))return!1}else if(!Ft[S]){if(!Se(ae,dt(k,me,""))){if(!((S==="src"||S==="xlink:href"||S==="href")&&l!=="script"&&gs(k,"data:")===0&&_n[l])){if(!(E&&!Se(se,dt(k,me,"")))){if(k)return!1}}}}}}return!0},An=function(l){return l!=="annotation-xml"&&qn(l,oe)},In=function(l){Be(b.beforeSanitizeAttributes,l,null);const{attributes:S}=l;if(!S||Bt(l))return;const k={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:J,forceKeepAttr:void 0};let ie=S.length;for(;ie--;){const ge=S[ie],{name:fe,namespaceURI:Le,value:ze}=ge,at=ue(fe);let ve=fe==="value"?ze:_s(ze);if(k.attrName=at,k.attrValue=ve,k.keepAttr=!0,k.forceKeepAttr=void 0,Be(b.uponSanitizeAttribute,l,k),ve=k.attrValue,Q&&(at==="id"||at==="name")&&(Et(fe,l),ve=le+ve),ee&&Se(/((--!?|])>)|<\/(style|title)/i,ve)){Et(fe,l);continue}if(k.forceKeepAttr||(Et(fe,l),!k.keepAttr))continue;if(!M&&Se(/\/>/i,ve)){Et(fe,l);continue}B&&Pt([I,N,D],Nn=>{ve=dt(ve,Nn," ")});const Pn=ue(l.nodeName);if(Cn(Pn,at,ve)){if(v&&typeof T=="object"&&typeof T.getAttributeType=="function"&&!Le)switch(T.getAttributeType(Pn,at)){case"TrustedHTML":{ve=v.createHTML(ve);break}case"TrustedScriptURL":{ve=v.createScriptURL(ve);break}}try{Le?l.setAttributeNS(Le,fe,ve):l.setAttribute(fe,ve),Bt(l)?Re(l):Un(t.removed)}catch{}}}Be(b.afterSanitizeAttributes,l,null)},yi=function R(l){let S=null;const k=xn(l);for(Be(b.beforeSanitizeShadowDOM,l,null);S=k.nextNode();)Be(b.uponSanitizeShadowNode,S,null),Ln(S),In(S),S.content instanceof o&&R(S.content);Be(b.afterSanitizeShadowDOM,l,null)};return t.sanitize=function(R){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},S=null,k=null,ie=null,ge=null;if(Ut=!R,Ut&&(R="<!-->"),typeof R!="string"&&!Tn(R))if(typeof R.toString=="function"){if(R=R.toString(),typeof R!="string")throw ut("dirty is not a string, aborting")}else throw ut("toString is not a function");if(!t.isSupported)return R;if(ce||Ht(l),t.removed=[],typeof R=="string"&&(qe=!1),qe){if(R.nodeName){const ze=ue(R.nodeName);if(!U[ze]||pe[ze])throw ut("root node is forbidden and cannot be sanitized in-place")}}else if(R instanceof c)S=En("<!---->"),k=S.ownerDocument.importNode(R,!0),k.nodeType===pt.element&&k.nodeName==="BODY"||k.nodeName==="HTML"?S=k:S.appendChild(k);else{if(!Z&&!B&&!te&&R.indexOf("<")===-1)return v&&W?v.createHTML(R):R;if(S=En(R),!S)return Z?null:W?C:""}S&&q&&Re(S.firstChild);const fe=xn(qe?R:S);for(;ie=fe.nextNode();)Ln(ie),In(ie),ie.content instanceof o&&yi(ie.content);if(qe)return R;if(Z){if(de)for(ge=x.call(S.ownerDocument);S.firstChild;)ge.appendChild(S.firstChild);else ge=S;return(J.shadowroot||J.shadowrootmode)&&(ge=u.call(i,ge,!0)),ge}let Le=te?S.outerHTML:S.innerHTML;return te&&U["!doctype"]&&S.ownerDocument&&S.ownerDocument.doctype&&S.ownerDocument.doctype.name&&Se(li,S.ownerDocument.doctype.name)&&(Le="<!DOCTYPE "+S.ownerDocument.doctype.name+`>
`+Le),B&&Pt([I,N,D],ze=>{Le=dt(Le,ze," ")}),v&&W?v.createHTML(Le):Le},t.setConfig=function(){let R=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ht(R),ce=!0},t.clearConfig=function(){Qe=null,ce=!1},t.isValidAttribute=function(R,l,S){Qe||Ht({});const k=ue(R),ie=ue(l);return Cn(k,ie,S)},t.addHook=function(R,l){typeof l=="function"&&ct(b[R],l)},t.removeHook=function(R){return Un(b[R])},t.removeHooks=function(R){b[R]=[]},t.removeAllHooks=function(){b=Xn()},t}var di=ci();function ui(e,t,n,i){const s=document.createElement("div");s.className="item card",n!=null&&n.has(e.name)?s.classList.add("active"):s.classList.remove("active");const o=document.createElement("button");o.className="icon-grid-size fullsize-button card-button";const a=document.createElement("button");a.className="icon-full-screen fullScreen-button card-button";const c=document.createElement("button");c.className="icon-tile tile-button card-button";const r=document.createElement("button");r.className="icon-info info-button card-button";const p=document.createElement("button");p.className="edit-meta edit-button card-button";const m=document.createElement("button");m.className="copy-path copy-path-button card-button";const g=document.createElement("button");g.className="icon-delete delete-button card-button";const h=document.createElement("button");h.className="icon-send-params send-params-button card-button";const T=document.createElement("div");T.className="item-info";const O=document.createElement("span");O.className="item-info-title",O.textContent=e.name;const H=document.createElement("div");H.className="item-info-description";const P=document.createElement("p");P.textContent=e.prompt;const w=document.createElement("p");w.textContent=e.negative;const f=document.createElement("p");f.textContent=e.tags;const y=document.createElement("p");y.textContent=e.extra,H.appendChild(P),H.appendChild(w),H.appendChild(f),H.appendChild(y),T.appendChild(O),T.appendChild(H);const v=document.createElement("div");v.className="item-actions-row";const C=document.createElement("div");C.className="item-actions";const $=document.createElement("div");$.className="item-actions-top";const j=document.createElement("div");j.className="item-spacer",$.appendChild(h),$.appendChild(j),$.appendChild(o),$.appendChild(a),C.appendChild(c),C.appendChild(r),C.appendChild(m),C.appendChild(p),C.appendChild(g),v.appendChild($),v.appendChild(C),s.appendChild(v);const x=e[t],d=e.timestamp||"";if(x){const u=document.createElement("div");u.style.backgroundImage=`url('${i}${encodeURIComponent(x)}${d}')`,u.className="item-img",s.appendChild(u)}return s.appendChild(T),s}function Os(e,t,n,i){const s=document.createElement("div");s.className="item card",n!=null&&n.has(e.name)?s.classList.add("active"):s.classList.remove("active");const o=document.createElement("button");o.className="icon-grid-size fullsize-button card-button";const a=document.createElement("button");a.className="icon-full-screen fullScreen-button card-button";const c=document.createElement("button");c.className="icon-tile tile-button card-button";const r=document.createElement("button");r.className="icon-info info-button card-button";const p=document.createElement("button");p.className="edit-meta edit-button card-button";const m=document.createElement("button");m.className="copy-path copy-path-button card-button";const g=document.createElement("button");g.className="icon-send-params send-params-button card-button";const h=document.createElement("div");h.className="item-info";const T=document.createElement("span");T.className="item-info-title",T.textContent=e.name;const O=document.createElement("div");if(O.className="item-info-description",e.activation_text){const $=document.createElement("p");$.textContent=e.activation_text;const j=document.createElement("p");j.textContent=e.negative_prompt,O.appendChild($),O.appendChild(j)}const H=document.createElement("p");H.textContent=e.tags,O.appendChild(H),h.appendChild(T),h.appendChild(O);const P=document.createElement("div");P.className="item-actions-row";const w=document.createElement("div");w.className="item-actions";const f=document.createElement("div");f.className="item-actions-top";const y=document.createElement("div");if(y.className="item-spacer",f.appendChild(g),f.appendChild(y),f.appendChild(o),f.appendChild(a),w.appendChild(r),w.appendChild(m),w.appendChild(p),e.metadata_exists){const $=document.createElement("button");$.className="show-meta metadata-button card-button",w.appendChild($)}P.appendChild(f),P.appendChild(w),s.appendChild(P);const v=e[t],C=e.timestamp||"";if(v){const $=document.createElement("div");$.style.backgroundImage=`url('${i}${encodeURIComponent(v)}${C}')`,$.className="item-img",s.appendChild($)}return s.appendChild(h),s}const Ms=["clipSkip","cfgScale","sampler","steps","seed","Size"];function ks(e){const t=document.createElement("div");t.className="item card";const n=document.createElement("button");n.className="icon-grid-size fullsize-button card-button";const i=document.createElement("button");i.className="icon-full-screen fullScreen-button card-button";const s=document.createElement("button");s.className="icon-tile tile-button card-button";const o=document.createElement("button");o.className="icon-info info-button card-button";const a=document.createElement("button");a.className="icon-stylez civit-add2styles-button card-button";const c=document.createElement("button");c.className="icon-link civit-link-button card-button";const r=document.createElement("button");r.className="icon-send-params send-params-button card-button";const p=document.createElement("div");p.className="item-info";const m=document.createElement("button");m.className="item-info-title",m.textContent=e.username;const g=document.createElement("div");g.className="item-info-description";const h=[];e.baseModel&&h.push(`baseModel: ${e.baseModel}`);const T=e.meta;if(T){if(T.prompt){const v=document.createElement("p");v.textContent="Prompt: "+T.prompt,g.appendChild(v)}if(T.negativePrompt){const v=document.createElement("p");v.textContent="Negative prompt: "+T.negativePrompt,g.appendChild(v)}Ms.forEach(v=>{T[v]!==void 0&&h.push(`${v}: ${T[v]}`)});const y=document.createElement("p");y.textContent=h.join(", "),g.appendChild(y),T.civitaiResources&&T.civitaiResources.forEach(v=>{const C=v.type?v.type:"Unknown Type",$=v.weight?v.weight:"",j=v.modelVersionId?v.modelVersionId:null,x=v.modelVersionName?v.modelVersionName:null;if(j){const d=document.createElement("p");d.textContent=`${C}: ${$} `;const u=document.createElement("a");u.textContent=`${x||"Unnamed Model Id: "+j}`,u.href=`https://civitai.com/api/v1/models/${j}`,u.target="_blank",d.appendChild(u),g.appendChild(d)}})}p.appendChild(m),p.appendChild(g);const O=document.createElement("div");O.className="item-actions-row";const H=document.createElement("div");H.className="item-actions";const P=document.createElement("div");P.className="item-actions-top";const w=document.createElement("div");w.className="item-spacer",P.appendChild(r),P.appendChild(w),P.appendChild(n),P.appendChild(i),H.appendChild(o),H.appendChild(c),H.appendChild(a),O.appendChild(P),O.appendChild(H),t.appendChild(O);const f=e.url;if(f){const y=document.createElement("div");y.style.backgroundImage=`url('${f}')`,y.className="item-img",t.appendChild(y)}return t.appendChild(p),t}function $s(e){var P,w;const t=document.createElement("div");t.className="item card";const n=document.createElement("button");n.className="icon-grid-size fullsize-button card-button";const i=document.createElement("button");i.className="icon-full-screen fullScreen-button card-button";const s=document.createElement("button");s.className="icon-tile tile-button card-button";const o=document.createElement("button");o.className="icon-info info-button card-button";const a=document.createElement("button");a.className="icon-link civit-link-button card-button";const c=document.createElement("button");c.className="icon-send-params send-params-button card-button";const r=document.createElement("div");r.className="item-info";const p=document.createElement("span");p.className="item-info-title",p.textContent=e.name;const m=document.createElement("span");m.textContent=e.type,m.className=`extra-type ${e.type}`;const g=document.createElement("div");g.innerHTML=di.sanitize(e.description),g.className="item-info-description",r.appendChild(p),r.appendChild(g);const h=document.createElement("div");h.className="item-actions-row";const T=document.createElement("div");T.className="item-actions";const O=document.createElement("div");O.className="item-spacer",T.appendChild(c),T.appendChild(O),T.appendChild(n),T.appendChild(i),T.appendChild(o),T.appendChild(a),h.appendChild(T),t.appendChild(m),t.appendChild(h);const H=(w=(P=e.modelVersions[0])==null?void 0:P.images[0])==null?void 0:w.url;if(H){const f=document.createElement("div");f.style.backgroundImage=`url(${encodeURI(H)})`,f.className="item-img",t.appendChild(f)}return t.appendChild(r),t}function Ds(e){const t=e/1024;return t>=1024?`${(t/1024).toFixed(2)} GB`:`${t.toFixed(2)} MB`}function Rs(e,t,n){const i=document.createElement("div");i.className="item card";const s=document.createElement("button");s.className="icon-grid-size fullsize-button card-button";const o=document.createElement("button");o.className="icon-full-screen fullScreen-button card-button";const a=document.createElement("button");a.className="icon-tile tile-button card-button";const c=document.createElement("button");c.className="icon-info info-button card-button";const r=document.createElement("button");r.className="icon-link civit-link-button card-button";const p=document.createElement("button");p.className="icon-send-params send-params-button card-button";const m=document.createElement("div");m.className="item-info";const g=document.createElement("span");g.className="item-info-title",g.textContent=t.name;const h=document.createElement("span");h.textContent=t.type,h.className=`extra-type ${t.type}`;const T=document.createElement("select");T.className="baseModel-select";const O=t.modelVersions;O.forEach((d,u)=>{const b=document.createElement("option");b.value=u,b.textContent=`${d.baseModel} | ${d.name} | ${d.baseModelType}`,u===n&&(b.selected=!0),T.appendChild(b)});const H=O[n].files[0].downloadUrl,P=O[n].files[0].name,w=O[n].files[0].sizeKB,f=document.createElement("a");f.target="_blank",f.setAttribute("data-url",H),f.className="model-sdownload",f.textContent=`${P} - ${Ds(w)}`;let y=O[n].description;n===0&&(y=(t.description||"")+(O[n].description||""));const v=document.createElement("div");v.innerHTML=di.sanitize(y),v.className="item-info-description",m.appendChild(g),m.appendChild(T),m.appendChild(f);const C=e.url;if(C){const d=document.createElement("a");d.className="download-image-button";const u=C.split(".").pop().split("?")[0],b=`${P.split(".")[0]}.${u}`;d.textContent=`${b}`,d.setAttribute("data-url",C),d.setAttribute("data-filename",b),m.appendChild(d)}m.appendChild(v);const $=document.createElement("div");$.className="item-actions-row";const j=document.createElement("div");j.className="item-actions";const x=document.createElement("div");if(x.className="item-spacer",j.appendChild(p),j.appendChild(x),j.appendChild(s),j.appendChild(o),j.appendChild(c),j.appendChild(r),$.appendChild(j),i.appendChild(h),i.appendChild($),C){const d=document.createElement("div");d.style.backgroundImage=`url(${C})`,d.className="item-img",i.appendChild(d)}return i.appendChild(m),i}async function zs(){const e=document.querySelector("#civitai_cardholder_images"),t=document.querySelector("#civit_search_images"),n=document.querySelector("#civit_search_images_clear"),i=100,s="/sd_webui_ux/civitai_proxy/images",o={"#civit_nsfw_images":"nsfw","#civit_sort_images":"sort","#civit_period_images":"period","#civit_search_images":"username"},a={limit:i,page:1},c={title:"username",url:"url",dataPath:"items"},r=new A(e,[],18,c,s,a),p=yt(o,a,r);r.createItemElement=function(h,T){return ks(h)};function m(h,T,O){const H=window.UIUX.FOCUS_PROMPT;if(h.classList.contains("copy-path"))navigator.clipboard.writeText(T.filename);else if(h.classList.contains("fullsize-button"))r.scrollToId(T.id),r.isFullSize?(r.setFullSize(!1),r.setLayout("vertical"),h.classList.remove("active")):(r.setFullSize(!0),r.setLayout("vertical"),h.classList.add("active"));else if(h.classList.contains("info-button"))r.setInfo(!r.isInfo);else if(h.classList.contains("fullScreen-button"))r.scrollToId(T.id),r.setFullScreen(!r.isFullScreen);else if(h.classList.contains("send-params-button")){const P=`${T.url}`;it(P,`#pnginfo_send_${H} button`)}else h.classList.contains("item-info-title")?(t.value=h.textContent,Ge(t)):h.classList.contains("civit-link-button")?window.open(`https://civitai.com/images/${T.id}`,"_blank"):h.classList.contains("civit-add2styles-button")}r.clickHandler=function(h){if(r.dragged||r.scrollDelta)return;const T=h.target.closest(".item.card"),O=T==null?void 0:T.dataset.id;if(O){const H=this.data.find(P=>P.id.toString()===O);console.log(O,h.target,H),H&&m(h.target,H)}h.preventDefault(),h.stopPropagation()};function g(h){t.value="",Ge(t)}n.addEventListener("click",g),r.updateParamsAndFetch(p,0)}async function Fs(){const e=document.querySelector("#civitai_cardholder_models"),t=document.querySelector("#civit_search_models"),n=document.querySelector("#civit_search_models_clear"),i=100,s="/sd_webui_ux/civitai_proxy/models",o={"#civit_nsfw_models":"nsfw","#civit_type_models":"types","#civit_sort_models":"sort","#civit_period_models":"period","#civit_search_models":"query"},a={limit:i,page:1},c={title:"username",url:"url",dataPath:"items"};let r,p=0;const m=new A(e,[],18,c,s,a),g=yt(o,a,m);function h(f,y,v){const C=window.UIUX.FOCUS_PROMPT;if(f.classList.contains("civit-link-button"))window.open(`https://civitai.com/models/${y.id}`,"_blank");else if(f.classList.contains("fullsize-button"))m.showDetail(),r=y,p=0,O.setData(y.modelVersions[p].images),O.setFullSize(!0),O.setLayout("vertical");else if(f.classList.contains("info-button"))m.setInfo(!m.isInfo);else if(f.classList.contains("fullScreen-button"))m.scrollToId(y.id),m.setFullScreen(!m.isFullScreen);else if(f.classList.contains("send-params-button")){const $=`${y.modelVersions[0].images[0].url}`;it($,`#pnginfo_send_${C} button`)}else f.classList.contains("item-info-title")&&(t.value=f.textContent,Ge(t))}m.createItemElement=function(f,y){return $s(f)},m.clickHandler=function(f){if(m.dragged||m.scrollDelta)return;const y=f.target.closest(".item.card"),v=y==null?void 0:y.dataset.id;if(v){const C=this.data.find($=>$.id.toString()===v);console.log(v,f.target,C),C&&h(f.target,C)}f.preventDefault(),f.stopPropagation()};const T=e.parentElement.querySelector(".ae-virtual-detail-content"),O=new A(T,[],8);O.createItemElement=function(f,y){return Rs(f,r,p)},O.clickHandler=function(f){if(O.dragged||O.scrollDelta)return;const y=f.target.closest(".item.card"),v=y==null?void 0:y.dataset.id;if(v){const C=this.data.find($=>$.id.toString()===v);C&&H(f.target,C)}f.preventDefault(),f.stopPropagation()},O.changeHandler=function(f){const y=f.target;y.classList.contains("baseModel-select")&&(p=parseInt(y.value),this.setData(r.modelVersions[p].images))};function H(f,y,v){const C=window.UIUX.FOCUS_PROMPT;if(f.classList.contains("civit-link-button"))window.open(`https://civitai.com/models/${r.id}?modelVersionId=${r.modelVersions[p].id}`,"_blank");else if(f.classList.contains("fullsize-button"))m.hideDetail();else if(f.classList.contains("info-button"))O.setInfo(!O.isInfo);else if(f.classList.contains("fullScreen-button"))O.scrollToId(y.id),O.setFullScreen(!O.isFullScreen);else if(f.classList.contains("send-params-button")){const $=`${y.url}`;it($,`#pnginfo_send_${C} button`)}else f.classList.contains("item-info-title")||(f.classList.contains("download-image-button")?P(f.dataset.url,f.dataset.filename):f.classList.contains("model-sdownload")&&P(f.dataset.url))}function P(f,y){const v=document.createElement("a");v.target="_blank",v.href=f,y&&(v.download=y),document.body.appendChild(v),v.click(),document.body.removeChild(v)}function w(f){t.value="",Ge(t)}n.addEventListener("click",w),m.updateParamsAndFetch(g,0)}function ye(e,t,n,i=""){this.container=document.querySelector(e),this.fetchUrl=t,this.tableName=n,this.rootPath=i.replace(/\\/g,"/").toLowerCase(),this.selected}ye.prototype.initialize=async function(){this.container.innerHTML="";const e=await this.fetchData(this.rootPath),t=this.buildTree(e),n=this.createTreeView(t);this.container.appendChild(n),this.attachEventListeners(),this.itemMap=e.reduce((i,s)=>(i[s.id]=s,i),{})};ye.prototype.updateSelectedItems=function(){var e;this.container.querySelectorAll(".li-file.active").forEach(t=>{t.classList.remove("active")}),(e=this.selected)==null||e.forEach(t=>{const n=this.container.querySelector(`.li-file[data-name="${t}"]`);n&&n.classList.add("active")})};ye.prototype.fetchData=async function(e){const n=await(await fetch(`${this.fetchUrl}?table_name=${this.tableName}&path=${encodeURIComponent(e)}`)).json();return this.data=n.data,this.subpaths=n.unique_subpaths,this.subpaths=this.subpaths.map(i=>{const s=i.split(e);return{path:i,relativePath:s[1],basePath:`${s[0]}${e}`}}),console.log(this.subpaths),console.log("tree data length:",this.data.length),n.data};ye.prototype.buildTree=function(e){const t={},n=this.rootPath;t[n]={};const i=t[n];return e.forEach(s=>{const o=s.filename.replace(/\\/g,"/").toLowerCase(),a=o.indexOf(n);if(a===-1)return;const r=o.slice(a+n.length).replace(/^\//,"").split("/").filter(Boolean);let p=i;for(let m=0;m<r.length;m++){const g=r[m];p[g]||(m===r.length-1?p[g]=s:p[g]={}),p=p[g]}}),t};ye.prototype.createFileItem=function(e,t){const n=document.createElement("li");return n.dataset.name=e[t].name,n.dataset.id=e[t].id,n.innerHTML=`<summary class="tree-file">${e[t].name}</summary>`,n.classList.add("li-file"),n};ye.prototype.createFolderItem=function(e,t,n){n+="/"+t,n=n.replace(/\/{2,}/g,"/");const i=document.createElement("li");i.innerHTML=`<summary class="tree-folder caret" data-path="${n}">${t}</summary>`;const s=this.createTreeView(e[t],n);return s.classList.add("nested"),i.appendChild(s),i};ye.prototype.createTreeView=function(e,t=""){const n=document.createElement("ul");n.classList.add("tree-view");for(const i in e){let s;typeof e[i]=="object"&&!Array.isArray(e[i])?i.includes(".safetensors")||i.includes(".pt")||i.includes(".png")||i.includes(".jpg")||i.includes(".webp")?s=this.createFileItem(e,i):s=this.createFolderItem(e,i,t):s=this.createFileItem(e,i),n.appendChild(s)}return n};ye.prototype.attachEventListeners=function(){this.eventListenerAdded||(this.container.addEventListener("click",async e=>{const t=e.target,n=t.closest("li[data-id]");if(t.tagName==="BUTTON"){const s=n.dataset.id,o=this.getItemProperties(s);this.onFileClicked(t,o)}else if(n){const s=n.dataset.id,o=this.getItemProperties(s);this.onFileClicked(n,o)}else if(t.classList.contains("caret")){t.classList.toggle("caret-down");const s=t.nextElementSibling;s.classList.contains("nested")&&s.classList.toggle("active"),this.onFolderClicked(t,t.getAttribute("data-path"),s.classList.contains("active"))}e.stopPropagation()}),this.eventListenerAdded=!0)};ye.prototype.getItemProperties=function(e){return this.itemMap[e]};ye.prototype.update=async function(){const e=[];this.container.querySelectorAll(".tree-folder.caret-down").forEach(n=>{e.push(n.dataset.path)});const t=this.container.parentElement.scrollTop;await this.initialize(),e.forEach(n=>{const i=this.container.querySelector(`.tree-folder[data-path="${n}"]`);i&&i.click()}),this.container.parentElement.scrollTop=t,this.attachEventListeners()};ye.prototype.updateDataById=function(e,t){const n=this.itemMap[t];if(n)for(const[i,s]of Object.entries(e))n[i]=s;else console.error(`Item with ID ${t} not found.`)};ye.prototype.onFolderClicked=function(e,t,n){};ye.prototype.onFileClicked=function(e,t){};function he(e,t,n,i,s="Submit"){this.url=e,this.table_name=t,this.itemData=n,this.container=i,this.submit_label=s,this.form=document.createElement("form"),this.form.setAttribute("id","userMetadataForm"),this.form.classList.add("flexbox","padding","col","shrink")}he.prototype.formatFileSize=function(e){return typeof e!="number"?"0 bytes":e>=1073741824?(e/1073741824).toFixed(2)+" GB":e>=1048576?(e/1048576).toFixed(2)+" MB":e>=1024?(e/1024).toFixed(2)+" KB":e+" bytes"};he.prototype.formatDate=function(e){return typeof e!="number"?"":new Date(e*1e3).toLocaleDateString()};he.prototype.formatFilename=function(e){return typeof e!="string"?"":e.replace(/\\/g,"/").split("/").pop()};he.prototype.createElement=function(e,t,n,i={}){const s={textarea:{tag:"textarea",attributes:{...i,rows:i.rows||1,textContent:n||""}},select:{tag:"select",attributes:{id:i.id,class:i.class,name:i.name},children:Array.isArray(i.options)?i.options.map(r=>({option:{type:"option",value:r.value,textContent:r.textContent,selected:r.value===i.value}})):[]},option:{tag:"option",attributes:{...i}},input:{tag:"input",attributes:{...i,type:"text",value:n||""}},file:{tag:"input",attributes:{type:"file"}},number:{tag:"input",attributes:{type:"number",value:n}},checkbox:{tag:"input",attributes:{type:"checkbox",checked:n}},radio:{tag:"input",attributes:{type:"radio",checked:n}},slider:{tag:"input",attributes:{type:"range",value:n}},img:{tag:"img",attributes:{src:i.req+n,alt:t,class:"thumbnail-image"}},button:{tag:"button",textContent:n,attributes:{type:"button",id:i.id,class:"ae-button",name:t}},placeholder:{tag:"div",attributes:i},row:{tag:"div",attributes:{id:i.id,class:`flexbox row ${i.class||""}`},children:i.children},col:{tag:"div",attributes:{id:i.id,class:`flexbox col ${i.class||""}`},children:i.children},panel:{tag:"div",attributes:{id:i.id,class:`panel padding ${i.class||""}`},children:i.children},default:{tag:"input",attributes:{type:"text",value:n||""}}},o=s[e]||s.default,a=document.createElement(o.tag);return((r,p)=>{Object.entries(p).forEach(([m,g])=>{typeof m=="string"&&m.trim()!==""?m==="textContent"?r.textContent=g:m==="checked"?r.checked=!!g:m==="selected"?r.selected=!!g:(typeof g=="string"||typeof g=="number")&&r.setAttribute(m,g):console.warn(`Invalid attribute name: ${m}`)})})(a,o.attributes),o.children&&o.children.forEach(r=>{const p=Object.keys(r)[0],m=r[p],g=m.value!==void 0?m.value:this.itemData[p]||"",h=this.createElement(m.type,p,g,m);a.appendChild(h)}),a};he.prototype.addElementToForm=function(e,t){const n=document.createElement("div");n.classList.add("panel","col","padding"),t.id&&(n.id=t.id);const i=document.createElement("label");i.setAttribute("for",e),i.classList.add("flexbox"),i.textContent=t.label||e.replace("_"," ").toUpperCase();const s=this.createElement(t.type,e,this.itemData[e],t);n.appendChild(i),n.appendChild(s),this.form.appendChild(n)};he.prototype.createForm=function(e){Object.entries(e).forEach(([s,o])=>{(this.itemData.hasOwnProperty(s)||o.draw==="true")&&this.addElementToForm(s,o)});const t=document.createElement("div");t.classList.add("panel","row","flex-end");const n=document.createElement("button");n.setAttribute("type","submit"),n.textContent=this.submit_label,n.classList.add("ae-submit-button"),t.appendChild(n);const i=document.createElement("button");if(i.setAttribute("type","button"),i.textContent="Cancel",i.classList.add("ae-submit-button","cancel"),t.appendChild(i),this.itemData.id){const s=document.createElement("button");s.setAttribute("type","button"),s.textContent="Delete",s.classList.add("ae-submit-button","delete"),t.appendChild(s)}return this.form.appendChild(t),this.form.addEventListener("submit",s=>this.handleSubmit(s)),this.form};he.prototype.createValueElement=function(e,t,n,i,s){let o=`?t=${new Date().getTime()}`;s&&s.indexOf("filename=")!==-1&&(o=`&t=${new Date().getTime()}`);const a={filename:{textContent:this.formatFilename(n)},filesize:{textContent:this.formatFileSize(n)},"date-format":{textContent:this.formatDate(n)},img:{tag:"img",attributes:{src:s+n+o,alt:t,class:"thumbnail-image"}},button:{tag:"button",textContent:i||"button",attributes:{class:`ae-button ${t}`,name:t}},default:{textContent:n||""}},c=a[e]||a.default;let r;return c.tag?(r=document.createElement(c.tag),Object.entries(c.attributes).forEach(([p,m])=>{r.setAttribute(p,m)}),c.textContent&&(r.textContent=c.textContent)):(r=document.createElement("span"),r.textContent=c.textContent),r};he.prototype.createTable=function(e){const t=document.createElement("table");return t.classList.add("non-editable-table","panel"),Object.entries(e).forEach(([n,i])=>{const s=document.createElement("tr"),o=document.createElement("td");o.textContent=n.replace("_"," ").toUpperCase(),s.appendChild(o);const a=document.createElement("td"),c=this.createValueElement(i.type,n,this.itemData[n]);a.appendChild(c),s.appendChild(a),t.appendChild(s)}),t};he.prototype.createHtmlElement=function(e){const t=document.createElement("div");return t.classList.add("non-editable-div","flexbox","col","shrink"),Object.entries(e).forEach(([n,i])=>{const s=document.createElement("div");if(s.classList.add("panel",n),i.showLabel!==!1){const a=document.createElement("label");a.textContent=n.replace("_"," ").toUpperCase(),s.appendChild(a)}const o=this.createValueElement(i.type,n,this.itemData[n],i.label||"",i.api);s.appendChild(o),t.appendChild(s)}),t};he.prototype.buildTags=function(e){const t=/[-_\w']+/g;function n(o){return Object.keys(o).reduce((c,r)=>c+r.length,0)/Object.keys(o).length>=16}const i={},s=e.ss_tag_frequency||{};for(const o of Object.values(s))for(const[a,c]of Object.entries(o)){const r=a.trim();i[r]=(i[r]||0)+parseInt(c,10)}if(Object.keys(i).length>0&&n(i)){const o={};for(const[a,c]of Object.entries(i)){const r=a.match(t)||[];for(const p of r)p.length>=3&&(o[p]=(o[p]||0)+c)}return Object.entries(o).sort(([,a],[,c])=>c-a).map(([a,c])=>[a,c])}return Object.entries(i).sort(([,o],[,a])=>a-o).map(([o,a])=>[o,a])};he.prototype.createTagsElement=function(e,t){const n=this.buildTags(e);if(n.length>0){const i=document.createElement("div");i.classList.add("non-editable-tags","flexbox","shrink");const s=document.createElement("div");if(s.classList.add("panel","flexbox","row","padding"),t){const o=document.createElement("label");o.textContent=t.toUpperCase(),s.appendChild(o)}return Object.entries(n).forEach(o=>{const a=document.createElement("button");a.type="button",a.textContent=o[1][0];const c=document.createElement("span");c.classList.add("tag-num"),c.textContent=o[1][1],a.appendChild(c),s.appendChild(a)}),i.appendChild(s),i}return!1};he.prototype.afterFormSubmit=function(e,t,n){};he.prototype.beforeFormSubmit=function(e){return e};he.prototype.handleSubmit=async function(e){e.preventDefault();const t=new FormData(this.form),n=Object.fromEntries(t.entries());let i=n;i.table_name=this.table_name,i.name=this.itemData.name,i=this.beforeFormSubmit(n);let s;i.file&&(s=i.file,delete i.file);const o=new FormData;o.append("payload",JSON.stringify(i)),s&&o.append("file",s);try{const a=await fetch(this.url,{method:"POST",body:o});if(!a.ok)throw new Error(`HTTP error! Status: ${a.status}`);const c=await a.json();await this.afterFormSubmit(n,c.data,c.message)}catch(a){console.error("Failed to fetch data:",a)}};async function Us(){zt("checkpoints","checkpoint","stable-diffusion/")}async function qs(){zt("textual_inversion","textualinversion","embeddings/")}async function Hs(){zt("lora","lora","lora/")}async function Bs(){zt("hypernetworks","hypernetwork","hypernetworks/")}function js(e,t){const n=e.parentElement.querySelector(".ae-virtual-detail-content");n.innerHTML="",n.appendChild(t)}async function Ws(e,t,n,i){const s=`/sd_webui_ux/get_internal_metadata?type=${encodeURIComponent(e)}&name=${encodeURIComponent(t)}`;si(s,function(o){console.log(o),n.showDetail();const a=window.extraNetworksFlattenMetadata(o),c=window.createVisualizationTable(a,0);js(i,c)})}const Ve={};async function zt(e,t,n){const i=document.querySelector(`#${e}_cardholder`),s=document.querySelector(`#${e}_search`);document.querySelector(`#${e}_sort`);const o=document.querySelector(`#${e}_order`);document.querySelector(`#${e}_sd_version`);const a=document.querySelector(`#${e}_refresh`),c=document.querySelector(`#${e}_rebuild`),r=document.querySelector(`#${e}_clear`),p=document.querySelector("#refresh_database");Ve[`txt2img_${t}`]=[],Ve[`img2img_${t}`]=[];const m=100,g="/sd_webui_ux/get_items_from_db",h="GET",T={table_name:t,skip:0,limit:m,sort_by:"name",order:"asc",search_term:""},O={title:"name",url:"preview",dataPath:"items"},H={[`#${e}_search`]:"search_term",[`#${e}_sort`]:"sort_by",[`#${e}_search_in`]:"search_columns",[`#${e}_sd_version`]:"sd_version"},P=d=>(d.skip=0,d),w=new A(i,[],18,O,g,T,h),f=yt(H,T,w,P);w.setNextCursor=function(d){d&&this.data.length>0?this.params.skip=this.params.cursor=d:delete this.params.cursor};let y="thumbnail";w.createItemElement=function(d,u){return Os(d,y,this.selected,"/sd_extra_networks/thumb?filename=")};function v(d,u,b){var F;const I=window.UIUX.FOCUS_PROMPT;let N=((F=u.prompt)==null?void 0:F.replace("opts.extra_networks_default_multiplier",u.preferred_weight>0?u.preferred_weight:opts.extra_networks_default_multiplier))||"";N+=u.activation_text||"";const D=u.negative_prompt||"";if(d.classList.contains("copy-path"))navigator.clipboard.writeText(u.filename);else if(d.classList.contains("fullsize-button"))w.scrollToId(u.id),w.isFullSize?(y="thumbnail",w.setFullSize(!1),w.setLayout("vertical"),d.classList.remove("active")):(y="local_preview",w.setFullSize(!0),w.setLayout("vertical"),d.classList.add("active"));else if(d.classList.contains("info-button"))w.setInfo(!w.isInfo);else if(d.classList.contains("fullScreen-button"))w.scrollToId(u.id),w.setFullScreen(!w.isFullScreen);else if(d.classList.contains("show-meta"))Ws(u.type,u.name,w,i);else if(d.classList.contains("edit-meta"))x(u,u.id);else if(d.classList.contains("send-params-button")){const ne=`/sd_extra_networks/thumb?filename=${encodeURIComponent(u.preview||u.local_preview)}`;it(ne,`#pnginfo_send_${I} button`)}else if(u.type==="Checkpoint"){if(w.isFullSize)return;window.selectCheckpoint(u.name)}else if(u.type==="TextualInversion"){if(w.isFullSize)return;window.cardClicked(I,N,D,!0),Ve[`${I}_textualinversion`].push({id:u.id,name:u.name,value:N})}else if(u.type==="LORA"){if(w.isFullSize)return;window.cardClicked(I,N,D,!1),Ve[`${I}_lora`].push({id:u.id,name:u.name,value:`<lora:${N.split(":")[1]}`})}else if(u.type==="Hypernetwork"){if(w.isFullSize)return;window.cardClicked(I,N,D,!1),Ve[`${I}_hypernetwork`].push({id:u.id,name:u.name,value:N})}}w.clickHandler=function(d){if(w.dragged||w.scrollDelta)return;const u=d.target.closest(".item.card"),b=u==null?void 0:u.dataset.id;if(b){const I=this.data.find(N=>N.id.toString()===b);I&&v(d.target,I)}d.stopPropagation()},c.addEventListener("click",d=>{Ue("/sd_webui_ux/generate-thumbnails",{table_name:t},function(u){console.log(u),setTimeout(()=>{f.skip=0,w.updateParamsAndFetch(f,0)},1e3)})}),o.addEventListener("click",d=>{const u=o.classList.contains("active");f.skip=0,f.order=u?"desc":"asc",w.updateParamsAndFetch(f,0)}),r.addEventListener("click",d=>{s.value="",Ge(s)}),w.updateParamsAndFetch(f,0);const C=new ye(`#${e}_tree_view`,"/sd_webui_ux/get_items_by_path",t,n);C.initialize(),C.createFileItem=function(d,u){var F;const b=document.createElement("li");b.dataset.name=d[u].name,b.dataset.id=d[u].id,(F=this.selected)!=null&&F.has(d[u].name)&&b.classList.add("active"),b.innerHTML=`<summary class="tree-file">${d[u].name}</summary>`,b.classList.add("li-file");const I=document.createElement("button");I.className="edit-meta edit-button card-button";const N=document.createElement("button");N.className="copy-path copy-path-button card-button";const D=document.createElement("div");if(D.className="item-actions",D.appendChild(N),d[u].metadata_exists){const ne=document.createElement("button");ne.className="show-meta metadata-button card-button",D.appendChild(ne)}return D.appendChild(I),b.appendChild(D),b},C.onFolderClicked=function(d,u,b){},C.onFileClicked=function(d,u){v(d,u,u.id)},a.addEventListener("click",d=>{p.click(),setTimeout(()=>{f.skip=0,w.updateParamsAndFetch(f,0),C.initialize()},1e3)});function $(d){const u=window.UIUX.FOCUS_PROMPT,b=Ve[`${u}_${t}`];setTimeout(()=>{let I="";document.querySelectorAll(`#${u}_prompt textarea, #${u}_neg_prompt textarea`).forEach(F=>{I+=F.value});const N=b.filter(F=>F&&F.value&&I.includes(F.value));Ve[`${u}_${t}`]=N;const D=new Set(N.map(F=>F.name));w.selected=C.selected=D,w.renderItems(),C.updateSelectedItems()},100)}function j(d){const u=window.UIUX.FOCUS_PROMPT;let b="";if(document.querySelectorAll(`#${u}_prompt textarea, #${u}_neg_prompt textarea`).forEach(D=>{b+=` ${D.value}`}),b.length>2){let D=function(se){return se.replace(/[()]+|:[0-9]+(.[0-9]+)?/g,"").trim()};var I=D;let ne=b.trim().split(/[\s,.]+/).map(D).filter(Boolean);if(t==="lora"||t==="hypernetwork"){let me=function(ae){if(ae.includes(`${se}:`)){const U=ae.split(`${se}:`)[1].split(":")[0];return`<${se}:${U}:opts.extra_networks_default_multiplier>`}return""};var N=me;const se=t==="lora"?"lora":"hypernet";ne=b.trim().split("<").map(me).filter(Boolean)}ne.length>0&&Ue("/sd_webui_ux/search_words_in_tables_columns",{tables:t,columns:"prompt",words:ne},function(oe){const U=oe[t].map(Y=>{let J=Y.prompt;return(t==="lora"||t==="hypernetwork")&&(J=`<${t==="lora"?"lora":"hypernet"}:${Y.prompt.split(":")[1]}`),{id:Y.id,name:Y.name,value:J}});Ve[`${u}_${t}`]=U,w.selected=C.selected=new Set(U.map(Y=>Y.name)),w.renderItems(),C.updateSelectedItems()})}else w.selected=C.selected=new Set,w.renderItems(),C.updateSelectedItems()}t!=="checkpoint"?document.querySelectorAll("#txt2img_prompt textarea, #img2img_prompt textarea, #txt2img_neg_prompt textarea, #img2img_neg_prompt textarea").forEach(d=>{d.addEventListener("input",$),d.addEventListener("focus",j)}):ls(w,C);function x(d,u){const b={local_preview:{type:"input",name:"local_preview"},sd_version:{type:"select",name:"sd_version",label:"SD Version",value:d.sd_version,options:mn},preferred_weight:{type:"number",name:"preferred_weight",label:"Preferred Weight"},activation_text:{type:"textarea",name:"activation_text",label:"Activation Text",rows:4},negative_prompt:{type:"textarea",name:"negative_prompt",label:"Negative Prompt",rows:2},description:{type:"textarea",name:"description",label:"Description",rows:2},tags:{type:"textarea",name:"tags",label:"Tags"},notes:{type:"textarea",name:"notes",label:"Notes",rows:2}},I={filename:{type:"filename"},filesize:{type:"filesize"},type:{type:"text"},hash:{type:"text"},date_created:{type:"date-format"},date_modified:{type:"date-format"}},N={thumbnail:{type:"img",api:"/sd_extra_networks/thumb?filename=",showLabel:!1},replace_preview:{type:"button",label:"Replace Preview",showLabel:!1},browse_preview:{type:"button",label:"Browse Preview",showLabel:!1}},D=`/sd_webui_ux/get_internal_metadata?type=${encodeURIComponent(d.type)}&name=${encodeURIComponent(d.name)}`;si(D,function(F){var ce;const ne=F,se="/sd_webui_ux/update_user_metadata",me=document.getElementById("formContainer"),oe=new he(se,t,d,me),ae=oe.createForm(b),U=oe.createTable(I),Y=oe.createHtmlElement(N),J=oe.createTagsElement(ne,"Train Tags");if(J){(ce=ae.children[2])==null||ce.insertAdjacentElement("afterend",J);let q=ae.querySelector("#activation_text");ae.addEventListener("click",Z=>{const de=Z.target.closest("textarea");de&&(q=de);const W=Z.target.closest("button[type=button]");if(W){const z=W.childNodes[0].textContent.trim(),Q=q.value;Q.includes(z)?q.value=Q.split(",").map(le=>le.trim()).filter(le=>le!==z).join(", "):q.value+=(Q?", ":"")+z}})}const re=document.createElement("div");re.classList.add("non-editable-info","flexbox","padding","shrink"),re.appendChild(Y),re.appendChild(U),w.showDetail();const G=i.parentElement.querySelector(".ae-virtual-detail-content");G.innerHTML="",G.appendChild(re),G.appendChild(ae);function pe(q){const Z=q.lastIndexOf(".");return Z===-1?q:q.substring(0,Z)}function be(q){const Z=q.lastIndexOf("/"),de=q.substring(0,Z),W=q.substring(Z+1),z=W.lastIndexOf("."),Q=W.substring(0,z);return{path:de,filename:W,filename_no_ext:Q}}let L,_;oe.beforeFormSubmit=function(q){return q.id=d.id,q.type=d.type,q.name=d.name,q.prompt=d.prompt,q.filename=d.filename,L&&(q.source_file=L),_&&(q.file=_),console.log(q),q};let E=d.local_preview;oe.afterFormSubmit=function(q){w.hideDetail();const Z=be(E),de=new Date().getTime();q.thumbnail=`${Z.path}/thumbnails/${Z.filename_no_ext}.thumb.webp`,q.timestamp=`&t=${de}`,w.updateDataById(q,u),C.update()};const M=Y.querySelector("button.replace_preview"),B=Y.querySelector(".thumbnail-image");M.addEventListener("click",q=>{const Z=window.UIUX.FOCUS_PROMPT,de=document.querySelector(`#${Z}_gallery [data-testid="detailed-image"]`);de&&(L=de.src.split("file=")[1].split("?")[0],B.style.filter="grayscale(1)")});const ee=document.createElement("input");ee.type="file",ee.accept="image/jpeg, image/png, image/webp, image/gif",ee.addEventListener("change",q=>{const Z=q.target.files[0];Z&&(_=Z,B.style.filter="grayscale(1)")}),Y.querySelector("button.browse_preview").addEventListener("click",q=>{ee.click()})})}}async function Gs(){Xs("styles","styles","styles_data/")}const et={};let V,we,$e,sn;async function Xs(e,t,n){sn=document.querySelector(`#${e}_cardholder`);const i=document.querySelector(`#${e}_search`);document.querySelector(`#${e}_sort`);const s=document.querySelector(`#${e}_order`);document.querySelector(`#${e}_sd_version`);const o=document.querySelector(`#${e}_refresh`),a=document.querySelector(`#${e}_rebuild`),c=document.querySelector(`#${e}_clear`),r=document.querySelector("#refresh_styles_database");et[`txt2img_${t}`]=[],et[`img2img_${t}`]=[];const p=100,m="/sd_webui_ux/get_items_from_db",g="GET",h={table_name:t,skip:0,limit:p,sort_by:"name",order:"asc",search_term:""},T={title:"name",url:"preview",dataPath:"items"},O={[`#${e}_search`]:"search_term",[`#${e}_sort`]:"sort_by",[`#${e}_search_in`]:"search_columns",[`#${e}_sd_version`]:"sd_version"},H=x=>(x.skip=0,x);V=new A(sn,[],18,T,m,h,g),$e=yt(O,h,V,H),V.setNextCursor=function(x){x&&this.data.length>0?this.params.skip=this.params.cursor=x:delete this.params.cursor};let P="thumbnail";V.createItemElement=function(x,d){return ui(x,P,this.selected,"/sd_styles/thumb/")},V.clickHandler=function(x){if(V.dragged||V.scrollDelta)return;const d=x.target.closest(".item.card"),u=d==null?void 0:d.dataset.id;if(u){const b=this.data.find(I=>I.id.toString()===u);b&&y(x.target,b)}x.preventDefault(),x.stopPropagation()},a.addEventListener("click",x=>{Ue("/sd_webui_ux/generate-thumbnails",{table_name:t},function(d){setTimeout(()=>{$e.skip=0,V.updateParamsAndFetch($e,0)},1e3)})}),s.addEventListener("click",x=>{const d=s.classList.contains("active");$e.skip=0,$e.order=d?"desc":"asc",V.updateParamsAndFetch($e,0)}),c.addEventListener("click",x=>{i.value="",Ge(i)}),V.updateParamsAndFetch($e,0),we=new ye(`#${e}_tree_view`,"/sd_webui_ux/get_items_by_path",t,n),we.initialize(),we.createFileItem=function(x,d){var D;const u=document.createElement("li");u.dataset.name=x[d].name,u.dataset.id=x[d].id,(D=this.selected)!=null&&D.has(x[d].name)&&u.classList.add("active"),u.innerHTML=`<summary class="tree-file">${x[d].name}</summary>`,u.classList.add("li-file");const b=document.createElement("button");b.className="edit-meta edit-button card-button";const I=document.createElement("button");I.className="copy-path copy-path-button card-button";const N=document.createElement("div");return N.className="item-actions",N.appendChild(I),N.appendChild(b),u.appendChild(N),u},we.onFolderClicked=function(x,d,u){},we.onFileClicked=function(x,d){y(x,d,d.id)},o.addEventListener("click",x=>{r.click(),setTimeout(()=>{$e.skip=0,V.updateParamsAndFetch($e,0),we.initialize()},1e3)});function w(x){const d=window.UIUX.FOCUS_PROMPT,u=et[`${d}_${t}`];setTimeout(()=>{let b="";document.querySelectorAll(`#${d}_prompt textarea, #${d}_neg_prompt textarea`).forEach(D=>{b+=D.value});const I=u.filter(D=>D&&D.value&&b.includes(D.value));et[`${d}_${t}`]=I;const N=new Set(I.map(D=>D.name));V.selected=we.selected=N,V.renderItems(),we.updateSelectedItems()},100)}function f(x){const d=window.UIUX.FOCUS_PROMPT;let u="";if(document.querySelectorAll(`#${d}_prompt textarea`).forEach(I=>{u+=`${I.value}`}),u.length>2){let I=function(ne){return ne.replace(/[()]+|:[0-9]+(.[0-9]+)?/g,"").trim()};var b=I;const F=u.trim().split(". ").map(I).filter(Boolean).map(ne=>". "+ne);F.length>0&&Ue("/sd_webui_ux/search_words_in_tables_columns",{words:F,tables:t,columns:"prompt",threshold:1},function(me){const oe=me[t];console.log(oe);const ae=oe.map(U=>({id:U.id,name:U.name,value:U.prompt}));et[`${d}_${t}`]=ae,V.selected=we.selected=new Set(ae.map(U=>U.name))})}else V.selected=we.selected=new Set;V.renderItems(),we.updateSelectedItems()}document.querySelectorAll("#txt2img_prompt textarea, #img2img_prompt textarea, #txt2img_neg_prompt textarea, #img2img_neg_prompt textarea").forEach(x=>{x.addEventListener("input",w),x.addEventListener("focus",f)});function y(x,d,u){const b=window.UIUX.FOCUS_PROMPT,I=d.prompt||"",N=d.negative||"";if(x.classList.contains("copy-path"))navigator.clipboard.writeText(d.filename);else if(x.classList.contains("fullsize-button"))V.scrollToId(d.id),V.isFullSize?(P="thumbnail",V.setFullSize(!1),V.setLayout("vertical"),x.classList.remove("active")):(P="local_preview",V.setFullSize(!0),V.setLayout("vertical"),x.classList.add("active"));else if(x.classList.contains("tile-button"))V.setTileable(!V.isTileable);else if(x.classList.contains("info-button"))V.setInfo(!V.isInfo);else if(x.classList.contains("fullScreen-button"))V.scrollToId(d.id),V.setFullScreen(!V.isFullScreen);else if(x.classList.contains("edit-meta"))C(d,d.id);else if(x.classList.contains("delete-button"))v(d,d.id);else if(x.classList.contains("send-params-button")){const D=`/sd_styles/thumb/${encodeURIComponent(d.local_preview)}`;it(D,`#pnginfo_send_${b} button`)}else if(d.type==="Style"){if(V.isFullSize)return;window.cardClicked(b,I,N,!0),et[`${b}_styles`].push({id:d.id,name:d.name,value:I})}}function v(x,d){const u="/sd_webui_ux/delete_item",b={table_name:t,item_id:x.id};Ue(u,b,function(I){V.removeDataById(x.id),we.update()})}function C(x,d){const u="styles",b=we.subpaths,I=new Set(b.map(W=>W.relativePath)),N=Array.from(I);let D=[{value:"None",textContent:"None"}],F;N.forEach(W=>{var z;(z=x.filename)!=null&&z.includes(`${W}/`)&&(F=W),D.push({value:W,textContent:W})});const ne={local_preview:{type:"input",id:"local_preview_path",name:"local_preview",label:"Local Preview"},row:{type:"row",draw:"true",id:"parent_folder_select_row",label:"Parent Category / Filename",children:[{parent_folder:{type:"select",id:"parent_folder_select",class:"grow",value:F,options:D}},{save_path:{type:"input",id:"parent_folder_save",class:"grow",value:x.name,label:"Style Name"}}]},sd_version:{type:"select",name:"sd_version",label:"SD Version",value:x.sd_version,options:mn},prompt:{type:"textarea",name:"prompt",label:"Prompt",rows:4},negative:{type:"textarea",name:"negative",label:"Negative Prompt",rows:2},tags:{type:"textarea",name:"tags",label:"Tags"},description:{type:"textarea",name:"description",label:"Description",rows:2}},se={filename:{type:"filename",label:"Filename"},filesize:{type:"filesize",label:"Filesize"},type:{type:"text",label:"Type"},hash:{type:"text",label:"Hash"},date_created:{type:"date-format",label:"Date Created"},date_modified:{type:"date-format",label:"Date Modified"}},me={thumbnail:{type:"img",api:"/sd_styles/thumb/",showLabel:!1},replace_preview:{type:"button",label:"Replace Preview",showLabel:!1}},oe="/sd_webui_ux/update_user_metadata",ae=document.getElementById("formContainer"),U=new he(oe,u,x,ae),Y=U.createForm(ne),J=U.createTable(se),re=U.createHtmlElement(me),G=document.createElement("div");G.classList.add("non-editable-info","flexbox","padding","shrink"),G.appendChild(re),G.appendChild(J),V.showDetail();const pe=sn.parentElement.querySelector(".ae-virtual-detail-content");pe.innerHTML="",pe.appendChild(G),pe.appendChild(Y);const be=Y.querySelector("#parent_folder_select"),L=Y.querySelector("#parent_folder_select_row label"),_=Y.querySelector("#parent_folder_save"),E=Y.querySelector("#local_preview_path input"),M=Y.querySelector("button.delete");let B;const ee=W=>W.replace(/\/{2,}/g,"/"),te=W=>{const z=be.value!=="None"?be.value:"",Q=_.value,le=`${z}/${Q}`;L.textContent=`Style will be saved: ${ee(le)}.png`,B=ee(`${b[0].basePath}/${le}.png`),E.value=B};be.addEventListener("change",te),_.addEventListener("input",te),te();function ce(W){const z=W.lastIndexOf("/"),Q=W.substring(0,z),le=W.substring(z+1),Te=le.lastIndexOf("."),qe=le.substring(0,Te);return{path:Q,filename:le,filename_no_ext:qe}}let q;U.beforeFormSubmit=function(W){return W.name=ce(B).filename_no_ext,W.filename=B,W.type="Style",x.id&&(W.id=x.id),q&&(W.source_file=q),W},U.afterFormSubmit=function(W,z){V.hideDetail(),V.updateDataById(z,z.id),we.update()};function Z(){const W=window.UIUX.FOCUS_PROMPT,z=document.querySelector(`#${W}_gallery [data-testid="detailed-image"]`);if(z){const Q=re.querySelector(".thumbnail-image");q=z.src.split("file=")[1].split("?")[0],Q.style.filter="grayscale(1)"}}re.querySelector("button.replace_preview").addEventListener("click",W=>{Z()}),x.id||Z(),x.id&&M.addEventListener("click",W=>{const z="/sd_webui_ux/delete_item",Q={table_name:u,item_id:x.id};Ue(z,Q,function(le){console.log(le),V.hideDetail(),$e.skip=0,V.updateParamsAndFetch($e,0),we.update()})})}function $(){const x=window.UIUX.FOCUS_PROMPT,d=document.querySelector(`#${x}_prompt textarea`),u=document.querySelector(`#${x}_neg_prompt textarea`),b=N=>N.replace(/\s{2,}/g," ").replace(/(\. )\1+/g,". "),I={};I.prompt=b(". "+d.value),I.negative=b(". "+u.value),I.name="Untitled",I.description="",I.tags="",I.local_preview="",C(I)}document.querySelector("#layout_db_styles button.create-style").addEventListener("click",x=>{$()})}async function Vs(){Ys("output_images","images","outputs/")}const tt={};let K,Ee,Fe,on;async function Ys(e,t,n){on=document.querySelector(`#${e}_cardholder`);const i=document.querySelector(`#${e}_search`),s=document.querySelector(`#${e}_sort`);s.value="date_created";const o=document.querySelector(`#${e}_order`);document.querySelector(`#${e}_sd_version`);const a=document.querySelector(`#${e}_refresh`),c=document.querySelector(`#${e}_rebuild`),r=document.querySelector(`#${e}_clear`),p=document.querySelector("#refresh_output_images_database");tt[`txt2img_${t}`]=[],tt[`img2img_${t}`]=[];const m=100,g="/sd_webui_ux/get_items_from_db",h="GET",T={table_name:t,skip:0,limit:m,sort_by:"date_created",order:"desc",search_term:""},O={title:"name",url:"preview",dataPath:"items"},H={[`#${e}_search`]:"search_term",[`#${e}_sort`]:"sort_by",[`#${e}_search_in`]:"search_columns",[`#${e}_sd_version`]:"sd_version"},P=d=>(d.skip=0,d);K=new A(on,[],18,O,g,T,h),Fe=yt(H,T,K,P),K.setNextCursor=function(d){d&&this.data.length>0?this.params.skip=this.params.cursor=d:delete this.params.cursor};let w="thumbnail";K.createItemElement=function(d,u){return ui(d,w,this.selected,"/sd_image/thumb/")},K.clickHandler=function(d){if(K.dragged||K.scrollDelta)return;const u=d.target.closest(".item.card"),b=u==null?void 0:u.dataset.id;if(b){const I=this.data.find(N=>N.id.toString()===b);I&&v(d.target,I)}d.preventDefault(),d.stopPropagation()},c.addEventListener("click",d=>{Ue("/sd_webui_ux/generate-thumbnails",{table_name:t},function(u){setTimeout(()=>{Fe.skip=0,K.updateParamsAndFetch(Fe,0)},1e3)})}),o.addEventListener("click",d=>{const u=o.classList.contains("active");Fe.skip=0,Fe.order=u?"desc":"asc",K.updateParamsAndFetch(Fe,0)}),r.addEventListener("click",d=>{i.value="",Ge(i)}),o.click(),Ee=new ye(`#${e}_tree_view`,"/sd_webui_ux/get_items_by_path",t,n),Ee.initialize(),Ee.createFileItem=function(d,u){var F;const b=document.createElement("li");b.dataset.name=d[u].name,b.dataset.id=d[u].id,(F=this.selected)!=null&&F.has(d[u].name)&&b.classList.add("active"),b.innerHTML=`<summary class="tree-file">${d[u].name}</summary>`,b.classList.add("li-file");const I=document.createElement("button");I.className="edit-meta edit-button card-button";const N=document.createElement("button");N.className="copy-path copy-path-button card-button";const D=document.createElement("div");return D.className="item-actions",D.appendChild(N),D.appendChild(I),b.appendChild(D),b},Ee.onFolderClicked=function(d,u,b){},Ee.onFileClicked=function(d,u){v(d,u,u.id)},a.addEventListener("click",d=>{p.click(),setTimeout(()=>{Fe.skip=0,K.updateParamsAndFetch(Fe,0),Ee.initialize()},1e3)});function f(d){const u=window.UIUX.FOCUS_PROMPT,b=tt[`${u}_${t}`];setTimeout(()=>{let I="";document.querySelectorAll(`#${u}_prompt textarea, #${u}_neg_prompt textarea`).forEach(F=>{I+=F.value});const N=b.filter(F=>F&&F.value&&I.includes(F.value));tt[`${u}_${t}`]=N;const D=new Set(N.map(F=>F.name));K.selected=Ee.selected=D,K.renderItems(),Ee.updateSelectedItems()},100)}function y(d){const u=window.UIUX.FOCUS_PROMPT;let b="";if(document.querySelectorAll(`#${u}_prompt textarea`).forEach(N=>{b+=`${N.value}`}),b.length>2){let N=function(se){return se.replace(/[()]+|:[0-9]+(.[0-9]+)?/g,"").trim()};var I=N;const ne=b.trim().split(". ").map(N).filter(Boolean).map(se=>". "+se);ne.length>0&&Ue("/sd_webui_ux/search_words_in_tables_columns",{words:ne,tables:t,columns:"prompt",threshold:1},function(oe){const ae=oe[t];console.log(ae);const U=ae.map(Y=>({id:Y.id,name:Y.name,value:Y.prompt}));tt[`${u}_${t}`]=U,K.selected=Ee.selected=new Set(U.map(Y=>Y.name))})}else K.selected=Ee.selected=new Set;K.renderItems(),Ee.updateSelectedItems()}document.querySelectorAll("#txt2img_prompt textarea, #img2img_prompt textarea, #txt2img_neg_prompt textarea, #img2img_neg_prompt textarea").forEach(d=>{d.addEventListener("input",f),d.addEventListener("focus",y)});function v(d,u,b){const I=window.UIUX.FOCUS_PROMPT,N=u.prompt||"",D=u.negative||"";if(d.classList.contains("copy-path"))navigator.clipboard.writeText(u.filename);else if(d.classList.contains("fullsize-button"))K.scrollToId(u.id),K.isFullSize?(w="thumbnail",K.setFullSize(!1),K.setLayout("vertical"),d.classList.remove("active")):(w="local_preview",K.setFullSize(!0),K.setLayout("vertical"),d.classList.add("active"));else if(d.classList.contains("tile-button"))K.setTileable(!K.isTileable);else if(d.classList.contains("info-button"))K.setInfo(!K.isInfo);else if(d.classList.contains("fullScreen-button"))K.scrollToId(u.id),K.setFullScreen(!K.isFullScreen);else if(d.classList.contains("edit-meta"))$(u,u.id);else if(d.classList.contains("delete-button"))C(u,u.id);else if(d.classList.contains("send-params-button")){const F=`/sd_image/thumb/${encodeURIComponent(u.local_preview)}`;it(F,`#pnginfo_send_${I} button`)}else if(u.type==="Image"){if(K.isFullSize)return;window.cardClicked(I,N,D,!0),tt[`${I}_output_images`].push({id:u.id,name:u.name,value:N})}}function C(d,u){const b="/sd_webui_ux/delete_item",I={table_name:t,item_id:d.id};Ue(b,I,function(N){K.removeDataById(d.id),Ee.update()})}function $(d,u){const b="images",I=Ee.subpaths,N=new Set(I.map(z=>z.relativePath)),D=Array.from(N);let F=[{value:"None",textContent:"None"}],ne;D.forEach(z=>{var Q;(Q=d.filename)!=null&&Q.includes(`${z}/`)&&(ne=z),F.push({value:z,textContent:z})});const se={local_preview:{type:"input",id:"local_preview_path",name:"local_preview",label:"Local Preview"},row:{type:"row",draw:"true",id:"parent_folder_select_row",label:"Parent Category / Filename",children:[{parent_folder:{type:"select",id:"parent_folder_select",class:"grow",value:ne,options:F}},{save_path:{type:"input",id:"parent_folder_save",class:"grow",value:d.name,label:"Image Name"}}]},sd_version:{type:"select",name:"sd_version",label:"SD Version",value:d.sd_version,options:mn},prompt:{type:"textarea",name:"prompt",label:"Prompt",rows:4},negative:{type:"textarea",name:"negative",label:"Negative Prompt",rows:2},tags:{type:"textarea",name:"tags",label:"Tags"},description:{type:"textarea",name:"description",label:"Description",rows:2}},me={filename:{type:"filename",label:"Filename"},filesize:{type:"filesize",label:"Filesize"},type:{type:"text",label:"Type"},hash:{type:"text",label:"Hash"},date_created:{type:"date-format",label:"Date Created"},date_modified:{type:"date-format",label:"Date Modified"}},oe={thumbnail:{type:"img",api:"/sd_image/thumb/",showLabel:!1},replace_preview:{type:"button",label:"Replace Preview",showLabel:!1}},ae="/sd_webui_ux/update_user_metadata",U=document.getElementById("formContainer"),Y=new he(ae,b,d,U),J=Y.createForm(se),re=Y.createTable(me),G=Y.createHtmlElement(oe),pe=document.createElement("div");pe.classList.add("non-editable-info","flexbox","padding","shrink"),pe.appendChild(G),pe.appendChild(re),K.showDetail();const be=on.parentElement.querySelector(".ae-virtual-detail-content");be.innerHTML="",be.appendChild(pe),be.appendChild(J);const L=J.querySelector("#parent_folder_select"),_=J.querySelector("#parent_folder_select_row label"),E=J.querySelector("#parent_folder_save"),M=J.querySelector("#local_preview_path input"),B=J.querySelector("button.delete");let ee;const te=z=>z.replace(/\/{2,}/g,"/"),ce=z=>{const Q=L.value!=="None"?L.value:"",le=E.value,Te=`${Q}/${le}`;_.textContent=`Image will be saved: ${te(Te)}.png`,ee=te(`${I[0].basePath}/${Te}.png`),M.value=ee};L.addEventListener("change",ce),E.addEventListener("input",ce),ce();function q(z){const Q=z.lastIndexOf("/"),le=z.substring(0,Q),Te=z.substring(Q+1),qe=Te.lastIndexOf("."),Xe=Te.substring(0,qe);return{path:le,filename:Te,filename_no_ext:Xe}}let Z;Y.beforeFormSubmit=function(z){return z.name=q(ee).filename_no_ext,z.filename=ee,z.type="Image",d.id&&(z.id=d.id),Z&&(z.source_file=Z),z},Y.afterFormSubmit=function(z,Q){K.hideDetail(),K.updateDataById(Q,Q.id),Ee.update()};function de(){const z=window.UIUX.FOCUS_PROMPT,Q=document.querySelector(`#${z}_gallery [data-testid="detailed-image"]`);if(Q){const le=G.querySelector(".thumbnail-image");Z=Q.src.split("file=")[1].split("?")[0],le.style.filter="grayscale(1)"}}G.querySelector("button.replace_preview").addEventListener("click",z=>{de()}),d.id||de(),d.id&&B.addEventListener("click",z=>{const Q="/sd_webui_ux/delete_item",le={table_name:b,item_id:d.id};Ue(Q,le,function(Te){console.log(Te),K.hideDetail(),Fe.skip=0,K.updateParamsAndFetch(Fe,0),Ee.update()})})}function j(){const d=window.UIUX.FOCUS_PROMPT,u=document.querySelector(`#${d}_prompt textarea`),b=document.querySelector(`#${d}_neg_prompt textarea`),I=D=>D.replace(/\s{2,}/g," ").replace(/(\. )\1+/g,". "),N={};N.prompt=I(". "+u.value),N.negative=I(". "+b.value),N.name="Untitled",N.description="",N.tags="",N.local_preview="",$(N)}document.querySelector("#layout_db_output_images button.create-style").addEventListener("click",d=>{j()})}function Zs(e){const t=document.querySelector("#logger_screen");t&&(document.querySelector("#container-console-log").append(getLoggerUiUx()),t.remove()),console.log("Finishing optimizations for Extra Networks"),rs(),as(),ss(),os(),document.querySelectorAll("#txt2img_styles_edit_button, #img2img_styles_edit_button").forEach(a=>{a.addEventListener("click",function(c){window.popup_trigger.click()})});function n(a){kn.FOCUS_PROMPT=a.includes("txt2img")?"txt2img":"img2img"}if(document.querySelectorAll("#txt2img_prompt textarea, #img2img_prompt textarea, #txt2img_neg_prompt textarea, #img2img_neg_prompt textarea").forEach(a=>{a.addEventListener("focus",c=>{const r=c.target.closest(".gradio-textbox").id;n(r)})}),document.querySelectorAll("#about_tabitem img").forEach(a=>{const c=a.getAttribute("data-src");c&&(a.src=c.replace("file=extensions/sd-webui-ux/assets/",`${Rt}`))}),window.UIUX=kn,$t.setItem("UiUxComplete","true"),window.opts.uiux_enable_theme_editor&&us(),window.opts.uiux_enable_civitai_explorer){document.querySelector("#civitai_explorer_nav").classList.remove("hidden");const c=document.querySelector("#civitai_nav_images"),r=document.querySelector("#civitai_nav_models");c.addEventListener("click",()=>{zs()},{once:!0}),r.addEventListener("click",()=>{Fs()},{once:!0})}const i=document.querySelector("#textual_inversion_nav"),s=document.querySelector("#lora_nav"),o=document.querySelector("#hypernetwork_nav");if(setTimeout(()=>{Us()},500),i.addEventListener("click",()=>{qs()},{once:!0}),s.addEventListener("click",()=>{Hs()},{once:!0}),o.addEventListener("click",()=>{Bs()},{once:!0}),window.opts.uiux_enable_sd_styles){const a=document.querySelector("#sd_styles_nav");a.classList.remove("hidden"),a.addEventListener("click",()=>{Gs()},{once:!0})}if(window.opts.uiux_enable_sd_output_images){const a=document.querySelector("#sd_output_images_nav");a.classList.remove("hidden"),a.addEventListener("click",()=>{Vs()},{once:!0})}}async function Ks(){const e=st(),t=Ye();await Si(),t.insertAdjacentElement("afterbegin",e);const n=Xi((i,s)=>{i==="UiUxReady"&&s==="true"&&(Zs(),n())},"UiUxReady");(async()=>await ni(e))(),zi(),setTimeout(()=>{wi("#infinite_image_browsing_container_wrapper iframe",["user.css","uiux-iibrowser.css"])},3e3)}async function Js(){try{Oi(),console.log("Starting DOM Optimizations"),es(),Qi(),console.log("Finishing DOM Optimizations"),Ei(Pi),We.gradio_major>3&&xi("style.css","style-gradio-4.css",document.body),(async()=>(await Di(),await Ks()))()}catch(e){console.error("Error in run sequence:",e)}}function Qs(){if(localStorage.setItem("UiUxReady","false"),localStorage.setItem("UiUxComplete","false"),!document.getElementById("logger_screen")){const n=document.createElement("div");n.id="logger_screen",n.style="position: fixed; inset: 0; background-color: black; z-index: 99999; display: flex; flex-direction: column; overflow:auto;";const i=document.createElement("div");i.id="loggerUiUx",n.append(i),document.body.append(n)}const e=new MutationObserver(async()=>{if(Kn()&&window.opts&&Object.keys(window.opts).length){e.disconnect();try{await Js()}catch(i){console.error("Error running the function:",i)}}}),t=Ye();t?e.observe(t,{childList:!0,subtree:!0}):console.error("getGradioApp() did not return a valid target for observation")}Qs();
